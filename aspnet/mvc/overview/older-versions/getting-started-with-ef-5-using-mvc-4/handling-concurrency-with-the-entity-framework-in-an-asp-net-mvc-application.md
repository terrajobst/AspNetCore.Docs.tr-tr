---
uid: mvc/overview/older-versions/getting-started-with-ef-5-using-mvc-4/handling-concurrency-with-the-entity-framework-in-an-asp-net-mvc-application
title: Bir ASP.NET MVC uygulamasındaki (10 7) Entity Framework eşzamanlılık işleme | Microsoft Docs
author: tdykstra
description: Contoso University örnek web uygulaması Entity Framework 5 Code First ve Visual Studio kullanarak ASP.NET MVC 4 uygulamaları oluşturmak nasıl gösteren...
ms.author: aspnetcontent
manager: wpickett
ms.date: 07/30/2013
ms.topic: article
ms.assetid: b83f47c4-8521-4d0a-8644-e8f77e39733e
ms.technology: dotnet-mvc
ms.prod: .net-framework
msc.legacyurl: /mvc/overview/older-versions/getting-started-with-ef-5-using-mvc-4/handling-concurrency-with-the-entity-framework-in-an-asp-net-mvc-application
msc.type: authoredcontent
ms.openlocfilehash: 609f493845f1d00a47d175a1b623a7f4866d191e
ms.sourcegitcommit: f8852267f463b62d7f975e56bea9aa3f68fbbdeb
ms.translationtype: MT
ms.contentlocale: tr-TR
ms.lasthandoff: 04/06/2018
ms.locfileid: "30877742"
---
<a name="handling-concurrency-with-the-entity-framework-in-an-aspnet-mvc-application-7-of-10"></a><span data-ttu-id="6cc87-103">Bir ASP.NET MVC uygulamasındaki (10 7) Entity Framework eşzamanlılık işleme</span><span class="sxs-lookup"><span data-stu-id="6cc87-103">Handling Concurrency with the Entity Framework in an ASP.NET MVC Application (7 of 10)</span></span>
====================
<span data-ttu-id="6cc87-104">by [Tom Dykstra](https://github.com/tdykstra)</span><span class="sxs-lookup"><span data-stu-id="6cc87-104">by [Tom Dykstra](https://github.com/tdykstra)</span></span>

[<span data-ttu-id="6cc87-105">Tamamlanan projenizi indirin</span><span class="sxs-lookup"><span data-stu-id="6cc87-105">Download Completed Project</span></span>](http://code.msdn.microsoft.com/Getting-Started-with-dd0e2ed8)

> <span data-ttu-id="6cc87-106">Contoso University örnek web uygulaması Entity Framework 5 Code First ve Visual Studio 2012 kullanarak ASP.NET MVC 4 uygulamalarının nasıl oluşturulacağını gösterir.</span><span class="sxs-lookup"><span data-stu-id="6cc87-106">The Contoso University sample web application demonstrates how to create ASP.NET MVC 4 applications using the Entity Framework 5 Code First and Visual Studio 2012.</span></span> <span data-ttu-id="6cc87-107">Eğitmen serisi hakkında daha fazla bilgi için bkz: [serideki ilk öğreticide](creating-an-entity-framework-data-model-for-an-asp-net-mvc-application.md).</span><span class="sxs-lookup"><span data-stu-id="6cc87-107">For information about the tutorial series, see [the first tutorial in the series](creating-an-entity-framework-data-model-for-an-asp-net-mvc-application.md).</span></span> <span data-ttu-id="6cc87-108">Eğitmen serisi baştan başlayabilirsiniz veya [Bu bölüm için bir başlangıç projesi indirme](building-the-ef5-mvc4-chapter-downloads.md) ve buradan başlayın.</span><span class="sxs-lookup"><span data-stu-id="6cc87-108">You can start the tutorial series from the beginning or [download a starter project for this chapter](building-the-ef5-mvc4-chapter-downloads.md) and start here.</span></span>
> 
> > [!NOTE] 
> > 
> > <span data-ttu-id="6cc87-109">Olamaz gidermek, bir sorunla çalıştırırsanız [tamamlanmış bölüm karşıdan](building-the-ef5-mvc4-chapter-downloads.md) ve sorunu yeniden deneyin.</span><span class="sxs-lookup"><span data-stu-id="6cc87-109">If you run into a problem you can't resolve, [download the completed chapter](building-the-ef5-mvc4-chapter-downloads.md) and try to reproduce your problem.</span></span> <span data-ttu-id="6cc87-110">Tamamlanan kodu kodunuzu karşılaştırarak genellikle soruna çözüm bulabilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="6cc87-110">You can generally find the solution to the problem by comparing your code to the completed code.</span></span> <span data-ttu-id="6cc87-111">Bazı yaygın hatalar ve bunları çözmek nasıl için bkz: [hatalarını ve geçici çözümler.](advanced-entity-framework-scenarios-for-an-mvc-web-application.md#errors)</span><span class="sxs-lookup"><span data-stu-id="6cc87-111">For some common errors and how to solve them, see [Errors and Workarounds.](advanced-entity-framework-scenarios-for-an-mvc-web-application.md#errors)</span></span>


<span data-ttu-id="6cc87-112">Önceki iki eğitimlerine ilgili verilerle çalışmıştır.</span><span class="sxs-lookup"><span data-stu-id="6cc87-112">In the previous two tutorials you worked with related data.</span></span> <span data-ttu-id="6cc87-113">Bu öğretici eşzamanlılık nasıl ele alınacağını gösterir.</span><span class="sxs-lookup"><span data-stu-id="6cc87-113">This tutorial shows how to handle concurrency.</span></span> <span data-ttu-id="6cc87-114">Çalışmak web sayfaları oluşturacaksınız `Department` varlık ve düzenleme ve silme sayfaları `Department` varlıklar eşzamanlılık hataları işleyecek.</span><span class="sxs-lookup"><span data-stu-id="6cc87-114">You'll create web pages that work with the `Department` entity, and the pages that edit and delete `Department` entities will handle concurrency errors.</span></span> <span data-ttu-id="6cc87-115">Aşağıdaki çizimler bir eşzamanlılık çakışması olursa, görüntülenen bazı iletiler de dahil olmak üzere dizin ve Delete sayfalarında gösterilir.</span><span class="sxs-lookup"><span data-stu-id="6cc87-115">The following illustrations show the Index and Delete pages, including some messages that are displayed if a concurrency conflict occurs.</span></span>

![Department_Index_page_before_edits](handling-concurrency-with-the-entity-framework-in-an-asp-net-mvc-application/_static/image1.png)

![Department_Edit_page_2_after_clicking_Save](handling-concurrency-with-the-entity-framework-in-an-asp-net-mvc-application/_static/image2.png)

## <a name="concurrency-conflicts"></a><span data-ttu-id="6cc87-118">Eşzamanlılık çakışmaları</span><span class="sxs-lookup"><span data-stu-id="6cc87-118">Concurrency Conflicts</span></span>

<span data-ttu-id="6cc87-119">Bir eşzamanlılık çakışması düzenlemek için bir kullanıcı bir varlığın verileri görüntüler ve ilk kullanıcının değişiklik veritabanına yazılmadan önce başka bir kullanıcı aynı varlığın veri güncelleştirmeleri oluşur.</span><span class="sxs-lookup"><span data-stu-id="6cc87-119">A concurrency conflict occurs when one user displays an entity's data in order to edit it, and then another user updates the same entity's data before the first user's change is written to the database.</span></span> <span data-ttu-id="6cc87-120">Bu gibi çakışmaları algılama etkinleştirmezseniz aktaranın veritabanını güncelleştiren son diğer kullanıcının değişiklikleri geçersiz kılar.</span><span class="sxs-lookup"><span data-stu-id="6cc87-120">If you don't enable the detection of such conflicts, whoever updates the database last overwrites the other user's changes.</span></span> <span data-ttu-id="6cc87-121">Birçok uygulamada, bu riski kabul edilebilir: birkaç kullanıcı ya da birkaç güncelleştirmeleri varsa veya bazı değişiklikleri üzerine yazılmışsa eşzamanlılık programlama maliyetini ağır avantajı gerçekten önemli değildir.</span><span class="sxs-lookup"><span data-stu-id="6cc87-121">In many applications, this risk is acceptable: if there are few users, or few updates, or if isn't really critical if some changes are overwritten, the cost of programming for concurrency might outweigh the benefit.</span></span> <span data-ttu-id="6cc87-122">Bu durumda, eşzamanlılık çakışmalarına için uygulamayı yapılandırma gerekmez.</span><span class="sxs-lookup"><span data-stu-id="6cc87-122">In that case, you don't have to configure the application to handle concurrency conflicts.</span></span>

### <a name="pessimistic-concurrency-locking"></a><span data-ttu-id="6cc87-123">Eşzamanlılık (kilitleme)</span><span class="sxs-lookup"><span data-stu-id="6cc87-123">Pessimistic Concurrency (Locking)</span></span>

<span data-ttu-id="6cc87-124">Uygulamanızı eşzamanlılık senaryolarda yanlışlıkla veri kaybını önlemek gerekiyorsa, bunu yapmanın bir yolu veritabanı kilitleri kullanmaktır.</span><span class="sxs-lookup"><span data-stu-id="6cc87-124">If your application does need to prevent accidental data loss in concurrency scenarios, one way to do that is to use database locks.</span></span> <span data-ttu-id="6cc87-125">Bu adlı *eşzamanlılık*.</span><span class="sxs-lookup"><span data-stu-id="6cc87-125">This is called *pessimistic concurrency*.</span></span> <span data-ttu-id="6cc87-126">Örneğin, bir veritabanından bir satır okumadan önce için bir kilit isteği salt okunur veya güncelleştirme erişim.</span><span class="sxs-lookup"><span data-stu-id="6cc87-126">For example, before you read a row from a database, you request a lock for read-only or for update access.</span></span> <span data-ttu-id="6cc87-127">Güncelleştirme erişim için bir satır kilitlemek, başka hiçbir kullanıcı için ya da satır kilitlemek için izin verilir salt okunur veya değiştirilen sürecinde olan verilerin bir kopyasını elde edecekleri çünkü erişimi güncelleştirin.</span><span class="sxs-lookup"><span data-stu-id="6cc87-127">If you lock a row for update access, no other users are allowed to lock the row either for read-only or update access, because they would get a copy of data that's in the process of being changed.</span></span> <span data-ttu-id="6cc87-128">Salt okunur erişim için bir satır kilitlemek, diğerleri de salt okunur erişim için kullanılabilir ancak güncelleştirme kilitleyebilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="6cc87-128">If you lock a row for read-only access, others can also lock it for read-only access but not for update.</span></span>

<span data-ttu-id="6cc87-129">Kilitleri yönetmek dezavantajları vardır.</span><span class="sxs-lookup"><span data-stu-id="6cc87-129">Managing locks has disadvantages.</span></span> <span data-ttu-id="6cc87-130">Programa karmaşık olabilir.</span><span class="sxs-lookup"><span data-stu-id="6cc87-130">It can be complex to program.</span></span> <span data-ttu-id="6cc87-131">Önemli Veritabanı Yönetimi kaynaklarını gerektirir ve bu kullanıcı bir uygulamanın sayısı olarak performans sorunlarına neden olabilir artırır (diğer bir deyişle, onu iyi ölçeklendirilmediğini).</span><span class="sxs-lookup"><span data-stu-id="6cc87-131">It requires significant database management resources, and it can cause performance problems as the number of users of an application increases (that is, it doesn't scale well).</span></span> <span data-ttu-id="6cc87-132">Bu nedenlerle, tüm veritabanı yönetim sistemleri eşzamanlılık destekler.</span><span class="sxs-lookup"><span data-stu-id="6cc87-132">For these reasons, not all database management systems support pessimistic concurrency.</span></span> <span data-ttu-id="6cc87-133">Entity Framework yerleşik hiçbir desteği sağlar ve bu öğreticiyi uyguladıktan nasıl göstermez.</span><span class="sxs-lookup"><span data-stu-id="6cc87-133">The Entity Framework provides no built-in support for it, and this tutorial doesn't show you how to implement it.</span></span>

### <a name="optimistic-concurrency"></a><span data-ttu-id="6cc87-134">İyimser eşzamanlılık</span><span class="sxs-lookup"><span data-stu-id="6cc87-134">Optimistic Concurrency</span></span>

<span data-ttu-id="6cc87-135">Eşzamanlılık için alternatif *iyimser eşzamanlılık*.</span><span class="sxs-lookup"><span data-stu-id="6cc87-135">The alternative to pessimistic concurrency is *optimistic concurrency*.</span></span> <span data-ttu-id="6cc87-136">İyimser eşzamanlılık gerçekleşecek şekilde eşzamanlılık çakışması izin vererek ve içermiyorlarsa uygun şekilde tepki anlamına gelir.</span><span class="sxs-lookup"><span data-stu-id="6cc87-136">Optimistic concurrency means allowing concurrency conflicts to happen, and then reacting appropriately if they do.</span></span> <span data-ttu-id="6cc87-137">Örneğin, John Departmanlar düzenleme sayfasında, değişiklikleri çalıştıran **bütçe** $350,000.00 $0,00 İngilizce departmanına tutar.</span><span class="sxs-lookup"><span data-stu-id="6cc87-137">For example, John runs the Departments Edit page, changes the **Budget** amount for the English department from $350,000.00 to $0.00.</span></span>

![Changing_English_dept_budget_to_100000](handling-concurrency-with-the-entity-framework-in-an-asp-net-mvc-application/_static/image3.png)

<span data-ttu-id="6cc87-139">John tıklar önce **kaydetmek**, Jane çalıştıran aynı sayfa ve değişiklikleri **başlangıç tarihi** alanı 1/9/2007'den 8/8/2013.</span><span class="sxs-lookup"><span data-stu-id="6cc87-139">Before John clicks **Save**, Jane runs the same page and changes the **Start Date** field from 9/1/2007 to 8/8/2013.</span></span>

![Changing_English_dept_start_date_to_1999](handling-concurrency-with-the-entity-framework-in-an-asp-net-mvc-application/_static/image4.png)

<span data-ttu-id="6cc87-141">John tıklar **kaydetmek** ilk ve tarayıcı sonra Jane dizin sayfasına geri döndüğünde, değişiklik tıklar görür **kaydetmek**.</span><span class="sxs-lookup"><span data-stu-id="6cc87-141">John clicks **Save** first and sees his change when the browser returns to the Index page, then Jane clicks **Save**.</span></span> <span data-ttu-id="6cc87-142">Ne olacağını eşzamanlılık çakışmaları nasıl işleneceğini tarafından belirlenir.</span><span class="sxs-lookup"><span data-stu-id="6cc87-142">What happens next is determined by how you handle concurrency conflicts.</span></span> <span data-ttu-id="6cc87-143">Bazı seçenekleri şunlardır:</span><span class="sxs-lookup"><span data-stu-id="6cc87-143">Some of the options include the following:</span></span>

- <span data-ttu-id="6cc87-144">Bir kullanıcı değiştirdi hangi özelliğinin izlemek ve yalnızca karşılık gelen sütunlara veritabanındaki güncelleştirin.</span><span class="sxs-lookup"><span data-stu-id="6cc87-144">You can keep track of which property a user has modified and update only the corresponding columns in the database.</span></span> <span data-ttu-id="6cc87-145">Farklı özellikler iki kullanıcı tarafından güncelleştirildi olduğundan örnek senaryoda, hiçbir veri kaybı, olacaktır.</span><span class="sxs-lookup"><span data-stu-id="6cc87-145">In the example scenario, no data would be lost, because different properties were updated by the two users.</span></span> <span data-ttu-id="6cc87-146">Sonraki birisi İngilizce departmanı gözatar, Can'ın ve Jane'nın değişiklikleri görürsünüz — bir 8/8/2013 başlangıç tarihini ve bütçe sıfır Doları bir.</span><span class="sxs-lookup"><span data-stu-id="6cc87-146">The next time someone browses the English department, they'll see both John's and Jane's changes — a start date of 8/8/2013 and a budget of Zero dollars.</span></span>

    <span data-ttu-id="6cc87-147">Güncelleştirme bu yöntem veri kaybına sebep çakışmaları sayısını azaltır, ancak bir varlık aynı özelliğe rakip bir değişiklik yaptıysanız, veri kaybını önlemek olamaz.</span><span class="sxs-lookup"><span data-stu-id="6cc87-147">This method of updating can reduce the number of conflicts that could result in data loss, but it can't avoid data loss if competing changes are made to the same property of an entity.</span></span> <span data-ttu-id="6cc87-148">Entity Framework bu şekilde çalışıp çalışmadığını güncelleştirme kodunuzu nasıl uygulayacağınıza bağlıdır.</span><span class="sxs-lookup"><span data-stu-id="6cc87-148">Whether the Entity Framework works this way depends on how you implement your update code.</span></span> <span data-ttu-id="6cc87-149">Bir varlık için tüm özgün özellik değerlerini yanı sıra yeni değerleri izlemek için büyük miktarlarda durumu bakımını gerektirebilir bir web uygulamasında pratik değildir, çünkü genellikle.</span><span class="sxs-lookup"><span data-stu-id="6cc87-149">It's often not practical in a web application, because it can require that you maintain large amounts of state in order to keep track of all original property values for an entity as well as new values.</span></span> <span data-ttu-id="6cc87-150">Sunucu kaynaklarını gerektirir ya da web sayfasındaki kendisini (örneğin, gizli alanlar) dahil gerekir çünkü durumu büyük miktarlarda koruma uygulama performansını etkileyebilir.</span><span class="sxs-lookup"><span data-stu-id="6cc87-150">Maintaining large amounts of state can affect application performance because it either requires server resources or must be included in the web page itself (for example, in hidden fields).</span></span>
- <span data-ttu-id="6cc87-151">Jane'nın değişiklik Can'ın değişiklik üzerine izin verebilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="6cc87-151">You can let Jane's change overwrite John's change.</span></span> <span data-ttu-id="6cc87-152">Sonraki birisi İngilizce departmanı gözatar, 8/8/2013 görürsünüz ve geri yüklenen $350,000.00 değeri.</span><span class="sxs-lookup"><span data-stu-id="6cc87-152">The next time someone browses the English department, they'll see 8/8/2013 and the restored $350,000.00 value.</span></span> <span data-ttu-id="6cc87-153">Bu adlı bir *istemci WINS* veya *WINS'de son* senaryo.</span><span class="sxs-lookup"><span data-stu-id="6cc87-153">This is called a *Client Wins* or *Last in Wins* scenario.</span></span> <span data-ttu-id="6cc87-154">(İstemcinin değerleri veri deposunda nedir üzerinden önceliklidir.) Bu bölüm için giriş hiçbir eşzamanlılık işleme için kodlama yapmazsanız belirtildiği gibi bu otomatik olarak gerçekleşir.</span><span class="sxs-lookup"><span data-stu-id="6cc87-154">(The client's values take precedence over what's in the data store.) As noted in the introduction to this section, if you don't do any coding for concurrency handling, this will happen automatically.</span></span>
- <span data-ttu-id="6cc87-155">Veritabanında güncelleştirilen Jane'nın değişiklik engelleyebilir.</span><span class="sxs-lookup"><span data-stu-id="6cc87-155">You can prevent Jane's change from being updated in the database.</span></span> <span data-ttu-id="6cc87-156">Genellikle, bir hata iletisi görüntüler her verilerin geçerli durumunu gösterir ve her aynen bunları olmak istiyorsa, kendi değişiklikleri uygulamak izin.</span><span class="sxs-lookup"><span data-stu-id="6cc87-156">Typically, you would display an error message, show her the current state of the data, and allow her to reapply her changes if she still wants to make them.</span></span> <span data-ttu-id="6cc87-157">Bu adlı bir *deposu WINS* senaryo.</span><span class="sxs-lookup"><span data-stu-id="6cc87-157">This is called a *Store Wins* scenario.</span></span> <span data-ttu-id="6cc87-158">(Veri deposu değerlerini istemci tarafından gönderilen değerler önceliklidir.) Bu öğreticide deposu WINS senaryo uygulama.</span><span class="sxs-lookup"><span data-stu-id="6cc87-158">(The data-store values take precedence over the values submitted by the client.) You'll implement the Store Wins scenario in this tutorial.</span></span> <span data-ttu-id="6cc87-159">Bu yöntem, hiçbir değişiklik olanlar için uyarı bir kullanıcı olmaksızın üzerine yazılır sağlar.</span><span class="sxs-lookup"><span data-stu-id="6cc87-159">This method ensures that no changes are overwritten without a user being alerted to what's happening.</span></span>

### <a name="detecting-concurrency-conflicts"></a><span data-ttu-id="6cc87-160">Eşzamanlılık çakışmalarını algılama</span><span class="sxs-lookup"><span data-stu-id="6cc87-160">Detecting Concurrency Conflicts</span></span>

<span data-ttu-id="6cc87-161">İşleyerek çakışmalarını çözme [OptimisticConcurrencyException](https://msdn.microsoft.com/library/system.data.optimisticconcurrencyexception.aspx) Entity Framework oluşturur özel durumları.</span><span class="sxs-lookup"><span data-stu-id="6cc87-161">You can resolve conflicts by handling [OptimisticConcurrencyException](https://msdn.microsoft.com/library/system.data.optimisticconcurrencyexception.aspx) exceptions that the Entity Framework throws.</span></span> <span data-ttu-id="6cc87-162">Bu özel durumlar oluşturma zamanı bilmek için Entity Framework çakışmaları algılayabilir olması gerekir.</span><span class="sxs-lookup"><span data-stu-id="6cc87-162">In order to know when to throw these exceptions, the Entity Framework must be able to detect conflicts.</span></span> <span data-ttu-id="6cc87-163">Bu nedenle, veritabanı ve veri modelinin uygun şekilde yapılandırmanız gerekir.</span><span class="sxs-lookup"><span data-stu-id="6cc87-163">Therefore, you must configure the database and the data model appropriately.</span></span> <span data-ttu-id="6cc87-164">Çakışma algılamasını etkinleştirmek için bazı seçenekler aşağıdakileri içerir:</span><span class="sxs-lookup"><span data-stu-id="6cc87-164">Some options for enabling conflict detection include the following:</span></span>

- <span data-ttu-id="6cc87-165">Veritabanı tablosunda bir satırı değiştiğinde belirlemek için kullanılan bir izleme sütun içerir.</span><span class="sxs-lookup"><span data-stu-id="6cc87-165">In the database table, include a tracking column that can be used to determine when a row has been changed.</span></span> <span data-ttu-id="6cc87-166">Daha sonra bu sütununu dahil etmek için Entity Framework yapılandırabilirsiniz `Where` yan tümcesi SQL `Update` veya `Delete` komutları.</span><span class="sxs-lookup"><span data-stu-id="6cc87-166">You can then configure the Entity Framework to include that column in the `Where` clause of SQL `Update` or `Delete` commands.</span></span>

    <span data-ttu-id="6cc87-167">İzleme sütunun veri türünü genellikle [rowversion](https://msdn.microsoft.com/library/ms182776(v=sql.110).aspx).</span><span class="sxs-lookup"><span data-stu-id="6cc87-167">The data type of the tracking column is typically [rowversion](https://msdn.microsoft.com/library/ms182776(v=sql.110).aspx).</span></span> <span data-ttu-id="6cc87-168">[Rowversion](https://msdn.microsoft.com/library/ms182776(v=sql.110).aspx) değerdir satır güncelleştirilir her zaman artar sıralı bir sayı.</span><span class="sxs-lookup"><span data-stu-id="6cc87-168">The [rowversion](https://msdn.microsoft.com/library/ms182776(v=sql.110).aspx) value is a sequential number that's incremented each time the row is updated.</span></span> <span data-ttu-id="6cc87-169">İçinde bir `Update` veya `Delete` komutu `Where` yan tümcesi izleme sütunu (özgün satır sürümü) özgün değeri içerir.</span><span class="sxs-lookup"><span data-stu-id="6cc87-169">In an `Update` or `Delete` command, the `Where` clause includes the original value of the tracking column (the original row version).</span></span> <span data-ttu-id="6cc87-170">Güncelleştirilen satır başka bir kullanıcı tarafından değeri değiştirildiğinde, `rowversion` sütundur özgün değerinden farklı şekilde `Update` veya `Delete` deyimi nedeniyle güncelleştirilecek satır bulamıyor `Where` yan tümcesi.</span><span class="sxs-lookup"><span data-stu-id="6cc87-170">If the row being updated has been changed by another user, the value in the `rowversion` column is different than the original value, so the `Update` or `Delete` statement can't find the row to update because of the `Where` clause.</span></span> <span data-ttu-id="6cc87-171">Entity Framework bulduğunda tarafından hiçbir satırın güncelleştirilmediği `Update` veya `Delete` komutunu (diğer bir deyişle, etkilenen satırların sayısı sıfır olduğunda), bir eşzamanlılık çakışması yorumlar.</span><span class="sxs-lookup"><span data-stu-id="6cc87-171">When the Entity Framework finds that no rows have been updated by the `Update` or `Delete` command (that is, when the number of affected rows is zero), it interprets that as a concurrency conflict.</span></span>
- <span data-ttu-id="6cc87-172">Tablodaki her sütunun özgün değerler eklemek için Entity Framework yapılandırma `Where` yan tümcesi `Update` ve `Delete` komutları.</span><span class="sxs-lookup"><span data-stu-id="6cc87-172">Configure the Entity Framework to include the original values of every column in the table in the `Where` clause of `Update` and `Delete` commands.</span></span>

    <span data-ttu-id="6cc87-173">İlk seçenek satırın ilk okunuşundan bu yana, sıradaki herhangi bir şey değiştiyse, olduğu gibi `Where` yan tümcesi güncelleştirmek için bir satır dönüş kalmaz, Entity Framework bir eşzamanlılık çakışması yorumlar.</span><span class="sxs-lookup"><span data-stu-id="6cc87-173">As in the first option, if anything in the row has changed since the row was first read, the `Where` clause won't return a row to update, which the Entity Framework interprets as a concurrency conflict.</span></span> <span data-ttu-id="6cc87-174">Çok sayıda sütuna sahip veritabanı tabloları için bu yaklaşım çok büyük sonuçlanabilir `Where` yan tümceleri ve büyük miktarlarda durumu bakımını gerektirebilir.</span><span class="sxs-lookup"><span data-stu-id="6cc87-174">For database tables that have many columns, this approach can result in very large `Where` clauses, and can require that you maintain large amounts of state.</span></span> <span data-ttu-id="6cc87-175">Sunucu kaynaklarını gerektirir ya da web sayfasının kendisi dahil gerekir çünkü daha önce belirtildiği gibi büyük miktarlarda durumu koruma uygulama performansını etkileyebilir.</span><span class="sxs-lookup"><span data-stu-id="6cc87-175">As noted earlier, maintaining large amounts of state can affect application performance because it either requires server resources or must be included in the web page itself.</span></span> <span data-ttu-id="6cc87-176">Bu nedenle bu yaklaşım genellikle önerilmez ve Bu öğreticide kullanılan yöntem değil.</span><span class="sxs-lookup"><span data-stu-id="6cc87-176">Therefore this approach generally not recommended, and it isn't the method used in this tutorial.</span></span>

    <span data-ttu-id="6cc87-177">Eşzamanlılık bu yaklaşımı uygulamak istiyorsanız, tüm birincil anahtar özellikleri'nde ekleyerek eşzamanlılık için izlemek istediğiniz varlık işaretleyin zorunda [ConcurrencyCheck](https://msdn.microsoft.com/library/system.componentmodel.dataannotations.concurrencycheckattribute.aspx) onlara özniteliği.</span><span class="sxs-lookup"><span data-stu-id="6cc87-177">If you do want to implement this approach to concurrency, you have to mark all non-primary-key properties in the entity you want to track concurrency for by adding the [ConcurrencyCheck](https://msdn.microsoft.com/library/system.componentmodel.dataannotations.concurrencycheckattribute.aspx) attribute to them.</span></span> <span data-ttu-id="6cc87-178">Değişiklik SQL'de tüm sütunları içerecek şekilde Entity Framework sağlar `WHERE` yan tümcesi `UPDATE` deyimleri.</span><span class="sxs-lookup"><span data-stu-id="6cc87-178">That change enables the Entity Framework to include all columns in the SQL `WHERE` clause of `UPDATE` statements.</span></span>

<span data-ttu-id="6cc87-179">Bu öğreticinin geri kalanında, ekleyeceksiniz bir [rowversion](https://msdn.microsoft.com/library/ms182776(v=sql.110).aspx) özelliğine izleme `Department` varlık, bir denetleyici ve görünümler oluşturma ve her şeyin doğru şekilde çalıştığını doğrulamak için test edin.</span><span class="sxs-lookup"><span data-stu-id="6cc87-179">In the remainder of this tutorial you'll add a [rowversion](https://msdn.microsoft.com/library/ms182776(v=sql.110).aspx) tracking property to the `Department` entity, create a controller and views, and test to verify that everything works correctly.</span></span>

## <a name="add-an-optimistic-concurrency-property-to-the-department-entity"></a><span data-ttu-id="6cc87-180">Departman varlığa bir iyimser eşzamanlılık özellik ekleme</span><span class="sxs-lookup"><span data-stu-id="6cc87-180">Add an Optimistic Concurrency Property to the Department Entity</span></span>

<span data-ttu-id="6cc87-181">İçinde *Models\Department.cs*, adlı izleme özellik ekleme `RowVersion`:</span><span class="sxs-lookup"><span data-stu-id="6cc87-181">In *Models\Department.cs*, add a tracking property named `RowVersion`:</span></span>

[!code-csharp[Main](handling-concurrency-with-the-entity-framework-in-an-asp-net-mvc-application/samples/sample1.cs?highlight=18-19)]

<span data-ttu-id="6cc87-182">[Zaman damgası](https://msdn.microsoft.com/library/system.componentmodel.dataannotations.timestampattribute.aspx) özniteliği belirtir. Bu sütun olarak eklenecek `Where` yan tümcesi `Update` ve `Delete` veritabanına gönderilen komutları.</span><span class="sxs-lookup"><span data-stu-id="6cc87-182">The [Timestamp](https://msdn.microsoft.com/library/system.componentmodel.dataannotations.timestampattribute.aspx) attribute specifies that this column will be included in the `Where` clause of `Update` and `Delete` commands sent to the database.</span></span> <span data-ttu-id="6cc87-183">Öznitelik adı verilen [zaman damgası](https://msdn.microsoft.com/library/system.componentmodel.dataannotations.timestampattribute.aspx) bir SQL SQL Server'ın önceki sürümlerinde kullanılan çünkü [zaman damgası](https://msdn.microsoft.com/library/ms182776(v=SQL.90).aspx) önce SQL veri türü [rowversion](https://msdn.microsoft.com/library/ms182776(v=sql.110).aspx) yerine.</span><span class="sxs-lookup"><span data-stu-id="6cc87-183">The attribute is called [Timestamp](https://msdn.microsoft.com/library/system.componentmodel.dataannotations.timestampattribute.aspx) because previous versions of SQL Server used a SQL [timestamp](https://msdn.microsoft.com/library/ms182776(v=SQL.90).aspx) data type before the SQL [rowversion](https://msdn.microsoft.com/library/ms182776(v=sql.110).aspx) replaced it.</span></span> <span data-ttu-id="6cc87-184">.Net türü için `rowversion` bir bayt dizisi.</span><span class="sxs-lookup"><span data-stu-id="6cc87-184">The .Net type for `rowversion` is a byte array.</span></span> <span data-ttu-id="6cc87-185">Fluent API kullanmayı tercih ederseniz kullanabilirsiniz [IsConcurrencyToken](https://msdn.microsoft.com/library/gg679501(v=VS.103).aspx) yöntemi izleme özelliği aşağıdaki örnekte gösterildiği gibi belirtin:</span><span class="sxs-lookup"><span data-stu-id="6cc87-185">If you prefer to use the fluent API, you can use the [IsConcurrencyToken](https://msdn.microsoft.com/library/gg679501(v=VS.103).aspx) method to specify the tracking property, as shown in the following example:</span></span>

[!code-csharp[Main](handling-concurrency-with-the-entity-framework-in-an-asp-net-mvc-application/samples/sample2.cs)]

<span data-ttu-id="6cc87-186">Başka bir geçiş gerçekleştirmeniz gereken şekilde bir özelliği ekleyerek veritabanı modeli değişti.</span><span class="sxs-lookup"><span data-stu-id="6cc87-186">By adding a property you changed the database model, so you need to do another migration.</span></span> <span data-ttu-id="6cc87-187">Paket Yöneticisi Konsolu (PMC)'da, aşağıdaki komutları girin:</span><span class="sxs-lookup"><span data-stu-id="6cc87-187">In the Package Manager Console (PMC), enter the following commands:</span></span>

[!code-console[Main](handling-concurrency-with-the-entity-framework-in-an-asp-net-mvc-application/samples/sample3.cmd)]

## <a name="create-a-department-controller"></a><span data-ttu-id="6cc87-188">Bir bölüm denetleyicisi oluşturun</span><span class="sxs-lookup"><span data-stu-id="6cc87-188">Create a Department Controller</span></span>

<span data-ttu-id="6cc87-189">Oluşturma bir `Department` denetleyici ve görünüm aşağıdaki ayarları kullanarak diğer denetleyicileri yaptığınız gibi:</span><span class="sxs-lookup"><span data-stu-id="6cc87-189">Create a `Department` controller and views the same way you did the other controllers, using the following settings:</span></span>

![Add_Controller_dialog_box_for_Department_controller](https://asp.net/media/2578041/Windows-Live-Writer_Handling-C.NET-MVC-Application-7-of-10h1_AFDC_Add_Controller_dialog_box_for_Department_controller_d1d9c788-f970-4d6a-9f5a-1eddc84330b7.png)

<span data-ttu-id="6cc87-191">İçinde *Controllers\DepartmentController.cs*, ekleme bir `using` deyimi:</span><span class="sxs-lookup"><span data-stu-id="6cc87-191">In *Controllers\DepartmentController.cs*, add a `using` statement:</span></span>

[!code-csharp[Main](handling-concurrency-with-the-entity-framework-in-an-asp-net-mvc-application/samples/sample4.cs)]

<span data-ttu-id="6cc87-192">Böylece departmanı yönetici aşağı açılan listeler Değiştir "FullName" "Soyadı" her yerde bu dosyadaki (dört oluşum) Eğitmen tam adı yerine yalnızca son adını içerir.</span><span class="sxs-lookup"><span data-stu-id="6cc87-192">Change "LastName" to "FullName" everywhere in this file (four occurrences) so that the department administrator drop-down lists will contain the full name of the instructor rather than just the last name.</span></span>

[!code-csharp[Main](handling-concurrency-with-the-entity-framework-in-an-asp-net-mvc-application/samples/sample5.cs?highlight=1)]

<span data-ttu-id="6cc87-193">Varolan kodunu değiştir `HttpPost` `Edit` aşağıdaki kod ile yöntemi:</span><span class="sxs-lookup"><span data-stu-id="6cc87-193">Replace the existing code for the `HttpPost` `Edit` method with the following code:</span></span>

[!code-csharp[Main](handling-concurrency-with-the-entity-framework-in-an-asp-net-mvc-application/samples/sample6.cs)]

<span data-ttu-id="6cc87-194">Görünüm özgün depolayacak `RowVersion` gizli bir alan değeri.</span><span class="sxs-lookup"><span data-stu-id="6cc87-194">The view will store the original `RowVersion` value in a hidden field.</span></span> <span data-ttu-id="6cc87-195">Model bağlayıcı oluşturduğunda `department` örneği, söz konusu nesne özgün olacaktır `RowVersion` özellik değeri ve düzenleme sayfasında kullanıcı tarafından girilen gibi diğer özellikleri için yeni değerleri.</span><span class="sxs-lookup"><span data-stu-id="6cc87-195">When the model binder creates the `department` instance, that object will have the original `RowVersion` property value and the new values for the other properties, as entered by the user on the Edit page.</span></span> <span data-ttu-id="6cc87-196">Ardından Entity Framework bir SQL oluşturduğunda `UPDATE` komutunu komutu içerecek bir `WHERE` özgün sahip bir satır için arar yan tümcesi `RowVersion` değeri.</span><span class="sxs-lookup"><span data-stu-id="6cc87-196">Then when the Entity Framework creates a SQL `UPDATE` command, that command will include a `WHERE` clause that looks for a row that has the original `RowVersion` value.</span></span>

<span data-ttu-id="6cc87-197">Hiçbir satır etkilenir, `UPDATE` komutu (özgün hiçbir satır sahip `RowVersion` değeri), Entity Framework oluşturur bir `DbUpdateConcurrencyException` özel durumu ve kodda `catch` bloğunu alır etkilenen `Department` özel varlıktan nesne.</span><span class="sxs-lookup"><span data-stu-id="6cc87-197">If no rows are affected by the `UPDATE` command (no rows have the original `RowVersion` value), the Entity Framework throws a `DbUpdateConcurrencyException` exception, and the code in the `catch` block gets the affected `Department` entity from the exception object.</span></span> <span data-ttu-id="6cc87-198">Bu varlığın veritabanından okunan değerleri ve kullanıcı tarafından girilen yeni değerler vardır:</span><span class="sxs-lookup"><span data-stu-id="6cc87-198">This entity has both the values read from the database and the new values entered by the user:</span></span>

[!code-csharp[Main](handling-concurrency-with-the-entity-framework-in-an-asp-net-mvc-application/samples/sample7.cs)]

<span data-ttu-id="6cc87-199">Ardından, kod ne kullanıcı düzenleme sayfasında girilen öğesinden farklı veritabanı değerlerine sahip her bir sütun için bir özel hata iletisi ekler:</span><span class="sxs-lookup"><span data-stu-id="6cc87-199">Next, the code adds a custom error message for each column that has database values different from what the user entered on the Edit page:</span></span>

[!code-csharp[Main](handling-concurrency-with-the-entity-framework-in-an-asp-net-mvc-application/samples/sample8.cs)]

<span data-ttu-id="6cc87-200">Uzun bir hata iletisi ne olduğu ve bu konuda yapmanız gerekenler açıklanmaktadır:</span><span class="sxs-lookup"><span data-stu-id="6cc87-200">A longer error message explains what happened and what to do about it:</span></span>

[!code-csharp[Main](handling-concurrency-with-the-entity-framework-in-an-asp-net-mvc-application/samples/sample9.cs)]

<span data-ttu-id="6cc87-201">Son olarak, kod ayarlar `RowVersion` değerini `Department` yeni değer nesnesine veritabanından alınır.</span><span class="sxs-lookup"><span data-stu-id="6cc87-201">Finally, the code sets the `RowVersion` value of the `Department` object to the new value retrieved from the database.</span></span> <span data-ttu-id="6cc87-202">Bu yeni `RowVersion` değeri sayfa yeniden düzenleme ve sonraki kullanıcı çalıştırdığında gizli alanında depolanacağı **kaydetmek**, düzenleme sayfasını yeniden yakalanan bu yana, eşzamanlılık hataları.</span><span class="sxs-lookup"><span data-stu-id="6cc87-202">This new `RowVersion` value will be stored in the hidden field when the Edit page is redisplayed, and the next time the user clicks **Save**, only concurrency errors that happen since the redisplay of the Edit page will be caught.</span></span>

<span data-ttu-id="6cc87-203">İçinde *Views\Department\Edit.cshtml*, kaydetmek için gizli bir alan eklemek `RowVersion` hemen gizli alanı için aşağıdaki özellik değeri `DepartmentID` özelliği:</span><span class="sxs-lookup"><span data-stu-id="6cc87-203">In *Views\Department\Edit.cshtml*, add a hidden field to save the `RowVersion` property value, immediately following the hidden field for the `DepartmentID` property:</span></span>

[!code-cshtml[Main](handling-concurrency-with-the-entity-framework-in-an-asp-net-mvc-application/samples/sample10.cshtml?highlight=17)]

<span data-ttu-id="6cc87-204">İçinde *Views\Department\Index.cshtml*, var olan kodu satır bağlantılar sola taşı ve görüntülemek için sayfa başlığı ve sütun başlıklarını değiştirmek için aşağıdaki kodla değiştirin `FullName` yerine `LastName` içinde**Yönetici** sütun:</span><span class="sxs-lookup"><span data-stu-id="6cc87-204">In *Views\Department\Index.cshtml*, replace the existing code with the following code to move row links to the left and change the page title and column headings to display `FullName` instead of `LastName` in the **Administrator** column:</span></span>

[!code-cshtml[Main](handling-concurrency-with-the-entity-framework-in-an-asp-net-mvc-application/samples/sample11.cshtml)]

## <a name="testing-optimistic-concurrency-handling"></a><span data-ttu-id="6cc87-205">İyimser eşzamanlılık işleme test etme</span><span class="sxs-lookup"><span data-stu-id="6cc87-205">Testing Optimistic Concurrency Handling</span></span>

<span data-ttu-id="6cc87-206">Siteyi çalıştırın ve tıklayın **Departmanlar**:</span><span class="sxs-lookup"><span data-stu-id="6cc87-206">Run the site and click **Departments**:</span></span>

![Department_Index_page_before_edits](handling-concurrency-with-the-entity-framework-in-an-asp-net-mvc-application/_static/image5.png)

<span data-ttu-id="6cc87-208">Sağ tıklayın **Düzenle** Kim Abercrombie ve select için köprü **yeni sekmede aç** ardından **Düzenle** Kim Abercrombie için köprü.</span><span class="sxs-lookup"><span data-stu-id="6cc87-208">Right click the **Edit** hyperlink for Kim Abercrombie and select **Open in new tab,** then click the **Edit** hyperlink for Kim Abercrombie.</span></span> <span data-ttu-id="6cc87-209">İki windows aynı bilgileri görüntüler.</span><span class="sxs-lookup"><span data-stu-id="6cc87-209">The two windows display the same information.</span></span>

![Department_Edit_page_before_changes](handling-concurrency-with-the-entity-framework-in-an-asp-net-mvc-application/_static/image6.png)

<span data-ttu-id="6cc87-211">Bir alan ilk tarayıcı penceresinde değiştirip'ı **kaydetmek**.</span><span class="sxs-lookup"><span data-stu-id="6cc87-211">Change a field in the first browser window and click **Save**.</span></span>

![Department_Edit_page_1_after_change](handling-concurrency-with-the-entity-framework-in-an-asp-net-mvc-application/_static/image7.png)

<span data-ttu-id="6cc87-213">Tarayıcı değiştirilen değerle dizin sayfası gösterilir.</span><span class="sxs-lookup"><span data-stu-id="6cc87-213">The browser shows the Index page with the changed value.</span></span>

![Departments_Index_page_after_first_budget_edit](handling-concurrency-with-the-entity-framework-in-an-asp-net-mvc-application/_static/image8.png)

<span data-ttu-id="6cc87-215">Herhangi bir alana ikinci bir tarayıcı penceresi değiştirip'ı **kaydetmek**.</span><span class="sxs-lookup"><span data-stu-id="6cc87-215">Change the any field in the second browser window and click **Save**.</span></span>

![Department_Edit_page_2_after_change](handling-concurrency-with-the-entity-framework-in-an-asp-net-mvc-application/_static/image9.png)

<span data-ttu-id="6cc87-217">Tıklatın **kaydetmek** ikinci bir tarayıcı penceresi içinde.</span><span class="sxs-lookup"><span data-stu-id="6cc87-217">Click **Save** in the second browser window.</span></span> <span data-ttu-id="6cc87-218">Bir hata iletisi görüntülenir:</span><span class="sxs-lookup"><span data-stu-id="6cc87-218">You see an error message:</span></span>

![Department_Edit_page_2_after_clicking_Save](handling-concurrency-with-the-entity-framework-in-an-asp-net-mvc-application/_static/image10.png)

<span data-ttu-id="6cc87-220">Tıklatın **kaydetmek** yeniden.</span><span class="sxs-lookup"><span data-stu-id="6cc87-220">Click **Save** again.</span></span> <span data-ttu-id="6cc87-221">İkinci tarayıcıda girilen değerin ilk tarayıcıda değiştirmek veri özgün değeri birlikte kaydedilir.</span><span class="sxs-lookup"><span data-stu-id="6cc87-221">The value you entered in the second browser is saved along with the original value of the data you change in the first browser.</span></span> <span data-ttu-id="6cc87-222">Dizin Sayfası göründüğünde, kaydedilen değerler görürsünüz.</span><span class="sxs-lookup"><span data-stu-id="6cc87-222">You see the saved values when the Index page appears.</span></span>

![Department_Index_page_with_change_from_second_browser](handling-concurrency-with-the-entity-framework-in-an-asp-net-mvc-application/_static/image11.png)

## <a name="updating-the-delete-page"></a><span data-ttu-id="6cc87-224">Delete sayfa güncelleştiriliyor</span><span class="sxs-lookup"><span data-stu-id="6cc87-224">Updating the Delete Page</span></span>

<span data-ttu-id="6cc87-225">Delete sayfa için Entity Framework birisi başka departman benzer bir şekilde düzenleyerek nedeni eşzamanlılık çakışması algılar.</span><span class="sxs-lookup"><span data-stu-id="6cc87-225">For the Delete page, the Entity Framework detects concurrency conflicts caused by someone else editing the department in a similar manner.</span></span> <span data-ttu-id="6cc87-226">Zaman `HttpGet` `Delete` yöntemi onay görünümü görüntüler, özgün görünümü içerir `RowVersion` gizli bir alan değeri.</span><span class="sxs-lookup"><span data-stu-id="6cc87-226">When the `HttpGet` `Delete` method displays the confirmation view, the view includes the original `RowVersion` value in a hidden field.</span></span> <span data-ttu-id="6cc87-227">Değer sonra kullanılabilir olduğunu `HttpPost` `Delete` kullanıcı silme doğruladığında çağrılan yöntem.</span><span class="sxs-lookup"><span data-stu-id="6cc87-227">That value is then available to the `HttpPost` `Delete` method that's called when the user confirms the deletion.</span></span> <span data-ttu-id="6cc87-228">Entity Framework, SQL oluşturduğunda `DELETE` komutu, içerdiği bir `WHERE` yan tümcesiyle birlikte özgün `RowVersion` değeri.</span><span class="sxs-lookup"><span data-stu-id="6cc87-228">When the Entity Framework creates the SQL `DELETE` command, it includes a `WHERE` clause with the original `RowVersion` value.</span></span> <span data-ttu-id="6cc87-229">Sıfır satır komutu sonuçlarında (satır silme onayı sayfası görüntülendikten sonra değiştirildiği anlamına gelir) etkilenen, bir eşzamanlılık özel durum oluşur ve `HttpGet Delete` yöntemi, bir hata bayrağı çağrılır `true` görüntülemek için onay sayfasında bir hata iletisi ile.</span><span class="sxs-lookup"><span data-stu-id="6cc87-229">If the command results in zero rows affected (meaning the row was changed after the Delete confirmation page was displayed), a concurrency exception is thrown, and the `HttpGet Delete` method is called with an error flag set to `true` in order to redisplay the confirmation page with an error message.</span></span> <span data-ttu-id="6cc87-230">Bu durumda farklı bir hata iletisi görüntülenir şekilde satır başka bir kullanıcı tarafından silindiği için sıfır satır etkilendi mümkündür.</span><span class="sxs-lookup"><span data-stu-id="6cc87-230">It's also possible that zero rows were affected because the row was deleted by another user, so in that case a different error message is displayed.</span></span>

<span data-ttu-id="6cc87-231">İçinde *DepartmentController.cs*, yerine `HttpGet` `Delete` aşağıdaki kod ile yöntemi:</span><span class="sxs-lookup"><span data-stu-id="6cc87-231">In *DepartmentController.cs*, replace the `HttpGet` `Delete` method with the following code:</span></span>

[!code-csharp[Main](handling-concurrency-with-the-entity-framework-in-an-asp-net-mvc-application/samples/sample12.cs)]

<span data-ttu-id="6cc87-232">Yöntemi, bir eşzamanlılık hatası sonra sayfanın görünürler olup olmadığını belirten isteğe bağlı bir parametre kabul eder.</span><span class="sxs-lookup"><span data-stu-id="6cc87-232">The method accepts an optional parameter that indicates whether the page is being redisplayed after a concurrency error.</span></span> <span data-ttu-id="6cc87-233">Bu bayrak ise `true`, görünümü kullanarak bir hata iletisi gönderilen bir `ViewBag` özelliği.</span><span class="sxs-lookup"><span data-stu-id="6cc87-233">If this flag is `true`, an error message is sent to the view using a `ViewBag` property.</span></span>

<span data-ttu-id="6cc87-234">Kodla `HttpPost` `Delete` yöntemi (adlı `DeleteConfirmed`) aşağıdaki kod ile:</span><span class="sxs-lookup"><span data-stu-id="6cc87-234">Replace the code in the `HttpPost` `Delete` method (named `DeleteConfirmed`) with the following code:</span></span>

[!code-csharp[Main](handling-concurrency-with-the-entity-framework-in-an-asp-net-mvc-application/samples/sample13.cs)]

<span data-ttu-id="6cc87-235">Yalnızca değiştirilen kurulmuş kodda, bu yöntem yalnızca bir kayıt kimliği kabul:</span><span class="sxs-lookup"><span data-stu-id="6cc87-235">In the scaffolded code that you just replaced, this method accepted only a record ID:</span></span>

[!code-csharp[Main](handling-concurrency-with-the-entity-framework-in-an-asp-net-mvc-application/samples/sample14.cs)]

<span data-ttu-id="6cc87-236">Bu parametre için değiştirdiyseniz bir `Department` model bağlayıcı tarafından oluşturulan varlık örneği.</span><span class="sxs-lookup"><span data-stu-id="6cc87-236">You've changed this parameter to a `Department` entity instance created by the model binder.</span></span> <span data-ttu-id="6cc87-237">Bu, erişim sağlayan `RowVersion` kayıt anahtarı ek özellik değeri.</span><span class="sxs-lookup"><span data-stu-id="6cc87-237">This gives you access to the `RowVersion` property value in addition to the record key.</span></span>

[!code-csharp[Main](handling-concurrency-with-the-entity-framework-in-an-asp-net-mvc-application/samples/sample15.cs)]

<span data-ttu-id="6cc87-238">Ayrıca eylem yönteminin adı değiştirilmiştir `DeleteConfirmed` için `Delete`.</span><span class="sxs-lookup"><span data-stu-id="6cc87-238">You have also changed the action method name from `DeleteConfirmed` to `Delete`.</span></span> <span data-ttu-id="6cc87-239">Adlı kurulmuş kodu `HttpPost` `Delete` yöntemi `DeleteConfirmed` vermek için `HttpPost` yöntemi benzersiz bir imza.</span><span class="sxs-lookup"><span data-stu-id="6cc87-239">The scaffolded code named the `HttpPost` `Delete` method `DeleteConfirmed` to give the `HttpPost` method a unique signature.</span></span> <span data-ttu-id="6cc87-240">(CLR farklı yöntem parametreleri sağlamak için aşırı yüklenmiş yöntemler gerektirir.) İmzaları benzersiz, MVC kuralı ile takılıyor ve için aynı adı kullanmak `HttpPost` ve `HttpGet` yöntemlerini silin.</span><span class="sxs-lookup"><span data-stu-id="6cc87-240">(The CLR requires overloaded methods to have different method parameters.) Now that the signatures are unique, you can stick with the MVC convention and use the same name for the `HttpPost` and `HttpGet` delete methods.</span></span>

<span data-ttu-id="6cc87-241">Bir eşzamanlılık hatası yakalanmışsa kodu silme onayı sayfası görüntüler ve bunu belirten bir bayrak bir eşzamanlılık hata iletisi görüntülenmelidir sağlar.</span><span class="sxs-lookup"><span data-stu-id="6cc87-241">If a concurrency error is caught, the code redisplays the Delete confirmation page and provides a flag that indicates it should display a concurrency error message.</span></span>

<span data-ttu-id="6cc87-242">İçinde *Views\Department\Delete.cshtml*, bazı biçimlendirme değişikliğini aşağıdaki kod ile kurulmuş kodu değiştirir ve bir hata iletisini alan ekler.</span><span class="sxs-lookup"><span data-stu-id="6cc87-242">In *Views\Department\Delete.cshtml*, replace the scaffolded code with the following code that makes some formatting changes and adds an error message field.</span></span> <span data-ttu-id="6cc87-243">Değişiklikler vurgulanır.</span><span class="sxs-lookup"><span data-stu-id="6cc87-243">The changes are highlighted.</span></span>

[!code-cshtml[Main](handling-concurrency-with-the-entity-framework-in-an-asp-net-mvc-application/samples/sample16.cshtml?highlight=9,37,40,45-46)]

<span data-ttu-id="6cc87-244">Bu kod hata iletisine arasında ekler `h2` ve `h3` başlıkları:</span><span class="sxs-lookup"><span data-stu-id="6cc87-244">This code adds an error message between the `h2` and `h3` headings:</span></span>

[!code-cshtml[Main](handling-concurrency-with-the-entity-framework-in-an-asp-net-mvc-application/samples/sample17.cshtml)]

<span data-ttu-id="6cc87-245">Yerini `LastName` ile `FullName` içinde `Administrator` alan:</span><span class="sxs-lookup"><span data-stu-id="6cc87-245">It replaces `LastName` with `FullName` in the `Administrator` field:</span></span>

[!code-cshtml[Main](handling-concurrency-with-the-entity-framework-in-an-asp-net-mvc-application/samples/sample18.cshtml)]

<span data-ttu-id="6cc87-246">Son olarak, gizli alanlar için ekler `DepartmentID` ve `RowVersion` sonra özellikleri `Html.BeginForm` deyimi:</span><span class="sxs-lookup"><span data-stu-id="6cc87-246">Finally, it adds hidden fields for the `DepartmentID` and `RowVersion` properties after the `Html.BeginForm` statement:</span></span>

[!code-cshtml[Main](handling-concurrency-with-the-entity-framework-in-an-asp-net-mvc-application/samples/sample19.cshtml)]

<span data-ttu-id="6cc87-247">Departmanlar dizin sayfası çalıştırın.</span><span class="sxs-lookup"><span data-stu-id="6cc87-247">Run the Departments Index page.</span></span> <span data-ttu-id="6cc87-248">Sağ tıklayın **silmek** seçin ve İngilizce departmanı için köprü **yeni pencerede aç** ilk penceresinde ardından **Düzenle** İngilizce için köprü Departman.</span><span class="sxs-lookup"><span data-stu-id="6cc87-248">Right click the **Delete** hyperlink for the English department and select **Open in new window,** then in the first window click the **Edit** hyperlink for the English department.</span></span>

<span data-ttu-id="6cc87-249">İlk penceresinde değerlerden birini değiştirmek ve tıklatın **kaydetmek** :</span><span class="sxs-lookup"><span data-stu-id="6cc87-249">In the first window, change one of the values, and click **Save** :</span></span>

![Department_Edit_page_after_change_before_delete](handling-concurrency-with-the-entity-framework-in-an-asp-net-mvc-application/_static/image12.png)

<span data-ttu-id="6cc87-251">Dizin Sayfası değişikliği onaylar.</span><span class="sxs-lookup"><span data-stu-id="6cc87-251">The Index page confirms the change.</span></span>

![Departments_Index_page_after_budget_edit_before_delete](handling-concurrency-with-the-entity-framework-in-an-asp-net-mvc-application/_static/image13.png)

<span data-ttu-id="6cc87-253">İkinci penceresinde **silmek**.</span><span class="sxs-lookup"><span data-stu-id="6cc87-253">In the second window, click **Delete**.</span></span>

![Department_Delete_confirmation_page_before_concurrency_error](handling-concurrency-with-the-entity-framework-in-an-asp-net-mvc-application/_static/image14.png)

<span data-ttu-id="6cc87-255">Eşzamanlılık hata iletisine bakın ve departman değerleri şu anda veritabanında nedir ile yenilenir.</span><span class="sxs-lookup"><span data-stu-id="6cc87-255">You see the concurrency error message, and the Department values are refreshed with what's currently in the database.</span></span>

![Department_Delete_confirmation_page_with_concurrency_error](handling-concurrency-with-the-entity-framework-in-an-asp-net-mvc-application/_static/image15.png)

<span data-ttu-id="6cc87-257">Tıklatırsanız **silmek** yeniden departman silinip silinmediğini gösterir dizin sayfasına yönlendirilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="6cc87-257">If you click **Delete** again, you're redirected to the Index page, which shows that the department has been deleted.</span></span>

## <a name="summary"></a><span data-ttu-id="6cc87-258">Özet</span><span class="sxs-lookup"><span data-stu-id="6cc87-258">Summary</span></span>

<span data-ttu-id="6cc87-259">Bu, eşzamanlılık çakışmalarını işleme giriş tamamlar.</span><span class="sxs-lookup"><span data-stu-id="6cc87-259">This completes the introduction to handling concurrency conflicts.</span></span> <span data-ttu-id="6cc87-260">Çeşitli eşzamanlılık senaryoları işlemek için diğer yolları hakkında daha fazla bilgi için bkz: [iyimser eşzamanlılık desenleri](https://blogs.msdn.com/b/adonet/archive/2011/02/03/using-dbcontext-in-ef-feature-ctp5-part-9-optimistic-concurrency-patterns.aspx) ve [özellik değerleri ile çalışma](https://blogs.msdn.com/b/adonet/archive/2011/01/30/using-dbcontext-in-ef-feature-ctp5-part-5-working-with-property-values.aspx) Entity Framework ekip blogunda.</span><span class="sxs-lookup"><span data-stu-id="6cc87-260">For information about other ways to handle various concurrency scenarios, see [Optimistic Concurrency Patterns](https://blogs.msdn.com/b/adonet/archive/2011/02/03/using-dbcontext-in-ef-feature-ctp5-part-9-optimistic-concurrency-patterns.aspx) and [Working with Property Values](https://blogs.msdn.com/b/adonet/archive/2011/01/30/using-dbcontext-in-ef-feature-ctp5-part-5-working-with-property-values.aspx) on the Entity Framework team blog.</span></span> <span data-ttu-id="6cc87-261">Sonraki öğretici için tablo başına hiyerarşisi devralma uygulamak gösterilmiştir `Instructor` ve `Student` varlıklar.</span><span class="sxs-lookup"><span data-stu-id="6cc87-261">The next tutorial shows how to implement table-per-hierarchy inheritance for the `Instructor` and `Student` entities.</span></span>

<span data-ttu-id="6cc87-262">Diğer Entity Framework kaynaklarına bağlantılar bulunabilir [ASP.NET Data Access içerik haritası](../../../../whitepapers/aspnet-data-access-content-map.md).</span><span class="sxs-lookup"><span data-stu-id="6cc87-262">Links to other Entity Framework resources can be found in the [ASP.NET Data Access Content Map](../../../../whitepapers/aspnet-data-access-content-map.md).</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="6cc87-263">[Önceki](updating-related-data-with-the-entity-framework-in-an-asp-net-mvc-application.md)
> [sonraki](implementing-inheritance-with-the-entity-framework-in-an-asp-net-mvc-application.md)</span><span class="sxs-lookup"><span data-stu-id="6cc87-263">[Previous](updating-related-data-with-the-entity-framework-in-an-asp-net-mvc-application.md)
[Next](implementing-inheritance-with-the-entity-framework-in-an-asp-net-mvc-application.md)</span></span>
