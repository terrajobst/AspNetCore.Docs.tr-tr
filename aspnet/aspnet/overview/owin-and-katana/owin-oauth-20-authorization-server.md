---
uid: aspnet/overview/owin-and-katana/owin-oauth-20-authorization-server
title: OWIN OAuth 2.0 yetkilendirme sunucusu | Microsoft Docs
author: hongyes
description: "Bu öğretici OWIN OAuth ara yazılımı kullanarak bir OAuth 2.0 yetkilendirme sunucusu uygulama konusunda size yol gösterecektir. Bu, yalnızca Gr Gelişmiş bir öğreticidir..."
ms.author: aspnetcontent
manager: wpickett
ms.date: 03/20/2014
ms.topic: article
ms.assetid: 20acee16-c70c-41e9-b38f-92bfcf9a4c1c
ms.technology: 
ms.prod: .net-framework
msc.legacyurl: /aspnet/overview/owin-and-katana/owin-oauth-20-authorization-server
msc.type: authoredcontent
ms.openlocfilehash: 8842f57df84d841df77b34e9645dbf4909f82d85
ms.sourcegitcommit: 9a9483aceb34591c97451997036a9120c3fe2baf
ms.translationtype: MT
ms.contentlocale: tr-TR
ms.lasthandoff: 11/10/2017
---
<a name="owin-oauth-20-authorization-server"></a><span data-ttu-id="5fc28-104">OWIN OAuth 2.0 yetkilendirme sunucusu</span><span class="sxs-lookup"><span data-stu-id="5fc28-104">OWIN OAuth 2.0 Authorization Server</span></span>
====================
<span data-ttu-id="5fc28-105">tarafından [Hongye Sun](https://github.com/hongyes), [Praburaj Thiagarajan](https://github.com/Praburaj), [Rick Anderson](https://github.com/Rick-Anderson)</span><span class="sxs-lookup"><span data-stu-id="5fc28-105">by [Hongye Sun](https://github.com/hongyes), [Praburaj Thiagarajan](https://github.com/Praburaj), [Rick Anderson](https://github.com/Rick-Anderson)</span></span>

> <span data-ttu-id="5fc28-106">Bu öğretici OWIN OAuth ara yazılımı kullanarak bir OAuth 2.0 yetkilendirme sunucusu uygulama konusunda size yol gösterecektir.</span><span class="sxs-lookup"><span data-stu-id="5fc28-106">This tutorial will guide you on how to implement an OAuth 2.0 Authorization Server using OWIN OAuth middleware.</span></span> <span data-ttu-id="5fc28-107">Yalnızca bir OWIN OAuth 2.0 yetkilendirme sunucusu oluşturmak için gereken adımları özetler Gelişmiş bir öğreticidir.</span><span class="sxs-lookup"><span data-stu-id="5fc28-107">This is an advanced tutorial that only outlines the steps to create an OWIN OAuth 2.0 Authorization Server.</span></span> <span data-ttu-id="5fc28-108">Bu adım adım öğretici değildir.</span><span class="sxs-lookup"><span data-stu-id="5fc28-108">This is not a step by step tutorial.</span></span> <span data-ttu-id="5fc28-109">[Örnek kodu indirdikten](https://code.msdn.microsoft.com/OWIN-OAuth-20-Authorization-ba2b8783/file/114932/1/AuthorizationServer.zip).</span><span class="sxs-lookup"><span data-stu-id="5fc28-109">[Download the sample code](https://code.msdn.microsoft.com/OWIN-OAuth-20-Authorization-ba2b8783/file/114932/1/AuthorizationServer.zip).</span></span>
> 
> > [!NOTE]
> > <span data-ttu-id="5fc28-110">Bu anahat güvenli bir üretim uygulaması oluşturmak için kullanılacak amaçlanmamış.</span><span class="sxs-lookup"><span data-stu-id="5fc28-110">This outline should not be intended to be used for creating a secure production app.</span></span> <span data-ttu-id="5fc28-111">Bu öğretici OWIN OAuth ara yazılımı kullanarak bir OAuth 2.0 yetkilendirme sunucusu uygulamak yalnızca ana hattı sağlamak için tasarlanmıştır.</span><span class="sxs-lookup"><span data-stu-id="5fc28-111">This tutorial is intended to provide only an outline on how to implement an OAuth 2.0 Authorization Server using OWIN OAuth middleware.</span></span>
> 
> 
> ## <a name="software-versions"></a><span data-ttu-id="5fc28-112">Yazılım sürümleri</span><span class="sxs-lookup"><span data-stu-id="5fc28-112">Software versions</span></span>
> 
> | <span data-ttu-id="5fc28-113">**Öğreticide gösterilen**</span><span class="sxs-lookup"><span data-stu-id="5fc28-113">**Shown in the tutorial**</span></span> | <span data-ttu-id="5fc28-114">**İle de çalışır**</span><span class="sxs-lookup"><span data-stu-id="5fc28-114">**Also works with**</span></span> |
> | --- | --- |
> | <span data-ttu-id="5fc28-115">Windows 8.1</span><span class="sxs-lookup"><span data-stu-id="5fc28-115">Windows 8.1</span></span> | <span data-ttu-id="5fc28-116">Windows 8, Windows 7</span><span class="sxs-lookup"><span data-stu-id="5fc28-116">Windows 8, Windows 7</span></span> |
> | [<span data-ttu-id="5fc28-117">Visual Studio 2013</span><span class="sxs-lookup"><span data-stu-id="5fc28-117">Visual Studio 2013</span></span>](https://www.microsoft.com/visualstudio/eng/2013-downloads) | <span data-ttu-id="5fc28-118">[Masaüstü için Visual Studio 2013 Express](https://www.microsoft.com/visualstudio/eng/2013-downloads#d-2013-express).</span><span class="sxs-lookup"><span data-stu-id="5fc28-118">[Visual Studio 2013 Express for Desktop](https://www.microsoft.com/visualstudio/eng/2013-downloads#d-2013-express).</span></span> <span data-ttu-id="5fc28-119">Visual Studio 2012 en son güncelleştirme çalışması gerekir, ancak öğreticinin ile test edilmemiştir ve bazı menü seçimlerini ve iletişim kutuları farklı.</span><span class="sxs-lookup"><span data-stu-id="5fc28-119">Visual Studio 2012 with the latest update should work, but the tutorial has not been tested with it, and some menu selections and dialog boxes are different.</span></span> |
> | <span data-ttu-id="5fc28-120">.NET 4.5</span><span class="sxs-lookup"><span data-stu-id="5fc28-120">.NET 4.5</span></span> |  |
> 
> ## <a name="questions-and-comments"></a><span data-ttu-id="5fc28-121">Sorularınız ve yorumlarınız</span><span class="sxs-lookup"><span data-stu-id="5fc28-121">Questions and Comments</span></span>
> 
> <span data-ttu-id="5fc28-122">Öğretici için doğrudan ilgili olmayan sorularınız varsa, onları nakledebilirsiniz [Katana proje github'da](https://github.com/aspnet/AspNetKatana/).</span><span class="sxs-lookup"><span data-stu-id="5fc28-122">If you have questions that are not directly related to the tutorial, you can post them at [Katana Project on GitHub](https://github.com/aspnet/AspNetKatana/).</span></span> <span data-ttu-id="5fc28-123">Sorularınız ve yorumlarınız ilgili öğretici için sayfanın sonundaki Açıklamalar bölümüne bakın.</span><span class="sxs-lookup"><span data-stu-id="5fc28-123">For questions and comments regarding the tutorial itself, see the comments section at the bottom of the page.</span></span>


<span data-ttu-id="5fc28-124">[OAuth 2.0 framework](http://tools.ietf.org/html/rfc6749) bir HTTP hizmeti sınırlı erişim elde etmek bir üçüncü taraf uygulama sağlar.</span><span class="sxs-lookup"><span data-stu-id="5fc28-124">The [OAuth 2.0 framework](http://tools.ietf.org/html/rfc6749) enables a third-party app to obtain limited access to an HTTP service.</span></span> <span data-ttu-id="5fc28-125">Korunan bir kaynağa erişmek için kaynak sahibinin kimlik bilgilerini kullanmak yerine, istemci bir erişim belirteci alır (bir dize olduğu belirli bir kapsamda, yaşam süresi ve diğer erişim öznitelikleri belirten).</span><span class="sxs-lookup"><span data-stu-id="5fc28-125">Instead of using the resource owner's credentials to access a protected resource, the client obtains an access token (which is a string denoting a specific scope, lifetime, and other access attributes).</span></span> <span data-ttu-id="5fc28-126">Erişim belirteçleri üçüncü taraf istemcilere kaynak sahibi onay ile bir yetkilendirme sunucusu tarafından verilir.</span><span class="sxs-lookup"><span data-stu-id="5fc28-126">Access tokens are issued to third-party clients by an authorization server with the approval of the resource owner.</span></span>

<span data-ttu-id="5fc28-127">Bu öğretici ele alınacaktır:</span><span class="sxs-lookup"><span data-stu-id="5fc28-127">This tutorial will cover:</span></span>

- <span data-ttu-id="5fc28-128">Dört yetkilendirme desteklemek için bir yetkilendirme sunucusu oluşturma, verme türlerini ve yenileme belirteçlerini:</span><span class="sxs-lookup"><span data-stu-id="5fc28-128">How to create an authorization server to support four authorization grant types and refresh tokens:</span></span>
    - <span data-ttu-id="5fc28-129">Yetkilendirme kodu verme</span><span class="sxs-lookup"><span data-stu-id="5fc28-129">Authorization code grant</span></span>
    - <span data-ttu-id="5fc28-130">Kapalı verin</span><span class="sxs-lookup"><span data-stu-id="5fc28-130">Implicit Grant</span></span>
    - <span data-ttu-id="5fc28-131">Kaynak sahibi parolası kimlik bilgileri verin</span><span class="sxs-lookup"><span data-stu-id="5fc28-131">Resource Owner Password Credentials Grant</span></span>
    - <span data-ttu-id="5fc28-132">İstemci kimlik bilgileri verin</span><span class="sxs-lookup"><span data-stu-id="5fc28-132">Client Credentials Grant</span></span>
- <span data-ttu-id="5fc28-133">Bir erişim belirteci tarafından korunan bir kaynak sunucusu oluşturuluyor.</span><span class="sxs-lookup"><span data-stu-id="5fc28-133">Creating a resource server which is protected by an access token.</span></span>
- <span data-ttu-id="5fc28-134">OAuth 2.0 istemcilerinin oluşturuluyor.</span><span class="sxs-lookup"><span data-stu-id="5fc28-134">Creating OAuth 2.0 clients.</span></span>

<a id="prerequisites"></a>
## <a name="prerequisites"></a><span data-ttu-id="5fc28-135">Önkoşullar</span><span class="sxs-lookup"><span data-stu-id="5fc28-135">Prerequisites</span></span>

- <span data-ttu-id="5fc28-136">[Visual Studio 2013](https://www.microsoft.com/visualstudio/eng/downloads#d-2013-editions) veya ücretsiz [Visual Studio Express 2013](https://www.microsoft.com/visualstudio/eng/downloads#d-2013-express)belirtilen gibi **yazılım sürümleri** sayfanın üst kısmındaki.</span><span class="sxs-lookup"><span data-stu-id="5fc28-136">[Visual Studio 2013](https://www.microsoft.com/visualstudio/eng/downloads#d-2013-editions) or the free [Visual Studio Express 2013](https://www.microsoft.com/visualstudio/eng/downloads#d-2013-express), as indicated in **Software Versions** at the top of the page.</span></span>
- <span data-ttu-id="5fc28-137">OWIN hakkında bilgi.</span><span class="sxs-lookup"><span data-stu-id="5fc28-137">Familiarity with OWIN.</span></span> <span data-ttu-id="5fc28-138">Bkz: [Katana proje ile çalışmaya başlama](https://msdn.microsoft.com/en-us/magazine/dn451439.aspx) ve [OWIN ve Katana yenilikler](index.md).</span><span class="sxs-lookup"><span data-stu-id="5fc28-138">See [Getting Started with the Katana Project](https://msdn.microsoft.com/en-us/magazine/dn451439.aspx) and [What's new in OWIN and Katana](index.md).</span></span>
- <span data-ttu-id="5fc28-139">Aşina [OAuth](http://tools.ietf.org/html/rfc6749) terminolojisinde dahil olmak üzere [rolleri](http://tools.ietf.org/html/rfc6749#section-1.1), [Protokolü akış](http://tools.ietf.org/html/rfc6749#section-1.2), ve [yetkilendirme verme](http://tools.ietf.org/html/rfc6749#section-1.3).</span><span class="sxs-lookup"><span data-stu-id="5fc28-139">Familiarity with [OAuth](http://tools.ietf.org/html/rfc6749) terminology, including [Roles](http://tools.ietf.org/html/rfc6749#section-1.1), [Protocol Flow](http://tools.ietf.org/html/rfc6749#section-1.2), and [Authorization Grant](http://tools.ietf.org/html/rfc6749#section-1.3).</span></span> <span data-ttu-id="5fc28-140">[OAuth 2.0 giriş](http://tools.ietf.org/html/rfc6749#section-1) iyi bir giriş sağlar.</span><span class="sxs-lookup"><span data-stu-id="5fc28-140">[OAuth 2.0 introduction](http://tools.ietf.org/html/rfc6749#section-1) provides a good introduction.</span></span>

## <a name="create-an-authorization-server"></a><span data-ttu-id="5fc28-141">Bir yetkilendirme sunucusu oluşturma</span><span class="sxs-lookup"><span data-stu-id="5fc28-141">Create an Authorization Server</span></span>

<span data-ttu-id="5fc28-142">Bu öğreticide, biz kabaca nasıl kullanacağınızı taslak [OWIN](https://msdn.microsoft.com/en-us/magazine/dn451439.aspx) ve bir yetkilendirme sunucusu oluşturmak için ASP.NET MVC.</span><span class="sxs-lookup"><span data-stu-id="5fc28-142">In this tutorial, we will roughly sketch out how to use [OWIN](https://msdn.microsoft.com/en-us/magazine/dn451439.aspx) and ASP.NET MVC to create an authorization server.</span></span> <span data-ttu-id="5fc28-143">Bu öğretici her adımı içermez gibi yakında tamamlanmış bir örnek için bir yükleme sağlamak umuyoruz.</span><span class="sxs-lookup"><span data-stu-id="5fc28-143">We hope to soon provide a download for the completed sample, as this tutorial does not include each step.</span></span> <span data-ttu-id="5fc28-144">İlk olarak, adlandırılmış bir boş web uygulaması oluşturma *AuthorizationServer* ve aşağıdaki paketler yükleyin:</span><span class="sxs-lookup"><span data-stu-id="5fc28-144">First, create an empty web app named *AuthorizationServer* and install the following packages:</span></span>

- <span data-ttu-id="5fc28-145">Microsoft.AspNet.Mvc</span><span class="sxs-lookup"><span data-stu-id="5fc28-145">Microsoft.AspNet.Mvc</span></span>
- <span data-ttu-id="5fc28-146">Microsoft.Owin.Host.SystemWeb</span><span class="sxs-lookup"><span data-stu-id="5fc28-146">Microsoft.Owin.Host.SystemWeb</span></span>
- <span data-ttu-id="5fc28-147">Microsoft.Owin.Security.OAuth</span><span class="sxs-lookup"><span data-stu-id="5fc28-147">Microsoft.Owin.Security.OAuth</span></span>
- <span data-ttu-id="5fc28-148">Microsoft.Owin.Security.Cookies</span><span class="sxs-lookup"><span data-stu-id="5fc28-148">Microsoft.Owin.Security.Cookies</span></span>
- <span data-ttu-id="5fc28-149">Microsoft.Owin.Security.Google (veya diğer sosyal oturum paketini Microsoft.Owin.Security.Facebook gibi)</span><span class="sxs-lookup"><span data-stu-id="5fc28-149">Microsoft.Owin.Security.Google (Or any other social login package such as Microsoft.Owin.Security.Facebook)</span></span>

<span data-ttu-id="5fc28-150">Ekleme bir [OWIN başlangıç sınıfı](owin-startup-class-detection.md) adlı proje kök klasörü altında *başlangıç*.</span><span class="sxs-lookup"><span data-stu-id="5fc28-150">Add an [OWIN Startup class](owin-startup-class-detection.md) under the project root folder named *Startup*.</span></span>

[!code-csharp[Main](owin-oauth-20-authorization-server/samples/sample1.cs?highlight=8)]

<span data-ttu-id="5fc28-151">Oluşturma bir *uygulama\_Başlat* klasör.</span><span class="sxs-lookup"><span data-stu-id="5fc28-151">Create an *App\_Start* folder.</span></span> <span data-ttu-id="5fc28-152">Seçin *uygulama\_Başlat* klasörü ve kullanım indirilen sürümü eklemek için Shift + Alt + A *AuthorizationServer\App\_Start\Startup.Auth.cs* dosya.</span><span class="sxs-lookup"><span data-stu-id="5fc28-152">Select the *App\_Start* folder and use Shift+Alt+A to add the downloaded version of the *AuthorizationServer\App\_Start\Startup.Auth.cs* file.</span></span>

[!code-csharp[Main](owin-oauth-20-authorization-server/samples/sample2.cs)]

<span data-ttu-id="5fc28-153">Yukarıdaki kod uygulama/dış oturum açma yetkilendirme sunucusu tarafından kendi hesaplarını yönetmek için kullanılan tanımlama bilgileri ve Google kimlik doğrulaması sağlar.</span><span class="sxs-lookup"><span data-stu-id="5fc28-153">The code above enables application/external sign in cookies and Google authentication, which are used by authorization server itself to manage accounts.</span></span>

<span data-ttu-id="5fc28-154">`UseOAuthAuthorizationServer` Uzantısı yöntemdir yetkilendirme sunucusu kurmak için.</span><span class="sxs-lookup"><span data-stu-id="5fc28-154">The `UseOAuthAuthorizationServer` extension method is to setup the authorization server.</span></span> <span data-ttu-id="5fc28-155">Kurulum seçenekleri şunlardır:</span><span class="sxs-lookup"><span data-stu-id="5fc28-155">The setup options are:</span></span>

- <span data-ttu-id="5fc28-156">`AuthorizeEndpointPath`: İstemci uygulamalarının kullanıcıların elde etmek için Kullanıcı aracısını burada yönlendirir istek yolu onay kodu ya da belirteci vermek için.</span><span class="sxs-lookup"><span data-stu-id="5fc28-156">`AuthorizeEndpointPath`: The request path where client applications will redirect the user-agent in order to obtain the users consent to issue a token or code.</span></span> <span data-ttu-id="5fc28-157">Bir eğik çizgiyle, örneğin, başlamalıdır "`/Authorize`".</span><span class="sxs-lookup"><span data-stu-id="5fc28-157">It must begin with a leading slash, for example, "`/Authorize`".</span></span>
- <span data-ttu-id="5fc28-158">`TokenEndpointPath`: Erişim belirteci almak için istek yolu istemci uygulamaları doğrudan iletişim kurar.</span><span class="sxs-lookup"><span data-stu-id="5fc28-158">`TokenEndpointPath`: The request path client applications directly communicate to obtain the access token.</span></span> <span data-ttu-id="5fc28-159">Bir eğik "/ Token" gibi çizgiyle başlamalıdır.</span><span class="sxs-lookup"><span data-stu-id="5fc28-159">It must begin with a leading slash, like "/Token".</span></span> <span data-ttu-id="5fc28-160">İstemci verilirse bir [istemci\_gizli](http://tools.ietf.org/html/rfc6749#appendix-A.2), bu uç noktaya sağlanmalıdır.</span><span class="sxs-lookup"><span data-stu-id="5fc28-160">If the client is issued a [client\_secret](http://tools.ietf.org/html/rfc6749#appendix-A.2), it must be provided to this endpoint.</span></span>
- <span data-ttu-id="5fc28-161">`ApplicationCanDisplayErrors`: Kümesine `true` web uygulaması için istemci doğrulama hatalarının bir özel hata sayfası oluştur isterse `/Authorize` uç noktası.</span><span class="sxs-lookup"><span data-stu-id="5fc28-161">`ApplicationCanDisplayErrors`: Set to `true` if the web application wants to generate a custom error page for the client validation errors on `/Authorize` endpoint.</span></span> <span data-ttu-id="5fc28-162">Burada tarayıcı olmayan yönlendirildiği durumlarda istemci uygulamaya örneğin yedekleme için yalnızca bu gereklidir, ne zaman `client_id` veya `redirect_uri` yanlış.</span><span class="sxs-lookup"><span data-stu-id="5fc28-162">This is only needed for cases where the browser is not redirected back to the client application, for example, when the `client_id` or `redirect_uri` are incorrect.</span></span> <span data-ttu-id="5fc28-163">`/Authorize` Uç nokta bekler "oauth. görmek Hata","oauth. ErrorDescription"ve"oauth. ErrorUri"özelliklerinin OWIN ortamına eklenir.</span><span class="sxs-lookup"><span data-stu-id="5fc28-163">The `/Authorize` endpoint should expect to see the "oauth.Error", "oauth.ErrorDescription", and "oauth.ErrorUri" properties are added to the OWIN environment.</span></span> 

    > [!NOTE]
    > <span data-ttu-id="5fc28-164">Değilse true, yetkilendirme sunucusu varsayılan hata sayfası ile hata ayrıntılarını döndürür.</span><span class="sxs-lookup"><span data-stu-id="5fc28-164">If not true, the authorization server will return a default error page with the error details.</span></span>
- <span data-ttu-id="5fc28-165">`AllowInsecureHttp`: Girintili için yetkilendirme ve belirteç isteklerinin HTTP URI adreslerine gelmesi ve gelen izin vermek için izin `redirect_uri` İstek parametreleri HTTP URI adreslerine sahip yetkilendirin.</span><span class="sxs-lookup"><span data-stu-id="5fc28-165">`AllowInsecureHttp`: True to allow authorize and token requests to arrive on HTTP URI addresses, and to allow incoming `redirect_uri` authorize request parameters to have HTTP URI addresses.</span></span> 

    > [!WARNING]
    > <span data-ttu-id="5fc28-166">Güvenlik - yalnızca geliştirme budur.</span><span class="sxs-lookup"><span data-stu-id="5fc28-166">Security - This is for development only.</span></span>
- <span data-ttu-id="5fc28-167">`Provider`: Yetkilendirme sunucusu ara yazılımı tarafından başlatılan olayları işlemek üzere uygulama tarafından sağlanan nesne.</span><span class="sxs-lookup"><span data-stu-id="5fc28-167">`Provider`: The object provided by the application to process events raised by the Authorization Server middleware.</span></span> <span data-ttu-id="5fc28-168">Uygulama arabirimi tamamen uygulayabilir ya da bir örneğini oluşturabilir `OAuthAuthorizationServerProvider` ve Temsilciler bu sunucunun desteklediği OAuth akışlar için gerekli atayın.</span><span class="sxs-lookup"><span data-stu-id="5fc28-168">The application may implement the interface fully, or it may create an instance of `OAuthAuthorizationServerProvider` and assign delegates necessary for the OAuth flows this server supports.</span></span>
- <span data-ttu-id="5fc28-169">`AuthorizationCodeProvider`: İstemci uygulamasına geri dönmek için bir tek kullanımlık bir yetki kodu oluşturur.</span><span class="sxs-lookup"><span data-stu-id="5fc28-169">`AuthorizationCodeProvider`: Produces a single-use authorization code to return to the client application.</span></span> <span data-ttu-id="5fc28-170">Uygulama olmasını OAuth sunucusunun güvenli **gerekir** sağlamak için bir örneği `AuthorizationCodeProvider` burada belirteç üretilen tarafından `OnCreate/OnCreateAsync` olay yalnızca bir çağrı için geçerli kabul `OnReceive/OnReceiveAsync`.</span><span class="sxs-lookup"><span data-stu-id="5fc28-170">For the OAuth server to be secure the application **MUST** provide an instance for `AuthorizationCodeProvider` where the token produced by the `OnCreate/OnCreateAsync` event is considered valid for only one call to `OnReceive/OnReceiveAsync`.</span></span>
- <span data-ttu-id="5fc28-171">`RefreshTokenProvider`: Gerektiğinde yeni bir erişim belirteci oluşturmak için kullanılabilen bir yenileme belirteci oluşturur.</span><span class="sxs-lookup"><span data-stu-id="5fc28-171">`RefreshTokenProvider`: Produces a refresh token which may be used to produce a new access token when needed.</span></span> <span data-ttu-id="5fc28-172">Sağlanmamış yetkilendirme sunucusu gelen yenileme belirteçleri döndürmez varsa `/Token` uç noktası.</span><span class="sxs-lookup"><span data-stu-id="5fc28-172">If not provided the authorization server will not return refresh tokens from the `/Token` endpoint.</span></span>

## <a name="account-management"></a><span data-ttu-id="5fc28-173">Hesap Yönetimi</span><span class="sxs-lookup"><span data-stu-id="5fc28-173">Account Management</span></span>

<span data-ttu-id="5fc28-174">OAuth nereye veya nasıl kullanıcı hesap bilgilerini yönetmek önemli değildir.</span><span class="sxs-lookup"><span data-stu-id="5fc28-174">OAuth doesn't care where or how you manage your user account information.</span></span> <span data-ttu-id="5fc28-175">Bunun [ASP.NET Identity](../../../identity/index.md) sorumlu olduğu.</span><span class="sxs-lookup"><span data-stu-id="5fc28-175">It's [ASP.NET Identity](../../../identity/index.md) which is responsible for it.</span></span> <span data-ttu-id="5fc28-176">Bu öğreticide, biz hesap yönetimi kodu basitleştirmek ve yalnızca o kullanıcı OWIN tanımlama bilgisi Ara kullanarak oturum açabilir emin olun.</span><span class="sxs-lookup"><span data-stu-id="5fc28-176">In this tutorial, we will simplify the account management code and just make sure that user can login using OWIN cookie middleware.</span></span> <span data-ttu-id="5fc28-177">Basitleştirilmiş örnek kodunu işte `AccountController`:</span><span class="sxs-lookup"><span data-stu-id="5fc28-177">Here is the simplified sample code for the `AccountController`:</span></span>

[!code-csharp[Main](owin-oauth-20-authorization-server/samples/sample3.cs)]

[!code-csharp[Main](owin-oauth-20-authorization-server/samples/sample4.cs?highlight=1)]

<span data-ttu-id="5fc28-178">`ValidateClientRedirectUri`kayıtlı yeniden yönlendirme URL'sini istemcisiyle doğrulamak için kullanılır.</span><span class="sxs-lookup"><span data-stu-id="5fc28-178">`ValidateClientRedirectUri` is used to validate the client with its registered redirect URL.</span></span> <span data-ttu-id="5fc28-179">`ValidateClientAuthentication`temel düzeni üstbilgi ve istemcinin kimlik bilgilerini almak için form gövdesini denetler.</span><span class="sxs-lookup"><span data-stu-id="5fc28-179">`ValidateClientAuthentication` checks the basic scheme header and form body to get the client's credentials.</span></span>

<span data-ttu-id="5fc28-180">Oturum açma sayfasına aşağıda gösterilmiştir:</span><span class="sxs-lookup"><span data-stu-id="5fc28-180">The login page is shown below:</span></span>

![](owin-oauth-20-authorization-server/_static/image1.png)

<span data-ttu-id="5fc28-181">IETF's OAuth 2 gözden [yetkilendirme kodu verme](http://tools.ietf.org/html/rfc6749#section-4.1) now bölümü.</span><span class="sxs-lookup"><span data-stu-id="5fc28-181">Review the IETF's OAuth 2 [Authorization Code Grant](http://tools.ietf.org/html/rfc6749#section-4.1) section now.</span></span> 

<span data-ttu-id="5fc28-182">**Sağlayıcı** (aşağıdaki tabloda) olan [oauthauthorizationserveroptions öğelerinde](https://msdn.microsoft.com/en-us/library/microsoft.owin.security.oauth.oauthauthorizationserveroptions(v=vs.111).aspx). Tür sağlayıcısı `OAuthAuthorizationServerProvider`, tüm OAuth sunucu olaylarını içerir.</span><span class="sxs-lookup"><span data-stu-id="5fc28-182">**Provider** (in the table below) is [OAuthAuthorizationServerOptions](https://msdn.microsoft.com/en-us/library/microsoft.owin.security.oauth.oauthauthorizationserveroptions(v=vs.111).aspx).Provider, which is of type `OAuthAuthorizationServerProvider`, which contains all OAuth server events.</span></span> 

| <span data-ttu-id="5fc28-183">Yetkilendirme kodu verme bölümünden akışı adımları</span><span class="sxs-lookup"><span data-stu-id="5fc28-183">Flow steps from Authorization Code Grant section</span></span> | <span data-ttu-id="5fc28-184">Örnek indirme ile aşağıdaki adımları gerçekleştirir:</span><span class="sxs-lookup"><span data-stu-id="5fc28-184">Sample download performs these steps with:</span></span> |
| --- | --- |
|  |  |
| <span data-ttu-id="5fc28-185">(A) istemci yetkilendirme uç noktası için kaynak sahibinin kullanıcı aracısını yönlendirerek akışını başlatır.</span><span class="sxs-lookup"><span data-stu-id="5fc28-185">(A) The client initiates the flow by directing the resource owner's user-agent to the authorization endpoint.</span></span> <span data-ttu-id="5fc28-186">İstemci, istemci tanıtıcısını, istenen kapsamı, yerel durumu ve geri erişim izni (engellendi veya sonra), yetkilendirme sunucusu kullanıcı aracısını göndereceğiniz bir yeniden yönlendirme URI'si içerir.</span><span class="sxs-lookup"><span data-stu-id="5fc28-186">The client includes its client identifier, requested scope, local state, and a redirection URI to which the authorization server will send the user-agent back once access is granted (or denied).</span></span> | <span data-ttu-id="5fc28-187">Provider.MatchEndpoint Provider.ValidateClientRedirectUri Provider.ValidateAuthorizeRequest Provider.AuthorizeEndpoint</span><span class="sxs-lookup"><span data-stu-id="5fc28-187">Provider.MatchEndpoint Provider.ValidateClientRedirectUri Provider.ValidateAuthorizeRequest Provider.AuthorizeEndpoint</span></span> |
|  |  |
| <span data-ttu-id="5fc28-188">(B yetkilendirme sunucusu (aracılığıyla kullanıcı aracısı) kaynak sahibinin kimliğini doğrular ve kaynak sahibi verir veya istemcinin erişim isteği reddeder oluşturur.</span><span class="sxs-lookup"><span data-stu-id="5fc28-188">(B) The authorization server authenticates the resource owner (via the user-agent) and establishes whether the resource owner grants or denies the client's access request.</span></span> | <span data-ttu-id="5fc28-189">**&lt;Kullanıcı erişim verirse&gt;**  Provider.MatchEndpoint Provider.ValidateClientRedirectUri Provider.ValidateAuthorizeRequest Provider.AuthorizeEndpoint AuthorizationCodeProvider.CreateAsync</span><span class="sxs-lookup"><span data-stu-id="5fc28-189">**&lt;If user grants access&gt;** Provider.MatchEndpoint Provider.ValidateClientRedirectUri Provider.ValidateAuthorizeRequest Provider.AuthorizeEndpoint AuthorizationCodeProvider.CreateAsync</span></span> |
|  |  |
| <span data-ttu-id="5fc28-190">(C) kaynak sahibi olduğu varsayılarak erişim verir, yetkilendirme sunucusu kullanıcı aracısını yeniden yönlendirme URI'si sağlanan kullanarak istemciye yönlendirir önceki (istek veya istemci kaydı sırasında).</span><span class="sxs-lookup"><span data-stu-id="5fc28-190">(C) Assuming the resource owner grants access, the authorization server redirects the user-agent back to the client using the redirection URI provided earlier (in the request or during client registration).</span></span> <span data-ttu-id="5fc28-191">...</span><span class="sxs-lookup"><span data-stu-id="5fc28-191">...</span></span> |  |
|  |  |
| <span data-ttu-id="5fc28-192">(D) istemci, önceki adımda alınan yetkilendirme kodu dahil ederek, yetkilendirme sunucunun belirteç uç noktasından bir erişim belirteci ister.</span><span class="sxs-lookup"><span data-stu-id="5fc28-192">(D) The client requests an access token from the authorization server's token endpoint by including the authorization code received in the previous step.</span></span> <span data-ttu-id="5fc28-193">İsteği yaparken yetkilendirme sunucusu ile istemci kimliğini doğrular.</span><span class="sxs-lookup"><span data-stu-id="5fc28-193">When making the request, the client authenticates with the authorization server.</span></span> <span data-ttu-id="5fc28-194">İstemci doğrulaması için yetkilendirme kodu almak için URI kullanılan yeniden yönlendirme içerir.</span><span class="sxs-lookup"><span data-stu-id="5fc28-194">The client includes the redirection URI used to obtain the authorization code for verification.</span></span> | <span data-ttu-id="5fc28-195">Provider.MatchEndpoint Provider.ValidateClientAuthentication AuthorizationCodeProvider.ReceiveAsync Provider.ValidateTokenRequest Provider.GrantAuthorizationCode Provider.TokenEndpoint AccessTokenProvider.CreateAsync RefreshTokenProvider.CreateAsync</span><span class="sxs-lookup"><span data-stu-id="5fc28-195">Provider.MatchEndpoint Provider.ValidateClientAuthentication AuthorizationCodeProvider.ReceiveAsync Provider.ValidateTokenRequest Provider.GrantAuthorizationCode Provider.TokenEndpoint AccessTokenProvider.CreateAsync RefreshTokenProvider.CreateAsync</span></span> |

<span data-ttu-id="5fc28-196">Örnek uygulama için `AuthorizationCodeProvider.CreateAsync` ve `ReceiveAsync` oluşturulmasını ve yetkilendirme kodu doğrulanması denetlemek için aşağıda gösterilmiştir.</span><span class="sxs-lookup"><span data-stu-id="5fc28-196">A sample implementation for `AuthorizationCodeProvider.CreateAsync` and `ReceiveAsync` to control the creation and validation of authorization code is shown below.</span></span>

[!code-csharp[Main](owin-oauth-20-authorization-server/samples/sample5.cs)]

<span data-ttu-id="5fc28-197">Yukarıdaki kod bir bellek içi eşzamanlı dizin kod ve kimlik bilet depolamak ve kimlik kodu aldıktan sonra geri yüklemek için kullanır.</span><span class="sxs-lookup"><span data-stu-id="5fc28-197">The code above uses an in-memory concurrent dictionary to store the code and identity ticket and restore the identity after receiving the code.</span></span> <span data-ttu-id="5fc28-198">Gerçek bir uygulamada kalıcı veri deposu değiştirilmesi.</span><span class="sxs-lookup"><span data-stu-id="5fc28-198">In a real application, it would be replaced by a persistent data store.</span></span> <span data-ttu-id="5fc28-199">Kaynak sahibi istemciye erişim vermek için yetkilendirme uç noktadır.</span><span class="sxs-lookup"><span data-stu-id="5fc28-199">The authorization endpoint is for the resource owner to grant access to the client.</span></span> <span data-ttu-id="5fc28-200">Genellikle, bir düğmeye tıklayın ve grant onaylamak izin vermek için bir kullanıcı arabirimi gerekir.</span><span class="sxs-lookup"><span data-stu-id="5fc28-200">Usually, it needs a user interface to allow the user to click a button and confirm the grant.</span></span> <span data-ttu-id="5fc28-201">OWIN OAuth Ara yetkilendirme uç noktası işlemek uygulama kodu sağlar.</span><span class="sxs-lookup"><span data-stu-id="5fc28-201">OWIN OAuth middleware allows application code to handle the authorization endpoint.</span></span> <span data-ttu-id="5fc28-202">Adlı bir MVC denetleyicisi kullanırız bizim örnek uygulamamız `OAuthController` işlenmesi için.</span><span class="sxs-lookup"><span data-stu-id="5fc28-202">In our sample app, we use an MVC controller called `OAuthController` to handle it.</span></span> <span data-ttu-id="5fc28-203">Örnek uygulama şöyledir:</span><span class="sxs-lookup"><span data-stu-id="5fc28-203">Here is the sample implementation:</span></span>

[!code-csharp[Main](owin-oauth-20-authorization-server/samples/sample6.cs?highlight=15)]

<span data-ttu-id="5fc28-204">`Authorize` Eylemi, kullanıcı yetkilendirme sunucu üzerinde oturum açan değilse ilk denetleyecek.</span><span class="sxs-lookup"><span data-stu-id="5fc28-204">The `Authorize` action will first check if the user has logged in to the authorization server.</span></span> <span data-ttu-id="5fc28-205">Değilse, kimlik doğrulaması ara yazılımı "Uygulama" tanımlama bilgisi kullanarak kimlik doğrulaması için arayan sınar ve oturum açma sayfasına yönlendirir.</span><span class="sxs-lookup"><span data-stu-id="5fc28-205">If not, the authentication middleware challenges the caller to authenticate using the "Application" cookie and redirects to the login page.</span></span> <span data-ttu-id="5fc28-206">(Bkz. vurgulanmış kodu yukarıdaki.) Kullanıcının oturum açtığı, aşağıda gösterildiği gibi Authorize görünümü işlemek:</span><span class="sxs-lookup"><span data-stu-id="5fc28-206">(See highlighted code above.) If user has logged in, it will render the Authorize view, as shown below:</span></span>

![](owin-oauth-20-authorization-server/_static/image2.png)

<span data-ttu-id="5fc28-207">Varsa **Grant** düğmesi seçilirse, `Authorize` eylemi, yeni bir "Bearer" kimlik ve bunu oturum oluşturacaktır.</span><span class="sxs-lookup"><span data-stu-id="5fc28-207">If the **Grant** button is selected, the `Authorize` action will create a new "Bearer" identity and sign in with it.</span></span> <span data-ttu-id="5fc28-208">Bir taşıyıcı belirteç oluşturmak ve JSON yükü istemciye geri göndermek için yetkilendirme sunucusu tetikler.</span><span class="sxs-lookup"><span data-stu-id="5fc28-208">It will trigger the authorization server to generate a bearer token and send it back to the client with JSON payload.</span></span> 

### <a name="implicit-grant"></a><span data-ttu-id="5fc28-209">Kapalı verin</span><span class="sxs-lookup"><span data-stu-id="5fc28-209">Implicit Grant</span></span>

<span data-ttu-id="5fc28-210">IETF's OAuth 2'ye başvurmak [örtük Grant](http://tools.ietf.org/html/rfc6749#section-4.2) now bölümü.</span><span class="sxs-lookup"><span data-stu-id="5fc28-210">Refer to the IETF's OAuth 2 [Implicit Grant](http://tools.ietf.org/html/rfc6749#section-4.2) section now.</span></span>

 <span data-ttu-id="5fc28-211">[Örtük Grant](http://tools.ietf.org/html/rfc6749#section-4.2) Şekil 4'te gösterilen akış akışıdır ve hangi OWIN OAuth eşleme ara yazılım izler.</span><span class="sxs-lookup"><span data-stu-id="5fc28-211">The [Implicit Grant](http://tools.ietf.org/html/rfc6749#section-4.2) flow shown in Figure 4 is the flow and mapping which the OWIN OAuth middleware follows.</span></span>  

| <span data-ttu-id="5fc28-212">Örtük Grant bölümünden akışı adımları</span><span class="sxs-lookup"><span data-stu-id="5fc28-212">Flow steps from Implicit Grant section</span></span> | <span data-ttu-id="5fc28-213">Örnek indirme ile aşağıdaki adımları gerçekleştirir:</span><span class="sxs-lookup"><span data-stu-id="5fc28-213">Sample download performs these steps with:</span></span> |
| --- | --- |
|  |  |
| <span data-ttu-id="5fc28-214">(A) istemci yetkilendirme uç noktası için kaynak sahibinin kullanıcı aracısını yönlendirerek akışını başlatır.</span><span class="sxs-lookup"><span data-stu-id="5fc28-214">(A) The client initiates the flow by directing the resource owner's user-agent to the authorization endpoint.</span></span> <span data-ttu-id="5fc28-215">İstemci, istemci tanıtıcısını, istenen kapsamı, yerel durumu ve geri erişim izni (engellendi veya sonra), yetkilendirme sunucusu kullanıcı aracısını göndereceğiniz bir yeniden yönlendirme URI'si içerir.</span><span class="sxs-lookup"><span data-stu-id="5fc28-215">The client includes its client identifier, requested scope, local state, and a redirection URI to which the authorization server will send the user-agent back once access is granted (or denied).</span></span> | <span data-ttu-id="5fc28-216">Provider.MatchEndpoint Provider.ValidateClientRedirectUri Provider.ValidateAuthorizeRequest Provider.AuthorizeEndpoint</span><span class="sxs-lookup"><span data-stu-id="5fc28-216">Provider.MatchEndpoint Provider.ValidateClientRedirectUri Provider.ValidateAuthorizeRequest Provider.AuthorizeEndpoint</span></span> |
|  |  |
| <span data-ttu-id="5fc28-217">(B yetkilendirme sunucusu (aracılığıyla kullanıcı aracısı) kaynak sahibinin kimliğini doğrular ve kaynak sahibi verir veya istemcinin erişim isteği reddeder oluşturur.</span><span class="sxs-lookup"><span data-stu-id="5fc28-217">(B) The authorization server authenticates the resource owner (via the user-agent) and establishes whether the resource owner grants or denies the client's access request.</span></span> | <span data-ttu-id="5fc28-218">**&lt;Kullanıcı erişim verirse&gt;**  Provider.MatchEndpoint Provider.ValidateClientRedirectUri Provider.ValidateAuthorizeRequest Provider.AuthorizeEndpoint AuthorizationCodeProvider.CreateAsync</span><span class="sxs-lookup"><span data-stu-id="5fc28-218">**&lt;If user grants access&gt;** Provider.MatchEndpoint Provider.ValidateClientRedirectUri Provider.ValidateAuthorizeRequest Provider.AuthorizeEndpoint AuthorizationCodeProvider.CreateAsync</span></span> |
|  |  |
| <span data-ttu-id="5fc28-219">(C) kaynak sahibi olduğu varsayılarak erişim verir, yetkilendirme sunucusu kullanıcı aracısını yeniden yönlendirme URI'si sağlanan kullanarak istemciye yönlendirir önceki (istek veya istemci kaydı sırasında).</span><span class="sxs-lookup"><span data-stu-id="5fc28-219">(C) Assuming the resource owner grants access, the authorization server redirects the user-agent back to the client using the redirection URI provided earlier (in the request or during client registration).</span></span> <span data-ttu-id="5fc28-220">...</span><span class="sxs-lookup"><span data-stu-id="5fc28-220">...</span></span> |  |
|  |  |
| <span data-ttu-id="5fc28-221">(D) istemci, önceki adımda alınan yetkilendirme kodu dahil ederek, yetkilendirme sunucunun belirteç uç noktasından bir erişim belirteci ister.</span><span class="sxs-lookup"><span data-stu-id="5fc28-221">(D) The client requests an access token from the authorization server's token endpoint by including the authorization code received in the previous step.</span></span> <span data-ttu-id="5fc28-222">İsteği yaparken yetkilendirme sunucusu ile istemci kimliğini doğrular.</span><span class="sxs-lookup"><span data-stu-id="5fc28-222">When making the request, the client authenticates with the authorization server.</span></span> <span data-ttu-id="5fc28-223">İstemci doğrulaması için yetkilendirme kodu almak için URI kullanılan yeniden yönlendirme içerir.</span><span class="sxs-lookup"><span data-stu-id="5fc28-223">The client includes the redirection URI used to obtain the authorization code for verification.</span></span> |  |

<span data-ttu-id="5fc28-224">Biz yetkilendirme uç nokta zaten uygulanmış olduğundan (`OAuthController.Authorize` eylemi) yetkilendirme kodu verme için otomatik olarak örtük akışını etkinleştirir.</span><span class="sxs-lookup"><span data-stu-id="5fc28-224">Since we already implemented the authorization endpoint (`OAuthController.Authorize` action) for authorization code grant, it automatically enables implicit flow as well.</span></span> <span data-ttu-id="5fc28-225">Not: `Provider.ValidateClientRedirectUri` erişim belirteci kötü amaçlı olarak istemciler göndermesini dolaylı grant akış korur, yeniden yönlendirme URL'si ile istemci Kimliğini doğrulamak için kullanılır ([Man-in--middle saldırı](https://www.owasp.org/index.php/Man-in-the-middle_attack)).</span><span class="sxs-lookup"><span data-stu-id="5fc28-225">Note: `Provider.ValidateClientRedirectUri` is used to validate the client ID with its redirection URL, which protects the implicit grant flow from sending the access token to malicious clients ([Man-in-the-middle attack](https://www.owasp.org/index.php/Man-in-the-middle_attack)).</span></span>

### <a name="resource-owner-password-credentials-grant"></a><span data-ttu-id="5fc28-226">Kaynak sahibi parolası kimlik bilgileri verin</span><span class="sxs-lookup"><span data-stu-id="5fc28-226">Resource Owner Password Credentials Grant</span></span>

<span data-ttu-id="5fc28-227">IETF's OAuth 2'ye başvurmak [kaynak sahibi parolası kimlik bilgileri sağlama](http://tools.ietf.org/html/rfc6749#section-4.3) now bölümü.</span><span class="sxs-lookup"><span data-stu-id="5fc28-227">Refer to the IETF's OAuth 2 [Resource Owner Password Credentials Grant](http://tools.ietf.org/html/rfc6749#section-4.3) section now.</span></span>

 <span data-ttu-id="5fc28-228">[Kaynak sahibi parolası kimlik bilgileri sağlama](http://tools.ietf.org/html/rfc6749#section-4.3) Şekil 5'te gösterilen akış akışıdır ve hangi OWIN OAuth eşleme ara yazılım izler.</span><span class="sxs-lookup"><span data-stu-id="5fc28-228">The [Resource Owner Password Credentials Grant](http://tools.ietf.org/html/rfc6749#section-4.3) flow shown in Figure 5 is the flow and mapping which the OWIN OAuth middleware follows.</span></span>  

| <span data-ttu-id="5fc28-229">Kaynak sahibi parolası kimlik bilgileri sağlama bölümünden akışı adımları</span><span class="sxs-lookup"><span data-stu-id="5fc28-229">Flow steps from Resource Owner Password Credentials Grant section</span></span> | <span data-ttu-id="5fc28-230">Örnek indirme ile aşağıdaki adımları gerçekleştirir:</span><span class="sxs-lookup"><span data-stu-id="5fc28-230">Sample download performs these steps with:</span></span> |
| --- | --- |
|  |  |
| <span data-ttu-id="5fc28-231">(A) kaynak sahibi, kullanıcı adı ve parola ile istemci sağlar.</span><span class="sxs-lookup"><span data-stu-id="5fc28-231">(A) The resource owner provides the client with its username and password.</span></span> |  |
|  |  |
| <span data-ttu-id="5fc28-232">(B) istemci bir erişim belirteci kaynak sahibinden alınan kimlik bilgileri dahil ederek yetkilendirme sunucusunun belirteç uç noktasından ister.</span><span class="sxs-lookup"><span data-stu-id="5fc28-232">(B) The client requests an access token from the authorization server's token endpoint by including the credentials received from the resource owner.</span></span> <span data-ttu-id="5fc28-233">İsteği yaparken yetkilendirme sunucusu ile istemci kimliğini doğrular.</span><span class="sxs-lookup"><span data-stu-id="5fc28-233">When making the request, the client authenticates with the authorization server.</span></span> | <span data-ttu-id="5fc28-234">Provider.MatchEndpoint Provider.ValidateClientAuthentication Provider.ValidateTokenRequest Provider.GrantResourceOwnerCredentials Provider.TokenEndpoint AccessToken Provider.CreateAsync RefreshTokenProvider.CreateAsync</span><span class="sxs-lookup"><span data-stu-id="5fc28-234">Provider.MatchEndpoint Provider.ValidateClientAuthentication Provider.ValidateTokenRequest Provider.GrantResourceOwnerCredentials Provider.TokenEndpoint AccessToken Provider.CreateAsync RefreshTokenProvider.CreateAsync</span></span> |
|  |  |
| <span data-ttu-id="5fc28-235">(C) yetkilendirme sunucusu istemcinin kimliğini doğrular ve kaynak sahibi kimlik bilgilerini doğrular ve geçerliyse, bir erişim belirteci verir.</span><span class="sxs-lookup"><span data-stu-id="5fc28-235">(C) The authorization server authenticates the client and validates the resource owner credentials, and if valid, issues an access token.</span></span> |  |

<span data-ttu-id="5fc28-236">Örnek uygulama için işte `Provider.GrantResourceOwnerCredentials`:</span><span class="sxs-lookup"><span data-stu-id="5fc28-236">Here is the sample implementation for `Provider.GrantResourceOwnerCredentials`:</span></span>

[!code-csharp[Main](owin-oauth-20-authorization-server/samples/sample7.cs)]

> [!NOTE]
> <span data-ttu-id="5fc28-237">Yukarıdaki kod öğreticinin bu bölümünde açıklamak için tasarlanmıştır ve güvenliğini kullanılmamalıdır veya üretim uygulamaları.</span><span class="sxs-lookup"><span data-stu-id="5fc28-237">The code above is intended to explain this section of the tutorial and should not be used in secure or production apps.</span></span> <span data-ttu-id="5fc28-238">Kaynak sahipleri kimlik bilgilerini denetlemez.</span><span class="sxs-lookup"><span data-stu-id="5fc28-238">It does not check the resource owners credentials.</span></span> <span data-ttu-id="5fc28-239">Her kimlik bilgilerinin geçerli olduğunu ve bunun için yeni bir kimlik oluşturur varsayar.</span><span class="sxs-lookup"><span data-stu-id="5fc28-239">It assumes every credential is valid and creates a new identity for it.</span></span> <span data-ttu-id="5fc28-240">Yeni kimlik, erişim belirtecini oluşturmak ve belirteç yenilemek için kullanılır.</span><span class="sxs-lookup"><span data-stu-id="5fc28-240">The new identity will be used to generate the access token and refresh token.</span></span> <span data-ttu-id="5fc28-241">Lütfen kodu kendi güvenli hesap yönetimi kod ile değiştirin.</span><span class="sxs-lookup"><span data-stu-id="5fc28-241">Please replace the code with your own secure account management code.</span></span>


### <a name="client-credentials-grant"></a><span data-ttu-id="5fc28-242">İstemci kimlik bilgileri verin</span><span class="sxs-lookup"><span data-stu-id="5fc28-242">Client Credentials Grant</span></span>

<span data-ttu-id="5fc28-243">IETF's OAuth 2'ye başvurmak [istemci kimlik bilgileri sağlama](http://tools.ietf.org/html/rfc6749#section-4.4) now bölümü.</span><span class="sxs-lookup"><span data-stu-id="5fc28-243">Refer to the IETF's OAuth 2 [Client Credentials Grant](http://tools.ietf.org/html/rfc6749#section-4.4) section now.</span></span>

 <span data-ttu-id="5fc28-244">[İstemci kimlik bilgileri sağlama](http://tools.ietf.org/html/rfc6749#section-4.4) Şekil 6'da gösterilen akış akışıdır ve hangi OWIN OAuth eşleme ara yazılım izler.</span><span class="sxs-lookup"><span data-stu-id="5fc28-244">The [Client Credentials Grant](http://tools.ietf.org/html/rfc6749#section-4.4) flow shown in Figure 6 is the flow and mapping which the OWIN OAuth middleware follows.</span></span>  

| <span data-ttu-id="5fc28-245">İstemci kimlik bilgileri sağlama bölümünden akışı adımları</span><span class="sxs-lookup"><span data-stu-id="5fc28-245">Flow steps from Client Credentials Grant section</span></span> | <span data-ttu-id="5fc28-246">Örnek indirme ile aşağıdaki adımları gerçekleştirir:</span><span class="sxs-lookup"><span data-stu-id="5fc28-246">Sample download performs these steps with:</span></span> |
| --- | --- |
|  |  |
| <span data-ttu-id="5fc28-247">(A) istemci yetkilendirme ile kimlik doğrulamasını ve belirteç uç noktasından bir erişim belirteci ister.</span><span class="sxs-lookup"><span data-stu-id="5fc28-247">(A) The client authenticates with the authorization server and requests an access token from the token endpoint.</span></span> | <span data-ttu-id="5fc28-248">Provider.MatchEndpoint Provider.ValidateClientAuthentication Provider.ValidateTokenRequest Provider.GrantClientCredentials Provider.TokenEndpoint AccessTokenProvider.CreateAsync RefreshTokenProvider.CreateAsync</span><span class="sxs-lookup"><span data-stu-id="5fc28-248">Provider.MatchEndpoint Provider.ValidateClientAuthentication Provider.ValidateTokenRequest Provider.GrantClientCredentials Provider.TokenEndpoint AccessTokenProvider.CreateAsync RefreshTokenProvider.CreateAsync</span></span> |
|  |  |
| <span data-ttu-id="5fc28-249">(B yetkilendirme sunucusu istemci kimliğini doğrular ve geçerliyse, bir erişim belirteci verir.</span><span class="sxs-lookup"><span data-stu-id="5fc28-249">(B) The authorization server authenticates the client, and if valid, issues an access token.</span></span> |  |

<span data-ttu-id="5fc28-250">Örnek uygulama için işte `Provider.GrantClientCredentials`:</span><span class="sxs-lookup"><span data-stu-id="5fc28-250">Here is the sample implementation for `Provider.GrantClientCredentials`:</span></span>

[!code-csharp[Main](owin-oauth-20-authorization-server/samples/sample8.cs)]

> [!NOTE]
> <span data-ttu-id="5fc28-251">Yukarıdaki kod öğreticinin bu bölümünde açıklamak için tasarlanmıştır ve güvenliğini kullanılmamalıdır veya üretim uygulamaları.</span><span class="sxs-lookup"><span data-stu-id="5fc28-251">The code above is intended to explain this section of the tutorial and should not be used in secure or production apps.</span></span> <span data-ttu-id="5fc28-252">Lütfen kodu kendi güvenli istemci Yönetimi kod ile değiştirin.</span><span class="sxs-lookup"><span data-stu-id="5fc28-252">Please replace the code with your own secure client management code.</span></span>


### <a name="refresh-token"></a><span data-ttu-id="5fc28-253">Belirteç Yenile</span><span class="sxs-lookup"><span data-stu-id="5fc28-253">Refresh Token</span></span>

<span data-ttu-id="5fc28-254">IETF's OAuth 2'ye başvurmak [yenileme belirteci](http://tools.ietf.org/html/rfc6749#section-1.5) now bölümü.</span><span class="sxs-lookup"><span data-stu-id="5fc28-254">Refer to the IETF's OAuth 2 [Refresh Token](http://tools.ietf.org/html/rfc6749#section-1.5) section now.</span></span>

 <span data-ttu-id="5fc28-255">[Yenileme belirteci](http://tools.ietf.org/html/rfc6749#section-1.5) Şekil 2'de gösterilen akış akışıdır ve hangi OWIN OAuth eşleme ara yazılım izler.</span><span class="sxs-lookup"><span data-stu-id="5fc28-255">The [Refresh Token](http://tools.ietf.org/html/rfc6749#section-1.5) flow shown in Figure 2 is the flow and mapping which the OWIN OAuth middleware follows.</span></span>  

| <span data-ttu-id="5fc28-256">İstemci kimlik bilgileri sağlama bölümünden akışı adımları</span><span class="sxs-lookup"><span data-stu-id="5fc28-256">Flow steps from Client Credentials Grant section</span></span> | <span data-ttu-id="5fc28-257">Örnek indirme ile aşağıdaki adımları gerçekleştirir:</span><span class="sxs-lookup"><span data-stu-id="5fc28-257">Sample download performs these steps with:</span></span> |
| --- | --- |
|  |  |
| <span data-ttu-id="5fc28-258">(G) istemci, yetkilendirme sunucusu ile kimlik doğrulaması ve yenileme belirtecini sunan yeni bir erişim belirteci ister.</span><span class="sxs-lookup"><span data-stu-id="5fc28-258">(G) The client requests a new access token by authenticating with the authorization server and presenting the refresh token.</span></span> <span data-ttu-id="5fc28-259">İstemci kimlik doğrulaması gereksinimleri, istemci türüne ve yetkilendirme sunucusu ilkelerini temel alır.</span><span class="sxs-lookup"><span data-stu-id="5fc28-259">The client authentication requirements are based on the client type and on the authorization server policies.</span></span> | <span data-ttu-id="5fc28-260">Provider.MatchEndpoint Provider.ValidateClientAuthentication RefreshTokenProvider.ReceiveAsync Provider.ValidateTokenRequest Provider.GrantRefreshToken Provider.TokenEndpoint AccessTokenProvider.CreateAsync RefreshTokenProvider.CreateAsync</span><span class="sxs-lookup"><span data-stu-id="5fc28-260">Provider.MatchEndpoint Provider.ValidateClientAuthentication RefreshTokenProvider.ReceiveAsync Provider.ValidateTokenRequest Provider.GrantRefreshToken Provider.TokenEndpoint AccessTokenProvider.CreateAsync RefreshTokenProvider.CreateAsync</span></span> |
|  |  |
| <span data-ttu-id="5fc28-261">(Y yetkilendirme sunucusu istemcinin kimliğini doğrular ve yenileme belirteci doğrular ve geçerliyse, yeni bir erişim belirteci (ve isteğe bağlı olarak, yeni bir yenileme belirteci) verir.</span><span class="sxs-lookup"><span data-stu-id="5fc28-261">(H) The authorization server authenticates the client and validates the refresh token, and if valid, issues a new access token (and, optionally, a new refresh token).</span></span> |  |

<span data-ttu-id="5fc28-262">Örnek uygulama için işte `Provider.GrantRefreshToken`:</span><span class="sxs-lookup"><span data-stu-id="5fc28-262">Here is the sample implementation for `Provider.GrantRefreshToken`:</span></span> 

[!code-csharp[Main](owin-oauth-20-authorization-server/samples/sample9.cs)]

[!code-csharp[Main](owin-oauth-20-authorization-server/samples/sample10.cs)]

## <a name="create-a-resource-server-which-is-protected-by-access-token"></a><span data-ttu-id="5fc28-263">Erişim belirteci tarafından korunan bir kaynak sunucu oluşturma</span><span class="sxs-lookup"><span data-stu-id="5fc28-263">Create a Resource Server which is protected by Access Token</span></span>

<span data-ttu-id="5fc28-264">Bir boş web uygulama projesi oluşturun ve projeyi paketlerinde aşağıdaki yükleyin:</span><span class="sxs-lookup"><span data-stu-id="5fc28-264">Create an empty web app project and install following packages in the project:</span></span>

- <span data-ttu-id="5fc28-265">Microsoft.AspNet.WebApi.Owin</span><span class="sxs-lookup"><span data-stu-id="5fc28-265">Microsoft.AspNet.WebApi.Owin</span></span>
- <span data-ttu-id="5fc28-266">Microsoft.Owin.Host.SystemWeb</span><span class="sxs-lookup"><span data-stu-id="5fc28-266">Microsoft.Owin.Host.SystemWeb</span></span>
- <span data-ttu-id="5fc28-267">Microsoft.Owin.Security.OAuth</span><span class="sxs-lookup"><span data-stu-id="5fc28-267">Microsoft.Owin.Security.OAuth</span></span>

<span data-ttu-id="5fc28-268">Başlangıç sınıfı oluşturun ve kimlik doğrulama ve Web API yapılandırın.</span><span class="sxs-lookup"><span data-stu-id="5fc28-268">Create a startup class and configure authentication and Web API.</span></span> <span data-ttu-id="5fc28-269">Bkz: *AuthorizationServer\ResourceServer\Startup.cs* örnek indirme içinde.</span><span class="sxs-lookup"><span data-stu-id="5fc28-269">See *AuthorizationServer\ResourceServer\Startup.cs* in the sample download.</span></span>

[!code-csharp[Main](owin-oauth-20-authorization-server/samples/sample11.cs)]

<span data-ttu-id="5fc28-270">Bkz: *AuthorizationServer\ResourceServer\App\_Start\Startup.Auth.cs* örnek indirme içinde.</span><span class="sxs-lookup"><span data-stu-id="5fc28-270">See *AuthorizationServer\ResourceServer\App\_Start\Startup.Auth.cs* in the sample download.</span></span>

[!code-csharp[Main](owin-oauth-20-authorization-server/samples/sample12.cs)]

<span data-ttu-id="5fc28-271">Bkz: *AuthorizationServer\ResourceServer\App\_Start\Startup.WebApi.cs* örnek indirme içinde.</span><span class="sxs-lookup"><span data-stu-id="5fc28-271">See *AuthorizationServer\ResourceServer\App\_Start\Startup.WebApi.cs* in the sample download.</span></span>

[!code-csharp[Main](owin-oauth-20-authorization-server/samples/sample13.cs)]

- <span data-ttu-id="5fc28-272">`UseCors`yöntemi, tüm etki alanları için CORS sağlar.</span><span class="sxs-lookup"><span data-stu-id="5fc28-272">`UseCors` method allows CORS for all domains.</span></span>
- <span data-ttu-id="5fc28-273">`UseOAuthBearerAuthentication`yöntemi, alır ve talep yetkilendirme başlığından taşıyıcı belirtecini doğrula OAuth taşıyıcı belirteci kimlik doğrulaması ara yazılımı sağlar.</span><span class="sxs-lookup"><span data-stu-id="5fc28-273">`UseOAuthBearerAuthentication` method enables OAuth bearer token authentication middleware which will receive and validate bearer token from authorization header in the request.</span></span>
- <span data-ttu-id="5fc28-274">`Config.SuppressDefaultHostAuthenticaiton`Varsayılan bastırır ana bilgisayar kimliği doğrulanmış sorumlu uygulamasından, tüm istekler bu çağrısından sonra bu nedenle anonim olacaktır.</span><span class="sxs-lookup"><span data-stu-id="5fc28-274">`Config.SuppressDefaultHostAuthenticaiton` suppresses default host authenticated principal from the app, therefore all requests will be anonymous after this call.</span></span>
- <span data-ttu-id="5fc28-275">`HostAuthenticationFilter`yalnızca belirtilen kimlik doğrulama türü için kimlik doğrulamasını etkinleştirir.</span><span class="sxs-lookup"><span data-stu-id="5fc28-275">`HostAuthenticationFilter` enables authentication just for the specified authentication type.</span></span> <span data-ttu-id="5fc28-276">Bu durumda, taşıyıcı kimlik doğrulaması türü değil.</span><span class="sxs-lookup"><span data-stu-id="5fc28-276">In this case, it's bearer authentication type.</span></span>

<span data-ttu-id="5fc28-277">Kimlik doğrulaması göstermek için geçerli kullanıcının talepleri çıktısını almak için bir ApiController oluşturuyoruz.</span><span class="sxs-lookup"><span data-stu-id="5fc28-277">In order to demonstrate the authenticated identity, we create an ApiController to output current user's claims.</span></span>

[!code-csharp[Main](owin-oauth-20-authorization-server/samples/sample14.cs)]

<span data-ttu-id="5fc28-278">Yetkilendirme sunucusu ve kaynak sunucuda aynı bilgisayarda değilse, OAuth Ara şifrelemek ve taşıyıcı erişim belirteci şifresini çözmek için farklı makine anahtarları kullanır.</span><span class="sxs-lookup"><span data-stu-id="5fc28-278">If the authorization server and the resource server are not on the same computer, the OAuth middleware will use the different machine keys to encrypt and decrypt bearer access token.</span></span> <span data-ttu-id="5fc28-279">Aynı özel anahtarı her iki projeler arasında paylaşmak için aynı eklediğimiz `machinekey` hem de ayarlama *web.config* dosyaları.</span><span class="sxs-lookup"><span data-stu-id="5fc28-279">In order to share the same private key between both projects, we add the same `machinekey` setting in both *web.config* files.</span></span>

[!code-xml[Main](owin-oauth-20-authorization-server/samples/sample15.xml?highlight=8-10)]

## <a name="create-oauth-20-clients"></a><span data-ttu-id="5fc28-280">OAuth 2.0 istemcileri oluşturma</span><span class="sxs-lookup"><span data-stu-id="5fc28-280">Create OAuth 2.0 Clients</span></span>

 <span data-ttu-id="5fc28-281">Kullanırız [DotNetOpenAuth.OAuth2.Client](http://www.nuget.org/packages/DotNetOpenAuth.OAuth2.Client) istemci kodu basitleştirmek için NuGet paketi.</span><span class="sxs-lookup"><span data-stu-id="5fc28-281">We use the [DotNetOpenAuth.OAuth2.Client](http://www.nuget.org/packages/DotNetOpenAuth.OAuth2.Client) NuGet package to simplify the client code.</span></span>

### <a name="authorization-code-grant-client"></a><span data-ttu-id="5fc28-282">Yetkilendirme kodu verme istemci</span><span class="sxs-lookup"><span data-stu-id="5fc28-282">Authorization Code Grant Client</span></span>

 <span data-ttu-id="5fc28-283">Bir MVC uygulaması istemcidir.</span><span class="sxs-lookup"><span data-stu-id="5fc28-283">This client is an MVC application.</span></span> <span data-ttu-id="5fc28-284">Arka ucunuzdan erişim belirteci almak üzere bir yetkilendirme kodu verme akışını tetikler.</span><span class="sxs-lookup"><span data-stu-id="5fc28-284">It will trigger an authorization code grant flow to get the access token from backend.</span></span> <span data-ttu-id="5fc28-285">Aşağıda gösterildiği gibi tek bir sayfayla sahiptir:</span><span class="sxs-lookup"><span data-stu-id="5fc28-285">It has a single page as shown below:</span></span>

![](owin-oauth-20-authorization-server/_static/image3.png)

- <span data-ttu-id="5fc28-286">**Authorize** düğmesi yönlendirmek tarayıcı bu istemciye erişim vermek üzere kaynak sahibi bildirmek için yetkilendirme sunucusu için.</span><span class="sxs-lookup"><span data-stu-id="5fc28-286">The **Authorize** button will redirect browser to the authorization server to notify the resource owner to grant access to this client.</span></span>
- <span data-ttu-id="5fc28-287">**Yenileme** düğmesi elde edersiniz yeni bir erişim belirteci ve yenileme belirteci geçerli yenileme kullanarak belirteci.</span><span class="sxs-lookup"><span data-stu-id="5fc28-287">The **Refresh** button will get a new access token and refresh token using the current refresh token.</span></span>
- <span data-ttu-id="5fc28-288">**Erişim korumalı kaynak API** düğmesi, geçerli kullanıcının talep verileri almak ve bunları sayfada göstermek için kaynak sunucunun çağıracaktır.</span><span class="sxs-lookup"><span data-stu-id="5fc28-288">The **Access Protected Resource API** button will call the resource server to get current user's claims data and show them on the page.</span></span>

<span data-ttu-id="5fc28-289">Örnek kodunu işte `HomeController` istemcinin.</span><span class="sxs-lookup"><span data-stu-id="5fc28-289">Here is the sample code of the `HomeController` of the client.</span></span>

[!code-csharp[Main](owin-oauth-20-authorization-server/samples/sample16.cs)]

<span data-ttu-id="5fc28-290">`DotNetOpenAuth`Varsayılan olarak SSL gerektirir.</span><span class="sxs-lookup"><span data-stu-id="5fc28-290">`DotNetOpenAuth` requires SSL by default.</span></span> <span data-ttu-id="5fc28-291">Kendi Tanıtımı HTTP kullandığından, eklemek istediğiniz ayar yapılandırma dosyasında aşağıdaki:</span><span class="sxs-lookup"><span data-stu-id="5fc28-291">Since our demo is using HTTP, you need to add following setting in the config file:</span></span>

[!code-xml[Main](owin-oauth-20-authorization-server/samples/sample17.xml?highlight=4-6)]

> [!WARNING]
> <span data-ttu-id="5fc28-292">Güvenlik - hiçbir zaman devre dışı bırak SSL bir üretim uygulamasında.</span><span class="sxs-lookup"><span data-stu-id="5fc28-292">Security - Never disable SSL in a production app.</span></span> <span data-ttu-id="5fc28-293">Oturum açma kimlik bilgilerinizi şimdi ağ üzerinden düz metin olarak gönderiliyor.</span><span class="sxs-lookup"><span data-stu-id="5fc28-293">Your login credentials are now being sent in clear-text across the wire.</span></span> <span data-ttu-id="5fc28-294">Yukarıdaki kod yalnızca yerel örnek hata ayıklama ve araştırması içindir.</span><span class="sxs-lookup"><span data-stu-id="5fc28-294">The code above is just for local sample debugging and exploration.</span></span>


### <a name="implicit-grant-client"></a><span data-ttu-id="5fc28-295">Örtük Grant istemci</span><span class="sxs-lookup"><span data-stu-id="5fc28-295">Implicit Grant Client</span></span>

<span data-ttu-id="5fc28-296">Bu istemci için JavaScript kullanıyor:</span><span class="sxs-lookup"><span data-stu-id="5fc28-296">This client is using JavaScript to:</span></span>

1. <span data-ttu-id="5fc28-297">Yeni bir pencerede açmak ve yetkilendirme sunucusu authorize son noktası yönlendirin.</span><span class="sxs-lookup"><span data-stu-id="5fc28-297">Open a new window and redirect to the authorize endpoint of the Authorization Server.</span></span>
2. <span data-ttu-id="5fc28-298">Yeniden yönlendirildiklerinde erişim URL'si parçaları belirteci alın.</span><span class="sxs-lookup"><span data-stu-id="5fc28-298">Get the access token from URL fragments when it redirects back.</span></span>

<span data-ttu-id="5fc28-299">Aşağıdaki resimde bu süreci göstermektedir:</span><span class="sxs-lookup"><span data-stu-id="5fc28-299">The following image shows this process:</span></span>

![](owin-oauth-20-authorization-server/_static/image4.png)

<span data-ttu-id="5fc28-300">İstemci iki sayfa olması gerekir: bir giriş sayfası diğeri geri çağırma. JavaScript kodu bulunan örnek işte *Index.cshtml* dosyası:</span><span class="sxs-lookup"><span data-stu-id="5fc28-300">The client should have two pages: one for home page and the other for callback.Here is the sample JavaScript code found in the *Index.cshtml* file:</span></span>

[!code-cshtml[Main](owin-oauth-20-authorization-server/samples/sample18.cshtml)]

<span data-ttu-id="5fc28-301">Kodda işleme geri çağırma işte *SignIn.cshtml* dosyası:</span><span class="sxs-lookup"><span data-stu-id="5fc28-301">Here is the callback handling code in *SignIn.cshtml* file:</span></span>

[!code-cshtml[Main](owin-oauth-20-authorization-server/samples/sample19.cshtml)]

> [!NOTE]
> <span data-ttu-id="5fc28-302">En iyi uygulama, JavaScript harici bir dosyaya taşıma ve Razor biçimlendirme ile embed değil olmaktır.</span><span class="sxs-lookup"><span data-stu-id="5fc28-302">A best practice is to move the JavaScript to an external file and not embed it with the Razor markup.</span></span> <span data-ttu-id="5fc28-303">Bu örneği basit tutmak için bunlar birleştirilmiştir.</span><span class="sxs-lookup"><span data-stu-id="5fc28-303">To keep this sample simple, they have been combined.</span></span>


### <a name="resource-owner-password-credentials-grant-client"></a><span data-ttu-id="5fc28-304">Kaynak sahibi parolası Grant istemci kimlik bilgileri</span><span class="sxs-lookup"><span data-stu-id="5fc28-304">Resource Owner Password Credentials Grant Client</span></span>

<span data-ttu-id="5fc28-305">Biz bir konsol uygulaması bu istemci gösteri için kullanır.</span><span class="sxs-lookup"><span data-stu-id="5fc28-305">We uses a console app to demo this client.</span></span> <span data-ttu-id="5fc28-306">Kod aşağıdaki gibidir:</span><span class="sxs-lookup"><span data-stu-id="5fc28-306">Here is the code:</span></span>

[!code-csharp[Main](owin-oauth-20-authorization-server/samples/sample20.cs)]

### <a name="client-credentials-grant-client"></a><span data-ttu-id="5fc28-307">İstemci kimlik bilgileri verin istemci</span><span class="sxs-lookup"><span data-stu-id="5fc28-307">Client Credentials Grant Client</span></span>

<span data-ttu-id="5fc28-308">Kaynak sahibi parolası kimlik bilgileri sağlama, burada benzer konsol uygulama kodu:</span><span class="sxs-lookup"><span data-stu-id="5fc28-308">Similar to the Resource Owner Password Credentials Grant, here is console app code:</span></span>

[!code-csharp[Main](owin-oauth-20-authorization-server/samples/sample21.cs)]
