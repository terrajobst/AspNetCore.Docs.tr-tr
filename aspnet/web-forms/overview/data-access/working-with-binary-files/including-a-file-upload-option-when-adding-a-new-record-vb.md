---
uid: web-forms/overview/data-access/working-with-binary-files/including-a-file-upload-option-when-adding-a-new-record-vb
title: "Bir dosya karşıya yükleme seçeneği yeni bir kayıt (VB) eklerken | Microsoft Docs"
author: rick-anderson
description: "Bu öğretici hem metin verileri girin ve ikili dosyaları karşıya yükleme yapmasına izin veren bir Web arabirimi oluşturulacağını gösterir. Seçenekleri kullanılabilir t göstermek için..."
ms.author: aspnetcontent
manager: wpickett
ms.date: 03/27/2007
ms.topic: article
ms.assetid: 5776281d-4637-4d1e-a65b-2621d2cade44
ms.technology: dotnet-webforms
ms.prod: .net-framework
msc.legacyurl: /web-forms/overview/data-access/working-with-binary-files/including-a-file-upload-option-when-adding-a-new-record-vb
msc.type: authoredcontent
ms.openlocfilehash: 4f49c201c71ca8f98d7e15b29f1df9a6bcd1b12e
ms.sourcegitcommit: 9a9483aceb34591c97451997036a9120c3fe2baf
ms.translationtype: MT
ms.contentlocale: tr-TR
ms.lasthandoff: 11/10/2017
---
<a name="including-a-file-upload-option-when-adding-a-new-record-vb"></a><span data-ttu-id="15c29-104">Yeni bir kayıt (VB) eklerken bir dosyayı karşıya yükleme seçeneği de dahil olmak üzere</span><span class="sxs-lookup"><span data-stu-id="15c29-104">Including a File Upload Option When Adding a New Record (VB)</span></span>
====================
<span data-ttu-id="15c29-105">tarafından [Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="15c29-105">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="15c29-106">[Örnek uygulamayı indirin](http://download.microsoft.com/download/4/a/7/4a7a3b18-d80e-4014-8e53-a6a2427f0d93/ASPNET_Data_Tutorial_56_VB.exe) veya [PDF indirin](including-a-file-upload-option-when-adding-a-new-record-vb/_static/datatutorial56vb1.pdf)</span><span class="sxs-lookup"><span data-stu-id="15c29-106">[Download Sample App](http://download.microsoft.com/download/4/a/7/4a7a3b18-d80e-4014-8e53-a6a2427f0d93/ASPNET_Data_Tutorial_56_VB.exe) or [Download PDF](including-a-file-upload-option-when-adding-a-new-record-vb/_static/datatutorial56vb1.pdf)</span></span>

> <span data-ttu-id="15c29-107">Bu öğretici hem metin verileri girin ve ikili dosyaları karşıya yükleme yapmasına izin veren bir Web arabirimi oluşturulacağını gösterir.</span><span class="sxs-lookup"><span data-stu-id="15c29-107">This tutorial shows how to create a Web interface that allows the user to both enter text data and upload binary files.</span></span> <span data-ttu-id="15c29-108">Diğer dosya sisteminde barındırırken ikili verileri depolamak için kullanılabilir seçenekleri göstermek için bir dosya veritabanına kaydedilir.</span><span class="sxs-lookup"><span data-stu-id="15c29-108">To illustrate the options available to store binary data, one file will be saved in the database while the other is stored in the file system.</span></span>


## <a name="introduction"></a><span data-ttu-id="15c29-109">Giriş</span><span class="sxs-lookup"><span data-stu-id="15c29-109">Introduction</span></span>

<span data-ttu-id="15c29-110">Önceki iki eğitimlerine biz dosyaları istemciden web sunucusuna göndermek ve bir veri W bu ikili verileri sunmak öğrendiniz dosya yükleme denetimi kullanmak nasıl Aranan uygulama s veri modeli ile ilişkili ikili verileri depolamak için teknikleri incelediniz EB denetim.</span><span class="sxs-lookup"><span data-stu-id="15c29-110">In the previous two tutorials we explored techniques for storing binary data that is associated with the application s data model, looked at how to use the FileUpload control to send files from the client to the web server, and saw how to present this binary data in a data Web control.</span></span> <span data-ttu-id="15c29-111">Biz ve henüz karşıya yüklenen veriler yine de veri modeli ile ilişkilendirmek hakkında konuşun.</span><span class="sxs-lookup"><span data-stu-id="15c29-111">We ve yet to talk about how to associate uploaded data with the data model, though.</span></span>

<span data-ttu-id="15c29-112">Bu öğreticide yeni bir kategori eklemek için bir web sayfasında oluşturacağız.</span><span class="sxs-lookup"><span data-stu-id="15c29-112">In this tutorial we will create a web page to add a new category.</span></span> <span data-ttu-id="15c29-113">Kategori s ad ve açıklama için metin kutuları ek olarak, iki dosya yükleme denetimleri yeni kategori s resmi için bir ve Broşürü için bir tane eklemek bu sayfayı gerekir.</span><span class="sxs-lookup"><span data-stu-id="15c29-113">In addition to TextBoxes for the category s name and description, this page will need to include two FileUpload controls one for the new category s picture and one for the brochure.</span></span> <span data-ttu-id="15c29-114">Karşıya yüklenen resim doğrudan yeni kayıttaki s depolanacak `Picture` sütun Broşürü kaydedilecek ancak `~/Brochures` yeni kayıt s kaydedilmiş dosyasının yolu klasörüyle `BrochurePath` sütun.</span><span class="sxs-lookup"><span data-stu-id="15c29-114">The uploaded picture will be stored directly in the new record s `Picture` column, whereas the brochure will be saved to the `~/Brochures` folder with the path to the file saved in the new record s `BrochurePath` column.</span></span>

<span data-ttu-id="15c29-115">Bu yeni bir web sayfası oluşturmadan önce biz mimarisi güncelleştirmeniz gerekir.</span><span class="sxs-lookup"><span data-stu-id="15c29-115">Before creating this new web page, we'll need to update the architecture.</span></span> <span data-ttu-id="15c29-116">`CategoriesTableAdapter` s ana sorgu alamadı `Picture` sütun.</span><span class="sxs-lookup"><span data-stu-id="15c29-116">The `CategoriesTableAdapter` s main query does not retrieve the `Picture` column.</span></span> <span data-ttu-id="15c29-117">Sonuç olarak, otomatik olarak oluşturulan `Insert` yöntemi yalnızca sahip girdileri `CategoryName`, `Description`, ve `BrochurePath` alanları.</span><span class="sxs-lookup"><span data-stu-id="15c29-117">Consequently, the auto-generated `Insert` method only has inputs for the `CategoryName`, `Description`, and `BrochurePath` fields.</span></span> <span data-ttu-id="15c29-118">Bu nedenle, ek bir yöntem için dört ister TableAdapter oluşturmak ihtiyacımız `Categories` alanları.</span><span class="sxs-lookup"><span data-stu-id="15c29-118">Therefore, we need to create an additional method in the TableAdapter that prompts for all four `Categories` fields.</span></span> <span data-ttu-id="15c29-119">`CategoriesBLL` İş mantığı katmanı sınıfında güncelleştirilmesi de gerekir.</span><span class="sxs-lookup"><span data-stu-id="15c29-119">The `CategoriesBLL` class in the Business Logic Layer will also need to be updated.</span></span>

## <a name="step-1-adding-aninsertwithpicturemethod-to-thecategoriestableadapter"></a><span data-ttu-id="15c29-120">1. adım: Ekleme bir`InsertWithPicture`yöntemi`CategoriesTableAdapter`</span><span class="sxs-lookup"><span data-stu-id="15c29-120">Step 1: Adding an`InsertWithPicture`Method to the`CategoriesTableAdapter`</span></span>

<span data-ttu-id="15c29-121">Ne zaman oluşturduğumuz `CategoriesTableAdapter` geri [veri erişim katmanı oluşturma](../introduction/creating-a-data-access-layer-vb.md) öğretici, biz yapılandırılmış otomatik olarak oluşturmak için `INSERT`, `UPDATE`, ve `DELETE` deyimleri ana sorguya dayalı.</span><span class="sxs-lookup"><span data-stu-id="15c29-121">When we created the `CategoriesTableAdapter` back in the [Creating a Data Access Layer](../introduction/creating-a-data-access-layer-vb.md) tutorial, we configured it to automatically generate `INSERT`, `UPDATE`, and `DELETE` statements based on the main query.</span></span> <span data-ttu-id="15c29-122">Ayrıca, biz yöntemleri oluşturulan DB doğrudan yaklaşım kullanmayı TableAdapter belirtildiği `Insert`, `Update`, ve `Delete`.</span><span class="sxs-lookup"><span data-stu-id="15c29-122">Moreover, we instructed the TableAdapter to employ the DB Direct approach, which created the methods `Insert`, `Update`, and `Delete`.</span></span> <span data-ttu-id="15c29-123">Bu yöntem otomatik olarak oluşturulan yürütülemez `INSERT`, `UPDATE`, ve `DELETE` deyimleri ve sonuç olarak, ana sorgu tarafından döndürülen sütunlara göre giriş parametreleri kabul eder.</span><span class="sxs-lookup"><span data-stu-id="15c29-123">These methods execute the auto-generated `INSERT`, `UPDATE`, and `DELETE` statements and, consequently, accept input parameters based on the columns returned by the main query.</span></span> <span data-ttu-id="15c29-124">İçinde [yüklenen dosyalar](uploading-files-vb.md) biz engagement'ta öğretici `CategoriesTableAdapter` kullanmak için ana sorgu s `BrochurePath` sütun.</span><span class="sxs-lookup"><span data-stu-id="15c29-124">In the [Uploading Files](uploading-files-vb.md) tutorial we augmented the `CategoriesTableAdapter` s main query to use the `BrochurePath` column.</span></span>

<span data-ttu-id="15c29-125">Bu yana `CategoriesTableAdapter` s ana sorgu başvurmuyor `Picture` sütun, biz yeni bir kayıt eklemek ne için bir değer ile varolan bir kaydı güncelleştirmeye `Picture` sütun.</span><span class="sxs-lookup"><span data-stu-id="15c29-125">Since the `CategoriesTableAdapter` s main query does not reference the `Picture` column, we can neither add a new record nor update an existing record with a value for the `Picture` column.</span></span> <span data-ttu-id="15c29-126">Bu bilgileri yakalamak üzere ya da yeni bir yöntem özellikle ikili veri içeren bir kayıt eklemek için kullanılan TableAdapter içinde oluşturabilir veya biz otomatik olarak oluşturulan özelleştirebilirsiniz `INSERT` deyimi.</span><span class="sxs-lookup"><span data-stu-id="15c29-126">In order to capture this information, we can either create a new method in the TableAdapter that is used specifically to insert a record with binary data or we can customize the auto-generated `INSERT` statement.</span></span> <span data-ttu-id="15c29-127">Otomatik olarak oluşturulan özelleştirme sorun `INSERT` açıklamadır risk biz sihirbaz tarafından üzerine bizim özelleştirmeleri sahip.</span><span class="sxs-lookup"><span data-stu-id="15c29-127">The problem with customizing the auto-generated `INSERT` statement is that we risk having our customizations overwritten by the wizard.</span></span> <span data-ttu-id="15c29-128">Örneğin, biz özelleştirilmiş düşünün `INSERT` kullanımını bildirimini `Picture` sütun.</span><span class="sxs-lookup"><span data-stu-id="15c29-128">For example, imagine that we customized the `INSERT` statement to include use of the `Picture` column.</span></span> <span data-ttu-id="15c29-129">Bu TableAdapter s güncelleştirecektir `Insert` kategori s resim s ikili veriler için ek bir giriş parametresi dahil etmek için yöntem.</span><span class="sxs-lookup"><span data-stu-id="15c29-129">This would update the TableAdapter s `Insert` method to include an additional input parameter for the category s picture s binary data.</span></span> <span data-ttu-id="15c29-130">Biz sonra bir yöntem bu DAL yöntemi kullanın ve sunu katmanı aracılığıyla bu BLL yöntemini çağırmak için iş mantığı katmanı olarak oluşturabilir ve her şeyi son derece çalışır.</span><span class="sxs-lookup"><span data-stu-id="15c29-130">We could then create a method in the Business Logic Layer to use this DAL method and invoke this BLL method through the Presentation Layer, and everything would work wonderfully.</span></span> <span data-ttu-id="15c29-131">Diğer bir deyişle, zamana kadar biz TableAdapter TableAdapter Yapılandırma Sihirbazı ile yapılandırılmış.</span><span class="sxs-lookup"><span data-stu-id="15c29-131">That is, until the next time we configured the TableAdapter through the TableAdapter Configuration wizard.</span></span> <span data-ttu-id="15c29-132">Sihirbazı Tamamlandı olarak bizim özelleştirmeleri `INSERT` deyimi üzerine, `Insert` yöntemi eski forma dönmek ve kodumuza artık derleme!</span><span class="sxs-lookup"><span data-stu-id="15c29-132">As soon as the wizard completed, our customizations to the `INSERT` statement would be overwritten, the `Insert` method would revert to its old form, and our code would no longer compile!</span></span>

> [!NOTE]
> <span data-ttu-id="15c29-133">Geçici SQL deyimleri yerine saklı yordamları kullanma olduğunda, bu sıkıntı getirir sorunu olmayan kullanır.</span><span class="sxs-lookup"><span data-stu-id="15c29-133">This annoyance is a non-issue when using stored procedures instead of ad-hoc SQL statements.</span></span> <span data-ttu-id="15c29-134">Bir sonraki öğretici, veri erişim katmanı'ndaki geçici SQL deyimleri yerine saklı yordamları kullanma inceleyeceksiniz.</span><span class="sxs-lookup"><span data-stu-id="15c29-134">A future tutorial will explore using stored procedures in lieu of ad-hoc SQL statements in the Data Access Layer.</span></span>


<span data-ttu-id="15c29-135">Bu olasılığını önlemek için bunun yerine yeni bir yöntem için TableAdapter oluşturma s otomatik olarak oluşturulan SQL deyimlerini özelleştirme yerine çekiyorsanız olanak tanır.</span><span class="sxs-lookup"><span data-stu-id="15c29-135">To avoid this potential headache, rather than customizing the auto-generated SQL statements let s instead create a new method for the TableAdapter.</span></span> <span data-ttu-id="15c29-136">Adlı bu yöntem `InsertWithPicture`, değerleri kabul `CategoryName`, `Description`, `BrochurePath`, ve `Picture` sütunları ve yürütme bir `INSERT` tüm dört değerleri yeni kayıt depolayan deyimi.</span><span class="sxs-lookup"><span data-stu-id="15c29-136">This method, named `InsertWithPicture`, will accept values for the `CategoryName`, `Description`, `BrochurePath`, and `Picture` columns and execute an `INSERT` statement that stores all four values in a new record.</span></span>

<span data-ttu-id="15c29-137">Yazılan veri kümesi'ni açın ve Tasarımcısı'ndan sağ tıklayın `CategoriesTableAdapter` s üstbilgi ve bağlam menüsünden Sorgu Ekle'i seçin.</span><span class="sxs-lookup"><span data-stu-id="15c29-137">Open the Typed DataSet and, from the Designer, right-click on the `CategoriesTableAdapter` s header and choose Add Query from the context menu.</span></span> <span data-ttu-id="15c29-138">Bu, bize nasıl TableAdapter sorgu veritabanına erişmek için kullanması isteyerek başlar TableAdapter sorgu Yapılandırma Sihirbazı başlatır.</span><span class="sxs-lookup"><span data-stu-id="15c29-138">This launches the TableAdapter Query Configuration Wizard, which begins by asking us how the TableAdapter query should access the database.</span></span> <span data-ttu-id="15c29-139">Use SQL deyimleri seçin ve İleri'yi tıklatın.</span><span class="sxs-lookup"><span data-stu-id="15c29-139">Choose Use SQL statements and click Next.</span></span> <span data-ttu-id="15c29-140">Sonraki adım sorgu türü için oluşturulacak ister.</span><span class="sxs-lookup"><span data-stu-id="15c29-140">The next step prompts for the type of query to be generated.</span></span> <span data-ttu-id="15c29-141">Size yeni bir kayıt eklemek için bir sorgu oluşturma re itibaren `Categories` tablo, INSERT seçin ve İleri'yi tıklatın.</span><span class="sxs-lookup"><span data-stu-id="15c29-141">Since we re creating a query to add a new record to the `Categories` table, choose INSERT and click Next.</span></span>


<span data-ttu-id="15c29-142">[![Ekle seçeneğini belirleyin](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image1.gif)](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="15c29-142">[![Select the INSERT Option](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image1.gif)](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image1.png)</span></span>

<span data-ttu-id="15c29-143">**Şekil 1**: Ekle seçeneğini belirleyin ([tam boyutlu görüntüyü görüntülemek için tıklatın](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image2.png))</span><span class="sxs-lookup"><span data-stu-id="15c29-143">**Figure 1**: Select the INSERT Option ([Click to view full-size image](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image2.png))</span></span>


<span data-ttu-id="15c29-144">Şimdi belirtmek ihtiyacımız `INSERT` SQL deyimi.</span><span class="sxs-lookup"><span data-stu-id="15c29-144">We now need to specify the `INSERT` SQL statement.</span></span> <span data-ttu-id="15c29-145">Sihirbaz otomatik olarak öneren bir `INSERT` TableAdapter s ana sorguya karşılık gelen deyimi.</span><span class="sxs-lookup"><span data-stu-id="15c29-145">The wizard automatically suggests an `INSERT` statement corresponding to the TableAdapter s main query.</span></span> <span data-ttu-id="15c29-146">Bu durumda, onu s bir `INSERT` ekler deyimi `CategoryName`, `Description`, ve `BrochurePath` değerleri.</span><span class="sxs-lookup"><span data-stu-id="15c29-146">In this case, it s an `INSERT` statement that inserts the `CategoryName`, `Description`, and `BrochurePath` values.</span></span> <span data-ttu-id="15c29-147">Update deyimi böylece `Picture` sütundur ile birlikte gelen bir `@Picture` parametresi şu şekilde:</span><span class="sxs-lookup"><span data-stu-id="15c29-147">Update the statement so that the `Picture` column is included along with a `@Picture` parameter, like so:</span></span>


[!code-sql[Main](including-a-file-upload-option-when-adding-a-new-record-vb/samples/sample1.sql)]

<span data-ttu-id="15c29-148">Sihirbazın son ekranında bize yeni TableAdapter yöntem adı ister.</span><span class="sxs-lookup"><span data-stu-id="15c29-148">The final screen of the wizard asks us to name the new TableAdapter method.</span></span> <span data-ttu-id="15c29-149">Girin `InsertWithPicture` ve Son'u tıklatın.</span><span class="sxs-lookup"><span data-stu-id="15c29-149">Enter `InsertWithPicture` and click Finish.</span></span>


<span data-ttu-id="15c29-150">[![Yeni TableAdapter yöntemi InsertWithPicture adı](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image2.gif)](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image3.png)</span><span class="sxs-lookup"><span data-stu-id="15c29-150">[![Name the New TableAdapter Method InsertWithPicture](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image2.gif)](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image3.png)</span></span>

<span data-ttu-id="15c29-151">**Şekil 2**: yeni TableAdapter yöntem adı `InsertWithPicture` ([tam boyutlu görüntüyü görüntülemek için tıklatın](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image4.png))</span><span class="sxs-lookup"><span data-stu-id="15c29-151">**Figure 2**: Name the New TableAdapter Method `InsertWithPicture` ([Click to view full-size image](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image4.png))</span></span>


## <a name="step-2-updating-the-business-logic-layer"></a><span data-ttu-id="15c29-152">2. adım: iş mantığı katmanı güncelleştiriliyor</span><span class="sxs-lookup"><span data-stu-id="15c29-152">Step 2: Updating the Business Logic Layer</span></span>

<span data-ttu-id="15c29-153">Sunu katmanı yalnızca iş mantığı katmanı ile arabirim yerine bu yana doğrudan veri erişim katmanı gitmesini atlayarak, yeni oluşturduğumuz DAL yöntemini çağıran bir BLL yöntemi oluşturmak ihtiyacımız (`InsertWithPicture`).</span><span class="sxs-lookup"><span data-stu-id="15c29-153">Since the Presentation Layer should only interface with the Business Logic Layer rather than bypassing it to go directly to the Data Access Layer, we need to create a BLL method that invokes the DAL method we just created (`InsertWithPicture`).</span></span> <span data-ttu-id="15c29-154">Bu öğretici için bir yöntem oluşturma `CategoriesBLL` adlı sınıf `InsertWithPicture` giriş olarak üç kabul eden `String` s ve `Byte` dizi.</span><span class="sxs-lookup"><span data-stu-id="15c29-154">For this tutorial, create a method in the `CategoriesBLL` class named `InsertWithPicture` that accepts as input three `String` s and a `Byte` array.</span></span> <span data-ttu-id="15c29-155">`String` Giriş parametreleri: s kategori adı, açıklama ve Broşürü dosya yolu, sırada `Byte` dizidir kategori s resmi için ikili içerik.</span><span class="sxs-lookup"><span data-stu-id="15c29-155">The `String` input parameters are for the category s name, description, and brochure file path, while the `Byte` array is for the binary contents of the category s picture.</span></span> <span data-ttu-id="15c29-156">Aşağıdaki kodda gösterildiği gibi bu BLL yöntemi karşılık gelen DAL yöntemi çağırır:</span><span class="sxs-lookup"><span data-stu-id="15c29-156">As the following code shows, this BLL method invokes the corresponding DAL method:</span></span>


[!code-vb[Main](including-a-file-upload-option-when-adding-a-new-record-vb/samples/sample2.vb)]

> [!NOTE]
> <span data-ttu-id="15c29-157">Yazılan veri kümesi eklemeden önce kaydettiğinizden emin olun `InsertWithPicture` BLL yöntemi.</span><span class="sxs-lookup"><span data-stu-id="15c29-157">Make sure that you have saved the Typed DataSet before adding the `InsertWithPicture` method to the BLL.</span></span> <span data-ttu-id="15c29-158">Bu yana `CategoriesTableAdapter` sınıf kodu otomatik olarak oluşturulan yazılan veri kümesinde dayalı t tan yazılan veri kümesine değişikliklerinizi ilk kaydederseniz `Adapter` t won özelliği bilmeniz hakkında `InsertWithPicture` yöntemi.</span><span class="sxs-lookup"><span data-stu-id="15c29-158">Since the `CategoriesTableAdapter` class code is auto-generated based on the Typed DataSet, if you don t first save your changes to the Typed DataSet the `Adapter` property won t know about the `InsertWithPicture` method.</span></span>


## <a name="step-3-listing-the-existing-categories-and-their-binary-data"></a><span data-ttu-id="15c29-159">3. adım: mevcut kategorileri ve ikili verilerini listeleme</span><span class="sxs-lookup"><span data-stu-id="15c29-159">Step 3: Listing the Existing Categories and their Binary Data</span></span>

<span data-ttu-id="15c29-160">Bu öğreticide sisteme yeni bir kategori eklemek bir son kullanıcı veren bir sayfa resim ve Broşürü yeni kategori için sağlama oluşturacağız.</span><span class="sxs-lookup"><span data-stu-id="15c29-160">In this tutorial we will create a page that allows an end user to add a new category to the system, providing a picture and brochure for the new category.</span></span> <span data-ttu-id="15c29-161">İçinde [önceki öğretici](displaying-binary-data-in-the-data-web-controls-vb.md) biz GridView TemplateField ve ImageField ile her kategori s adını görüntülemek için kullanılan tanımlama, resmi ve onun Broşürü indirmek için bir bağlantı.</span><span class="sxs-lookup"><span data-stu-id="15c29-161">In the [preceding tutorial](displaying-binary-data-in-the-data-web-controls-vb.md) we used a GridView with a TemplateField and ImageField to display each category s name, description, picture, and a link to download its brochure.</span></span> <span data-ttu-id="15c29-162">Bu işlevselliği hem tüm mevcut kategorilerini listeler ve yenilerini oluşturulmasını sağlayan bir sayfa oluşturma, Bu öğretici için çoğaltma s olanak tanır.</span><span class="sxs-lookup"><span data-stu-id="15c29-162">Let s replicate that functionality for this tutorial, creating a page that both lists all existing categories and allows for new ones to be created.</span></span>

<span data-ttu-id="15c29-163">Başlangıç açarak `DisplayOrDownload.aspx` gelen sayfa `BinaryData` klasör.</span><span class="sxs-lookup"><span data-stu-id="15c29-163">Start by opening the `DisplayOrDownload.aspx` page from the `BinaryData` folder.</span></span> <span data-ttu-id="15c29-164">Kaynak görünümüne gidin ve içinde yapıştırma GridView ve ObjectDataSource s tanımlayıcı sözdizimi, kopyalama `<asp:Content>` öğesinde `UploadInDetailsView.aspx`.</span><span class="sxs-lookup"><span data-stu-id="15c29-164">Go to the Source view and copy the GridView and ObjectDataSource s declarative syntax, pasting it within the `<asp:Content>` element in `UploadInDetailsView.aspx`.</span></span> <span data-ttu-id="15c29-165">Ayrıca, t tan unuttunuz üzerinden kopyalamak `GenerateBrochureLink` arka plandaki kod sınıfı yönteminden `DisplayOrDownload.aspx` için `UploadInDetailsView.aspx`.</span><span class="sxs-lookup"><span data-stu-id="15c29-165">Also, don t forget to copy over the `GenerateBrochureLink` method from the code-behind class of `DisplayOrDownload.aspx` to `UploadInDetailsView.aspx`.</span></span>


<span data-ttu-id="15c29-166">[![DisplayOrDownload.aspx UploadInDetailsView.aspx bildirim temelli sözdizimine yapıştırın](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image3.gif)](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image5.png)</span><span class="sxs-lookup"><span data-stu-id="15c29-166">[![Copy and Paste the Declarative Syntax from DisplayOrDownload.aspx to UploadInDetailsView.aspx](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image3.gif)](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image5.png)</span></span>

<span data-ttu-id="15c29-167">**Şekil 3**: bildirim temelli sözdiziminde kopyalayıp `DisplayOrDownload.aspx` için `UploadInDetailsView.aspx` ([tam boyutlu görüntüyü görüntülemek için tıklatın](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image6.png))</span><span class="sxs-lookup"><span data-stu-id="15c29-167">**Figure 3**: Copy and Paste the Declarative Syntax from `DisplayOrDownload.aspx` to `UploadInDetailsView.aspx` ([Click to view full-size image](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image6.png))</span></span>


<span data-ttu-id="15c29-168">Bildirim temelli söz dizimini kopyaladıktan sonra ve `GenerateBrochureLink` üzerinden yönteme `UploadInDetailsView.aspx` sayfasında, her şeyi üzerinde doğru şekilde kopyalandığından emin olmak için bir tarayıcı aracılığıyla sayfasını görüntüleyin.</span><span class="sxs-lookup"><span data-stu-id="15c29-168">After copying the declarative syntax and `GenerateBrochureLink` method over to the `UploadInDetailsView.aspx` page, view the page through a browser to ensure that everything was copied over correctly.</span></span> <span data-ttu-id="15c29-169">Kategori s resmi yanı sıra Broşürü indirmek için bir bağlantı içeren sekiz kategorilerini liste GridView görmeniz gerekir.</span><span class="sxs-lookup"><span data-stu-id="15c29-169">You should see a GridView listing the eight categories that includes a link to download the brochure as well as the category s picture.</span></span>


<span data-ttu-id="15c29-170">[![İkili verileri birlikte her kategori görmelisiniz](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image4.gif)](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="15c29-170">[![You Should Now See Each Category Along with Its Binary Data](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image4.gif)](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image7.png)</span></span>

<span data-ttu-id="15c29-171">**Şekil 4**:, gereken şimdi bkz her kategori boyunca ITS ikili verilerle ([tam boyutlu görüntüyü görüntülemek için tıklatın](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image8.png))</span><span class="sxs-lookup"><span data-stu-id="15c29-171">**Figure 4**: You Should Now See Each Category Along with Its Binary Data ([Click to view full-size image](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image8.png))</span></span>


## <a name="step-4-configuring-thecategoriesdatasourceto-support-inserting"></a><span data-ttu-id="15c29-172">4. adım: Yapılandırma`CategoriesDataSource`desteği eklemek için</span><span class="sxs-lookup"><span data-stu-id="15c29-172">Step 4: Configuring the`CategoriesDataSource`to Support Inserting</span></span>

<span data-ttu-id="15c29-173">`CategoriesDataSource` ObjectDataSource tarafından kullanılan `Categories` GridView şu anda sağlamaz veri ekleme olanağı.</span><span class="sxs-lookup"><span data-stu-id="15c29-173">The `CategoriesDataSource` ObjectDataSource used by the `Categories` GridView currently does not provide the ability to insert data.</span></span> <span data-ttu-id="15c29-174">Bu veri kaynağı denetimi ekleme desteklemek için eşlemek ihtiyacımız kendi `Insert` kendi nesnesini yönteminde yönteme `CategoriesBLL`.</span><span class="sxs-lookup"><span data-stu-id="15c29-174">In order to support inserting through this data source control, we need to map its `Insert` method to a method in its underlying object, `CategoriesBLL`.</span></span> <span data-ttu-id="15c29-175">Özellikle, kendisine eşlemek istiyoruz `CategoriesBLL` geri 2. adımda, eklediğimiz yöntemi `InsertWithPicture`.</span><span class="sxs-lookup"><span data-stu-id="15c29-175">In particular, we want to map it to the `CategoriesBLL` method we added back in Step 2, `InsertWithPicture`.</span></span>

<span data-ttu-id="15c29-176">ObjectDataSource s akıllı etiket yapılandırma veri kaynağı bağlantısını tıklatarak başlatın.</span><span class="sxs-lookup"><span data-stu-id="15c29-176">Start by clicking the Configure Data Source link from the ObjectDataSource s smart tag.</span></span> <span data-ttu-id="15c29-177">İlk ekranda birlikte çalışmak üzere yapılandırılmış veri kaynağı nesnesi gösterir `CategoriesBLL`.</span><span class="sxs-lookup"><span data-stu-id="15c29-177">The first screen shows the object the data source is configured to work with, `CategoriesBLL`.</span></span> <span data-ttu-id="15c29-178">Bu ayarı olarak bırakın-olduğunu ve tanımlama veri yöntemleri ekranına öncelikli İleri'yi tıklatın.</span><span class="sxs-lookup"><span data-stu-id="15c29-178">Leave this setting as-is and click Next to advance to the Define Data Methods screen.</span></span> <span data-ttu-id="15c29-179">Taşıma Ekle sekmesi ve çekme `InsertWithPicture` aşağı açılan listeden yöntemi.</span><span class="sxs-lookup"><span data-stu-id="15c29-179">Move to the INSERT tab and pick the `InsertWithPicture` method from the drop-down list.</span></span> <span data-ttu-id="15c29-180">Sihirbazı tamamlamak için Son'u tıklatın.</span><span class="sxs-lookup"><span data-stu-id="15c29-180">Click Finish to complete the wizard.</span></span>


<span data-ttu-id="15c29-181">[![ObjectDataSource InsertWithPicture yöntemi kullanmak üzere yapılandırma](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image5.gif)](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image9.png)</span><span class="sxs-lookup"><span data-stu-id="15c29-181">[![Configure the ObjectDataSource to use the InsertWithPicture Method](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image5.gif)](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image9.png)</span></span>

<span data-ttu-id="15c29-182">**Şekil 5**: ObjectDataSource kullanmak için yapılandırma `InsertWithPicture` yöntemi ([tam boyutlu görüntüyü görüntülemek için tıklatın](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image10.png))</span><span class="sxs-lookup"><span data-stu-id="15c29-182">**Figure 5**: Configure the ObjectDataSource to use the `InsertWithPicture` Method ([Click to view full-size image](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image10.png))</span></span>


> [!NOTE]
> <span data-ttu-id="15c29-183">Sihirbazı tamamladığınızda, Visual Studio alanları Yenile'yi ve anahtarları istiyorsanız, Web verileri yeniden oluşturacak alanları denetimleri isteyebilir.</span><span class="sxs-lookup"><span data-stu-id="15c29-183">Upon completing the wizard, Visual Studio may ask if you want to Refresh Fields and Keys, which will regenerate the data Web controls fields.</span></span> <span data-ttu-id="15c29-184">Evet'i seçerseniz, alan özelleştirmeler yapmış olabileceğiniz üzerine yazar için Hayır'ı seçin.</span><span class="sxs-lookup"><span data-stu-id="15c29-184">Choose No, because choosing Yes will overwrite any field customizations you may have made.</span></span>


<span data-ttu-id="15c29-185">Sihirbazı tamamladıktan sonra ObjectDataSource şimdi için bir değer içerir, `InsertMethod` özelliği yanı `InsertParameters` dört kategori sütunlar için aşağıdaki bildirim temelli biçimlendirme olarak gösterilmektedir:</span><span class="sxs-lookup"><span data-stu-id="15c29-185">After completing the wizard, the ObjectDataSource will now include a value for its `InsertMethod` property as well as `InsertParameters` for the four category columns, as the following declarative markup illustrates:</span></span>


[!code-aspx[Main](including-a-file-upload-option-when-adding-a-new-record-vb/samples/sample3.aspx)]

## <a name="step-5-creating-the-inserting-interface"></a><span data-ttu-id="15c29-186">5. adım: ekleme arabirimi oluşturma</span><span class="sxs-lookup"><span data-stu-id="15c29-186">Step 5: Creating the Inserting Interface</span></span>

<span data-ttu-id="15c29-187">İlk olarak ele [, bir genel bakış ekleme, güncelleştirme ve silme veri](../editing-inserting-and-deleting-data/an-overview-of-inserting-updating-and-deleting-data-vb.md), DetailsView denetimi ekleme destekleyen bir veri kaynağı denetimi ile çalışırken, kullanılabilir yerleşik bir ekleme arabirim sağlar.</span><span class="sxs-lookup"><span data-stu-id="15c29-187">As first covered in the [An Overview of Inserting, Updating, and Deleting Data](../editing-inserting-and-deleting-data/an-overview-of-inserting-updating-and-deleting-data-vb.md), the DetailsView control provides a built-in inserting interface that can be utilized when working with a data source control that supports inserting.</span></span> <span data-ttu-id="15c29-188">Bu sayfaya hızla yeni bir kategori eklemek bir kullanıcının kalıcı olarak ekleme arabirimiyle kılacak GridView yukarıda DetailsView denetimini ekleme s olanak tanır.</span><span class="sxs-lookup"><span data-stu-id="15c29-188">Let s add a DetailsView control to this page above the GridView that will permanently render its inserting interface, allowing a user to quickly add a new category.</span></span> <span data-ttu-id="15c29-189">Yeni bir kategori DetailsView'da ekledikten sonra GridView altındaki otomatik olarak yenileyin ve yeni kategori görüntüler.</span><span class="sxs-lookup"><span data-stu-id="15c29-189">Upon adding a new category in the DetailsView, the GridView beneath it will automatically refresh and display the new category.</span></span>

<span data-ttu-id="15c29-190">Araç kutusu ayarı GridView, yukarıda tasarımcıya'ndan bir DetailsView sürükleyerek başlangıç kendi `ID` özelliğine `NewCategory` ve Temizleme `Height` ve `Width` özellik değerleri.</span><span class="sxs-lookup"><span data-stu-id="15c29-190">Start by dragging a DetailsView from the Toolbox onto the Designer above the GridView, setting its `ID` property to `NewCategory` and clearing out the `Height` and `Width` property values.</span></span> <span data-ttu-id="15c29-191">DetailsView s akıllı etiketten varolan bağlama `CategoriesDataSource` ve ardından ekleme etkinleştir onay kutusunu işaretleyin.</span><span class="sxs-lookup"><span data-stu-id="15c29-191">From the DetailsView s smart tag, bind it to the existing `CategoriesDataSource` and then check the Enable Inserting checkbox.</span></span>


<span data-ttu-id="15c29-192">[![DetailsView CategoriesDataSource bağlayın ve eklemeyi etkinleştir](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image6.gif)](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image11.png)</span><span class="sxs-lookup"><span data-stu-id="15c29-192">[![Bind the DetailsView to the CategoriesDataSource and Enable Inserting](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image6.gif)](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image11.png)</span></span>

<span data-ttu-id="15c29-193">**Şekil 6**: DetailsView'a bağlamak `CategoriesDataSource` ve etkinleştirme ekleme ([tam boyutlu görüntüyü görüntülemek için tıklatın](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image12.png))</span><span class="sxs-lookup"><span data-stu-id="15c29-193">**Figure 6**: Bind the DetailsView to the `CategoriesDataSource` and Enable Inserting ([Click to view full-size image](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image12.png))</span></span>


<span data-ttu-id="15c29-194">Kalıcı olarak ekleme arabirimiyle DetailsView'da işlemek için ayarlanmış kendi `DefaultMode` özelliğine `Insert`.</span><span class="sxs-lookup"><span data-stu-id="15c29-194">To permanently render the DetailsView in its inserting interface, set its `DefaultMode` property to `Insert`.</span></span>

<span data-ttu-id="15c29-195">DetailsView beş BoundFields sahip olduğuna dikkat edin `CategoryID`, `CategoryName`, `Description`, `NumberOfProducts`, ve `BrochurePath` rağmen `CategoryID` çünkü BoundField ekleme arabiriminde değil çizilir kendi `InsertVisible` özelliği ayarlanmış `False`.</span><span class="sxs-lookup"><span data-stu-id="15c29-195">Note that the DetailsView has five BoundFields `CategoryID`, `CategoryName`, `Description`, `NumberOfProducts`, and `BrochurePath` although the `CategoryID` BoundField is not rendered in the inserting interface because its `InsertVisible` property is set to `False`.</span></span> <span data-ttu-id="15c29-196">Bu BoundFields var. tarafından döndürülecek olan sütunları olduklarından `GetCategories()` ObjectDataSource verilerini almak için çağırır olduğu yöntemi.</span><span class="sxs-lookup"><span data-stu-id="15c29-196">These BoundFields exists because they are the columns returned by the `GetCategories()` method, which is what the ObjectDataSource invokes to retrieve its data.</span></span> <span data-ttu-id="15c29-197">Eklemek için ancak biz t kullanıcının için bir değer belirtmesine izin vermek istiyorsanız güncelleştireceğinizi `NumberOfProducts`.</span><span class="sxs-lookup"><span data-stu-id="15c29-197">For inserting, however, we don t want to let the user specify a value for `NumberOfProducts`.</span></span> <span data-ttu-id="15c29-198">Ayrıca, biz bunları yanı sıra yeni kategori için bir resim karşıya Broşürü için bir PDF karşıya yüklemek izin vermeniz gerekir.</span><span class="sxs-lookup"><span data-stu-id="15c29-198">Moreover, we need to allow them to upload a picture for the new category as well as upload a PDF for the brochure.</span></span>

<span data-ttu-id="15c29-199">Kaldırma `NumberOfProducts` DetailsView değerlerinin ve ardından güncelleştirme BoundField'den `HeaderText` özelliklerini `CategoryName` ve `BrochurePath` BoundFields kategori ve Broşürü, sırasıyla.</span><span class="sxs-lookup"><span data-stu-id="15c29-199">Remove the `NumberOfProducts` BoundField from the DetailsView altogether and then update the `HeaderText` properties of the `CategoryName` and `BrochurePath` BoundFields to Category and Brochure, respectively.</span></span> <span data-ttu-id="15c29-200">Ardından, dönüştürme `BrochurePath` bir TemplateField içine BoundField ve resim için yeni bir TemplateField eklemek bu yeni TemplateField vermiş bir `HeaderText` resmi değeri.</span><span class="sxs-lookup"><span data-stu-id="15c29-200">Next, convert the `BrochurePath` BoundField into a TemplateField and add a new TemplateField for the picture, giving this new TemplateField a `HeaderText` value of Picture.</span></span> <span data-ttu-id="15c29-201">Taşıma `Picture` onun arasında olacak şekilde TemplateField `BrochurePath` TemplateField ve CommandField.</span><span class="sxs-lookup"><span data-stu-id="15c29-201">Move the `Picture` TemplateField so that it is between the `BrochurePath` TemplateField and CommandField.</span></span>


![DetailsView CategoriesDataSource bağlayın ve eklemeyi etkinleştir](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image7.gif)

<span data-ttu-id="15c29-203">**Şekil 7**: DetailsView'a bağlamak `CategoriesDataSource` ve eklemeyi etkinleştir</span><span class="sxs-lookup"><span data-stu-id="15c29-203">**Figure 7**: Bind the DetailsView to the `CategoriesDataSource` and Enable Inserting</span></span>


<span data-ttu-id="15c29-204">Dönüştürülürse `BrochurePath` TemplateField BoundField TemplateField alanları Düzenle iletişim kutusu üzerinden içine içeren bir `ItemTemplate`, `EditItemTemplate`, ve `InsertItemTemplate`.</span><span class="sxs-lookup"><span data-stu-id="15c29-204">If you converted the `BrochurePath` BoundField into a TemplateField through the Edit Fields dialog box, the TemplateField includes an `ItemTemplate`, `EditItemTemplate`, and `InsertItemTemplate`.</span></span> <span data-ttu-id="15c29-205">Yalnızca `InsertItemTemplate` olan gerekli, ancak, bu nedenle diğer iki şablonları Kaldır çekinmeyin.</span><span class="sxs-lookup"><span data-stu-id="15c29-205">Only the `InsertItemTemplate` is needed, however, so feel free to remove the other two templates.</span></span> <span data-ttu-id="15c29-206">Bu noktada DetailsView s tanımlayıcı sözdizimi aşağıdaki gibi görünmelidir:</span><span class="sxs-lookup"><span data-stu-id="15c29-206">At this point your DetailsView s declarative syntax should look like the following:</span></span>


[!code-aspx[Main](including-a-file-upload-option-when-adding-a-new-record-vb/samples/sample4.aspx)]

## <a name="adding-fileupload-controls-for-the-brochure-and-picture-fields"></a><span data-ttu-id="15c29-207">Broşür ve resim alanları için dosya yükleme denetimler ekleme</span><span class="sxs-lookup"><span data-stu-id="15c29-207">Adding FileUpload Controls for the Brochure and Picture Fields</span></span>

<span data-ttu-id="15c29-208">Şu anda `BrochurePath` TemplateField s `InsertItemTemplate` bir metin kutusu içeren sırada `Picture` TemplateField şablonlardan içermiyor.</span><span class="sxs-lookup"><span data-stu-id="15c29-208">Presently, the `BrochurePath` TemplateField s `InsertItemTemplate` contains a TextBox, while the `Picture` TemplateField does not contain any templates.</span></span> <span data-ttu-id="15c29-209">Bu iki TemplateField s güncelleştirmek ihtiyacımız `InsertItemTemplate` s dosya yükleme denetimleri kullanın.</span><span class="sxs-lookup"><span data-stu-id="15c29-209">We need to update these two TemplateField s `InsertItemTemplate` s to use FileUpload controls.</span></span>

<span data-ttu-id="15c29-210">DetailsView s akıllı etiket Şablonları Düzenle seçeneğini seçin ve ardından `BrochurePath` TemplateField s `InsertItemTemplate` aşağı açılan listeden.</span><span class="sxs-lookup"><span data-stu-id="15c29-210">From the DetailsView s smart tag, choose the Edit Templates option and then select the `BrochurePath` TemplateField s `InsertItemTemplate` from the drop-down list.</span></span> <span data-ttu-id="15c29-211">TextBox kaldırın ve sonra dosya yükleme Denetim Araç Kutusu'ndan şablona sürükleyin.</span><span class="sxs-lookup"><span data-stu-id="15c29-211">Remove the TextBox and then drag a FileUpload control from the Toolbox into the template.</span></span> <span data-ttu-id="15c29-212">Dosya yükleme denetimini s ayarlama `ID` için `BrochureUpload`.</span><span class="sxs-lookup"><span data-stu-id="15c29-212">Set the FileUpload control s `ID` to `BrochureUpload`.</span></span> <span data-ttu-id="15c29-213">Benzer şekilde, bir dosya yükleme denetimine ekleme `Picture` TemplateField s `InsertItemTemplate`.</span><span class="sxs-lookup"><span data-stu-id="15c29-213">Similarly, add a FileUpload control to the `Picture` TemplateField s `InsertItemTemplate`.</span></span> <span data-ttu-id="15c29-214">Bu dosya yükleme denetimini s ayarlama `ID` için `PictureUpload`.</span><span class="sxs-lookup"><span data-stu-id="15c29-214">Set this FileUpload control s `ID` to `PictureUpload`.</span></span>


<span data-ttu-id="15c29-215">[![InsertItemTemplate dosya yükleme denetim ekleme](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image8.gif)](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image13.png)</span><span class="sxs-lookup"><span data-stu-id="15c29-215">[![Add a FileUpload Control to the InsertItemTemplate](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image8.gif)](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image13.png)</span></span>

<span data-ttu-id="15c29-216">**Şekil 8**: dosya yükleme denetimine ekleme `InsertItemTemplate` ([tam boyutlu görüntüyü görüntülemek için tıklatın](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image14.png))</span><span class="sxs-lookup"><span data-stu-id="15c29-216">**Figure 8**: Add a FileUpload Control to the `InsertItemTemplate` ([Click to view full-size image](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image14.png))</span></span>


<span data-ttu-id="15c29-217">Bu eklemeleri yaptıktan sonra iki TemplateField s Tanımlayıcı Sözdizimi olacaktır:</span><span class="sxs-lookup"><span data-stu-id="15c29-217">After making these additions, the two TemplateField s declarative syntax will be:</span></span>


[!code-aspx[Main](including-a-file-upload-option-when-adding-a-new-record-vb/samples/sample5.aspx)]

<span data-ttu-id="15c29-218">Bir kullanıcı yeni bir kategori eklediğinde, Broşürü ve resim doğru dosya türü olduğundan emin olmak istiyoruz.</span><span class="sxs-lookup"><span data-stu-id="15c29-218">When a user adds a new category, we want to ensure that the brochure and picture are of the correct file type.</span></span> <span data-ttu-id="15c29-219">Broşürü, kullanıcı bir PDF sağlamanız gerekir.</span><span class="sxs-lookup"><span data-stu-id="15c29-219">For the brochure, the user must supply a PDF.</span></span> <span data-ttu-id="15c29-220">Bir görüntü dosyası karşıya yüklemek için kullanıcı ihtiyacımız için resim, ancak biz izin *herhangi* görüntü dosyası veya yalnızca görüntü dosyaları GIF veya JPG formatından gibi belirli bir türdeki?</span><span class="sxs-lookup"><span data-stu-id="15c29-220">For the picture, we need the user to upload an image file, but do we allow *any* image file or only image files of a particular type, such as GIFs or JPGs?</span></span> <span data-ttu-id="15c29-221">Farklı dosya türleri için izin vermek üzere d genişletmek ihtiyacımız `Categories` dosya türü yakalar ve böylece bu tür istemciye gönderilen bir sütun eklemek için şema `Response.ContentType` içinde `DisplayCategoryPicture.aspx`.</span><span class="sxs-lookup"><span data-stu-id="15c29-221">In order to allow for different file types, we d need to extend the `Categories` schema to include a column that captures the file type so that this type can be sent to the client through `Response.ContentType` in `DisplayCategoryPicture.aspx`.</span></span> <span data-ttu-id="15c29-222">Biz t güncelleştireceğinizi beri böyle bir sütun, kullanıcıların yalnızca belirli görüntü dosya türü sağlamayı kısıtlamak akıllıca olur.</span><span class="sxs-lookup"><span data-stu-id="15c29-222">Since we don t have such a column, it would be prudent to restrict users to only providing a specific image file type.</span></span> <span data-ttu-id="15c29-223">`Categories` s tablosunda var olan görüntüleri bit eşlemler, ancak jpg formatından web üzerinden sunulan görüntüleri için daha uygun bir dosya biçimi.</span><span class="sxs-lookup"><span data-stu-id="15c29-223">The `Categories` table s existing images are bitmaps, but JPGs are a more appropriate file format for images served over the web.</span></span>

<span data-ttu-id="15c29-224">Dosya türü yanlış bir kullanıcı yüklerse, kimliğinizi Ekle iptal etme ve sorun belirten bir ileti görüntüleme gerekiyor.</span><span class="sxs-lookup"><span data-stu-id="15c29-224">If a user uploads an incorrect file type, we need to cancel the insert and display a message indicating the problem.</span></span> <span data-ttu-id="15c29-225">Bir etiket Web denetimi DetailsView altına ekleyin.</span><span class="sxs-lookup"><span data-stu-id="15c29-225">Add a Label Web control beneath the DetailsView.</span></span> <span data-ttu-id="15c29-226">Ayarlama, `ID` özelliğine `UploadWarning`, kullanıma açık kendi `Text` özelliği ayarlamak `CssClass` uyarı özelliğine ve `Visible` ve `EnableViewState` özelliklerine `False`.</span><span class="sxs-lookup"><span data-stu-id="15c29-226">Set its `ID` property to `UploadWarning`, clear out its `Text` property, set the `CssClass` property to Warning, and the `Visible` and `EnableViewState` properties to `False`.</span></span> <span data-ttu-id="15c29-227">`Warning` CSS sınıfı tanımlanmış `Styles.css` ve bir büyük, kırmızı, italik, kalın yazı tipi metinde işler.</span><span class="sxs-lookup"><span data-stu-id="15c29-227">The `Warning` CSS class is defined in `Styles.css` and renders the text in a large, red, italicized, bold font.</span></span>

> [!NOTE]
> <span data-ttu-id="15c29-228">İdeal olarak, `CategoryName` ve `Description` TemplateFields ve özelleştirilmiş ekleme arabirimlerini BoundFields'in dönüştürülmesi.</span><span class="sxs-lookup"><span data-stu-id="15c29-228">Ideally, the `CategoryName` and `Description` BoundFields would be converted to TemplateFields and their inserting interfaces customized.</span></span> <span data-ttu-id="15c29-229">`Description` Arabirimi, örneğin, ekleme olasılıkla daha uygun çok satırlı metin kutusu.</span><span class="sxs-lookup"><span data-stu-id="15c29-229">The `Description` inserting interface, for example, would likely be better suited through a multi-line textbox.</span></span> <span data-ttu-id="15c29-230">Ve bu yana `CategoryName` sütun kabul etmiyor `NULL` değerleri, kullanıcı için yeni bir kategori s ad değeri sağlar emin olmak için bir RequiredFieldValidator eklenmelidir.</span><span class="sxs-lookup"><span data-stu-id="15c29-230">And since the `CategoryName` column does not accept `NULL` values, a RequiredFieldValidator should be added to ensure the user provides a value for the new category s name.</span></span> <span data-ttu-id="15c29-231">Bu adımları bir alıştırma olarak okuyucuya bırakılır.</span><span class="sxs-lookup"><span data-stu-id="15c29-231">These steps are left as an exercise to the reader.</span></span> <span data-ttu-id="15c29-232">Geri başvurmak [veri değişikliği arabirimi özelleştirme](../editing-inserting-and-deleting-data/customizing-the-data-modification-interface-vb.md) veri değişikliği arabirimleri program.cs'ye derinlemesine bir bakış için.</span><span class="sxs-lookup"><span data-stu-id="15c29-232">Refer back to [Customizing the Data Modification Interface](../editing-inserting-and-deleting-data/customizing-the-data-modification-interface-vb.md) for an in-depth look at augmenting the data modification interfaces.</span></span>


## <a name="step-6-saving-the-uploaded-brochure-to-the-web-server-s-file-system"></a><span data-ttu-id="15c29-233">6. adım: karşıya yüklenen Broşürü Web sunucusu s dosya sistemine kaydetme</span><span class="sxs-lookup"><span data-stu-id="15c29-233">Step 6: Saving the Uploaded Brochure to the Web Server s File System</span></span>

<span data-ttu-id="15c29-234">Kullanıcı için yeni bir kategori değerleri girer ve Ekle düğmesine tıkladığında ekleme iş akışı açılan ve geri gönderimin oluşur.</span><span class="sxs-lookup"><span data-stu-id="15c29-234">When the user enters the values for a new category and clicks the Insert button, a postback occurs and the inserting workflow unfolds.</span></span> <span data-ttu-id="15c29-235">İlk olarak, DetailsView s [ `ItemInserting` olay](https://msdn.microsoft.com/en-us/library/system.web.ui.webcontrols.detailsview.iteminserting.aspx) etkinleşir.</span><span class="sxs-lookup"><span data-stu-id="15c29-235">First, the DetailsView s [`ItemInserting` event](https://msdn.microsoft.com/en-us/library/system.web.ui.webcontrols.detailsview.iteminserting.aspx) fires.</span></span> <span data-ttu-id="15c29-236">İleri, ObjectDataSource s `Insert()` yöntemi çağrıldığında, hangi eklenmekte olan yeni bir kayıt sonuçlanır `Categories` tablo.</span><span class="sxs-lookup"><span data-stu-id="15c29-236">Next, the ObjectDataSource s `Insert()` method is invoked, which results in a new record being added to the `Categories` table.</span></span> <span data-ttu-id="15c29-237">Bundan sonra DetailsView s [ `ItemInserted` olay](https://msdn.microsoft.com/en-us/library/system.web.ui.webcontrols.detailsview.iteminserted.aspx) etkinleşir.</span><span class="sxs-lookup"><span data-stu-id="15c29-237">After that, the DetailsView s [`ItemInserted` event](https://msdn.microsoft.com/en-us/library/system.web.ui.webcontrols.detailsview.iteminserted.aspx) fires.</span></span>

<span data-ttu-id="15c29-238">ObjectDataSource s önce `Insert()` yöntemi çağrıldığında, biz önce uygun dosya türlerini kullanıcı tarafından yüklenen sağlayın ve ardından web sunucusu s dosya sistemine PDF Broşürü kaydetmeniz gerekir.</span><span class="sxs-lookup"><span data-stu-id="15c29-238">Before the ObjectDataSource s `Insert()` method is invoked, we must first ensure that the appropriate file types were uploaded by the user and then save the brochure PDF to the web server s file system.</span></span> <span data-ttu-id="15c29-239">DetailsView s için bir olay işleyicisi oluşturun `ItemInserting` olay ve aşağıdaki kodu ekleyin:</span><span class="sxs-lookup"><span data-stu-id="15c29-239">Create an event handler for the DetailsView s `ItemInserting` event and add the following code:</span></span>


[!code-vb[Main](including-a-file-upload-option-when-adding-a-new-record-vb/samples/sample6.vb)]

<span data-ttu-id="15c29-240">Olay işleyicisi başvurarak başlatır `BrochureUpload` DetailsView s şablonlardan dosya yükleme denetim.</span><span class="sxs-lookup"><span data-stu-id="15c29-240">The event handler starts by referencing the `BrochureUpload` FileUpload control from the DetailsView s templates.</span></span> <span data-ttu-id="15c29-241">Ardından, bir Broşürü karşıya yüklediyseniz, karşıya yüklenen dosya s uzantısı incelenir.</span><span class="sxs-lookup"><span data-stu-id="15c29-241">Then, if a brochure has been uploaded, the uploaded file s extension is examined.</span></span> <span data-ttu-id="15c29-242">Uzantı değilse. PDF, sonra bir uyarı görüntülenir, ekleme iptal edilir ve olay işleyicisi yürütülmesi biter.</span><span class="sxs-lookup"><span data-stu-id="15c29-242">If the extension is not .PDF, then a warning is displayed, the insert is cancelled, and the execution of the event handler ends.</span></span>

> [!NOTE]
> <span data-ttu-id="15c29-243">Karşıya yüklenen dosya s uzantısına bağlı karşıya yüklenen dosyanın bir PDF belgesini olduğunu sağlamaya yönelik bir sure-fire teknik değil.</span><span class="sxs-lookup"><span data-stu-id="15c29-243">Relying on the uploaded file s extension is not a sure-fire technique for ensuring that the uploaded file is a PDF document.</span></span> <span data-ttu-id="15c29-244">Kullanıcının geçerli bir PDF belgesini uzantılı olabilir `.Brochure`, veya olmayan PDF belgesini alınır ve verilen bir `.pdf` uzantısı.</span><span class="sxs-lookup"><span data-stu-id="15c29-244">The user could have a valid PDF document with the extension `.Brochure`, or could have taken a non-PDF document and given it a `.pdf` extension.</span></span> <span data-ttu-id="15c29-245">Dosya s ikili içerik daha conclusively dosya türünü doğrulamak için program aracılığıyla incelenmesi gerekir.</span><span class="sxs-lookup"><span data-stu-id="15c29-245">The file s binary content would need to be programmatically examined in order to more conclusively verify the file type.</span></span> <span data-ttu-id="15c29-246">Bu tür kapsamlı bir yaklaşım genellikle yine de gereğinden fazla bağlıdır; Uzantı denetimi çoğu senaryoları için yeterli olur.</span><span class="sxs-lookup"><span data-stu-id="15c29-246">Such thorough approaches, though, are often overkill; checking the extension is sufficient for most scenarios.</span></span>


<span data-ttu-id="15c29-247">' Da anlatıldığı gibi [yüklenen dosyalar](uploading-files-vb.md) öğretici, bu bir kullanıcı s karşıya yükleme başka bir s üzerine yazmaz şekilde dosya sistemine kaydetme dosyaları dikkatli'nin alınması gerekir.</span><span class="sxs-lookup"><span data-stu-id="15c29-247">As discussed in the [Uploading Files](uploading-files-vb.md) tutorial, care must be taken when saving files to the file system so that one user s upload does not overwrite another s.</span></span> <span data-ttu-id="15c29-248">Bu öğretici için size aynı adı yüklenen dosya kullanmayı dener.</span><span class="sxs-lookup"><span data-stu-id="15c29-248">For this tutorial we will attempt to use the same name as the uploaded file.</span></span> <span data-ttu-id="15c29-249">Zaten varsa bir dosyada `~/Brochures` dizin, aynı dosya adıyla, ancak biz append sonunda bir sayı benzersiz bir ad bulunana kadar.</span><span class="sxs-lookup"><span data-stu-id="15c29-249">If there already exists a file in the `~/Brochures` directory with that same file name, however, we'll append a number at the end until a unique name is found.</span></span> <span data-ttu-id="15c29-250">Örneğin, kullanıcı adında bir Broşürü dosya karşıya yükleme `Meats.pdf`, adında bir dosya yoktur ancak `Meats.pdf` içinde `~/Brochures` klasörü, biz değiştirmek için kaydedilen dosya adı `Meats-1.pdf`.</span><span class="sxs-lookup"><span data-stu-id="15c29-250">For example, if the user uploads a brochure file named `Meats.pdf`, but there is already a file named `Meats.pdf` in the `~/Brochures` folder, we'll change the saved file name to `Meats-1.pdf`.</span></span> <span data-ttu-id="15c29-251">Varsa, biz deneyeceksiniz `Meats-2.pdf`ve benzeri benzersiz bir dosya adı bulunana kadar.</span><span class="sxs-lookup"><span data-stu-id="15c29-251">If that exists, we'll try `Meats-2.pdf`, and so on, until a unique file name is found.</span></span>

<span data-ttu-id="15c29-252">Aşağıdaki kod [ `File.Exists(path)` yöntemi](https://msdn.microsoft.com/en-us/library/system.io.file.exists.aspx) belirtilen dosya adıyla bir dosya zaten olup olmadığını belirlemek için.</span><span class="sxs-lookup"><span data-stu-id="15c29-252">The following code uses the [`File.Exists(path)` method](https://msdn.microsoft.com/en-us/library/system.io.file.exists.aspx) to determine if a file already exists with the specified file name.</span></span> <span data-ttu-id="15c29-253">Bu durumda, yeni dosya adları Broşürü için çakışma bulunana kadar denemeye devam eder.</span><span class="sxs-lookup"><span data-stu-id="15c29-253">If so, it continues to try new file names for the brochure until no conflict is found.</span></span>


[!code-vb[Main](including-a-file-upload-option-when-adding-a-new-record-vb/samples/sample7.vb)]

<span data-ttu-id="15c29-254">Dosya geçerli bir dosya adı bulundu sonra dosya sistemi ve ObjectDataSource s kaydedilmesi gerekiyor `brochurePath``InsertParameter` değeri bu dosya adı veritabanına yazılan böylece güncelleştirilmesi gerekiyor.</span><span class="sxs-lookup"><span data-stu-id="15c29-254">Once a valid file name has been found, the file needs to be saved to the file system and the ObjectDataSource s `brochurePath``InsertParameter` value needs to be updated so that this file name is written to the database.</span></span> <span data-ttu-id="15c29-255">Geri gördüğümüz gibi *yüklenen dosyalar* öğretici, dosyayı kaydedilebilir dosya yükleme denetimini s kullanarak `SaveAs(path)` yöntemi.</span><span class="sxs-lookup"><span data-stu-id="15c29-255">As we saw back in the *Uploading Files* tutorial, the file can be saved using the FileUpload control s `SaveAs(path)` method.</span></span> <span data-ttu-id="15c29-256">ObjectDataSource s güncelleştirmek için `brochurePath` parametresi, kullanım `e.Values` koleksiyonu.</span><span class="sxs-lookup"><span data-stu-id="15c29-256">To update the ObjectDataSource s `brochurePath` parameter, use the `e.Values` collection.</span></span>


[!code-vb[Main](including-a-file-upload-option-when-adding-a-new-record-vb/samples/sample8.vb)]

## <a name="step-7-saving-the-uploaded-picture-to-the-database"></a><span data-ttu-id="15c29-257">7. adım: karşıya yüklenen resim veritabanına kaydetme</span><span class="sxs-lookup"><span data-stu-id="15c29-257">Step 7: Saving the Uploaded Picture to the Database</span></span>

<span data-ttu-id="15c29-258">Karşıya yüklenen resim yeni depolamak için `Categories` kayıt, karşıya yüklenen ikili içerik ObjectDataSource s atamak ihtiyacımız `picture` DetailsView s parametresinde `ItemInserting` olay.</span><span class="sxs-lookup"><span data-stu-id="15c29-258">To store the uploaded picture in the new `Categories` record, we need to assign the uploaded binary content to the ObjectDataSource s `picture` parameter in the DetailsView s `ItemInserting` event.</span></span> <span data-ttu-id="15c29-259">Ancak, biz bu atama yapmadan önce biz öncelikle karşıya yüklenen resim JPG ve diğer olmayan bazı görüntü türü olduğundan emin olun gerekir.</span><span class="sxs-lookup"><span data-stu-id="15c29-259">Before we make this assignment, however, we need to first make sure that the uploaded picture is a JPG and not some other image type.</span></span> <span data-ttu-id="15c29-260">Adım 6 olduğu gibi türünü onaylaması için karşıya yüklenen resim s dosya uzantısını kullanan s olanak tanır.</span><span class="sxs-lookup"><span data-stu-id="15c29-260">As in Step 6, let s use the uploaded picture s file extension to ascertain its type.</span></span>

<span data-ttu-id="15c29-261">Sırada `Categories` tablosu verir `NULL` değerleri `Picture` sütun, şu anda tüm kategorileri sahip bir resim.</span><span class="sxs-lookup"><span data-stu-id="15c29-261">While the `Categories` table allows `NULL` values for the `Picture` column, all categories currently have a picture.</span></span> <span data-ttu-id="15c29-262">Bu sayfadan yeni bir kategori eklerken resim sağlamak için kullanıcı zorunlu s olanak tanır.</span><span class="sxs-lookup"><span data-stu-id="15c29-262">Let s force the user to provide a picture when adding a new category through this page.</span></span> <span data-ttu-id="15c29-263">Resim karşıya yüklendi ve uygun bir uzantısına sahip olduğundan emin olmak için aşağıdaki kodu denetler.</span><span class="sxs-lookup"><span data-stu-id="15c29-263">The following code checks to ensure that a picture has been uploaded and that it has an appropriate extension.</span></span>


[!code-vb[Main](including-a-file-upload-option-when-adding-a-new-record-vb/samples/sample9.vb)]

<span data-ttu-id="15c29-264">Bu kod yerleştirilmelidir *önce* adım 6 koddan böylece resim karşıya yükleme ile ilgili bir sorun varsa, Broşürü dosya için dosya sistemi kaydedilmeden önce olay işleyicisi sonlandırılacak.</span><span class="sxs-lookup"><span data-stu-id="15c29-264">This code should be placed *before* the code from Step 6 so that if there is a problem with the picture upload, the event handler will terminate before the brochure file is saved to the file system.</span></span>

<span data-ttu-id="15c29-265">Uygun bir dosyayı karşıya varsayılarak, karşıya yüklenen ikili içerik aşağıdaki kod satırını resim parametre s değeriyle atayın:</span><span class="sxs-lookup"><span data-stu-id="15c29-265">Assuming that an appropriate file has been uploaded, assign the uploaded binary content to the picture parameter s value with the following line of code:</span></span>


[!code-vb[Main](including-a-file-upload-option-when-adding-a-new-record-vb/samples/sample10.vb)]

## <a name="the-completeiteminsertingevent-handler"></a><span data-ttu-id="15c29-266">Tam`ItemInserting`olay işleyicisi</span><span class="sxs-lookup"><span data-stu-id="15c29-266">The Complete`ItemInserting`Event Handler</span></span>

<span data-ttu-id="15c29-267">Bütünlük açısından işte `ItemInserting` okumalıdır olay işleyicisi:</span><span class="sxs-lookup"><span data-stu-id="15c29-267">For completeness, here is the `ItemInserting` event handler in its entirety:</span></span>


[!code-vb[Main](including-a-file-upload-option-when-adding-a-new-record-vb/samples/sample11.vb)]

## <a name="step-8-fixing-thedisplaycategorypictureaspxpage"></a><span data-ttu-id="15c29-268">8. adım: Düzelttikten`DisplayCategoryPicture.aspx`sayfası</span><span class="sxs-lookup"><span data-stu-id="15c29-268">Step 8: Fixing the`DisplayCategoryPicture.aspx`Page</span></span>

<span data-ttu-id="15c29-269">Let s ekleme arabirimin dışına sınamak için bir dakikanızı alın ve `ItemInserting` son birkaç adımda oluşturulan olay işleyicisi.</span><span class="sxs-lookup"><span data-stu-id="15c29-269">Let s take a moment to test out the inserting interface and `ItemInserting` event handler that was created over the last few steps.</span></span> <span data-ttu-id="15c29-270">Ziyaret `UploadInDetailsView.aspx` sayfa tarayıcı ve bir kategoriye Ekle, ancak resmi atlayın girişimi ya da olmayan JPG resim ya da bir PDF olmayan broşür belirtin.</span><span class="sxs-lookup"><span data-stu-id="15c29-270">Visit the `UploadInDetailsView.aspx` page through a browser and attempt to add a category, but omit the picture, or specify a non-JPG picture or a non-PDF brochure.</span></span> <span data-ttu-id="15c29-271">Bu durumların herhangi birinde, bir hata iletisi görüntülenir ve ekleme iş akışı iptal edildi.</span><span class="sxs-lookup"><span data-stu-id="15c29-271">In any of these cases, an error message will be displayed and the insert workflow cancelled.</span></span>


<span data-ttu-id="15c29-272">[![Bir uyarı iletisi görüntülenir geçersiz bir dosya türü karşıya ise](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image9.gif)](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image15.png)</span><span class="sxs-lookup"><span data-stu-id="15c29-272">[![A Warning Message is Displayed If an Invalid File Type is Uploaded](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image9.gif)](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image15.png)</span></span>

<span data-ttu-id="15c29-273">**Şekil 9**: bir uyarı iletisi olup görüntülenen geçersiz bir dosya türü karşıya ([tam boyutlu görüntüyü görüntülemek için tıklatın](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image16.png))</span><span class="sxs-lookup"><span data-stu-id="15c29-273">**Figure 9**: A Warning Message is Displayed If an Invalid File Type is Uploaded ([Click to view full-size image](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image16.png))</span></span>


<span data-ttu-id="15c29-274">Bir kez Broşürü alan boş bırakılırsa sayfa karşıya yüklenecek resim gerektiriyorsa ve kazanılan t PDF olmayan veya JPG olmayan dosyaları kabul, geçerli bir JPG resim ile yeni bir kategori ekleyin doğrulanmıştır.</span><span class="sxs-lookup"><span data-stu-id="15c29-274">Once you have verified that the page requires a picture to be uploaded and won t accept non-PDF or non-JPG files, add a new category with a valid JPG picture, leaving the Brochure field empty.</span></span> <span data-ttu-id="15c29-275">Ekle düğmesine tıkladıktan sonra sayfanın geri gönderilir ve yeni bir kayıt eklenecek `Categories` doğrudan veritabanında depolanan karşıya yüklenen görüntü s ikili içeriğini içeren tablo.</span><span class="sxs-lookup"><span data-stu-id="15c29-275">After clicking the Insert button, the page will postback and a new record will be added to the `Categories` table with the uploaded image s binary contents stored directly in the database.</span></span> <span data-ttu-id="15c29-276">GridView güncelleştirilir ve yeni eklenen kategorisi için bir satır gösterir, ancak, Şekil 10 gösterildiği gibi yeni bir kategori s resim doğru işlenmez.</span><span class="sxs-lookup"><span data-stu-id="15c29-276">The GridView is updated and shows a row for the newly added category, but, as Figure 10 shows, the new category s picture is not rendered correctly.</span></span>


<span data-ttu-id="15c29-277">[![Yeni kategori resim gösterilmez s](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image10.gif)](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image17.png)</span><span class="sxs-lookup"><span data-stu-id="15c29-277">[![The New Category s Picture is not Displayed](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image10.gif)](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image17.png)</span></span>

<span data-ttu-id="15c29-278">**Şekil 10**: resim görüntülenmez yeni kategori s ([tam boyutlu görüntüyü görüntülemek için tıklatın](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image18.png))</span><span class="sxs-lookup"><span data-stu-id="15c29-278">**Figure 10**: The New Category s Picture is not Displayed ([Click to view full-size image](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image18.png))</span></span>


<span data-ttu-id="15c29-279">Yeni bir resim görüntülenmez neden olduğundan `DisplayCategoryPicture.aspx` belirtilen kategori s resim döndürür sayfa OLE üstbilginin bit eşlemler işlemek üzere yapılandırılmış.</span><span class="sxs-lookup"><span data-stu-id="15c29-279">The reason the new picture is not displayed is because the `DisplayCategoryPicture.aspx` page that returns a specified category s picture is configured to process bitmaps that have an OLE header.</span></span> <span data-ttu-id="15c29-280">Bu 78 bayt üst öğesinden yapılandırıldıktan `Picture` gönderilmeden önce s sütunu ikili içeriği istemciye yedekleyin.</span><span class="sxs-lookup"><span data-stu-id="15c29-280">This 78 byte header is stripped from the `Picture` column s binary contents before they are sent back to the client.</span></span> <span data-ttu-id="15c29-281">Ancak biz yalnızca karşıya JPG dosyası yeni kategori için bu OLE üstbilgi yok; Bu nedenle, geçerli, gerekli bayt görüntü s ikili verileri kaldırılıyor.</span><span class="sxs-lookup"><span data-stu-id="15c29-281">But the JPG file we just uploaded for the new category does not have this OLE header; therefore, valid, necessary bytes are being removed from the image s binary data.</span></span>

<span data-ttu-id="15c29-282">Şimdi iki bit eşlemler OLE üstbilgileri ve jpg formatından içinde olduğundan `Categories` tablo ihtiyacımız güncelleştirmek `DisplayCategoryPicture.aspx` böylece özgün sekiz kategorilerini çıkarma OLE üstbilgi ve bu yeni kategori kayıtlarını çıkarma atlar.</span><span class="sxs-lookup"><span data-stu-id="15c29-282">Since there are now both bitmaps with OLE headers and JPGs in the `Categories` table, we need to update `DisplayCategoryPicture.aspx` so that it does the OLE header stripping for the original eight categories and bypasses this stripping for the newer category records.</span></span> <span data-ttu-id="15c29-283">Bizim sonraki öğreticide biz var olan bir kayıt s görüntüsünü güncelleştirmek nasıl inceleyeceğiz ve jpg formatından; böylece tüm eski kategori resimler güncelleştirme yapacaksınız.</span><span class="sxs-lookup"><span data-stu-id="15c29-283">In our next tutorial we'll examine how to update an existing record s image, and we'll update all of the old category pictures so that they are JPGs.</span></span> <span data-ttu-id="15c29-284">Şimdilik, yine de aşağıdaki kodda kullanmak `DisplayCategoryPicture.aspx` OLE üst bilgileri yalnızca özgün sekiz kategorilerin Şerit için:</span><span class="sxs-lookup"><span data-stu-id="15c29-284">For now, though, use the following code in `DisplayCategoryPicture.aspx` to strip the OLE headers only for those original eight categories:</span></span>


[!code-vb[Main](including-a-file-upload-option-when-adding-a-new-record-vb/samples/sample12.vb)]

<span data-ttu-id="15c29-285">Bu değişiklikle, JPG resim artık doğru GridView işlenir.</span><span class="sxs-lookup"><span data-stu-id="15c29-285">With this change, the JPG image is now rendered correctly in the GridView.</span></span>


<span data-ttu-id="15c29-286">[![Yeni kategoriler JPG görüntülerde doğru işlenmiş olan](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image11.gif)](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image19.png)</span><span class="sxs-lookup"><span data-stu-id="15c29-286">[![The JPG Images for New Categories are Correctly Rendered](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image11.gif)](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image19.png)</span></span>

<span data-ttu-id="15c29-287">**Şekil 11**: JPG görüntüleri yeni kategori için olan doğru çizilir ([tam boyutlu görüntüyü görüntülemek için tıklatın](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image20.png))</span><span class="sxs-lookup"><span data-stu-id="15c29-287">**Figure 11**: The JPG Images for New Categories are Correctly Rendered ([Click to view full-size image](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image20.png))</span></span>


## <a name="step-9-deleting-the-brochure-in-the-face-of-an-exception"></a><span data-ttu-id="15c29-288">9. adım: bir özel durum karşısında Broşürü silme</span><span class="sxs-lookup"><span data-stu-id="15c29-288">Step 9: Deleting the Brochure in the Face of an Exception</span></span>

<span data-ttu-id="15c29-289">Web sunucusu s dosya sisteminde ikili veri depolamanın zorluklardan biri, onu veri modeli ve ikili verileri arasında bir bağlantı kesme içermesidir.</span><span class="sxs-lookup"><span data-stu-id="15c29-289">One of the challenges of storing binary data on the web server s file system is that it introduces a disconnect between the data model and its binary data.</span></span> <span data-ttu-id="15c29-290">Bu nedenle, bir kaydı silindiğinde, dosya sistemindeki karşılık gelen ikili veriler ayrıca kaldırılmalıdır.</span><span class="sxs-lookup"><span data-stu-id="15c29-290">Therefore, whenever a record is deleted, the corresponding binary data on the file system must also be removed.</span></span> <span data-ttu-id="15c29-291">Bu, de eklerken oyuna gelebilir.</span><span class="sxs-lookup"><span data-stu-id="15c29-291">This can come into play when inserting, as well.</span></span> <span data-ttu-id="15c29-292">Aşağıdaki senaryoyu düşünün: geçerli resim ve Broşürü belirten yeni bir kategori bir kullanıcı ekler.</span><span class="sxs-lookup"><span data-stu-id="15c29-292">Consider the following scenario: a user adds a new category, specifying a valid picture and brochure.</span></span> <span data-ttu-id="15c29-293">Geri gönderimin oluştuğu için Ekle düğmesini tıklatın ve DetailsView s `ItemInserting` Broşürü web sunucusu s dosya sistemine kaydetme olay etkinleşir.</span><span class="sxs-lookup"><span data-stu-id="15c29-293">Upon clicking the Insert button, a postback occurs and the DetailsView s `ItemInserting` event fires, saving the brochure to the web server s file system.</span></span> <span data-ttu-id="15c29-294">İleri, ObjectDataSource s `Insert()` yöntemi çağrıldığında, çağıran `CategoriesBLL` s sınıfı `InsertWithPicture` çağırır yöntemi `CategoriesTableAdapter` s `InsertWithPicture` yöntemi.</span><span class="sxs-lookup"><span data-stu-id="15c29-294">Next, the ObjectDataSource s `Insert()` method is invoked, which calls the `CategoriesBLL` class s `InsertWithPicture` method, which calls the `CategoriesTableAdapter` s `InsertWithPicture` method.</span></span>

<span data-ttu-id="15c29-295">Şimdi, veritabanı çevrimdışıysa ne olur veya bir hata olup olmadığını `INSERT` SQL deyimini?</span><span class="sxs-lookup"><span data-stu-id="15c29-295">Now, what happens if the database is offline, or if there is an error in the `INSERT` SQL statement?</span></span> <span data-ttu-id="15c29-296">Yeni bir kategori satır veritabanına eklenecek şekilde açıkça ekleme başarısız olur.</span><span class="sxs-lookup"><span data-stu-id="15c29-296">Clearly the INSERT will fail, so no new category row will be added to the database.</span></span> <span data-ttu-id="15c29-297">Ancak hala web sunucusu s dosya sisteminde durduğunu karşıya yüklenen Broşürü dosya sahibiz!</span><span class="sxs-lookup"><span data-stu-id="15c29-297">But we still have the uploaded brochure file sitting on the web server s file system!</span></span> <span data-ttu-id="15c29-298">Bu dosya ekleme iş akışı sırasında bir özel durum karşısında silinmesi gerekir.</span><span class="sxs-lookup"><span data-stu-id="15c29-298">This file needs to be deleted in the face of an exception during the inserting workflow.</span></span>

<span data-ttu-id="15c29-299">Daha önce anlatıldığı gibi [işleme BLL - ve ASP.NET sayfası DAL düzeyi durumlar](../editing-inserting-and-deleting-data/handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb.md) onu kabarcıklanma yukarı çeşitli katmanından mimarisi derinliklerine içinde gelen bir özel durum olduğunda öğretici.</span><span class="sxs-lookup"><span data-stu-id="15c29-299">As discussed previously in the [Handling BLL- and DAL-Level Exceptions in an ASP.NET Page](../editing-inserting-and-deleting-data/handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb.md) tutorial, when an exception is thrown from within the depths of the architecture it is bubbled up through the various layers.</span></span> <span data-ttu-id="15c29-300">Sunu katmanında, biz bir özel durum DetailsView s'den gerçekleşip gerçekleşmediğini belirleyebilirsiniz `ItemInserted` olay.</span><span class="sxs-lookup"><span data-stu-id="15c29-300">At the Presentation Layer, we can determine if an exception has occurred from the DetailsView s `ItemInserted` event.</span></span> <span data-ttu-id="15c29-301">Bu olay işleyicisi ObjectDataSource s değerlerini de sağlar `InsertParameters`.</span><span class="sxs-lookup"><span data-stu-id="15c29-301">This event handler also provides the values of the ObjectDataSource s `InsertParameters`.</span></span> <span data-ttu-id="15c29-302">Bu nedenle, bir olay işleyicisi için oluşturabiliriz `ItemInserted` denetler bir özel durum ise ve bu durumda, olay siler ObjectDataSource s tarafından belirtilen dosya `brochurePath` parametre:</span><span class="sxs-lookup"><span data-stu-id="15c29-302">Therefore, we can create an event handler for the `ItemInserted` event that checks if there was an exception and, if so, deletes the file specified by the ObjectDataSource s `brochurePath` parameter:</span></span>


[!code-vb[Main](including-a-file-upload-option-when-adding-a-new-record-vb/samples/sample13.vb)]

## <a name="summary"></a><span data-ttu-id="15c29-303">Özet</span><span class="sxs-lookup"><span data-stu-id="15c29-303">Summary</span></span>

<span data-ttu-id="15c29-304">İkili veriler dahil kayıtları eklemek için web tabanlı bir arabirim sağlamak için gerçekleştirilmesi gereken adımlar vardır.</span><span class="sxs-lookup"><span data-stu-id="15c29-304">There are a number of steps that must be performed in order to provide a web-based interface for adding records that include binary data.</span></span> <span data-ttu-id="15c29-305">İkili veriler doğrudan veritabanına depolanan olasılığını mimarisi güncelleştirmek ikili veri burada eklenmekte durumu işlemek için özel yöntemler ekleme gerekir demektir.</span><span class="sxs-lookup"><span data-stu-id="15c29-305">If the binary data is being stored directly into the database, chances are you'll need to update the architecture, adding specific methods to handle the case where binary data is being inserted.</span></span> <span data-ttu-id="15c29-306">Mimari güncelleştirilmiş sonra sonraki adım bir dosya yükleme denetimini her ikili veri alanı eklemek için özelleştirilmiş bir DetailsView kullanılarak gerçekleştirilebilir ekleme arabirimi oluşturuyor.</span><span class="sxs-lookup"><span data-stu-id="15c29-306">Once the architecture has been updated, the next step is creating the inserting interface, which can be accomplished using a DetailsView that has been customized to include a FileUpload control for each binary data field.</span></span> <span data-ttu-id="15c29-307">Karşıya yüklenen veriler sonra web sunucusu s dosya sistemine kaydedilmiş veya bir veri kaynağı parametresi DetailsView s atanan `ItemInserting` olay işleyicisi.</span><span class="sxs-lookup"><span data-stu-id="15c29-307">The uploaded data can then be saved to the web server s file system or assigned to a data source parameter in the DetailsView s `ItemInserting` event handler.</span></span>

<span data-ttu-id="15c29-308">İkili verileri dosya sistemine kaydetme verileri doğrudan veritabanına kaydetme'den daha fazla planlama gerektirir.</span><span class="sxs-lookup"><span data-stu-id="15c29-308">Saving binary data to the file system requires more planning than saving data directly into the database.</span></span> <span data-ttu-id="15c29-309">Başka bir s üzerine bir kullanıcı s karşıya yükleme önlemek için bir adlandırma şeması seçilmelidir.</span><span class="sxs-lookup"><span data-stu-id="15c29-309">A naming scheme must be chosen in order to avoid one user s upload overwriting another s.</span></span> <span data-ttu-id="15c29-310">Ayrıca, veritabanı ekleme başarısız olursa yüklenen dosya silmek için ek adımlar izlenmelidir.</span><span class="sxs-lookup"><span data-stu-id="15c29-310">Also, extra steps must be taken to delete the uploaded file if the database insert fails.</span></span>

<span data-ttu-id="15c29-311">Biz şimdi broşürlerde ve resim ancak biz sistemiyle yeni kategorileri eklemek için var olan bir kategori s ikili verileri güncelleştirmek nasıl ya da doğru olarak silinen bir kategori için ikili verileri kaldırmak nasıl henüz bakmak için ve sahipsiniz.</span><span class="sxs-lookup"><span data-stu-id="15c29-311">We now have the ability to add new categories to the system with a brochure and picture, but we ve yet to look at how to update an existing category s binary data or how to correctly remove the binary data for a deleted category.</span></span> <span data-ttu-id="15c29-312">Sonraki öğreticide Biz bu iki konuları ele alacağız.</span><span class="sxs-lookup"><span data-stu-id="15c29-312">We'll explore these two topics in the next tutorial.</span></span>

<span data-ttu-id="15c29-313">Mutluluk programlama!</span><span class="sxs-lookup"><span data-stu-id="15c29-313">Happy Programming!</span></span>

## <a name="about-the-author"></a><span data-ttu-id="15c29-314">Yazar hakkında</span><span class="sxs-lookup"><span data-stu-id="15c29-314">About the Author</span></span>

<span data-ttu-id="15c29-315">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), yazar ve yedi ASP/ASP.NET books kurucusu, [4GuysFromRolla.com](http://www.4guysfromrolla.com), Microsoft Web teknolojileri ile bu yana 1998 çalışma.</span><span class="sxs-lookup"><span data-stu-id="15c29-315">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), author of seven ASP/ASP.NET books and founder of [4GuysFromRolla.com](http://www.4guysfromrolla.com), has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="15c29-316">Tan bağımsız Danışman, eğitmen ve yazıcı çalışır.</span><span class="sxs-lookup"><span data-stu-id="15c29-316">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="15c29-317">En son kendi defteri [ *kendi öğretmek kendiniz ASP.NET 2.0 24 saat içindeki*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span><span class="sxs-lookup"><span data-stu-id="15c29-317">His latest book is [*Sams Teach Yourself ASP.NET 2.0 in 24 Hours*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span></span> <span data-ttu-id="15c29-318">Kendisi üzerinde erişilebilir [ mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com) veya kendi blog hangi adresinde bulunabilir [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span><span class="sxs-lookup"><span data-stu-id="15c29-318">He can be reached at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com) or via his blog, which can be found at [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span></span>

## <a name="special-thanks-to"></a><span data-ttu-id="15c29-319">Özel teşekkürler</span><span class="sxs-lookup"><span data-stu-id="15c29-319">Special Thanks To</span></span>

<span data-ttu-id="15c29-320">Bu öğretici seri pek çok yararlı gözden geçirenler tarafından gözden geçirildi.</span><span class="sxs-lookup"><span data-stu-id="15c29-320">This tutorial series was reviewed by many helpful reviewers.</span></span> <span data-ttu-id="15c29-321">Bu öğretici için sağlama gözden geçirenler Dave Gardner, Teresa Murphy ve Bernadette Leigh yoktu.</span><span class="sxs-lookup"><span data-stu-id="15c29-321">Lead reviewers for this tutorial were Dave Gardner, Teresa Murphy, and Bernadette Leigh.</span></span> <span data-ttu-id="15c29-322">My yaklaşan MSDN makaleleri gözden geçirme ilginizi çekiyor mu?</span><span class="sxs-lookup"><span data-stu-id="15c29-322">Interested in reviewing my upcoming MSDN articles?</span></span> <span data-ttu-id="15c29-323">Öyleyse, bana bir satırında bırakma [ mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="15c29-323">If so, drop me a line at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span>

>[!div class="step-by-step"]
<span data-ttu-id="15c29-324">[Önceki](displaying-binary-data-in-the-data-web-controls-vb.md)
[sonraki](updating-and-deleting-existing-binary-data-vb.md)</span><span class="sxs-lookup"><span data-stu-id="15c29-324">[Previous](displaying-binary-data-in-the-data-web-controls-vb.md)
[Next](updating-and-deleting-existing-binary-data-vb.md)</span></span>
