---
uid: web-forms/overview/data-access/working-with-batched-data/wrapping-database-modifications-within-a-transaction-cs
title: Veritabanı değişiklikleri (C#) bir işlem içinde sarmalama | Microsoft Docs
author: rick-anderson
description: Bu güncelleştirme, silme ve toplu veri ekleme görünen dört ilk öğreticidir. Bu öğreticide nasıl veritabanı işlemleri izin bilgi edinin...
ms.author: aspnetcontent
manager: wpickett
ms.date: 06/26/2007
ms.topic: article
ms.assetid: b45fede3-c53a-4ea1-824b-20200808dbae
ms.technology: dotnet-webforms
ms.prod: .net-framework
msc.legacyurl: /web-forms/overview/data-access/working-with-batched-data/wrapping-database-modifications-within-a-transaction-cs
msc.type: authoredcontent
ms.openlocfilehash: a3f8ec2de7b9259e4bb83f4346bde8abfd643fb4
ms.sourcegitcommit: f8852267f463b62d7f975e56bea9aa3f68fbbdeb
ms.translationtype: MT
ms.contentlocale: tr-TR
ms.lasthandoff: 04/06/2018
ms.locfileid: "30888961"
---
<a name="wrapping-database-modifications-within-a-transaction-c"></a><span data-ttu-id="2c4a4-104">Bir işlem (C#) içinde kaydırma veritabanı değişiklikleri</span><span class="sxs-lookup"><span data-stu-id="2c4a4-104">Wrapping Database Modifications within a Transaction (C#)</span></span>
====================
<span data-ttu-id="2c4a4-105">tarafından [Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="2c4a4-105">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="2c4a4-106">[Kodu indirme](http://download.microsoft.com/download/3/9/f/39f92b37-e92e-4ab3-909e-b4ef23d01aa3/ASPNET_Data_Tutorial_63_CS.zip) veya [PDF indirin](wrapping-database-modifications-within-a-transaction-cs/_static/datatutorial63cs1.pdf)</span><span class="sxs-lookup"><span data-stu-id="2c4a4-106">[Download Code](http://download.microsoft.com/download/3/9/f/39f92b37-e92e-4ab3-909e-b4ef23d01aa3/ASPNET_Data_Tutorial_63_CS.zip) or [Download PDF](wrapping-database-modifications-within-a-transaction-cs/_static/datatutorial63cs1.pdf)</span></span>

> <span data-ttu-id="2c4a4-107">Bu güncelleştirme, silme ve toplu veri ekleme görünen dört ilk öğreticidir.</span><span class="sxs-lookup"><span data-stu-id="2c4a4-107">This tutorial is the first of four that looks at updating, deleting, and inserting batches of data.</span></span> <span data-ttu-id="2c4a4-108">Bu öğreticide nasıl veritabanı işlemleri tüm adımları başarılı veya tüm adımları başarısız sağlayan atomik bir işlem olarak gerçekleştirilebilmesi toplu değişikliklere izin ver öğrenin.</span><span class="sxs-lookup"><span data-stu-id="2c4a4-108">In this tutorial we learn how database transactions allow batch modifications to be carried out as an atomic operation, which ensures that either all steps succeed or all steps fail.</span></span>


## <a name="introduction"></a><span data-ttu-id="2c4a4-109">Giriş</span><span class="sxs-lookup"><span data-stu-id="2c4a4-109">Introduction</span></span>

<span data-ttu-id="2c4a4-110">İle başlayan gördüğümüz gibi [, bir genel bakış ekleme, güncelleştirme ve silme veri](../editing-inserting-and-deleting-data/an-overview-of-inserting-updating-and-deleting-data-cs.md) öğretici, GridView desteği sağlar. yerleşik satır düzeyi düzenleme ve silme için.</span><span class="sxs-lookup"><span data-stu-id="2c4a4-110">As we saw starting with the [An Overview of Inserting, Updating, and Deleting Data](../editing-inserting-and-deleting-data/an-overview-of-inserting-updating-and-deleting-data-cs.md) tutorial, the GridView provides built-in support for row-level editing and deleting.</span></span> <span data-ttu-id="2c4a4-111">Fare birkaç tıklama ile bir satır kod yazmadan zengin veri değişikliği arabirimi düzenleme ve silme bir satır başına temelinde ile içerik sürece oluşturmak mümkündür.</span><span class="sxs-lookup"><span data-stu-id="2c4a4-111">With a few clicks of the mouse it is possible to create a rich data modification interface without writing a line of code, so long as you are content with editing and deleting on a per-row basis.</span></span> <span data-ttu-id="2c4a4-112">Ancak, bazı senaryolarda bu yetersiz ve kullanıcılara düzenleme veya bir toplu kayıt silme olanağı sağlamak ihtiyacımız.</span><span class="sxs-lookup"><span data-stu-id="2c4a4-112">However, in certain scenarios this is insufficient and we need to provide users with the ability to edit or delete a batch of records.</span></span>

<span data-ttu-id="2c4a4-113">Örneğin, e-posta istemcileri en web tabanlı bir kılavuz her ileti listelemek için burada her satır bir onay e-posta s bilgileri (konu, gönderen ve benzeri) ile birlikte içeren kullanın.</span><span class="sxs-lookup"><span data-stu-id="2c4a4-113">For example, most web-based email clients use a grid to list each message where each row includes a checkbox along with the email s information (subject, sender, and so forth).</span></span> <span data-ttu-id="2c4a4-114">Bu arabirim kullanıcının birden fazla ileti bunları denetleniyor ve ardından Seçili iletileri Sil düğmesini tıklatarak silmesine izin verir.</span><span class="sxs-lookup"><span data-stu-id="2c4a4-114">This interface permits the user to delete multiple messages by checking them and then clicking a Delete Selected Messages button.</span></span> <span data-ttu-id="2c4a4-115">Arabirim düzenleme toplu kullanıcıların yaygın olarak birçok farklı kaydını düzenlemek burada durumlarda idealdir.</span><span class="sxs-lookup"><span data-stu-id="2c4a4-115">A batch editing interface is ideal in situations where users commonly edit many different records.</span></span> <span data-ttu-id="2c4a4-116">Kullanıcının'ı zorlama yerine düzenleme, kullanıcıların değişiklik ve değiştirilmesi gereken her kayıt için Güncelleştir'i tıklatın, her satırın düzenleme arabirimiyle arabirimini düzenleme toplu işler.</span><span class="sxs-lookup"><span data-stu-id="2c4a4-116">Rather than forcing the user to click Edit, make their change, and then click Update for each record that needs to be modified, a batch editing interface renders each row with its editing interface.</span></span> <span data-ttu-id="2c4a4-117">Kullanıcı, hızlı bir şekilde değiştirilmesi gereken satır kümesini değiştirin ve Tümünü Güncelleştir düğmesini tıklatarak bu değişiklikleri kaydedin.</span><span class="sxs-lookup"><span data-stu-id="2c4a4-117">The user can quickly modify the set of rows that need to be changed and then save these changes by clicking an Update All button.</span></span> <span data-ttu-id="2c4a4-118">Bu öğreticiler kümesinde biz ekleme, düzenleme ve veri toplu silme arabirimlerin nasıl oluşturulacağı inceleyeceğiz.</span><span class="sxs-lookup"><span data-stu-id="2c4a4-118">In this set of tutorials we'll examine how to create interfaces for inserting, editing, and deleting batches of data.</span></span>

<span data-ttu-id="2c4a4-119">Toplu işlemleri gerçekleştirirken, bazı işlemlerin başarılı olması için Toplu işlemdeki diğer while için bunu mümkün olup olmaması gerektiğini belirlemek önemli s başarısız.</span><span class="sxs-lookup"><span data-stu-id="2c4a4-119">When performing batch operations it s important to determine whether it should be possible for some of the operations in the batch to succeed while others fail.</span></span> <span data-ttu-id="2c4a4-120">İlk seçili kaydı başarıyla silindi, ancak İkincisi, söyleyin, yabancı anahtar kısıtlaması ihlali nedeniyle başarısız olursa ne olacağını arabirimi - silme toplu göz önünde bulundurun?</span><span class="sxs-lookup"><span data-stu-id="2c4a4-120">Consider a batch deleting interface - what should happen if the first selected record is deleted successfully, but the second one fails, say, because of a foreign key constraint violation?</span></span> <span data-ttu-id="2c4a4-121">İlk kaydı s silme geri alınması yoksa ilk kaydı silinen kalması kabul edilebilir mı?</span><span class="sxs-lookup"><span data-stu-id="2c4a4-121">Should the first record s delete be rolled back or is it acceptable for the first record to remain deleted?</span></span>

<span data-ttu-id="2c4a4-122">Toplu işlem göreceğini isteyip istemediğinizi bir [atomik işlemi](http://en.wikipedia.org/wiki/Atomic_operation), bir burada ya da tüm adımlar başarılı veya tüm adımları başarısız ve veri erişim katmanı için destek eklemek için Genişletilebilir gerekiyor [veritabanı İşlemler](http://en.wikipedia.org/wiki/Database_transaction).</span><span class="sxs-lookup"><span data-stu-id="2c4a4-122">If you want the batch operation to be treated as an [atomic operation](http://en.wikipedia.org/wiki/Atomic_operation), one where either all of the steps succeed or all of the steps fail, then the Data Access Layer needs to be augmented to include support for [database transactions](http://en.wikipedia.org/wiki/Database_transaction).</span></span> <span data-ttu-id="2c4a4-123">Veritabanı işlemleri garanti kümesinin kararlılık `INSERT`, `UPDATE`, ve `DELETE` deyimleri işlem şemsiyesi yürütülen ve çoğu tüm modern veritabanı sistemleri tarafından desteklenen bir özelliğidir.</span><span class="sxs-lookup"><span data-stu-id="2c4a4-123">Database transactions guarantee atomicity for the set of `INSERT`, `UPDATE`, and `DELETE` statements executed under the umbrella of the transaction and are a feature supported by most all modern database systems.</span></span>

<span data-ttu-id="2c4a4-124">Bu öğreticide biz veritabanı işlemleri kullanmak için DAL genişletmek ne göreceğiz.</span><span class="sxs-lookup"><span data-stu-id="2c4a4-124">In this tutorial we'll look at how to extend the DAL to use database transactions.</span></span> <span data-ttu-id="2c4a4-125">Sonraki öğreticilerde uygulayan web sayfaları ekleme, güncelleştirme ve silme arabirimleri toplu için inceleyeceksiniz.</span><span class="sxs-lookup"><span data-stu-id="2c4a4-125">Subsequent tutorials will examine implementing web pages for batch inserting, updating, and deleting interfaces.</span></span> <span data-ttu-id="2c4a4-126">Let s başlayın!</span><span class="sxs-lookup"><span data-stu-id="2c4a4-126">Let s get started!</span></span>

> [!NOTE]
> <span data-ttu-id="2c4a4-127">Bir toplu işlemde verileri değiştirirken kararlılık her zaman gerekli değildir.</span><span class="sxs-lookup"><span data-stu-id="2c4a4-127">When modifying data in a batch transaction, atomicity is not always needed.</span></span> <span data-ttu-id="2c4a4-128">Bazı senaryolarda, bazı veri değişikliklerinin başarılı olması için kabul edilebilir olabilir ve diğerleri aynı toplu iş zaman gibi başarısız bir web tabanlı e-posta istemcisinden e-postaları kümesi siliniyor.</span><span class="sxs-lookup"><span data-stu-id="2c4a4-128">In some scenarios, it may be acceptable to have some data modifications succeed and others in the same batch fail, such as when deleting a set of emails from a web-based email client.</span></span> <span data-ttu-id="2c4a4-129">Bir veritabanı hatası yarıda silme aracılığıyla orada s işlem, bu s hatasız işlenen kayıtları silinen kalmasını büyük olasılıkla kabul edilebilir.</span><span class="sxs-lookup"><span data-stu-id="2c4a4-129">If there s a database error midway through the deletion process, it s probably acceptable that those records processed without error remain deleted.</span></span> <span data-ttu-id="2c4a4-130">Böyle durumlarda, DAL veritabanı işlemleri desteklemek için değişiklik gerekmez.</span><span class="sxs-lookup"><span data-stu-id="2c4a4-130">In such cases, the DAL does not need to be modified to support database transactions.</span></span> <span data-ttu-id="2c4a4-131">Kararlılık önemli olduğu diğer toplu işlem senaryolar, ancak vardır.</span><span class="sxs-lookup"><span data-stu-id="2c4a4-131">There are other batch operation scenarios, however, where atomicity is vital.</span></span> <span data-ttu-id="2c4a4-132">Bir müşteri kendi fon bir banka hesabından diğerine taşındığında, iki işlem gerçekleştirilmelidir: fon ilk hesabından kesinti ve ikinci eklenir.</span><span class="sxs-lookup"><span data-stu-id="2c4a4-132">When a customer moves her funds from one bank account to another, two operations must be performed: the funds must be deducted from the first account and then added to the second.</span></span> <span data-ttu-id="2c4a4-133">Banka başarılı ilk adımı sahip şunları aklınızda değil ancak ikinci adım başarısız olsa da, müşterilerinin understandably upset olacaktır.</span><span class="sxs-lookup"><span data-stu-id="2c4a4-133">While the bank may not mind having the first step succeed but the second step fail, its customers would understandably be upset.</span></span> <span data-ttu-id="2c4a4-134">Bu öğreticide çalışma ve geliştirmeler ekleme toplu kullanarak, güncelleştirme ve biz aşağıdaki üç öğreticilerde derleme arabirimleri silme düşünmüyorsanız bile, veritabanı işlemleri desteklemek için DAL uygulamak için önerilir.</span><span class="sxs-lookup"><span data-stu-id="2c4a4-134">I encourage you to work through this tutorial and implement the enhancements to the DAL to support database transactions even if you do not plan on using them in the batch inserting, updating, and deleting interfaces we'll be building in the following three tutorials.</span></span>


## <a name="an-overview-of-transactions"></a><span data-ttu-id="2c4a4-135">İşlemleri genel bakış</span><span class="sxs-lookup"><span data-stu-id="2c4a4-135">An Overview of Transactions</span></span>

<span data-ttu-id="2c4a4-136">Çoğu veritabanları için destek içerir *işlemleri*, tek bir mantıksal birimde iş gruplandırılmasını birden çok veritabanı komutları etkinleştirin.</span><span class="sxs-lookup"><span data-stu-id="2c4a4-136">Most databases include support for *transactions*, which enable multiple database commands to be grouped into a single logical unit of work.</span></span> <span data-ttu-id="2c4a4-137">Bir işlem oluşturan veritabanı komutları tüm komutları başarısız olur veya tüm başarılı olur anlamına gelen, atomik olması garanti.</span><span class="sxs-lookup"><span data-stu-id="2c4a4-137">The database commands that comprise a transaction are guaranteed to be atomic, meaning that either all commands will fail or all will succeed.</span></span>

<span data-ttu-id="2c4a4-138">Genel olarak, işlemleri şu biçimi kullanarak SQL deyimlerini uygulanır:</span><span class="sxs-lookup"><span data-stu-id="2c4a4-138">In general, transactions are implemented through SQL statements using the following pattern:</span></span>

1. <span data-ttu-id="2c4a4-139">Bir işlem başlangıcını gösterir.</span><span class="sxs-lookup"><span data-stu-id="2c4a4-139">Indicate the start of a transaction.</span></span>
2. <span data-ttu-id="2c4a4-140">İşlem oluşturan SQL deyimlerini yürütün.</span><span class="sxs-lookup"><span data-stu-id="2c4a4-140">Execute the SQL statements that comprise the transaction.</span></span>
3. <span data-ttu-id="2c4a4-141">Adım 2 ', geri alma işlemi deyimleri birinde bir hata varsa.</span><span class="sxs-lookup"><span data-stu-id="2c4a4-141">If there is an error in one of the statements from Step 2, rollback the transaction.</span></span>
4. <span data-ttu-id="2c4a4-142">Adım 2'deyimleri tümünün hatasız tamamlarsanız, işlem uygulayın.</span><span class="sxs-lookup"><span data-stu-id="2c4a4-142">If all of the statements from Step 2 complete without error, commit the transaction.</span></span>

<span data-ttu-id="2c4a4-143">Oluşturmak için kullanılan SQL deyimlerini yürütün ve işlem girilebilir el ile saklı yordamlar SQL komut dosyası yazma veya oluşturma sırasında geri veya ADO.NET ya da sınıflarını kullanarak program aracılığıyla anlamına gelir [ `System.Transactions` ad alanı](https://msdn.microsoft.com/library/system.transactions.aspx).</span><span class="sxs-lookup"><span data-stu-id="2c4a4-143">The SQL statements used to create, commit, and roll back the transaction can be entered manually when writing SQL scripts or creating stored procedures, or through programmatic means using either ADO.NET or the classes in the [`System.Transactions` namespace](https://msdn.microsoft.com/library/system.transactions.aspx).</span></span> <span data-ttu-id="2c4a4-144">Bu öğreticide yalnızca inceleyeceğiz ADO.NET kullanarak işlemleri yönetme.</span><span class="sxs-lookup"><span data-stu-id="2c4a4-144">In this tutorial we will only examine managing transactions using ADO.NET.</span></span> <span data-ttu-id="2c4a4-145">Sonraki öğreticide saklı yordamlar aynı zamanda biz oluşturma, geri alma ve işlem yürüten SQL deyimlerini ele alacağız veri erişim katmanı kullanmak nasıl ele alacağız.</span><span class="sxs-lookup"><span data-stu-id="2c4a4-145">In a future tutorial we will look at how to use stored procedures in the Data Access Layer, at which time we'll explore the SQL statements for creating, rolling back, and committing transactions.</span></span> <span data-ttu-id="2c4a4-146">Bu arada, başvurun [SQL Server saklı yordamlar yönetme işlemlerinde](http://www.4guysfromrolla.com/webtech/080305-1.shtml) daha fazla bilgi için.</span><span class="sxs-lookup"><span data-stu-id="2c4a4-146">In the meantime, consult [Managing Transactions in SQL Server Stored Procedures](http://www.4guysfromrolla.com/webtech/080305-1.shtml) for more information.</span></span>

> [!NOTE]
> <span data-ttu-id="2c4a4-147">[ `TransactionScope` Sınıfı](https://msdn.microsoft.com/library/system.transactions.transactionscope.aspx) içinde `System.Transactions` ad alanı programlı olarak bir dizi deyimi bir işlem kapsamı içinde sarmalamak için geliştiricilere olanak sağlar ve birden çok ilgili karmaşık işlemleri için destek içerir iki farklı veritabanları veya bir Microsoft SQL Server veritabanı, bir Oracle veritabanına ve bir Web hizmeti gibi veri depolarına bile heterojen türleri gibi kaynakları.</span><span class="sxs-lookup"><span data-stu-id="2c4a4-147">The [`TransactionScope` class](https://msdn.microsoft.com/library/system.transactions.transactionscope.aspx) in the `System.Transactions` namespace enables developers to programmatically wrap a series of statements within the scope of a transaction and includes support for complex transactions that involve multiple sources, such as two different databases or even heterogeneous types of data stores, such as a Microsoft SQL Server database, an Oracle database, and a Web service.</span></span> <span data-ttu-id="2c4a4-148">I ullanıcı karar yerine Bu öğretici için ADO.NET hareketleri kullanmak `TransactionScope` sınıfı ADO.NET veritabanı işlemleri için ve çoğu durumda, daha özel olduğundan çok daha az kaynak yoğundur.</span><span class="sxs-lookup"><span data-stu-id="2c4a4-148">I ve decided to use ADO.NET transactions for this tutorial instead of the `TransactionScope` class because ADO.NET is more specific for database transactions and, in many cases, is far less resource intensive.</span></span> <span data-ttu-id="2c4a4-149">Ayrıca, bazı senaryolarla `TransactionScope` sınıfı, Microsoft Dağıtılmış İşlem Düzenleyicisi (MSDTC) kullanır.</span><span class="sxs-lookup"><span data-stu-id="2c4a4-149">In addition, under certain scenarios the `TransactionScope` class uses the Microsoft Distributed Transaction Coordinator (MSDTC).</span></span> <span data-ttu-id="2c4a4-150">Yapılandırma, uygulama ve performans sorunlarını çevresindeki MSDTC yerine özel ve gelişmiş bir konu kolaylaştırır ve bu öğreticileri kapsamı dışında.</span><span class="sxs-lookup"><span data-stu-id="2c4a4-150">The configuration, implementation, and performance issues surrounding MSDTC makes it a rather specialized and advanced topic and beyond the scope of these tutorials.</span></span>


<span data-ttu-id="2c4a4-151">ADO.NET SqlClient sağlayıcısı ile çalışırken, işlemleri çağrısıyla başlatılan [ `SqlConnection` sınıfı](https://msdn.microsoft.com/library/system.data.sqlclient.sqlconnection.aspx) s [ `BeginTransaction` yöntemi](https://msdn.microsoft.com/library/system.data.sqlclient.sqlconnection.begintransaction.aspx), döndüren bir [ `SqlTransaction` nesne](https://msdn.microsoft.com/library/system.data.sqlclient.sqltransaction.aspx).</span><span class="sxs-lookup"><span data-stu-id="2c4a4-151">When working with the SqlClient provider in ADO.NET, transactions are initiated through a call to the [`SqlConnection` class](https://msdn.microsoft.com/library/system.data.sqlclient.sqlconnection.aspx) s [`BeginTransaction` method](https://msdn.microsoft.com/library/system.data.sqlclient.sqlconnection.begintransaction.aspx), which returns a [`SqlTransaction` object](https://msdn.microsoft.com/library/system.data.sqlclient.sqltransaction.aspx).</span></span> <span data-ttu-id="2c4a4-152">Oluşma şekli işlem içinde yerleştirilir veri değişikliği deyimleri bir `try...catch` bloğu.</span><span class="sxs-lookup"><span data-stu-id="2c4a4-152">The data modification statements that makeup the transaction are placed within a `try...catch` block.</span></span> <span data-ttu-id="2c4a4-153">Bir deyimi içinde bir hata oluşursa, `try` engellemek, yürütme aktarımları için `catch` burada hareket geri aracılığıyla blok `SqlTransaction` s nesnesi [ `Rollback` yöntemi](https://msdn.microsoft.com/library/system.data.sqlclient.sqltransaction.rollback.aspx).</span><span class="sxs-lookup"><span data-stu-id="2c4a4-153">If an error occurs in a statement in the `try` block, execution transfers to the `catch` block where the transaction can be rolled back via the `SqlTransaction` object s [`Rollback` method](https://msdn.microsoft.com/library/system.data.sqlclient.sqltransaction.rollback.aspx).</span></span> <span data-ttu-id="2c4a4-154">Tüm ifadeler başarıyla tamamlanması için bir çağrı varsa `SqlTransaction` s nesnesi [ `Commit` yöntemi](https://msdn.microsoft.com/library/system.data.sqlclient.sqltransaction.commit.aspx) sonunda `try` blok işlem kaydeder.</span><span class="sxs-lookup"><span data-stu-id="2c4a4-154">If all of the statements complete successfully, a call to the `SqlTransaction` object s [`Commit` method](https://msdn.microsoft.com/library/system.data.sqlclient.sqltransaction.commit.aspx) at the end of the `try` block commits the transaction.</span></span> <span data-ttu-id="2c4a4-155">Aşağıdaki kod parçacığını bu deseni gösterilmektedir.</span><span class="sxs-lookup"><span data-stu-id="2c4a4-155">The following code snippet illustrates this pattern.</span></span> <span data-ttu-id="2c4a4-156">Bkz: [Bakımı veritabanı tutarlılığını hareketlerle](http://aspnet.4guysfromrolla.com/articles/072705-1.aspx) ek sözdizimi ve örnekleri işlemleri ADO.NET ile kullanma.</span><span class="sxs-lookup"><span data-stu-id="2c4a4-156">See [Maintaining Database Consistency with Transactions](http://aspnet.4guysfromrolla.com/articles/072705-1.aspx) for additional syntax and examples of using transactions with ADO.NET.</span></span>


[!code-csharp[Main](wrapping-database-modifications-within-a-transaction-cs/samples/sample1.cs)]

<span data-ttu-id="2c4a4-157">Varsayılan olarak, yazdığınız kümesindeki TableAdapters işlemleri kullanmayın.</span><span class="sxs-lookup"><span data-stu-id="2c4a4-157">By default, the TableAdapters in a Typed DataSet do not use transactions.</span></span> <span data-ttu-id="2c4a4-158">Bir işlem kapsamı içinde veri değişikliği bildirimlerini bir dizi gerçekleştirmek için yukarıdaki desenini kullanan ek yöntemleri dahil etmek için TableAdapter sınıfları büyütmek için ihtiyacımız işlemleri için destek sağlamak için.</span><span class="sxs-lookup"><span data-stu-id="2c4a4-158">To provide support for transactions we need to augment the TableAdapter classes to include additional methods that use the above pattern to perform a series of data modification statements within the scope of a transaction.</span></span> <span data-ttu-id="2c4a4-159">Kısmi sınıflar bu yöntemleri eklemek için nasıl kullanılacağını adım 2'de göreceğiz.</span><span class="sxs-lookup"><span data-stu-id="2c4a4-159">In Step 2 we'll see how to use partial classes to add these methods.</span></span>

## <a name="step-1-creating-the-working-with-batched-data-web-pages"></a><span data-ttu-id="2c4a4-160">1. adım: toplu veri Web sayfalarıyla çalışan oluşturma</span><span class="sxs-lookup"><span data-stu-id="2c4a4-160">Step 1: Creating the Working with Batched Data Web Pages</span></span>

<span data-ttu-id="2c4a4-161">Veritabanı işlemleri desteklemek için DAL büyütmek üzere nasıl keşfetme başlamadan önce öncelikle Bu öğretici için ihtiyacımız ASP.NET web sayfaları ve izleyin ve üç oluşturmak için bir dakikanızı ayırın s olanak tanır.</span><span class="sxs-lookup"><span data-stu-id="2c4a4-161">Before we start exploring how to augment the DAL to support database transactions, let s first take a moment to create the ASP.NET web pages that we will need for this tutorial and the three that follow.</span></span> <span data-ttu-id="2c4a4-162">Adlı yeni bir klasör eklemeye başlayın `BatchData` ve her bir sayfa ile ilişkilendirme aşağıdaki ASP.NET sayfaları ekleme `Site.master` ana sayfa.</span><span class="sxs-lookup"><span data-stu-id="2c4a4-162">Start by adding a new folder named `BatchData` and then add the following ASP.NET pages, associating each page with the `Site.master` master page.</span></span>

- `Default.aspx`
- `Transactions.aspx`
- `BatchUpdate.aspx`
- `BatchDelete.aspx`
- `BatchInsert.aspx`


![ASP.NET sayfaları için SqlDataSource ile ilgili öğreticiler ekleme](wrapping-database-modifications-within-a-transaction-cs/_static/image1.gif)

<span data-ttu-id="2c4a4-164">**Şekil 1**: SqlDataSource ilgili öğreticileri için ASP.NET sayfaları ekleme</span><span class="sxs-lookup"><span data-stu-id="2c4a4-164">**Figure 1**: Add the ASP.NET Pages for the SqlDataSource-Related Tutorials</span></span>


<span data-ttu-id="2c4a4-165">Diğer bir klasörleri olduğu gibi `Default.aspx` kullanacağı `SectionLevelTutorialListing.ascx` öğreticileri, bölüm içindeki listelemek için kullanıcı denetimi.</span><span class="sxs-lookup"><span data-stu-id="2c4a4-165">As with the other folders, `Default.aspx` will use the `SectionLevelTutorialListing.ascx` User Control to list the tutorials within its section.</span></span> <span data-ttu-id="2c4a4-166">Bu nedenle, bu kullanıcı denetimi Ekle `Default.aspx` s Tasarım görünümü sayfaya Çözüm Gezgini'nden sürükleyerek.</span><span class="sxs-lookup"><span data-stu-id="2c4a4-166">Therefore, add this User Control to `Default.aspx` by dragging it from the Solution Explorer onto the page s Design view.</span></span>


<span data-ttu-id="2c4a4-167">[![İçin Default.aspx SectionLevelTutorialListing.ascx kullanıcı denetimi Ekle](wrapping-database-modifications-within-a-transaction-cs/_static/image2.gif)](wrapping-database-modifications-within-a-transaction-cs/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="2c4a4-167">[![Add the SectionLevelTutorialListing.ascx User Control to Default.aspx](wrapping-database-modifications-within-a-transaction-cs/_static/image2.gif)](wrapping-database-modifications-within-a-transaction-cs/_static/image1.png)</span></span>

<span data-ttu-id="2c4a4-168">**Şekil 2**: eklemek `SectionLevelTutorialListing.ascx` kullanıcı denetimine `Default.aspx` ([tam boyutlu görüntüyü görüntülemek için tıklatın](wrapping-database-modifications-within-a-transaction-cs/_static/image2.png))</span><span class="sxs-lookup"><span data-stu-id="2c4a4-168">**Figure 2**: Add the `SectionLevelTutorialListing.ascx` User Control to `Default.aspx` ([Click to view full-size image](wrapping-database-modifications-within-a-transaction-cs/_static/image2.png))</span></span>


<span data-ttu-id="2c4a4-169">Son olarak, bu dört sayfaları girişlere ekleyin `Web.sitemap` dosya.</span><span class="sxs-lookup"><span data-stu-id="2c4a4-169">Lastly, add these four pages as entries to the `Web.sitemap` file.</span></span> <span data-ttu-id="2c4a4-170">Özellikle, aşağıdaki biçimlendirmeyi özelleştirme sonra eklemeniz Site Haritası `<siteMapNode>`:</span><span class="sxs-lookup"><span data-stu-id="2c4a4-170">Specifically, add the following markup after the Customizing the Site Map `<siteMapNode>`:</span></span>


[!code-xml[Main](wrapping-database-modifications-within-a-transaction-cs/samples/sample2.xml)]

<span data-ttu-id="2c4a4-171">Güncelleştirdikten sonra `Web.sitemap`, bir tarayıcı aracılığıyla öğreticileri Web sitesini görüntülemek için bir dakikanızı ayırın.</span><span class="sxs-lookup"><span data-stu-id="2c4a4-171">After updating `Web.sitemap`, take a moment to view the tutorials website through a browser.</span></span> <span data-ttu-id="2c4a4-172">Soldaki menüde artık toplu veri öğreticileri çalışmak için öğeleri içerir.</span><span class="sxs-lookup"><span data-stu-id="2c4a4-172">The menu on the left now includes items for the working with batched data tutorials.</span></span>


![Site Haritasını toplu veri öğreticileri çalışmak için girişleri şimdi içerir.](wrapping-database-modifications-within-a-transaction-cs/_static/image3.gif)

<span data-ttu-id="2c4a4-174">**Şekil 3**: Site Haritası toplu veri öğreticileri çalışmak için girişleri şimdi içerir.</span><span class="sxs-lookup"><span data-stu-id="2c4a4-174">**Figure 3**: The Site Map Now Includes Entries for the Working with Batched Data Tutorials</span></span>


## <a name="step-2-updating-the-data-access-layer-to-support-database-transactions"></a><span data-ttu-id="2c4a4-175">2. adım: Veritabanı işlemleri desteklemek için veri erişim katmanı güncelleştiriliyor</span><span class="sxs-lookup"><span data-stu-id="2c4a4-175">Step 2: Updating the Data Access Layer to Support Database Transactions</span></span>

<span data-ttu-id="2c4a4-176">Biz geri ilk öğreticide anlatıldığı gibi [veri erişim katmanı oluşturma](../introduction/creating-a-data-access-layer-cs.md), bizim DAL yazılan veri kümesini DataTables ve TableAdapters oluşur.</span><span class="sxs-lookup"><span data-stu-id="2c4a4-176">As we discussed back in the first tutorial, [Creating a Data Access Layer](../introduction/creating-a-data-access-layer-cs.md), the Typed DataSet in our DAL is composed of DataTables and TableAdapters.</span></span> <span data-ttu-id="2c4a4-177">DataTables veri tutarken TableAdapters DataTables ve benzeri yapılan değişikliklerle veritabanını güncelleştirmek için DataTables içine veritabanından veri okumak için işlevsellik sağlar.</span><span class="sxs-lookup"><span data-stu-id="2c4a4-177">The DataTables hold data while the TableAdapters provide the functionality to read data from the database into the DataTables, to update the database with changes made to the DataTables, and so forth.</span></span> <span data-ttu-id="2c4a4-178">TableAdapters t için toplu güncelleştirme ve DB doğrudan olarak adlandırılan verileri güncelleştirmek için iki desenleri sağlamak geri çağırma.</span><span class="sxs-lookup"><span data-stu-id="2c4a4-178">Recall that the TableAdapters provide two patterns for updating data, which I referred to as Batch Update and DB-Direct.</span></span> <span data-ttu-id="2c4a4-179">Toplu güncelleştirme desenle TableAdapter DataSet, DataTable ya da DataRow koleksiyonu geçirilir.</span><span class="sxs-lookup"><span data-stu-id="2c4a4-179">With the Batch Update pattern, the TableAdapter is passed a DataSet, DataTable, or collection of DataRows.</span></span> <span data-ttu-id="2c4a4-180">Bu veri numaralandırılır ve her biri için eklenen, değiştirilen veya satır, silinen `InsertCommand`, `UpdateCommand`, veya `DeleteCommand` yürütülür.</span><span class="sxs-lookup"><span data-stu-id="2c4a4-180">This data is enumerated and for each inserted, modified, or deleted row, the `InsertCommand`, `UpdateCommand`, or `DeleteCommand` is executed.</span></span> <span data-ttu-id="2c4a4-181">DB doğrudan desenle TableAdapter yerine sütun ekleme, güncelleştirme veya tek bir kaydını silmek için gerekli değerleri geçirilir.</span><span class="sxs-lookup"><span data-stu-id="2c4a4-181">With the DB-Direct pattern, the TableAdapter is instead passed the values of the columns necessary for inserting, updating, or deleting a single record.</span></span> <span data-ttu-id="2c4a4-182">DB doğrudan düzeni yöntemi sonra uygun yürütmek için geçirilen bu değerleri kullanır `InsertCommand`, `UpdateCommand`, veya `DeleteCommand` deyimi.</span><span class="sxs-lookup"><span data-stu-id="2c4a4-182">The DB Direct pattern method then uses those passed-in values to execute the appropriate `InsertCommand`, `UpdateCommand`, or `DeleteCommand` statement.</span></span>

<span data-ttu-id="2c4a4-183">Kullanılan güncelleştirme Düzen bağımsız olarak işlemleri otomatik olarak oluşturulan TableAdapters yöntemleri kullanmayın.</span><span class="sxs-lookup"><span data-stu-id="2c4a4-183">Regardless of the update pattern used, the TableAdapters auto-generated methods do not use transactions.</span></span> <span data-ttu-id="2c4a4-184">Varsayılan olarak her INSERT, update veya delete TableAdapter tarafından gerçekleştirilen tek ayrık bir işlem olarak kabul edilir.</span><span class="sxs-lookup"><span data-stu-id="2c4a4-184">By default each insert, update, or delete performed by the TableAdapter is treated as a single discrete operation.</span></span> <span data-ttu-id="2c4a4-185">Örneğin, DB doğrudan düzeni tarafından BLL bazı kodda on kayıt veritabanına eklemek için kullanılan olduğunu düşünün.</span><span class="sxs-lookup"><span data-stu-id="2c4a4-185">For instance, imagine that the DB-Direct pattern is used by some code in the BLL to insert ten records into the database.</span></span> <span data-ttu-id="2c4a4-186">Bu kod TableAdapter s çağırırdı `Insert` yöntemi on kez.</span><span class="sxs-lookup"><span data-stu-id="2c4a4-186">This code would call the TableAdapter s `Insert` method ten times.</span></span> <span data-ttu-id="2c4a4-187">İlk beş eklemeleri başarılı, ancak altıncı tek bir özel durumla sonuçlandı, ilk beş eklenen kayıtlar veritabanında kalır.</span><span class="sxs-lookup"><span data-stu-id="2c4a4-187">If the first five inserts succeed, but the sixth one resulted in an exception, the first five inserted records would remain in the database.</span></span> <span data-ttu-id="2c4a4-188">Benzer şekilde, toplu güncelleştirme düzeni ekler gerçekleştirmek için kullanılırsa, güncelleştirme ve silme için eklenen, değiştirilen ve bir DataTable tablosundaki satırları ilk çeşitli değişiklikler başarılı oldu, ancak daha sonraki bir önceki bu değişiklikleri bir hata ile karşılaştı silindiği, Tamamlanan veritabanında kalır.</span><span class="sxs-lookup"><span data-stu-id="2c4a4-188">Similarly, if the Batch Update pattern is used to perform inserts, updates, and deletes to the inserted, modified, and deleted rows in a DataTable, if the first several modifications succeeded but a later one encountered an error, those earlier modifications that completed would remain in the database.</span></span>

<span data-ttu-id="2c4a4-189">Bazı senaryolarda kararlılık değişiklikleri bir dizi arasında emin olmak istiyoruz.</span><span class="sxs-lookup"><span data-stu-id="2c4a4-189">In certain scenarios we want to ensure atomicity across a series of modifications.</span></span> <span data-ttu-id="2c4a4-190">Biz el ile genişlemelidir TableAdapter yürütme yeni yöntemleri ekleyerek bunu gerçekleştirmek için `InsertCommand`, `UpdateCommand`, ve `DeleteCommand` bir işlem şemsiyesi altındaki s.</span><span class="sxs-lookup"><span data-stu-id="2c4a4-190">To accomplish this we must manually extend the TableAdapter by adding new methods that execute the `InsertCommand`, `UpdateCommand`, and `DeleteCommand` s under the umbrella of a transaction.</span></span> <span data-ttu-id="2c4a4-191">İçinde [veri erişim katmanı oluşturma](../introduction/creating-a-data-access-layer-cs.md) kullanarak Aranan [kısmi sınıflar](http://en.wikipedia.org/wiki/Partial_type) yazılan DataSet içindeki DataTable işlevselliğini genişletmek için.</span><span class="sxs-lookup"><span data-stu-id="2c4a4-191">In [Creating a Data Access Layer](../introduction/creating-a-data-access-layer-cs.md) we looked at using [partial classes](http://en.wikipedia.org/wiki/Partial_type) to extend the functionality of the DataTables within the Typed DataSet.</span></span> <span data-ttu-id="2c4a4-192">Bu teknik TableAdapters ile de kullanılabilir.</span><span class="sxs-lookup"><span data-stu-id="2c4a4-192">This technique can also be used with TableAdapters.</span></span>

<span data-ttu-id="2c4a4-193">Yazılan veri kümesi `Northwind.xsd` bulunan `App_Code` s klasörü `DAL` alt klasörü.</span><span class="sxs-lookup"><span data-stu-id="2c4a4-193">The Typed DataSet `Northwind.xsd` is located in the `App_Code` folder s `DAL` subfolder.</span></span> <span data-ttu-id="2c4a4-194">Bir alt klasör oluşturun `DAL` adlı klasörü `TransactionSupport` ve adlı yeni bir sınıf dosyası ekleyin `ProductsTableAdapter.TransactionSupport.cs` (Şekil 4'e bakın).</span><span class="sxs-lookup"><span data-stu-id="2c4a4-194">Create a subfolder in the `DAL` folder named `TransactionSupport` and add a new class file named `ProductsTableAdapter.TransactionSupport.cs` (see Figure 4).</span></span> <span data-ttu-id="2c4a4-195">Bu dosya kısmi uygulanması tutacak `ProductsTableAdapter` bir işlemi kullanarak veri değişiklikleri gerçekleştirmek için yöntemler içerir.</span><span class="sxs-lookup"><span data-stu-id="2c4a4-195">This file will hold the partial implementation of the `ProductsTableAdapter` that includes methods for performing data modifications using a transaction.</span></span>


![TransactionSupport adlı bir klasör ve ProductsTableAdapter.TransactionSupport.cs adlı bir sınıf dosyası ekleme](wrapping-database-modifications-within-a-transaction-cs/_static/image4.gif)

<span data-ttu-id="2c4a4-197">**Şekil 4**: adlı bir klasör ekleme `TransactionSupport` ve adlı bir sınıf dosyası `ProductsTableAdapter.TransactionSupport.cs`</span><span class="sxs-lookup"><span data-stu-id="2c4a4-197">**Figure 4**: Add a Folder Named `TransactionSupport` and a Class File Named `ProductsTableAdapter.TransactionSupport.cs`</span></span>


<span data-ttu-id="2c4a4-198">Aşağıdaki kodu girin `ProductsTableAdapter.TransactionSupport.cs` dosyası:</span><span class="sxs-lookup"><span data-stu-id="2c4a4-198">Enter the following code into the `ProductsTableAdapter.TransactionSupport.cs` file:</span></span>


[!code-csharp[Main](wrapping-database-modifications-within-a-transaction-cs/samples/sample3.cs)]

<span data-ttu-id="2c4a4-199">`partial` Burada sınıf bildirimindeki anahtar sözcüğü gösterir eklenecek içinde eklenen üye olan derleyici `ProductsTableAdapter` sınıfını `NorthwindTableAdapters` ad alanı.</span><span class="sxs-lookup"><span data-stu-id="2c4a4-199">The `partial` keyword in the class declaration here indicates to the compiler that the members added within are to be added to the `ProductsTableAdapter` class in the `NorthwindTableAdapters` namespace.</span></span> <span data-ttu-id="2c4a4-200">Not `using System.Data.SqlClient` deyimini dosyanın üst.</span><span class="sxs-lookup"><span data-stu-id="2c4a4-200">Note the `using System.Data.SqlClient` statement at the top of the file.</span></span> <span data-ttu-id="2c4a4-201">TableAdapter SqlClient sağlayıcısı kullanacak şekilde yapılandırıldıktan sonra dahili olarak kullandığı bir [ `SqlDataAdapter` ](https://msdn.microsoft.com/library/system.data.sqlclient.sqldataadapter.aspx) kendi komutları veritabanına vermek için nesne.</span><span class="sxs-lookup"><span data-stu-id="2c4a4-201">Since the TableAdapter was configured to use the SqlClient provider, internally it uses a [`SqlDataAdapter`](https://msdn.microsoft.com/library/system.data.sqlclient.sqldataadapter.aspx) object to issue its commands to the database.</span></span> <span data-ttu-id="2c4a4-202">Sonuç olarak, kullanılacak ihtiyacımız `SqlTransaction` işlem başlamak için sınıf ve ardından onu yürütme veya geri alma için.</span><span class="sxs-lookup"><span data-stu-id="2c4a4-202">Consequently, we need to use the `SqlTransaction` class to begin the transaction and then to commit it or roll it back.</span></span> <span data-ttu-id="2c4a4-203">Microsoft SQL Server dışındaki bir veri deposu kullanıyorsanız, uygun sağlayıcıyı kullanmanız gerekir.</span><span class="sxs-lookup"><span data-stu-id="2c4a4-203">If you are using a data store other than Microsoft SQL Server, you'll need to use the appropriate provider.</span></span>

<span data-ttu-id="2c4a4-204">Bu yöntemler, geri alma, başlatmak için gereken yapı taşlarını sağlar ve bir işlem uygulayın.</span><span class="sxs-lookup"><span data-stu-id="2c4a4-204">These methods provide the building blocks needed to start, rollback, and commit a transaction.</span></span> <span data-ttu-id="2c4a4-205">Bunlar işaretlenmiş `public`, bunları içinden kullanılacak etkinleştirme `ProductsTableAdapter`, DAL başka bir sınıf ya da mimarisinde BLL gibi başka bir katmandan.</span><span class="sxs-lookup"><span data-stu-id="2c4a4-205">They are marked `public`, enabling them to be used from within the `ProductsTableAdapter`, from another class in the DAL, or from another layer in the architecture, such as the BLL.</span></span> <span data-ttu-id="2c4a4-206">`BeginTransaction` İç TableAdapter s açılır `SqlConnection` (gerekirse), işlem başlar ve atar `Transaction` özelliği, hareket iç ağa bağlayan `SqlDataAdapter` s `SqlCommand` nesneleri.</span><span class="sxs-lookup"><span data-stu-id="2c4a4-206">`BeginTransaction` opens the TableAdapter s internal `SqlConnection` (if needed), begins the transaction and assigns it to the `Transaction` property, and attaches the transaction to the internal `SqlDataAdapter` s `SqlCommand` objects.</span></span> <span data-ttu-id="2c4a4-207">`CommitTransaction` ve `RollbackTransaction` çağrısı `Transaction` s nesnesi `Commit` ve `Rollback` yöntemleri, sırasıyla iç kapatmadan önce `Connection` nesnesi.</span><span class="sxs-lookup"><span data-stu-id="2c4a4-207">`CommitTransaction` and `RollbackTransaction` call the `Transaction` object s `Commit` and `Rollback` methods, respectively, before closing the internal `Connection` object.</span></span>

## <a name="step-3-adding-methods-to-update-and-delete-data-under-the-umbrella-of-a-transaction"></a><span data-ttu-id="2c4a4-208">3. adım: Güncelleştirme ve bir işlem Şemsiyesi altındaki verilerini silmek için yöntemler ekleme</span><span class="sxs-lookup"><span data-stu-id="2c4a4-208">Step 3: Adding Methods to Update and Delete Data Under the Umbrella of a Transaction</span></span>

<span data-ttu-id="2c4a4-209">Bu yöntemler tam, biz re hazır yöntemleri eklemek için `ProductsDataTable` veya bir dizi komut bir işlem şemsiyesi altındaki gerçekleştirmek BLL.</span><span class="sxs-lookup"><span data-stu-id="2c4a4-209">With these methods complete, we re ready to add methods to `ProductsDataTable` or the BLL that perform a series of commands under the umbrella of a transaction.</span></span> <span data-ttu-id="2c4a4-210">Aşağıdaki yöntemi güncelleştirmek için toplu güncelleştirme desen kullanan bir `ProductsDataTable` bir işlem kullanarak örneği.</span><span class="sxs-lookup"><span data-stu-id="2c4a4-210">The following method uses the Batch Update pattern to update a `ProductsDataTable` instance using a transaction.</span></span> <span data-ttu-id="2c4a4-211">Çağırarak bir işlem başlatır `BeginTransaction` yöntemi ve kullandığı bir `try...catch` veri değişikliği deyimleri vermek için blok.</span><span class="sxs-lookup"><span data-stu-id="2c4a4-211">It starts a transaction by calling the `BeginTransaction` method and then uses a `try...catch` block to issue the data modification statements.</span></span> <span data-ttu-id="2c4a4-212">Varsa çağrısı `Adapter` s nesnesi `Update` yöntemde bir özel durum, yürütme transfer edeceğini için `catch` burada işlem geri alınacak bloğu ve yeniden oluşturulan özel durum.</span><span class="sxs-lookup"><span data-stu-id="2c4a4-212">If the call to the `Adapter` object s `Update` method results in an exception, execution will transfer to the `catch` block where the transaction will be rolled back and the exception re-thrown.</span></span> <span data-ttu-id="2c4a4-213">Sözcüğünün `Update` yöntemi sağlanan satırlarını numaralandırarak toplu güncelleştirme deseni uygular `ProductsDataTable` ve gerekli gerçekleştirme `InsertCommand`, `UpdateCommand`, ve `DeleteCommand` s.</span><span class="sxs-lookup"><span data-stu-id="2c4a4-213">Recall that the `Update` method implements the Batch Update pattern by enumerating the rows of the supplied `ProductsDataTable` and performing the necessary `InsertCommand`, `UpdateCommand`, and `DeleteCommand` s.</span></span> <span data-ttu-id="2c4a4-214">Bu komutları sonuçlar hata herhangi biri olursa, işlem geri, işlem s ömrü boyunca yapılan önceki değişiklikler geri alındı.</span><span class="sxs-lookup"><span data-stu-id="2c4a4-214">If any one of these commands results in an error, the transaction is rolled back, undoing the previous modifications made during the transaction s lifetime.</span></span> <span data-ttu-id="2c4a4-215">Gereken `Update` deyimini tamamlamak hatasız, işlem tamamının gerçekleştirilir.</span><span class="sxs-lookup"><span data-stu-id="2c4a4-215">Should the `Update` statement complete without error, the transaction is committed in its entirety.</span></span>


[!code-csharp[Main](wrapping-database-modifications-within-a-transaction-cs/samples/sample4.cs)]

<span data-ttu-id="2c4a4-216">Ekleme `UpdateWithTransaction` yönteme `ProductsTableAdapter` sınıfı kısmi sınıfında üzerinden `ProductsTableAdapter.TransactionSupport.cs`.</span><span class="sxs-lookup"><span data-stu-id="2c4a4-216">Add the `UpdateWithTransaction` method to the `ProductsTableAdapter` class through the partial class in `ProductsTableAdapter.TransactionSupport.cs`.</span></span> <span data-ttu-id="2c4a4-217">Alternatif olarak, bu yöntem iş mantığı katmanı s eklenemedi `ProductsBLL` birkaç küçük söz dizimi değişikliklerle sınıfı.</span><span class="sxs-lookup"><span data-stu-id="2c4a4-217">Alternatively, this method could be added to the Business Logic Layer s `ProductsBLL` class with a few minor syntactical changes.</span></span> <span data-ttu-id="2c4a4-218">Yani, anahtar sözcüğü bu `this.BeginTransaction()`, `this.CommitTransaction()`, ve `this.RollbackTransaction()` ile değiştirilmeleri gerekir `Adapter` (sözcüğünün `Adapter` bir özellik adı `ProductsBLL` türü `ProductsTableAdapter`).</span><span class="sxs-lookup"><span data-stu-id="2c4a4-218">Namely, the keyword this in `this.BeginTransaction()`, `this.CommitTransaction()`, and `this.RollbackTransaction()` would need to be replaced with `Adapter` (recall that `Adapter` is the name of a property in `ProductsBLL` of type `ProductsTableAdapter`).</span></span>

<span data-ttu-id="2c4a4-219">`UpdateWithTransaction` Yöntemi toplu güncelleştirme deseni kullanır, ancak bir dizi DB doğrudan çağrısı aşağıdaki gösterildiği gibi yöntemi bir işlem kapsamı içinde de kullanılabilir.</span><span class="sxs-lookup"><span data-stu-id="2c4a4-219">The `UpdateWithTransaction` method uses the Batch Update pattern, but a series of DB-Direct calls can also be used within the scope of a transaction, as the following method shows.</span></span> <span data-ttu-id="2c4a4-220">`DeleteProductsWithTransaction` Yöntemi giriş olarak kabul eden bir `List<T>` türü `int`, hangi `ProductID` silmek için s.</span><span class="sxs-lookup"><span data-stu-id="2c4a4-220">The `DeleteProductsWithTransaction` method accepts as input a `List<T>` of type `int`, which are the `ProductID` s to delete.</span></span> <span data-ttu-id="2c4a4-221">Yöntem çağrısı aracılığıyla işlemi başlatan `BeginTransaction` , daha sonra `try` engellemek, DB doğrudan düzeni çağırma sağlanan listede tekrarlanan `Delete` yöntemi her `ProductID` değeri.</span><span class="sxs-lookup"><span data-stu-id="2c4a4-221">The method initiates the transaction via a call to `BeginTransaction` and then, in the `try` block, iterates through the supplied list calling the DB-Direct pattern `Delete` method for each `ProductID` value.</span></span> <span data-ttu-id="2c4a4-222">Yapılan çağrıların varsa `Delete` başarısız denetim için aktarılır `catch` burada işlem geri bloğu ve yeniden oluşturulan özel durum.</span><span class="sxs-lookup"><span data-stu-id="2c4a4-222">If any of the calls to `Delete` fails, control is transferred to the `catch` block where the transaction is rolled back and the exception re-thrown.</span></span> <span data-ttu-id="2c4a4-223">Tüm çağrılar, `Delete` işlem sonra başarılı.</span><span class="sxs-lookup"><span data-stu-id="2c4a4-223">If all calls to `Delete` succeed, then transaction is committed.</span></span> <span data-ttu-id="2c4a4-224">Bu yönteme eklemek `ProductsBLL` sınıfı.</span><span class="sxs-lookup"><span data-stu-id="2c4a4-224">Add this method to the `ProductsBLL` class.</span></span>


[!code-csharp[Main](wrapping-database-modifications-within-a-transaction-cs/samples/sample5.cs)]

## <a name="applying-transactions-across-multiple-tableadapters"></a><span data-ttu-id="2c4a4-225">Birden çok TableAdapters üzerinden uygulanan işlemler</span><span class="sxs-lookup"><span data-stu-id="2c4a4-225">Applying Transactions Across Multiple TableAdapters</span></span>

<span data-ttu-id="2c4a4-226">Bu öğreticide incelenmesi işlem ilgili kod karşı birden çok deyime sağlar `ProductsTableAdapter` atomik bir işlem olarak kabul edilmesi için.</span><span class="sxs-lookup"><span data-stu-id="2c4a4-226">The transaction-related code examined in this tutorial allows for multiple statements against the `ProductsTableAdapter` to be treated as an atomic operation.</span></span> <span data-ttu-id="2c4a4-227">Ancak ne birden fazla değişiklik yapılması farklı veritabanı tablolarını otomatik olarak gerçekleştirilmesi gerekir?</span><span class="sxs-lookup"><span data-stu-id="2c4a4-227">But what if multiple modifications to different database tables need to be performed atomically?</span></span> <span data-ttu-id="2c4a4-228">Örneği için bir kategori silerken, ilk geçerli ürünlerinden başka bir kategoriye atamak istiyoruz.</span><span class="sxs-lookup"><span data-stu-id="2c4a4-228">For instance, when deleting a category, we might first want to reassign its current products to some other category.</span></span> <span data-ttu-id="2c4a4-229">Ürünleri yeniden atama ve kategori silindiğinde bu iki adımı atomik bir işlem olarak yapılmalıdır.</span><span class="sxs-lookup"><span data-stu-id="2c4a4-229">These two steps reassigning the products and deleting the category should be executed as an atomic operation.</span></span> <span data-ttu-id="2c4a4-230">Ancak `ProductsTableAdapter` yalnızca değiştirme yöntemlerini içeren `Products` tablo ve `CategoriesTableAdapter` yalnızca değiştirme yöntemleri içerir `Categories` tablo.</span><span class="sxs-lookup"><span data-stu-id="2c4a4-230">But the `ProductsTableAdapter` includes only methods for modifying the `Products` table and the `CategoriesTableAdapter` includes only methods for modifying the `Categories` table.</span></span> <span data-ttu-id="2c4a4-231">Nasıl bir işlem hem TableAdapters olabilir?</span><span class="sxs-lookup"><span data-stu-id="2c4a4-231">So how can a transaction encompass both TableAdapters?</span></span>

<span data-ttu-id="2c4a4-232">Bir seçenek olan bir yöntem eklemek için `CategoriesTableAdapter` adlı `DeleteCategoryAndReassignProducts(categoryIDtoDelete, reassignToCategoryID)` ve bu yöntem ürünleri yeniden atar hem de kategori saklı yordam içinde tanımlanan bir işlem kapsamı içinde siler bir saklı yordam çağrısı.</span><span class="sxs-lookup"><span data-stu-id="2c4a4-232">One option is to add a method to the `CategoriesTableAdapter` named `DeleteCategoryAndReassignProducts(categoryIDtoDelete, reassignToCategoryID)` and have that method call a stored procedure that both reassigns the products and deletes the category within the scope of a transaction defined within the stored procedure.</span></span> <span data-ttu-id="2c4a4-233">Başlamak için Yürüt nasıl ve saklı yordamlar geri alma işlemlerinde gelecekteki bir öğreticide inceleyeceğiz.</span><span class="sxs-lookup"><span data-stu-id="2c4a4-233">We'll look at how to begin, commit, and rollback transactions in stored procedures in a future tutorial.</span></span>

<span data-ttu-id="2c4a4-234">İçeren DAL bir yardımcı sınıfı oluşturmak için başka bir seçenektir `DeleteCategoryAndReassignProducts(categoryIDtoDelete, reassignToCategoryID)` yöntemi.</span><span class="sxs-lookup"><span data-stu-id="2c4a4-234">Another option is to create a helper class in the DAL that contains the `DeleteCategoryAndReassignProducts(categoryIDtoDelete, reassignToCategoryID)` method.</span></span> <span data-ttu-id="2c4a4-235">Bir örneğini oluşturur. Bu yöntem `CategoriesTableAdapter` ve `ProductsTableAdapter` ve ardından bu iki TableAdapters `Connection` aynı özelliklerine `SqlConnection` örneği.</span><span class="sxs-lookup"><span data-stu-id="2c4a4-235">This method would create an instance of the `CategoriesTableAdapter` and the `ProductsTableAdapter` and then set these two TableAdapters `Connection` properties to the same `SqlConnection` instance.</span></span> <span data-ttu-id="2c4a4-236">AT o noktadan iki TableAdapters birini başlatmak çağrısıyla işlem `BeginTransaction`.</span><span class="sxs-lookup"><span data-stu-id="2c4a4-236">At that point, either one of the two TableAdapters would initiate the transaction with a call to `BeginTransaction`.</span></span> <span data-ttu-id="2c4a4-237">Ürünleri yeniden atama ve kategoriyi silmek için TableAdapters yöntemleri içinde çağrılan bir `try...catch` işlem yürütülmeli veya geri gerektiğinde with bloğu.</span><span class="sxs-lookup"><span data-stu-id="2c4a4-237">The TableAdapters methods for reassigning the products and deleting the category would be invoked in a `try...catch` block with the transaction committed or rolled back as needed.</span></span>

## <a name="step-4-adding-theupdatewithtransactionmethod-to-the-business-logic-layer"></a><span data-ttu-id="2c4a4-238">4. adım: Ekleme`UpdateWithTransaction`iş mantığı katmanı yöntemi</span><span class="sxs-lookup"><span data-stu-id="2c4a4-238">Step 4: Adding the`UpdateWithTransaction`Method to the Business Logic Layer</span></span>

<span data-ttu-id="2c4a4-239">Adım 3'te eklediğimiz bir `UpdateWithTransaction` yönteme `ProductsTableAdapter` DAL içinde.</span><span class="sxs-lookup"><span data-stu-id="2c4a4-239">In Step 3 we added an `UpdateWithTransaction` method to the `ProductsTableAdapter` in the DAL.</span></span> <span data-ttu-id="2c4a4-240">Biz BLL karşılık gelen bir yöntemi eklemeniz gerekir.</span><span class="sxs-lookup"><span data-stu-id="2c4a4-240">We should add a corresponding method to the BLL.</span></span> <span data-ttu-id="2c4a4-241">Sunu katmanı çağırmak için doğrudan DAL aşağıya doğru çağırabilirsiniz sırada `UpdateWithTransaction` yöntemi, bu öğreticileri genişletmeniz sunu katmandan DAL sahibi olma gereksiniminden kurtarır katmanlı bir mimari tanımlamak.</span><span class="sxs-lookup"><span data-stu-id="2c4a4-241">While the Presentation Layer could call directly down to the DAL to invoke the `UpdateWithTransaction` method, these tutorials have strived to define a layered architecture that insulates the DAL from the Presentation Layer.</span></span> <span data-ttu-id="2c4a4-242">Bu nedenle, bu yaklaşım devam etmemizi behooves.</span><span class="sxs-lookup"><span data-stu-id="2c4a4-242">Therefore, it behooves us to continue this approach.</span></span>

<span data-ttu-id="2c4a4-243">Açık `ProductsBLL` sınıf dosya ve adlı bir yöntem ekleyin `UpdateWithTransaction` yalnızca çağıran karşılık gelen DAL yöntemi aşağı kaydırın.</span><span class="sxs-lookup"><span data-stu-id="2c4a4-243">Open the `ProductsBLL` class file and add a method named `UpdateWithTransaction` that simply calls down to the corresponding DAL method.</span></span> <span data-ttu-id="2c4a4-244">Ayrıca, iki yeni yöntemleri şimdi olmalıdır `ProductsBLL`: `UpdateWithTransaction`, hangi yeni eklediğiniz, ve `DeleteProductsWithTransaction`, adım 3'te eklendi.</span><span class="sxs-lookup"><span data-stu-id="2c4a4-244">There should now be two new methods in `ProductsBLL`: `UpdateWithTransaction`, which you just added, and `DeleteProductsWithTransaction`, which was added in Step 3.</span></span>


[!code-csharp[Main](wrapping-database-modifications-within-a-transaction-cs/samples/sample6.cs)]

> [!NOTE]
> <span data-ttu-id="2c4a4-245">Bu yöntemleri dahil etmeyin `DataObjectMethodAttribute` çoğu diğer yöntemleri için atanan öznitelik `ProductsBLL` Biz bu yöntemlerini doğrudan sınıflardan ASP.NET sayfaları arka plan kodu çağırma çünkü sınıfı.</span><span class="sxs-lookup"><span data-stu-id="2c4a4-245">These methods do not include the `DataObjectMethodAttribute` attribute assigned to most other methods in the `ProductsBLL` class because we'll be invoking these methods directly from the ASP.NET pages code-behind classes.</span></span> <span data-ttu-id="2c4a4-246">Sözcüğünün `DataObjectMethodAttribute` hangi yöntemlerin ObjectDataSource s yapılandırma veri kaynağı Sihirbazı ve hangi sekmesinde (seçin, güncelleştirme, ekleme veya silme) altında görünmelidir bayrak için kullanılır.</span><span class="sxs-lookup"><span data-stu-id="2c4a4-246">Recall that `DataObjectMethodAttribute` is used to flag what methods should appear in the ObjectDataSource s Configure Data Source wizard and under what tab (SELECT, UPDATE, INSERT, or DELETE).</span></span> <span data-ttu-id="2c4a4-247">GridView düzenleme veya silme toplu için herhangi bir yerleşik destek eksik olduğundan, biz bu yöntemleri program aracılığıyla çağırmak yerine Kodsuz bildirim temelli yaklaşımı kullanmak zorunda kalırsınız.</span><span class="sxs-lookup"><span data-stu-id="2c4a4-247">Since the GridView lacks any built-in support for batch editing or deleting, we'll have to invoke these methods programmatically rather than use the code-free declarative approach.</span></span>


## <a name="step-5-atomically-updating-database-data-from-the-presentation-layer"></a><span data-ttu-id="2c4a4-248">5. adım: Sunu katmanı veritabanı verilerinden otomatik olarak güncelleştiriliyor</span><span class="sxs-lookup"><span data-stu-id="2c4a4-248">Step 5: Atomically Updating Database Data from the Presentation Layer</span></span>

<span data-ttu-id="2c4a4-249">Let s işlem kayıtları toplu güncelleştirirken etkisini anlamak için tüm ürünler GridView, listeler ve düğmesi Web içeren bir kullanıcı arabirimi oluşturma tıklatıldığında kontrol eden, ürünleri yeniden atar `CategoryID` değerleri.</span><span class="sxs-lookup"><span data-stu-id="2c4a4-249">To illustrate the effect that the transaction has when updating a batch of records, let s create a user interface that lists all products in a GridView and includes a Button Web control that, when clicked, reassigns the products `CategoryID` values.</span></span> <span data-ttu-id="2c4a4-250">İlk birkaç ürünleri geçerli bir kalmayacak şekilde özel olarak, kategori yeniden atama ilerleyeceğini `CategoryID` başkalarının var durumdayken değeri atanmış mevcut olmayan `CategoryID` değeri.</span><span class="sxs-lookup"><span data-stu-id="2c4a4-250">In particular, the category reassignment will progress so that the first several products are assigned a valid `CategoryID` value while others are purposefully assigned a non-existent `CategoryID` value.</span></span> <span data-ttu-id="2c4a4-251">Veritabanı olan bir ürün güncelleştirme denemesi biz, `CategoryID` var olan bir kategori s eşleşmiyor `CategoryID`, yabancı anahtar kısıtlaması ihlali ortaya çıkar ve özel durum oluşturuldu.</span><span class="sxs-lookup"><span data-stu-id="2c4a4-251">If we attempt to update the database with a product whose `CategoryID` does not match an existing category s `CategoryID`, a foreign key constraint violation will occur and an exception will be raised.</span></span> <span data-ttu-id="2c4a4-252">Bir işlem özel durum yabancı anahtar kısıtlaması ihlali oluştu kullanarak önceki neden olur, bu örnekte ne göreceğiz olan geçerli `CategoryID` değişiklikler geri alındı.</span><span class="sxs-lookup"><span data-stu-id="2c4a4-252">What we'll see in this example is that when using a transaction the exception raised from the foreign key constraint violation will cause the previous valid `CategoryID` changes to be rolled back.</span></span> <span data-ttu-id="2c4a4-253">Ancak, bir işlem kullanmadığınızda, ilk kategorileri için yapılan değişiklikleri kalmaya devam edecek.</span><span class="sxs-lookup"><span data-stu-id="2c4a4-253">When not using a transaction, however, the modifications to the initial categories will remain.</span></span>

<span data-ttu-id="2c4a4-254">Başlangıç açarak `Transactions.aspx` sayfasındaki `BatchData` klasörü ve araç tasarımcıya GridView sürükleyin.</span><span class="sxs-lookup"><span data-stu-id="2c4a4-254">Start by opening the `Transactions.aspx` page in the `BatchData` folder and drag a GridView from the Toolbox onto the Designer.</span></span> <span data-ttu-id="2c4a4-255">Ayarlama, `ID` için `Products` ve akıllı etiketten adlı yeni bir ObjectDataSource bağlayın `ProductsDataSource`.</span><span class="sxs-lookup"><span data-stu-id="2c4a4-255">Set its `ID` to `Products` and, from its smart tag, bind it to a new ObjectDataSource named `ProductsDataSource`.</span></span> <span data-ttu-id="2c4a4-256">ObjectDataSource kendi verisinden isteyecek şekilde yapılandırma `ProductsBLL` s sınıfı `GetProducts` yöntemi.</span><span class="sxs-lookup"><span data-stu-id="2c4a4-256">Configure the ObjectDataSource to pull its data from the `ProductsBLL` class s `GetProducts` method.</span></span> <span data-ttu-id="2c4a4-257">Bu salt okunur GridView olması, bu nedenle güncelleştirme, ekleme, açılan listeleri ayarlamak ve sekmeleri (hiçbiri) silecek ve bu Son'u tıklatın.</span><span class="sxs-lookup"><span data-stu-id="2c4a4-257">This will be a read-only GridView, so set the drop-down lists in the UPDATE, INSERT, and DELETE tabs to (None) and click Finish.</span></span>


<span data-ttu-id="2c4a4-258">[![Şekil 5: ObjectDataSource s ProductsBLL sınıfı GetProducts yöntemi kullanmak üzere yapılandırma](wrapping-database-modifications-within-a-transaction-cs/_static/image5.gif)](wrapping-database-modifications-within-a-transaction-cs/_static/image3.png)</span><span class="sxs-lookup"><span data-stu-id="2c4a4-258">[![Figure 5: Configure the ObjectDataSource to Use the ProductsBLL Class s GetProducts Method](wrapping-database-modifications-within-a-transaction-cs/_static/image5.gif)](wrapping-database-modifications-within-a-transaction-cs/_static/image3.png)</span></span>

<span data-ttu-id="2c4a4-259">**Şekil 5**: Şekil 5: ObjectDataSource kullanılacak yapılandırma `ProductsBLL` s sınıfı `GetProducts` yöntemi ([tam boyutlu görüntüyü görüntülemek için tıklatın](wrapping-database-modifications-within-a-transaction-cs/_static/image4.png))</span><span class="sxs-lookup"><span data-stu-id="2c4a4-259">**Figure 5**: Figure 5: Configure the ObjectDataSource to Use the `ProductsBLL` Class s `GetProducts` Method ([Click to view full-size image](wrapping-database-modifications-within-a-transaction-cs/_static/image4.png))</span></span>


<span data-ttu-id="2c4a4-260">[![Güncelleştirme, ekleme, açılan listeleri ayarlayın ve sekmeleri (hiçbiri) silme](wrapping-database-modifications-within-a-transaction-cs/_static/image6.gif)](wrapping-database-modifications-within-a-transaction-cs/_static/image5.png)</span><span class="sxs-lookup"><span data-stu-id="2c4a4-260">[![Set the Drop-Down Lists in the UPDATE, INSERT, and DELETE Tabs to (None)](wrapping-database-modifications-within-a-transaction-cs/_static/image6.gif)](wrapping-database-modifications-within-a-transaction-cs/_static/image5.png)</span></span>

<span data-ttu-id="2c4a4-261">**Şekil 6**: aşağı açılan listeler güncelleştirme, ekleme ve silme sekmeler (hiçbiri) ayarlayın ([tam boyutlu görüntüyü görüntülemek için tıklatın](wrapping-database-modifications-within-a-transaction-cs/_static/image6.png))</span><span class="sxs-lookup"><span data-stu-id="2c4a4-261">**Figure 6**: Set the Drop-Down Lists in the UPDATE, INSERT, and DELETE Tabs to (None) ([Click to view full-size image](wrapping-database-modifications-within-a-transaction-cs/_static/image6.png))</span></span>


<span data-ttu-id="2c4a4-262">Veri Kaynağı Yapılandırma Sihirbazı'nı tamamladıktan sonra Visual Studio BoundFields ve ürün veri alanları için CheckBoxField oluşturur.</span><span class="sxs-lookup"><span data-stu-id="2c4a4-262">After completing the Configure Data Source wizard, Visual Studio will create BoundFields and a CheckBoxField for the product data fields.</span></span> <span data-ttu-id="2c4a4-263">Dışında bu alanların tümünü Kaldır `ProductID`, `ProductName`, `CategoryID`, ve `CategoryName` ve yeniden adlandırma `ProductName` ve `CategoryName` BoundFields `HeaderText` özellikleri ürün ve kategorisi, sırasıyla.</span><span class="sxs-lookup"><span data-stu-id="2c4a4-263">Remove all of these fields except for `ProductID`, `ProductName`, `CategoryID`, and `CategoryName` and rename the `ProductName` and `CategoryName` BoundFields `HeaderText` properties to Product and Category, respectively.</span></span> <span data-ttu-id="2c4a4-264">Akıllı etiketten etkinleştirmek disk belleği seçeneği işaretleyin.</span><span class="sxs-lookup"><span data-stu-id="2c4a4-264">From the smart tag, check the Enable Paging option.</span></span> <span data-ttu-id="2c4a4-265">Bu değişiklikleri yaptıktan sonra GridView ve ObjectDataSource s bildirim temelli biçimlendirme aşağıdaki gibi görünmelidir:</span><span class="sxs-lookup"><span data-stu-id="2c4a4-265">After making these modifications, the GridView and ObjectDataSource s declarative markup should look like the following:</span></span>


[!code-aspx[Main](wrapping-database-modifications-within-a-transaction-cs/samples/sample7.aspx)]

<span data-ttu-id="2c4a4-266">Ardından, yukarıdaki GridView üç düğme Web denetimleri ekleyin.</span><span class="sxs-lookup"><span data-stu-id="2c4a4-266">Next, add three Button Web controls above the GridView.</span></span> <span data-ttu-id="2c4a4-267">Kılavuzu Yenile, ikinci s kategorilerine (işlem) ile değiştirin ve üçüncü bir s kategorileri (olmadan işlem) değiştirmek için ilk düğme s metin özelliğini ayarlayın.</span><span class="sxs-lookup"><span data-stu-id="2c4a4-267">Set the first Button s Text property to Refresh Grid, the second s to Modify Categories (WITH TRANSACTION), and the third one s to Modify Categories (WITHOUT TRANSACTION) .</span></span>


[!code-aspx[Main](wrapping-database-modifications-within-a-transaction-cs/samples/sample8.aspx)]

<span data-ttu-id="2c4a4-268">Bu noktada Visual Studio Tasarım görünümünde Şekil 7'de gösterilen ekran benzer görünmelidir.</span><span class="sxs-lookup"><span data-stu-id="2c4a4-268">At this point the Design view in Visual Studio should look similar to the screen shot shown in Figure 7.</span></span>


<span data-ttu-id="2c4a4-269">[![Sayfa GridView ve üç düğme Web denetimleri içeriyor](wrapping-database-modifications-within-a-transaction-cs/_static/image7.gif)](wrapping-database-modifications-within-a-transaction-cs/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="2c4a4-269">[![The Page Contains a GridView and Three Button Web Controls](wrapping-database-modifications-within-a-transaction-cs/_static/image7.gif)](wrapping-database-modifications-within-a-transaction-cs/_static/image7.png)</span></span>

<span data-ttu-id="2c4a4-270">**Şekil 7**: sayfası GridView ve üç düğme Web denetimleri içerir ([tam boyutlu görüntüyü görüntülemek için tıklatın](wrapping-database-modifications-within-a-transaction-cs/_static/image8.png))</span><span class="sxs-lookup"><span data-stu-id="2c4a4-270">**Figure 7**: The Page Contains a GridView and Three Button Web Controls ([Click to view full-size image](wrapping-database-modifications-within-a-transaction-cs/_static/image8.png))</span></span>


<span data-ttu-id="2c4a4-271">Her üç düğme s için olay işleyicileri oluşturma `Click` olaylar ve aşağıdaki kodu kullanın:</span><span class="sxs-lookup"><span data-stu-id="2c4a4-271">Create event handlers for each of the three Button s `Click` events and use the following code:</span></span>


[!code-csharp[Main](wrapping-database-modifications-within-a-transaction-cs/samples/sample9.cs)]

<span data-ttu-id="2c4a4-272">Yenile düğmesini s `Click` rebinds yalnızca GridView verileri olay işleyicisi çağrılarak `Products` GridView s `DataBind` yöntemi.</span><span class="sxs-lookup"><span data-stu-id="2c4a4-272">The refresh Button s `Click` event handler simply rebinds the data to the GridView by calling the `Products` GridView s `DataBind` method.</span></span>

<span data-ttu-id="2c4a4-273">İkinci olay işleyicisi ürünleri yeniden atar `CategoryID` s ve BLL veritabanı gerçekleştirmek için yeni işlem yönteminden güncelleştirmeleri bir işlem şemsiyesi kullanır.</span><span class="sxs-lookup"><span data-stu-id="2c4a4-273">The second event handler reassigns the products `CategoryID` s and uses the new transaction method from the BLL to perform the database updates under the umbrella of a transaction.</span></span> <span data-ttu-id="2c4a4-274">Unutmayın her ürünün s `CategoryID` rasgele aynı değere ayarlanır kendi `ProductID`.</span><span class="sxs-lookup"><span data-stu-id="2c4a4-274">Note that each product s `CategoryID` is arbitrarily set to the same value as its `ProductID`.</span></span> <span data-ttu-id="2c4a4-275">Bu ürünler olduğundan bu ince ilk birkaç ürünleri çalışır `ProductID` geçerli eşlemek için durum değerleri `CategoryID` s.</span><span class="sxs-lookup"><span data-stu-id="2c4a4-275">This will work fine for the first few products, since those products have `ProductID` values that happen to map to valid `CategoryID` s.</span></span> <span data-ttu-id="2c4a4-276">Ancak bir kez `ProductID` çok fazla büyümesini s başlatmak, bu içerik olarak farklı çakışmasını `ProductID` s ve `CategoryID` s artık uygular.</span><span class="sxs-lookup"><span data-stu-id="2c4a4-276">But once the `ProductID` s start getting too large, this coincidental overlap of `ProductID` s and `CategoryID` s no longer applies.</span></span>

<span data-ttu-id="2c4a4-277">Üçüncü `Click` olay işleyicisi güncelleştirmeleri ürünleri `CategoryID` gönderir ancak güncelleştirme s aynı şekilde kullanarak veritabanı `ProductsTableAdapter` s varsayılan `Update` yöntemi.</span><span class="sxs-lookup"><span data-stu-id="2c4a4-277">The third `Click` event handler updates the products `CategoryID` s in the same manner, but sends the update to the database using the `ProductsTableAdapter` s default `Update` method.</span></span> <span data-ttu-id="2c4a4-278">Bu `Update` yöntemi bir işlem içinde komutları dizi sarmalamak değil, bu değişiklikleri önce ilk karşılaşılan yabancı anahtar kısıtlaması ihlali hatası yapılan şekilde korunur.</span><span class="sxs-lookup"><span data-stu-id="2c4a4-278">This `Update` method does not wrap the series of commands within a transaction, so those changes are made prior to the first encountered foreign key constraint violation error will persist.</span></span>

<span data-ttu-id="2c4a4-279">Bu davranış göstermek için bir tarayıcı aracılığıyla bu sayfasını ziyaret edin.</span><span class="sxs-lookup"><span data-stu-id="2c4a4-279">To demonstrate this behavior, visit this page through a browser.</span></span> <span data-ttu-id="2c4a4-280">Başlangıçta verileri'nın ilk sayfasında Şekil 8'de gösterildiği gibi görmeniz gerekir.</span><span class="sxs-lookup"><span data-stu-id="2c4a4-280">Initially you should see the first page of data as shown in Figure 8.</span></span> <span data-ttu-id="2c4a4-281">Ardından, değişiklik kategorileri (ile işlem) düğmesine tıklayın.</span><span class="sxs-lookup"><span data-stu-id="2c4a4-281">Next, click the Modify Categories (WITH TRANSACTION) button.</span></span> <span data-ttu-id="2c4a4-282">Bu geri gönderimin neden ve tüm ürünleri güncelleştirme denemesi `CategoryID` değerleri, ancak bir yabancı anahtar kısıtlaması ihlali neden olur (bkz. Şekil 9).</span><span class="sxs-lookup"><span data-stu-id="2c4a4-282">This will cause a postback and attempt to update all of the products `CategoryID` values, but will result in a foreign key constraint violation (see Figure 9).</span></span>


<span data-ttu-id="2c4a4-283">[![Bir disk belleğine alınabilir GridView ürünleri görüntülenir](wrapping-database-modifications-within-a-transaction-cs/_static/image8.gif)](wrapping-database-modifications-within-a-transaction-cs/_static/image9.png)</span><span class="sxs-lookup"><span data-stu-id="2c4a4-283">[![The Products are Displayed in a Pageable GridView](wrapping-database-modifications-within-a-transaction-cs/_static/image8.gif)](wrapping-database-modifications-within-a-transaction-cs/_static/image9.png)</span></span>

<span data-ttu-id="2c4a4-284">**Şekil 8**: ürünler, bir disk belleğine alınabilir GridView görüntülenir ([tam boyutlu görüntüyü görüntülemek için tıklatın](wrapping-database-modifications-within-a-transaction-cs/_static/image10.png))</span><span class="sxs-lookup"><span data-stu-id="2c4a4-284">**Figure 8**: The Products are Displayed in a Pageable GridView ([Click to view full-size image](wrapping-database-modifications-within-a-transaction-cs/_static/image10.png))</span></span>


<span data-ttu-id="2c4a4-285">[![Bir yabancı anahtar kısıtlaması ihlali kategorileri sonuçlarında yeniden atama](wrapping-database-modifications-within-a-transaction-cs/_static/image9.gif)](wrapping-database-modifications-within-a-transaction-cs/_static/image11.png)</span><span class="sxs-lookup"><span data-stu-id="2c4a4-285">[![Reassigning the Categories Results in a Foreign Key Constraint Violation](wrapping-database-modifications-within-a-transaction-cs/_static/image9.gif)](wrapping-database-modifications-within-a-transaction-cs/_static/image11.png)</span></span>

<span data-ttu-id="2c4a4-286">**Şekil 9**: bir yabancı anahtar kısıtlaması ihlali kategorileri sonuçlarında yeniden atama ([tam boyutlu görüntüyü görüntülemek için tıklatın](wrapping-database-modifications-within-a-transaction-cs/_static/image12.png))</span><span class="sxs-lookup"><span data-stu-id="2c4a4-286">**Figure 9**: Reassigning the Categories Results in a Foreign Key Constraint Violation ([Click to view full-size image](wrapping-database-modifications-within-a-transaction-cs/_static/image12.png))</span></span>


<span data-ttu-id="2c4a4-287">Şimdi, tarayıcı s geri düğmesine basın ve ardından Kılavuzu Yenile düğmesini tıklatın.</span><span class="sxs-lookup"><span data-stu-id="2c4a4-287">Now hit your browser s Back button and then click the Refresh Grid button.</span></span> <span data-ttu-id="2c4a4-288">Veri yenileme sırasında tam aynı çıktı Şekil 8'de gösterildiği gibi görmeniz gerekir.</span><span class="sxs-lookup"><span data-stu-id="2c4a4-288">Upon refreshing the data you should see the exact same output as shown in Figure 8.</span></span> <span data-ttu-id="2c4a4-289">Diğer bir deyişle, hatta bazı ürünler olsa `CategoryID` s yasal için değiştirilmiş değerleri olan ve geri yabancı anahtar kısıtlaması ihlali oluştu zaman veritabanında güncelleştirilen, bunlar alındı.</span><span class="sxs-lookup"><span data-stu-id="2c4a4-289">That is, even though some of the products `CategoryID` s were changed to legal values and updated in the database, they were rolled back when the foreign key constraint violation occurred.</span></span>

<span data-ttu-id="2c4a4-290">Şimdi değiştir kategorileri (olmadan işlem) düğmesini tıklatarak deneyin.</span><span class="sxs-lookup"><span data-stu-id="2c4a4-290">Now try clicking the Modify Categories (WITHOUT TRANSACTION) button.</span></span> <span data-ttu-id="2c4a4-291">Bu aynı yabancı anahtar kısıtlaması ihlali hataya neden olur (bkz. Şekil 9), ancak bu sefer bu ürünler, `CategoryID` değerleri için yasal değiştirildi değeri değil geri alınacak.</span><span class="sxs-lookup"><span data-stu-id="2c4a4-291">This will result in the same foreign key constraint violation error (see Figure 9), but this time those products whose `CategoryID` values were changed to a legal value will not be rolled back.</span></span> <span data-ttu-id="2c4a4-292">Tarayıcı s geri düğmesine ve ardından Kılavuzu yenile düğmesine basın.</span><span class="sxs-lookup"><span data-stu-id="2c4a4-292">Hit your browser s Back button and then the Refresh Grid button.</span></span> <span data-ttu-id="2c4a4-293">Şekil 10 gösterildiği gibi `CategoryID` ilk sekiz ürünlerin s yeniden.</span><span class="sxs-lookup"><span data-stu-id="2c4a4-293">As Figure 10 shows, the `CategoryID` s of the first eight products have been reassigned.</span></span> <span data-ttu-id="2c4a4-294">Örneğin, Şekil 8'de izleme sahip bir `CategoryID` 1, ancak Şekil 10 BT s 2'ye yeniden atandığında.</span><span class="sxs-lookup"><span data-stu-id="2c4a4-294">For example, in Figure 8, Chang had a `CategoryID` of 1, but in Figure 10 it s been reassigned to 2.</span></span>


<span data-ttu-id="2c4a4-295">[![Bazı ürünler adlı kullanıcı, Categoryıd'si değerler güncelleştirildi ancak başkalarının olan değil olan](wrapping-database-modifications-within-a-transaction-cs/_static/image10.gif)](wrapping-database-modifications-within-a-transaction-cs/_static/image13.png)</span><span class="sxs-lookup"><span data-stu-id="2c4a4-295">[![Some Products CategoryID Values were Updated While Others Were Not](wrapping-database-modifications-within-a-transaction-cs/_static/image10.gif)](wrapping-database-modifications-within-a-transaction-cs/_static/image13.png)</span></span>

<span data-ttu-id="2c4a4-296">**Şekil 10**: bazı ürünler `CategoryID` değerleri değildi güncelleştirilmiş sırada başkalarının olan ([tam boyutlu görüntüyü görüntülemek için tıklatın](wrapping-database-modifications-within-a-transaction-cs/_static/image14.png))</span><span class="sxs-lookup"><span data-stu-id="2c4a4-296">**Figure 10**: Some Products `CategoryID` Values were Updated While Others Were Not ([Click to view full-size image](wrapping-database-modifications-within-a-transaction-cs/_static/image14.png))</span></span>


## <a name="summary"></a><span data-ttu-id="2c4a4-297">Özet</span><span class="sxs-lookup"><span data-stu-id="2c4a4-297">Summary</span></span>

<span data-ttu-id="2c4a4-298">Varsayılan olarak, TableAdapter s yöntemleri bir işlem kapsamı içinde yürütülen veritabanı deyimleri sarmalamak değil, ancak küçük bir iş oluşturacak yöntemleri, kaydetme ve geri alma bir işlem ekleyebiliriz.</span><span class="sxs-lookup"><span data-stu-id="2c4a4-298">By default, the TableAdapter s methods do not wrap the executed database statements within the scope of a transaction, but with a little work we can add methods that will create, commit, and rollback a transaction.</span></span> <span data-ttu-id="2c4a4-299">Bu öğreticide, üç tür yöntem oluşturduğumuz `ProductsTableAdapter` sınıfı: `BeginTransaction`, `CommitTransaction`, ve `RollbackTransaction`.</span><span class="sxs-lookup"><span data-stu-id="2c4a4-299">In this tutorial we created three such methods in the `ProductsTableAdapter` class: `BeginTransaction`, `CommitTransaction`, and `RollbackTransaction`.</span></span> <span data-ttu-id="2c4a4-300">Bu yöntemleri ile birlikte kullanmak nasıl gördüğümüz bir `try...catch` bir dizi veri değişikliği deyimi atomik yapmak için blok.</span><span class="sxs-lookup"><span data-stu-id="2c4a4-300">We saw how to use these methods along with a `try...catch` block to make a series of data modification statements atomic.</span></span> <span data-ttu-id="2c4a4-301">Özellikle, oluşturduğumuz `UpdateWithTransaction` yönteminde `ProductsTableAdapter`, sağlanan satırlarını gerekli değişiklikleri yapmak için toplu güncelleştirme desen kullanan `ProductsDataTable`.</span><span class="sxs-lookup"><span data-stu-id="2c4a4-301">In particular, we created the `UpdateWithTransaction` method in the `ProductsTableAdapter`, which uses the Batch Update pattern to perform the necessary modifications to the rows of a supplied `ProductsDataTable`.</span></span> <span data-ttu-id="2c4a4-302">Ayrıca eklediğimiz `DeleteProductsWithTransaction` yönteme `ProductsBLL` kabul BLL sınıfında bir `List` , `ProductID` değerleri kendi giriş ve DB doğrudan düzeni yöntemini çağırır `Delete` her `ProductID`.</span><span class="sxs-lookup"><span data-stu-id="2c4a4-302">We also added the `DeleteProductsWithTransaction` method to the `ProductsBLL` class in the BLL, which accepts a `List` of `ProductID` values as its input and calls the DB-Direct pattern method `Delete` for each `ProductID`.</span></span> <span data-ttu-id="2c4a4-303">Bir işlem oluşturarak ve veri değişikliği deyimleri içinde yürütülen her iki yöntem Başlat bir `try...catch` bloğu.</span><span class="sxs-lookup"><span data-stu-id="2c4a4-303">Both methods start by creating a transaction and then executing the data modification statements within a `try...catch` block.</span></span> <span data-ttu-id="2c4a4-304">Bir özel durum oluşursa, işlem geri alındı, aksi takdirde taahhüt eder.</span><span class="sxs-lookup"><span data-stu-id="2c4a4-304">If an exception occurs, the transaction is rolled back, otherwise it is committed.</span></span>

<span data-ttu-id="2c4a4-305">Adım 5 işlem toplu güncelleştirmeleri bir işlem kullanılacak ihmal toplu güncelleştirmeler karşı etkisini gösterilmiştir.</span><span class="sxs-lookup"><span data-stu-id="2c4a4-305">Step 5 illustrated the effect of transactional batch updates versus batch updates that neglected to use a transaction.</span></span> <span data-ttu-id="2c4a4-306">Sonraki üç eğitimlerine biz Bu öğreticide yerleştirilmiş foundation temel yapı ve toplu güncelleştirme, silme ve eklemeleri gerçekleştirmek için kullanıcı arabirimleri oluşturun.</span><span class="sxs-lookup"><span data-stu-id="2c4a4-306">In the next three tutorials we will build upon the foundation laid in this tutorial and create user interfaces for performing batch updates, deletes, and inserts.</span></span>

<span data-ttu-id="2c4a4-307">Mutluluk programlama!</span><span class="sxs-lookup"><span data-stu-id="2c4a4-307">Happy Programming!</span></span>

## <a name="further-reading"></a><span data-ttu-id="2c4a4-308">Daha Fazla Bilgi</span><span class="sxs-lookup"><span data-stu-id="2c4a4-308">Further Reading</span></span>

<span data-ttu-id="2c4a4-309">Bu öğreticide konular hakkında daha fazla bilgi için aşağıdaki kaynaklara bakın:</span><span class="sxs-lookup"><span data-stu-id="2c4a4-309">For more information on the topics discussed in this tutorial, refer to the following resources:</span></span>

- [<span data-ttu-id="2c4a4-310">Veritabanı tutarlılığını işlemleri ile koruma</span><span class="sxs-lookup"><span data-stu-id="2c4a4-310">Maintaining Database Consistency with Transactions</span></span>](http://aspnet.4guysfromrolla.com/articles/072705-1.aspx)
- [<span data-ttu-id="2c4a4-311">Saklı yordamlar SQL Server'daki işlemleri yönetme</span><span class="sxs-lookup"><span data-stu-id="2c4a4-311">Managing Transactions in SQL Server Stored Procedures</span></span>](http://www.4guysfromrolla.com/webtech/080305-1.shtml)
- [<span data-ttu-id="2c4a4-312">Kolaylaştırılmış işlemler: `System.Transactions`</span><span class="sxs-lookup"><span data-stu-id="2c4a4-312">Transactions Made Easy: `System.Transactions`</span></span>](https://blogs.msdn.com/florinlazar/archive/2004/07/23/192239.aspx)
- [<span data-ttu-id="2c4a4-313">TransactionScope ve DataAdapters</span><span class="sxs-lookup"><span data-stu-id="2c4a4-313">TransactionScope and DataAdapters</span></span>](http://andyclymer.blogspot.com/2007/01/transactionscope-and-dataadapters.html)
- [<span data-ttu-id="2c4a4-314">Oracle veritabanı işlemleri .NET ile kullanma</span><span class="sxs-lookup"><span data-stu-id="2c4a4-314">Using Oracle Database Transactions in .NET</span></span>](http://www.oracle.com/technology/pub/articles/price_dbtrans_dotnet.html)

## <a name="about-the-author"></a><span data-ttu-id="2c4a4-315">Yazar hakkında</span><span class="sxs-lookup"><span data-stu-id="2c4a4-315">About the Author</span></span>

<span data-ttu-id="2c4a4-316">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), yazar ve yedi ASP/ASP.NET books kurucusu, [4GuysFromRolla.com](http://www.4guysfromrolla.com), Microsoft Web teknolojileri ile bu yana 1998 çalışma.</span><span class="sxs-lookup"><span data-stu-id="2c4a4-316">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), author of seven ASP/ASP.NET books and founder of [4GuysFromRolla.com](http://www.4guysfromrolla.com), has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="2c4a4-317">Tan bağımsız Danışman, eğitmen ve yazıcı çalışır.</span><span class="sxs-lookup"><span data-stu-id="2c4a4-317">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="2c4a4-318">En son kendi defteri [ *kendi öğretmek kendiniz ASP.NET 2.0 24 saat içindeki*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span><span class="sxs-lookup"><span data-stu-id="2c4a4-318">His latest book is [*Sams Teach Yourself ASP.NET 2.0 in 24 Hours*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span></span> <span data-ttu-id="2c4a4-319">Kendisi üzerinde erişilebilir [ mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com) veya kendi blog hangi adresinde bulunabilir [ http://ScottOnWriting.NET ](http://ScottOnWriting.NET).</span><span class="sxs-lookup"><span data-stu-id="2c4a4-319">He can be reached at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com) or via his blog, which can be found at [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span></span>

## <a name="special-thanks-to"></a><span data-ttu-id="2c4a4-320">Özel teşekkürler</span><span class="sxs-lookup"><span data-stu-id="2c4a4-320">Special Thanks To</span></span>

<span data-ttu-id="2c4a4-321">Bu öğretici seri pek çok yararlı gözden geçirenler tarafından gözden geçirildi.</span><span class="sxs-lookup"><span data-stu-id="2c4a4-321">This tutorial series was reviewed by many helpful reviewers.</span></span> <span data-ttu-id="2c4a4-322">Bu öğretici için sağlama gözden geçirenler Dave Gardner, Hilton Giesenow ve Teresa Murphy yoktu.</span><span class="sxs-lookup"><span data-stu-id="2c4a4-322">Lead reviewers for this tutorial were Dave Gardner, Hilton Giesenow, and Teresa Murphy.</span></span> <span data-ttu-id="2c4a4-323">My yaklaşan MSDN makaleleri gözden geçirme ilginizi çekiyor mu?</span><span class="sxs-lookup"><span data-stu-id="2c4a4-323">Interested in reviewing my upcoming MSDN articles?</span></span> <span data-ttu-id="2c4a4-324">Öyleyse, bana bir satırında bırakma [ mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="2c4a4-324">If so, drop me a line at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span>

> [!div class="step-by-step"]
> [<span data-ttu-id="2c4a4-325">Next</span><span class="sxs-lookup"><span data-stu-id="2c4a4-325">Next</span></span>](batch-updating-cs.md)
