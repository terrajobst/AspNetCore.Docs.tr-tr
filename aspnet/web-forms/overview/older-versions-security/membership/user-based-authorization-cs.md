---
uid: web-forms/overview/older-versions-security/membership/user-based-authorization-cs
title: Kullanıcı tabanlı bir yetkilendirme (C#) | Microsoft Docs
author: rick-anderson
description: Bu öğreticide sayfalarına erişimi sınırlandırma ve sayfa düzeyinde işlevselliği teknikleri çeşitli kısıtlayarak ele alacağız.
ms.author: aspnetcontent
manager: wpickett
ms.date: 01/18/2008
ms.topic: article
ms.assetid: 3c815a9e-2296-4b9b-b945-776d54989daa
ms.technology: dotnet-webforms
ms.prod: .net-framework
msc.legacyurl: /web-forms/overview/older-versions-security/membership/user-based-authorization-cs
msc.type: authoredcontent
ms.openlocfilehash: 9a0d476ffaf1f176c21b245520fa943f66e8c0d5
ms.sourcegitcommit: f8852267f463b62d7f975e56bea9aa3f68fbbdeb
ms.translationtype: MT
ms.contentlocale: tr-TR
ms.lasthandoff: 04/10/2018
ms.locfileid: "30891925"
---
<a name="user-based-authorization-c"></a><span data-ttu-id="169e5-103">Kullanıcı tabanlı bir yetkilendirme (C#)</span><span class="sxs-lookup"><span data-stu-id="169e5-103">User-Based Authorization (C#)</span></span>
====================
<span data-ttu-id="169e5-104">tarafından [Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="169e5-104">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="169e5-105">[Kodu indirme](http://download.microsoft.com/download/3/f/5/3f5a8605-c526-4b34-b3fd-a34167117633/ASPNET_Security_Tutorial_07_CS.zip) veya [PDF indirin](http://download.microsoft.com/download/3/f/5/3f5a8605-c526-4b34-b3fd-a34167117633/aspnet_tutorial07_UserAuth_cs.pdf)</span><span class="sxs-lookup"><span data-stu-id="169e5-105">[Download Code](http://download.microsoft.com/download/3/f/5/3f5a8605-c526-4b34-b3fd-a34167117633/ASPNET_Security_Tutorial_07_CS.zip) or [Download PDF](http://download.microsoft.com/download/3/f/5/3f5a8605-c526-4b34-b3fd-a34167117633/aspnet_tutorial07_UserAuth_cs.pdf)</span></span>

> <span data-ttu-id="169e5-106">Bu öğreticide sayfalarına erişimi sınırlandırma ve sayfa düzeyinde işlevselliği teknikleri çeşitli kısıtlayarak ele alacağız.</span><span class="sxs-lookup"><span data-stu-id="169e5-106">In this tutorial we will look at limiting access to pages and restricting page-level functionality through a variety of techniques.</span></span>


## <a name="introduction"></a><span data-ttu-id="169e5-107">Giriş</span><span class="sxs-lookup"><span data-stu-id="169e5-107">Introduction</span></span>

<span data-ttu-id="169e5-108">Kullanıcı hesapları teklif çoğu web uygulamaları belirli ziyaretçileri site belirli sayfalara erişimini kısıtlamak için bölümünde bunu.</span><span class="sxs-lookup"><span data-stu-id="169e5-108">Most web applications that offer user accounts do so in part to restrict certain visitors from accessing certain pages within the site.</span></span> <span data-ttu-id="169e5-109">Birçok çevrimiçi messageboard sitelerdeki Örneğin, tüm kullanıcılar - anonim ve kimliği doğrulanmış - messageboard's gönderileri görüntüleyebilirsiniz, ancak yalnızca kimliği doğrulanmış kullanıcıların yeni bir posta oluşturmak için web sayfasını ziyaret.</span><span class="sxs-lookup"><span data-stu-id="169e5-109">In most online messageboard sites, for example, all users - anonymous and authenticated - are able to view the messageboard's posts, but only authenticated users can visit the web page to create a new post.</span></span> <span data-ttu-id="169e5-110">Ve yalnızca belirli bir kullanıcı (veya belirli bir kullanıcı kümesini) erişilebilen yönetim sayfaları olabilir.</span><span class="sxs-lookup"><span data-stu-id="169e5-110">And there may be administrative pages that are only accessible to a particular user (or a particular set of users).</span></span> <span data-ttu-id="169e5-111">Ayrıca, sayfa düzeyinde işlevselliği bir kullanıcı tarafından temelinde farklı olabilir.</span><span class="sxs-lookup"><span data-stu-id="169e5-111">Moreover, page-level functionality can differ on a user-by-user basis.</span></span> <span data-ttu-id="169e5-112">Bu arabirim anonim ziyaretçilere değildir, ancak gönderileri listesini görüntülerken, kimliği doğrulanmış kullanıcıların her post derecelendirme için bir arabirim gösterilir.</span><span class="sxs-lookup"><span data-stu-id="169e5-112">When viewing a list of posts, authenticated users are shown an interface for rating each post, whereas this interface is not available to anonymous visitors.</span></span>

<span data-ttu-id="169e5-113">ASP.NET, kullanıcı tabanlı bir yetkilendirme kurallarını tanımlamak kolaylaştırır.</span><span class="sxs-lookup"><span data-stu-id="169e5-113">ASP.NET makes it easy to define user-based authorization rules.</span></span> <span data-ttu-id="169e5-114">Yalnızca biçimlendirme biraz ile `Web.config`, belirli web sayfalarına ya da tüm dizinleri kilitlenebilir aşağı böylece yalnızca belirtilen bir kullanıcılar alt kümesine erişilebilir.</span><span class="sxs-lookup"><span data-stu-id="169e5-114">With just a bit of markup in `Web.config`, specific web pages or entire directories can be locked down so that they are only accessible to a specified subset of users.</span></span> <span data-ttu-id="169e5-115">Sayfa düzeyi işlevselliği açmak veya kapatmak programlı ve bildirim temelli araçlarla şu anda oturum açmış olan kullanıcının dayanan açılabilir.</span><span class="sxs-lookup"><span data-stu-id="169e5-115">Page-level functionality can be turned on or off based on the currently logged in user through programmatic and declarative means.</span></span>

<span data-ttu-id="169e5-116">Bu öğreticide sayfalarına erişimi sınırlandırma ve sayfa düzeyinde işlevselliği teknikleri çeşitli kısıtlayarak ele alacağız.</span><span class="sxs-lookup"><span data-stu-id="169e5-116">In this tutorial we will look at limiting access to pages and restricting page-level functionality through a variety of techniques.</span></span> <span data-ttu-id="169e5-117">Haydi başlayalım!</span><span class="sxs-lookup"><span data-stu-id="169e5-117">Let's get started!</span></span>

## <a name="a-look-at-the-url-authorization-workflow"></a><span data-ttu-id="169e5-118">URL yetkilendirme iş akışı bakma</span><span class="sxs-lookup"><span data-stu-id="169e5-118">A Look at the URL Authorization Workflow</span></span>

<span data-ttu-id="169e5-119">' Da anlatıldığı gibi [ *form kimlik doğrulaması bir genel bakış* ](../introduction/an-overview-of-forms-authentication-cs.md) ASP.NET kaynak isteği olay sayısı, yaşam döngüsü sırasında başlatır için ASP.NET çalışma zamanı bir isteği işlerken öğretici.</span><span class="sxs-lookup"><span data-stu-id="169e5-119">As discussed in the [*An Overview of Forms Authentication*](../introduction/an-overview-of-forms-authentication-cs.md) tutorial, when the ASP.NET runtime processes a request for an ASP.NET resource the request raises a number of events during its lifecycle.</span></span> <span data-ttu-id="169e5-120">*HTTP modülleri* kodu isteği yaşam döngüsü belirli bir olaya yanıt yürütüldüğünde yönetilen sınıflarıdır.</span><span class="sxs-lookup"><span data-stu-id="169e5-120">*HTTP Modules* are managed classes whose code is executed in response to a particular event in the request lifecycle.</span></span> <span data-ttu-id="169e5-121">ASP.NET birkaç önemli görevleri arka planda gerçekleştirmek HTTP Modülleri ile birlikte gelir.</span><span class="sxs-lookup"><span data-stu-id="169e5-121">ASP.NET ships with a number of HTTP Modules that perform essential tasks behind the scenes.</span></span>

<span data-ttu-id="169e5-122">Bu tür bir HTTP modülü [ `FormsAuthenticationModule` ](https://msdn.microsoft.com/library/system.web.security.formsauthenticationmodule.aspx).</span><span class="sxs-lookup"><span data-stu-id="169e5-122">One such HTTP Module is [`FormsAuthenticationModule`](https://msdn.microsoft.com/library/system.web.security.formsauthenticationmodule.aspx).</span></span> <span data-ttu-id="169e5-123">Önceki öğreticileri, sunucunun birincil işlevi anlatıldığı gibi `FormsAuthenticationModule` geçerli isteğin kimliğini belirlemektir.</span><span class="sxs-lookup"><span data-stu-id="169e5-123">As discussed in previous tutorials, the primary function of the `FormsAuthenticationModule` is to determine the identity of the current request.</span></span> <span data-ttu-id="169e5-124">Bu, bir tanımlama bilgisinde bulunan veya URL içinde katıştırılmış forms kimlik doğrulaması bileti inceleyerek gerçekleştirilir.</span><span class="sxs-lookup"><span data-stu-id="169e5-124">This is accomplished by inspecting the forms authentication ticket, which is either located in a cookie or embedded within the URL.</span></span> <span data-ttu-id="169e5-125">Bu kimliği gerçekleşir sırasında [ `AuthenticateRequest` olay](https://msdn.microsoft.com/library/system.web.httpapplication.authenticaterequest.aspx).</span><span class="sxs-lookup"><span data-stu-id="169e5-125">This identification takes place during the [`AuthenticateRequest` event](https://msdn.microsoft.com/library/system.web.httpapplication.authenticaterequest.aspx).</span></span>

<span data-ttu-id="169e5-126">Başka bir önemli HTTP modülü [ `UrlAuthorizationModule` ](https://msdn.microsoft.com/library/system.web.security.urlauthorizationmodule.aspx), yanıt olarak gerçekleştirilen [ `AuthorizeRequest` olay](https://msdn.microsoft.com/library/system.web.httpapplication.authorizerequest.aspx) (sonra gerçekleşir `AuthenticateRequest` olay).</span><span class="sxs-lookup"><span data-stu-id="169e5-126">Another important HTTP Module is the [`UrlAuthorizationModule`](https://msdn.microsoft.com/library/system.web.security.urlauthorizationmodule.aspx), which is raised in response to the [`AuthorizeRequest` event](https://msdn.microsoft.com/library/system.web.httpapplication.authorizerequest.aspx) (which happens after the `AuthenticateRequest` event).</span></span> <span data-ttu-id="169e5-127">`UrlAuthorizationModule` Yapılandırma biçimlendirmede inceler `Web.config` geçerli kimlik belirtilen sayfasını ziyaret etmek için yetkili olup olmadığını belirlemek için.</span><span class="sxs-lookup"><span data-stu-id="169e5-127">The `UrlAuthorizationModule` examines configuration markup in `Web.config` to determine whether the current identity has authority to visit the specified page.</span></span> <span data-ttu-id="169e5-128">Bu işlem olarak adlandırılır *URL yetkilendirmesi*.</span><span class="sxs-lookup"><span data-stu-id="169e5-128">This process is referred to as *URL authorization*.</span></span>

<span data-ttu-id="169e5-129">Biz 1. adımda, URL yetkilendirme kuralları için söz dizimi ancak daha önce şimdi inceleyeceğiz tahminde bulunduğunu görmek `UrlAuthorizationModule` istek veya yetkili bağlı olarak yapar.</span><span class="sxs-lookup"><span data-stu-id="169e5-129">We'll examine the syntax for the URL authorization rules in Step 1, but first let's look at what the `UrlAuthorizationModule` does depending on whether the request is authorized or not.</span></span> <span data-ttu-id="169e5-130">Varsa `UrlAuthorizationModule` istek yetki sonra hiçbir şey yapmaz ve istek kendi yaşam döngüsü devam eder belirler.</span><span class="sxs-lookup"><span data-stu-id="169e5-130">If the `UrlAuthorizationModule` determines that the request is authorized, then it does nothing, and the request continues through its lifecycle.</span></span> <span data-ttu-id="169e5-131">Ancak, istek ise *değil* yetkili ve sonra `UrlAuthorizationModule` yaşam döngüsü durdurur ve bildirir `Response` dönmek için nesne bir [HTTP 401 Yetkisiz](http://www.checkupdown.com/status/E401.html) durumu.</span><span class="sxs-lookup"><span data-stu-id="169e5-131">However, if the request is *not* authorized, then the `UrlAuthorizationModule` aborts the lifecycle and instructs the `Response` object to return an [HTTP 401 Unauthorized](http://www.checkupdown.com/status/E401.html) status.</span></span> <span data-ttu-id="169e5-132">Forms kimlik doğrulaması kullanırken bu HTTP 401 durum hiçbir zaman istemciye çünkü döndürülür, `FormsAuthenticationModule` bir HTTP durumu 401 değiştirir kendisine algılar bir [HTTP 302 yeniden yönlendirme](http://www.checkupdown.com/status/E302.html) oturum açma sayfası.</span><span class="sxs-lookup"><span data-stu-id="169e5-132">When using forms authentication this HTTP 401 status is never returned to the client because if the `FormsAuthenticationModule` detects an HTTP 401 status is modifies it to an [HTTP 302 Redirect](http://www.checkupdown.com/status/E302.html) to the login page.</span></span>

<span data-ttu-id="169e5-133">Şekil 1'iş akışı ASP.NET ardışık düzenini gösterir `FormsAuthenticationModule`ve `UrlAuthorizationModule` yetkisiz bir istek geldiğinde.</span><span class="sxs-lookup"><span data-stu-id="169e5-133">Figure 1 illustrates the workflow of the ASP.NET pipeline, the `FormsAuthenticationModule`, and the `UrlAuthorizationModule` when an unauthorized request arrives.</span></span> <span data-ttu-id="169e5-134">Özellikle, Şekil 1 tarafından anonim bir ziyaretçi için bir istek gösterir `ProtectedPage.aspx`, anonim kullanıcılara erişimini engellediği bir sayfa olduğu.</span><span class="sxs-lookup"><span data-stu-id="169e5-134">In particular, Figure 1 shows a request by an anonymous visitor for `ProtectedPage.aspx`, which is a page that denies access to anonymous users.</span></span> <span data-ttu-id="169e5-135">Ziyaretçi anonimdir beri `UrlAuthorizationModule` isteğini durdurur ve bir HTTP 401 yetkilendirilmedi durum döndürür.</span><span class="sxs-lookup"><span data-stu-id="169e5-135">Since the visitor is anonymous, the `UrlAuthorizationModule` aborts the request and returns an HTTP 401 Unauthorized status.</span></span> <span data-ttu-id="169e5-136">`FormsAuthenticationModule` Oturum açma sayfasının 302 yeniden yönlendirme 401 durum dönüştürür.</span><span class="sxs-lookup"><span data-stu-id="169e5-136">The `FormsAuthenticationModule` then converts the 401 status into a 302 Redirect to login page.</span></span> <span data-ttu-id="169e5-137">Kullanıcı oturum açma sayfasına doğrulandıktan sonra kendisinin yönlendirilir `ProtectedPage.aspx`.</span><span class="sxs-lookup"><span data-stu-id="169e5-137">After the user is authenticated via the login page, he is redirected to `ProtectedPage.aspx`.</span></span> <span data-ttu-id="169e5-138">Bu süre `FormsAuthenticationModule` kullanıcı kendi kimlik doğrulama bileti tabanlı tanımlar.</span><span class="sxs-lookup"><span data-stu-id="169e5-138">This time the `FormsAuthenticationModule` identifies the user based on his authentication ticket.</span></span> <span data-ttu-id="169e5-139">Ziyaretçi kimlik doğrulaması, `UrlAuthorizationModule` sayfaya erişim verir.</span><span class="sxs-lookup"><span data-stu-id="169e5-139">Now that the visitor is authenticated, the `UrlAuthorizationModule` permits access to the page.</span></span>


<span data-ttu-id="169e5-140">[![Form kimlik doğrulaması ve URL yetkilendirme iş akışı](user-based-authorization-cs/_static/image2.png)](user-based-authorization-cs/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="169e5-140">[![The Forms Authentication and URL Authorization Workflow](user-based-authorization-cs/_static/image2.png)](user-based-authorization-cs/_static/image1.png)</span></span>

<span data-ttu-id="169e5-141">**Şekil 1**: URL yetkilendirme iş akışını ve Forms kimlik doğrulaması ([tam boyutlu görüntüyü görüntülemek için tıklatın](user-based-authorization-cs/_static/image3.png))</span><span class="sxs-lookup"><span data-stu-id="169e5-141">**Figure 1**: The Forms Authentication and URL Authorization Workflow  ([Click to view full-size image](user-based-authorization-cs/_static/image3.png))</span></span>


<span data-ttu-id="169e5-142">Şekil 1 anonim bir ziyaretçi, anonim kullanıcılar için kullanılabilir olmayan bir kaynağa erişmeyi denediğinde oluşan etkileşimler gösterilmektedir.</span><span class="sxs-lookup"><span data-stu-id="169e5-142">Figure 1 depicts the interaction that occurs when an anonymous visitor attempts to access a resource that is not available to anonymous users.</span></span> <span data-ttu-id="169e5-143">Böyle bir durumda anonim ziyaretçi aynen sorgu dizesinde belirtilen ziyaret denediğiniz sayfa ile oturum açma sayfasına yönlendirilir.</span><span class="sxs-lookup"><span data-stu-id="169e5-143">In such a case, the anonymous visitor is redirected to the login page with the page she attempted to visit specified in the querystring.</span></span> <span data-ttu-id="169e5-144">Kullanıcı başarıyla oturum açtıktan sonra aynen otomatik olarak kendisi başlangıçta görüntülemek için çalışıyordu kaynak yeniden yönlendirilir.</span><span class="sxs-lookup"><span data-stu-id="169e5-144">Once the user has successfully logged on, she will be automatically redirected back to the resource she was initially attempting to view.</span></span>

<span data-ttu-id="169e5-145">Anonim kullanıcılar tarafından yetkisiz istek yapıldığında, bu iş akışı basittir ve ziyaretçi ne olduğunu anlamak kolaydır ve neden.</span><span class="sxs-lookup"><span data-stu-id="169e5-145">When the unauthorized request is made by an anonymous user, this workflow is straightforward and is easy for the visitor to understand what has happened and why.</span></span> <span data-ttu-id="169e5-146">Ancak, şunları aklınızda tutun içinde `FormsAuthenticationModule` yönlendirir *herhangi* tarafından kimliği doğrulanmış bir kullanıcı bir istekte olsa bile kullanıcı oturum açma sayfasına yetkisiz.</span><span class="sxs-lookup"><span data-stu-id="169e5-146">But keep in mind that the `FormsAuthenticationModule` will redirect *any* unauthorized user to the login page, even if the request is made by an authenticated user.</span></span> <span data-ttu-id="169e5-147">Kimliği doğrulanmış bir kullanıcı aynen yetkilisi eksik sayfasını ziyaret edin girişiminde bulunursa bu kafa karıştırıcı bir kullanıcı deneyimi neden olabilir.</span><span class="sxs-lookup"><span data-stu-id="169e5-147">This can result in a confusing user experience if an authenticated user attempts to visit a page for which she lacks authority.</span></span>

<span data-ttu-id="169e5-148">Bizim Web sitesinin yapılandırılan URL yetkilendirme kurallarını olduğunu düşünün gibi ASP.NET sayfası `OnlyTito.aspx` accessibly yalnızca Tito oluştu.</span><span class="sxs-lookup"><span data-stu-id="169e5-148">Imagine that our website had its URL authorization rules configured such that the ASP.NET page `OnlyTito.aspx` was accessibly only to Tito.</span></span> <span data-ttu-id="169e5-149">Şimdi, Sam sitesini ziyaret, oturum açan ve ziyaret girişiminde düşünün `OnlyTito.aspx`.</span><span class="sxs-lookup"><span data-stu-id="169e5-149">Now, imagine that Sam visits the site, logs on, and then attempts to visit `OnlyTito.aspx`.</span></span> <span data-ttu-id="169e5-150">`UrlAuthorizationModule` İsteği yaşam döngüsü durdurmak ve bir HTTP 401 Yetkisiz duruma dönmesi hangi `FormsAuthenticationModule` algılar ve ardından Sam oturum açma sayfasına yeniden yönlendir.</span><span class="sxs-lookup"><span data-stu-id="169e5-150">The `UrlAuthorizationModule` will halt the request lifecycle and return an HTTP 401 Unauthorized status, which the `FormsAuthenticationModule` will detect and then redirect Sam to the login page.</span></span> <span data-ttu-id="169e5-151">SAM zaten oturum açtıktan sonra yine de aynen oturum açma sayfasına yeniden aynen neden gönderildi merak ediyor olabilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="169e5-151">Since Sam has already logged in, though, she may wonder why she has been sent back to the login page.</span></span> <span data-ttu-id="169e5-152">Aynen her oturum açma kimlik bilgileri şekilde kayıp ya da aynen geçersiz kimlik bilgileri girilen neden.</span><span class="sxs-lookup"><span data-stu-id="169e5-152">She might reason that her login credentials were lost somehow, or that she entered invalid credentials.</span></span> <span data-ttu-id="169e5-153">Kendi kimlik bilgileri oturum açma sayfasından SAM reenters varsa aynen (yeniden) olarak oturum açmış ve olması için yeniden yönlendirilen `OnlyTito.aspx`.</span><span class="sxs-lookup"><span data-stu-id="169e5-153">If Sam reenters her credentials from the login page she will be logged on (again) and redirected to `OnlyTito.aspx`.</span></span> <span data-ttu-id="169e5-154">`UrlAuthorizationModule` Sam olamaz bu sayfasını ziyaret edin ve oturum açma sayfasına aynen döndürülür algılar.</span><span class="sxs-lookup"><span data-stu-id="169e5-154">The `UrlAuthorizationModule` will detect that Sam cannot visit this page and she will be returned to the login page.</span></span>

<span data-ttu-id="169e5-155">Şekil 2 kafa karıştırıcı bu iş akışı gösterilmektedir.</span><span class="sxs-lookup"><span data-stu-id="169e5-155">Figure 2 depicts this confusing workflow.</span></span>


<span data-ttu-id="169e5-156">[![Varsayılan iş akışı için kafa karıştırıcı bir döngü yol açabilir](user-based-authorization-cs/_static/image5.png)](user-based-authorization-cs/_static/image4.png)</span><span class="sxs-lookup"><span data-stu-id="169e5-156">[![The Default Workflow Can Lead to a Confusing Cycle](user-based-authorization-cs/_static/image5.png)](user-based-authorization-cs/_static/image4.png)</span></span>

<span data-ttu-id="169e5-157">**Şekil 2**: varsayılan iş akışı açabilir kafa karıştırıcı döngüsü ([tam boyutlu görüntüyü görüntülemek için tıklatın](user-based-authorization-cs/_static/image6.png))</span><span class="sxs-lookup"><span data-stu-id="169e5-157">**Figure 2**: The Default Workflow Can Lead to a Confusing Cycle  ([Click to view full-size image](user-based-authorization-cs/_static/image6.png))</span></span>


<span data-ttu-id="169e5-158">Şekil 2'de gösterilen iş akışı hızla bile çoğu bilgisayar deneyimli ziyaretçi befuddle.</span><span class="sxs-lookup"><span data-stu-id="169e5-158">The workflow illustrated in Figure 2 can quickly befuddle even the most computer savvy visitor.</span></span> <span data-ttu-id="169e5-159">2. adım döngüsünde kafa karıştırıcı Bunu önlemenin yolu ele alacağız.</span><span class="sxs-lookup"><span data-stu-id="169e5-159">We will look at ways to prevent this confusing cycle in Step 2.</span></span>

> [!NOTE]
> <span data-ttu-id="169e5-160">ASP.NET, geçerli kullanıcının belirli bir web sayfasını erişebileceğini belirlemek için iki mekanizma kullanır: URL yetkilendirme ve dosya yetkilendirme.</span><span class="sxs-lookup"><span data-stu-id="169e5-160">ASP.NET uses two mechanisms to determine whether the current user can access a particular web page: URL authorization and file authorization.</span></span> <span data-ttu-id="169e5-161">Dosya yetkilendirmesi tarafından gerçekleştirilir [ `FileAuthorizationModule` ](https://msdn.microsoft.com/library/system.web.security.fileauthorizationmodule.aspx), istenen dosya ACL'leri danışmanlık tarafından yetkilisi belirler.</span><span class="sxs-lookup"><span data-stu-id="169e5-161">File authorization is implemented by the [`FileAuthorizationModule`](https://msdn.microsoft.com/library/system.web.security.fileauthorizationmodule.aspx), which determines authority by consulting the requested file(s) ACLs.</span></span> <span data-ttu-id="169e5-162">ACL'ler Windows hesaplarına uygulanan izinleri olduğundan dosya yetkilendirme Windows kimlik doğrulaması ile en yaygın olarak kullanılır.</span><span class="sxs-lookup"><span data-stu-id="169e5-162">File authorization is most commonly used with Windows authentication because ACLs are permissions that apply to Windows accounts.</span></span> <span data-ttu-id="169e5-163">Forms kimlik doğrulaması kullanırken, tüm işletim sistemi ve dosya sistemi düzeyinde istekleri sitesini ziyaret kullanıcıya bakılmaksızın aynı Windows hesabına göre çalıştırılır.</span><span class="sxs-lookup"><span data-stu-id="169e5-163">When using forms authentication, all operating system- and file system-level requests are executed by the same Windows account, regardless of the user visiting the site.</span></span> <span data-ttu-id="169e5-164">Bu öğretici seri form kimlik doğrulamasını odaklanır olduğundan, biz dosya yetkilendirme ele değil.</span><span class="sxs-lookup"><span data-stu-id="169e5-164">Since this tutorial series focuses on forms authentication, we will not be discussing file authorization.</span></span>


### <a name="the-scope-of-url-authorization"></a><span data-ttu-id="169e5-165">URL yetkilendirme kapsamı</span><span class="sxs-lookup"><span data-stu-id="169e5-165">The Scope of URL Authorization</span></span>

<span data-ttu-id="169e5-166">`UrlAuthorizationModule` Olan yönetilen ASP.NET çalışma zamanı parçası olan kod.</span><span class="sxs-lookup"><span data-stu-id="169e5-166">The `UrlAuthorizationModule` is managed code that is part of the ASP.NET runtime.</span></span> <span data-ttu-id="169e5-167">Microsoft'un 7 sürümü önce [Internet Information Services (IIS)](https://www.iis.net/) web sunucusuna IIS HTTP ardışık düzen ve ASP.NET zamanının ardışık düzen arasında farklı bir engel oldu.</span><span class="sxs-lookup"><span data-stu-id="169e5-167">Prior to version 7 of Microsoft's [Internet Information Services (IIS)](https://www.iis.net/) web server, there was a distinct barrier between IIS's HTTP pipeline and the ASP.NET runtime's pipeline.</span></span> <span data-ttu-id="169e5-168">Kısa içinde IIS 6 ve önceki sürümlerinde, ASP. NET'in `UrlAuthorizationModule` bir istek IIS ASP.NET çalışma yetkisi aktarıldığında yalnızca yürütür.</span><span class="sxs-lookup"><span data-stu-id="169e5-168">In short, in IIS 6 and earlier, ASP.NET's `UrlAuthorizationModule` only executes when a request is delegated from IIS to the ASP.NET runtime.</span></span> <span data-ttu-id="169e5-169">Varsayılan olarak, IIS statik içeriğin kendisini - HTML sayfaları ve CSS, JavaScript ve görüntü dosyaları - gibi işler ve ASP.NET çalışma zamanı uzantısına sahip bir sayfa olduğunda isteklerini kapatmak yalnızca aktarır `.aspx`, `.asmx`, veya `.ashx` isteniyor.</span><span class="sxs-lookup"><span data-stu-id="169e5-169">By default, IIS processes static content itself - like HTML pages and CSS, JavaScript, and image files - and only hands off requests to the ASP.NET runtime when a page with an extension of `.aspx`, `.asmx`, or `.ashx` is requested.</span></span>

<span data-ttu-id="169e5-170">IIS 7, ancak, tümleşik IIS ve ASP.NET için işlem hatları sağlar.</span><span class="sxs-lookup"><span data-stu-id="169e5-170">IIS 7, however, allows for integrated IIS and ASP.NET pipelines.</span></span> <span data-ttu-id="169e5-171">Bazı yapılandırma ayarlarıyla çağırmak için IIS 7 Kurulumu `UrlAuthorizationModule` için *tüm* istekleri, URL yetkilendirme kuralları için herhangi bir türde dosyaları tanımlanabilir anlamına gelir.</span><span class="sxs-lookup"><span data-stu-id="169e5-171">With a few configuration settings you can setup IIS 7 to invoke the `UrlAuthorizationModule` for *all* requests, meaning that URL authorization rules can be defined for files of any type.</span></span> <span data-ttu-id="169e5-172">Ayrıca, IIS 7 kendi URL yetkilendirme altyapısı içerir.</span><span class="sxs-lookup"><span data-stu-id="169e5-172">Additionally, IIS 7 includes its own URL authorization engine.</span></span> <span data-ttu-id="169e5-173">ASP.NET tümleştirme ve IIS 7'in yerel URL yetkilendirme işlevselliği hakkında daha fazla bilgi için bkz: [anlama IIS7 URL yetkilendirmesi](https://www.iis.net/articles/view.aspx/IIS7/Managing-IIS7/Configuring-Security/URL-Authorization/Understanding-IIS7-URL-Authorization).</span><span class="sxs-lookup"><span data-stu-id="169e5-173">For more information on ASP.NET integration and IIS 7's native URL authorization functionality, see [Understanding IIS7 URL Authorization](https://www.iis.net/articles/view.aspx/IIS7/Managing-IIS7/Configuring-Security/URL-Authorization/Understanding-IIS7-URL-Authorization).</span></span> <span data-ttu-id="169e5-174">Shahram Khosravi'nın defterinin bir kopya için daha kapsamlı bir görünüm ASP.NET ve IIS 7 tümleştirme sırasında çekme *Professional IIS 7 ve ASP.NET tümleşik programlama* (ISBN: 978 0470152539).</span><span class="sxs-lookup"><span data-stu-id="169e5-174">For a more in-depth look at ASP.NET and IIS 7 integration, pick up a copy of Shahram Khosravi's book, *Professional IIS 7 and ASP.NET Integrated Programming* (ISBN: 978-0470152539).</span></span>

<span data-ttu-id="169e5-175">Buna koysalar IIS 7'den önceki sürümleri, URL yetkilendirme kuralları yalnızca ASP.NET çalışma zamanı tarafından işlenen kaynaklarına uygulanır.</span><span class="sxs-lookup"><span data-stu-id="169e5-175">In a nutshell, in versions prior to IIS 7, URL authorization rules are only applied to resources handled by the ASP.NET runtime.</span></span> <span data-ttu-id="169e5-176">Ancak, IIS 7 ile IIS yerel URL yetkilendirme özelliğini kullanmak veya ASP tümleştirme için mümkündür. NET'in `UrlAuthorizationModule` IIS HTTP ardışık düzenine böylece tüm isteklere bu işlevselliği genişletme.</span><span class="sxs-lookup"><span data-stu-id="169e5-176">But with IIS 7 it is possible to use IIS's native URL authorization feature or to integrate ASP.NET's `UrlAuthorizationModule` into IIS's HTTP pipeline, thereby extending this functionality to all requests.</span></span>

> [!NOTE]
> <span data-ttu-id="169e5-177">Bazı nasıl Zarif henüz önemli farklılıklar vardır ASP. NET'in `UrlAuthorizationModule` ve IIS 7'in URL yetkilendirme özelliği yetkilendirme kurallarını işleme.</span><span class="sxs-lookup"><span data-stu-id="169e5-177">There are some subtle yet important differences in how ASP.NET's `UrlAuthorizationModule` and IIS 7's URL authorization feature process the authorization rules.</span></span> <span data-ttu-id="169e5-178">Bu öğretici IIS 7'in URL yetkilendirme işlevselliği veya nasıl karşılaştırılan yetkilendirme kuralları ayrıştırır farklar inceleyin değil `UrlAuthorizationModule`.</span><span class="sxs-lookup"><span data-stu-id="169e5-178">This tutorial does not examine IIS 7's URL authorization functionality or the differences in how it parses authorization rules compared to the `UrlAuthorizationModule`.</span></span> <span data-ttu-id="169e5-179">Bu konular hakkında daha fazla bilgi için MSDN'de veya, IIS 7 belgelerine başvurun [www.iis.net](https://www.iis.net/).</span><span class="sxs-lookup"><span data-stu-id="169e5-179">For more information on these topics, refer to the IIS 7 documentation on MSDN or at [www.iis.net](https://www.iis.net/).</span></span>


## <a name="step-1-defining-url-authorization-rules-inwebconfig"></a><span data-ttu-id="169e5-180">1. adım: URL yetkilendirme kuralları tanımlama`Web.config`</span><span class="sxs-lookup"><span data-stu-id="169e5-180">Step 1: Defining URL Authorization Rules in`Web.config`</span></span>

<span data-ttu-id="169e5-181">`UrlAuthorizationModule` Uygulamanın yapılandırma dosyasındaki tanımlanan URL yetkilendirme kuralları göre belirli bir kimlik için istenen kaynak için erişim vermek veya reddetmek belirler.</span><span class="sxs-lookup"><span data-stu-id="169e5-181">The `UrlAuthorizationModule` determines whether to grant or deny access to a requested resource for a particular identity based on the URL authorization rules defined in the application's configuration.</span></span> <span data-ttu-id="169e5-182">Yetkilendirme kuralları içinde yazıldığından [ `<authorization>` öğesi](https://msdn.microsoft.com/library/8d82143t.aspx) biçiminde `<allow>` ve `<deny>` alt öğeleri.</span><span class="sxs-lookup"><span data-stu-id="169e5-182">The authorization rules are spelled out in the [`<authorization>` element](https://msdn.microsoft.com/library/8d82143t.aspx) in the form of `<allow>` and `<deny>` child elements.</span></span> <span data-ttu-id="169e5-183">Her `<allow>` ve `<deny>` alt öğesi belirtebilirsiniz:</span><span class="sxs-lookup"><span data-stu-id="169e5-183">Each `<allow>` and `<deny>` child element can specify:</span></span>

- <span data-ttu-id="169e5-184">Belirli bir kullanıcı</span><span class="sxs-lookup"><span data-stu-id="169e5-184">A particular user</span></span>
- <span data-ttu-id="169e5-185">Kullanıcıların virgülle ayrılmış bir listesi</span><span class="sxs-lookup"><span data-stu-id="169e5-185">A comma-delimited list of users</span></span>
- <span data-ttu-id="169e5-186">Bir soru işareti (?) tarafından belirtilen tüm anonim kullanıcılar</span><span class="sxs-lookup"><span data-stu-id="169e5-186">All anonymous users, denoted by a question mark (?)</span></span>
- <span data-ttu-id="169e5-187">Tüm kullanıcılar, bir yıldız işaretiyle gösterilir (\*)</span><span class="sxs-lookup"><span data-stu-id="169e5-187">All users, denoted by an asterisk (\*)</span></span>

<span data-ttu-id="169e5-188">Aşağıdaki biçimlendirmede URL yetkilendirme kuralları kullanıcıların Tito ve Scott verin ve diğerlerini reddetmek için nasıl kullanılacağı gösterilmektedir:</span><span class="sxs-lookup"><span data-stu-id="169e5-188">The following markup illustrates how to use the URL authorization rules to allow users Tito and Scott and deny all others:</span></span>

[!code-xml[Main](user-based-authorization-cs/samples/sample1.xml)]

<span data-ttu-id="169e5-189">`<allow>` Öğesi tanımlar hangi kullanıcıların - Tito ve Scott - izin verilen sırada `<deny>` öğesi bildirir *tüm* kullanıcılar engellenir.</span><span class="sxs-lookup"><span data-stu-id="169e5-189">The `<allow>` element defines what users are permitted - Tito and Scott - while the `<deny>` element instructs that *all* users are denied.</span></span>

> [!NOTE]
> <span data-ttu-id="169e5-190">`<allow>` Ve `<deny>` öğeleri rolleri için yetkilendirme kuralları da belirtebilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="169e5-190">The `<allow>` and `<deny>` elements can also specify authorization rules for roles.</span></span> <span data-ttu-id="169e5-191">Rol tabanlı bir yetkilendirme gelecekteki öğreticideki inceleyeceğiz.</span><span class="sxs-lookup"><span data-stu-id="169e5-191">We will examine role-based authorization in a future tutorial.</span></span>


<span data-ttu-id="169e5-192">Aşağıdaki ayar (anonim ziyaretçiler dahil) Sam dışındaki bir kişiye erişim verir:</span><span class="sxs-lookup"><span data-stu-id="169e5-192">The following setting grants access to anyone other than Sam (including anonymous visitors):</span></span>

[!code-xml[Main](user-based-authorization-cs/samples/sample2.xml)]

<span data-ttu-id="169e5-193">Yalnızca kimliği doğrulanan kullanıcılar izin vermek için tüm anonim kullanıcılar için erişimini engellediği aşağıdaki yapılandırmayı kullanın:</span><span class="sxs-lookup"><span data-stu-id="169e5-193">To allow only authenticated users, use the following configuration, which denies access to all anonymous users:</span></span>

[!code-xml[Main](user-based-authorization-cs/samples/sample3.xml)]

<span data-ttu-id="169e5-194">Yetkilendirme kuralları içinde tanımlanan `<system.web>` öğesinde `Web.config` ve web uygulamasında ASP.NET kaynakların tümünü uygulanır.</span><span class="sxs-lookup"><span data-stu-id="169e5-194">The authorization rules are defined within the `<system.web>` element in `Web.config` and apply to all of the ASP.NET resources in the web application.</span></span> <span data-ttu-id="169e5-195">Bir uygulama görmemeleri, farklı yetkilendirme kuralları için farklı bölümlere sahiptir.</span><span class="sxs-lookup"><span data-stu-id="169e5-195">Oftentimes, an application has different authorization rules for different sections.</span></span> <span data-ttu-id="169e5-196">Örneğin, bir e-ticaret sitesinde tüm ziyaretçiler ürün tekrar kullanmanıza, ürün incelemeleri bkz, katalogda arama ve benzeri.</span><span class="sxs-lookup"><span data-stu-id="169e5-196">For example, at an eCommerce site, all visitors may peruse the products, see product reviews, search the catalog, and so on.</span></span> <span data-ttu-id="169e5-197">Ancak, yalnızca kimliği doğrulanan kullanıcılar checkout veya birinin sevkiyat geçmişini yönetmek için sayfaları ulaşabilir.</span><span class="sxs-lookup"><span data-stu-id="169e5-197">However, only authenticated users may reach the checkout or the pages to manage one's shipping history.</span></span> <span data-ttu-id="169e5-198">Ayrıca, yalnızca site yöneticileri gibi select kullanıcılar tarafından erişilebilen site bölümlerini olabilir.</span><span class="sxs-lookup"><span data-stu-id="169e5-198">Moreover, there may be portions of the site that are only accessible by select users, such as site administrators.</span></span>

<span data-ttu-id="169e5-199">ASP.NET, site için farklı dosya ve klasörler için farklı yetkilendirme kurallarını tanımlamak kolaylaştırır.</span><span class="sxs-lookup"><span data-stu-id="169e5-199">ASP.NET makes it easy to define different authorization rules for different files and folders in the site.</span></span> <span data-ttu-id="169e5-200">Kök klasör belirtilen yetkilendirme kuralları `Web.config` dosya geçerli sitedeki tüm ASP.NET kaynaklarına.</span><span class="sxs-lookup"><span data-stu-id="169e5-200">The authorization rules specified in the root folder's `Web.config` file apply to all ASP.NET resources in the site.</span></span> <span data-ttu-id="169e5-201">Ancak, bu varsayılan yetkilendirme ayarları için belirli bir klasör ekleyerek geçersiz kılınabilir bir `Web.config` ile bir `<authorization>` bölümü.</span><span class="sxs-lookup"><span data-stu-id="169e5-201">However, these default authorization settings can be overridden for a particular folder by adding a `Web.config` with an `<authorization>` section.</span></span>

<span data-ttu-id="169e5-202">Şimdi yalnızca kimliği doğrulanan kullanıcılar ASP.NET sayfaları ziyaret edebileceği Web sitemizi güncelleştirmek `Membership` klasör.</span><span class="sxs-lookup"><span data-stu-id="169e5-202">Let's update our website so that only authenticated users can visit the ASP.NET pages in the `Membership` folder.</span></span> <span data-ttu-id="169e5-203">Bunu eklemek için ihtiyacımız gerçekleştirmek için bir `Web.config` dosya `Membership` klasörü ve anonim kullanıcıların engellemek için yetkilendirme ayarlarını ayarlayın.</span><span class="sxs-lookup"><span data-stu-id="169e5-203">To accomplish this we need to add a `Web.config` file to the `Membership` folder and set its authorization settings to deny anonymous users.</span></span> <span data-ttu-id="169e5-204">Sağ `Membership` Çözüm Gezgininde klasör bağlam menüsünde Yeni Öğe Ekle menü seçeneğini belirleyin ve adlı yeni bir Web yapılandırma dosyası ekleme `Web.config`.</span><span class="sxs-lookup"><span data-stu-id="169e5-204">Right-click the `Membership` folder in the Solution Explorer, choose the Add New Item menu from the context menu, and add a new Web Configuration File named `Web.config`.</span></span>


<span data-ttu-id="169e5-205">[![Üyelik klasörüne bir Web.config dosyası ekleyin](user-based-authorization-cs/_static/image8.png)](user-based-authorization-cs/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="169e5-205">[![Add a Web.config File to the Membership Folder](user-based-authorization-cs/_static/image8.png)](user-based-authorization-cs/_static/image7.png)</span></span>

<span data-ttu-id="169e5-206">**Şekil 3**: ekleme bir `Web.config` dosya `Membership` klasörü ([tam boyutlu görüntüyü görüntülemek için tıklatın](user-based-authorization-cs/_static/image9.png))</span><span class="sxs-lookup"><span data-stu-id="169e5-206">**Figure 3**: Add a `Web.config` File to the `Membership` Folder  ([Click to view full-size image](user-based-authorization-cs/_static/image9.png))</span></span>


<span data-ttu-id="169e5-207">Bu noktada, projenizin iki içermelidir `Web.config` dosyaları: biri kök dizin, diğeri de `Membership` klasör.</span><span class="sxs-lookup"><span data-stu-id="169e5-207">At this point your project should contain two `Web.config` files: one in the root directory and one in the `Membership` folder.</span></span>


<span data-ttu-id="169e5-208">[![Uygulamanızı şimdi iki Web.config dosyaları içermelidir](user-based-authorization-cs/_static/image11.png)](user-based-authorization-cs/_static/image10.png)</span><span class="sxs-lookup"><span data-stu-id="169e5-208">[![Your Application Should Now Contain Two Web.config Files](user-based-authorization-cs/_static/image11.png)](user-based-authorization-cs/_static/image10.png)</span></span>

<span data-ttu-id="169e5-209">**Şekil 4**: Bilgisayarınızı uygulama gereken şimdi içeren iki `Web.config` dosyaları ([tam boyutlu görüntüyü görüntülemek için tıklatın](user-based-authorization-cs/_static/image12.png))</span><span class="sxs-lookup"><span data-stu-id="169e5-209">**Figure 4**: Your Application Should Now Contain Two `Web.config` Files  ([Click to view full-size image](user-based-authorization-cs/_static/image12.png))</span></span>


<span data-ttu-id="169e5-210">Yapılandırma dosyasında güncelleştirme `Membership` anonim kullanıcılara erişimi olan yasaklar şekilde klasör.</span><span class="sxs-lookup"><span data-stu-id="169e5-210">Update the configuration file in the `Membership` folder so that it prohibits access to anonymous users.</span></span>

[!code-xml[Main](user-based-authorization-cs/samples/sample4.xml)]

<span data-ttu-id="169e5-211">Tüm olan İşte bu kadar!</span><span class="sxs-lookup"><span data-stu-id="169e5-211">That's all there is to it!</span></span>

<span data-ttu-id="169e5-212">Bu değişiklik test etmek için bir tarayıcıda giriş sayfasını ziyaret edin ve kaydedilir emin olun. Tüm ziyaretçiler izin vermek için bir ASP.NET uygulaması varsayılan davranışını olduğundan ve kök dizinin için yetkilendirme değişiklikleri siz istemediyseniz bu yana `Web.config` dosya, biz anonim bir ziyaretçi olarak kök dizindeki dosyaların ziyaret etmek kullanabilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="169e5-212">To test out this change, visit the homepage in a browser and make sure you are logged out. Since the default behavior of an ASP.NET application is to allow all visitors, and since we didn't make any authorization modifications to the root directory's `Web.config` file, we are able to visit the files in the root directory as an anonymous visitor.</span></span>

<span data-ttu-id="169e5-213">Sol sütunda bulunan kullanıcı hesapları oluşturma bağlantıyı tıklatın.</span><span class="sxs-lookup"><span data-stu-id="169e5-213">Click on the Creating User Accounts link found in the left column.</span></span> <span data-ttu-id="169e5-214">Bu, olanak sürecek `~/Membership/CreatingUserAccounts.aspx`.</span><span class="sxs-lookup"><span data-stu-id="169e5-214">This will take you to the `~/Membership/CreatingUserAccounts.aspx`.</span></span> <span data-ttu-id="169e5-215">Bu yana `Web.config` dosyasını `Membership` klasörü tanımlayan anonim erişimi engellemek için yetkilendirme kuralları `UrlAuthorizationModule` isteğini durdurur ve bir HTTP 401 yetkilendirilmedi durum döndürür.</span><span class="sxs-lookup"><span data-stu-id="169e5-215">Since the `Web.config` file in the `Membership` folder defines authorization rules to prohibit anonymous access, the `UrlAuthorizationModule` aborts the request and returns an HTTP 401 Unauthorized status.</span></span> <span data-ttu-id="169e5-216">`FormsAuthenticationModule` Bu oturum açma sayfasına gönderdiğiniz bir 302 yeniden yönlendirme durum değiştirir.</span><span class="sxs-lookup"><span data-stu-id="169e5-216">The `FormsAuthenticationModule` modifies this to a 302 Redirect status, sending us to the login page.</span></span> <span data-ttu-id="169e5-217">Sayfa biz erişmeye çalıştığınız olduğunu unutmayın (`CreatingUserAccounts.aspx`) oturum açma sayfasına geçirilen `ReturnUrl` sorgu dizesi parametresi.</span><span class="sxs-lookup"><span data-stu-id="169e5-217">Note that the page we were attempting to access (`CreatingUserAccounts.aspx`) is passed to the login page via the `ReturnUrl` querystring parameter.</span></span>


<span data-ttu-id="169e5-218">[![URL yetkilendirme kuralları engelle anonim erişim itibaren biz oturum açma sayfasına yeniden yönlendirilir](user-based-authorization-cs/_static/image14.png)](user-based-authorization-cs/_static/image13.png)</span><span class="sxs-lookup"><span data-stu-id="169e5-218">[![Since the URL Authorization Rules Prohibit Anonymous Access, We are Redirected to the Login Page](user-based-authorization-cs/_static/image14.png)](user-based-authorization-cs/_static/image13.png)</span></span>

<span data-ttu-id="169e5-219">**Şekil 5**: URL yetkilendirme kuralları için anonim erişimi engelle olduğundan, biz oturum açma sayfasına yönlendirilirsiniz ([tam boyutlu görüntüyü görüntülemek için tıklatın](user-based-authorization-cs/_static/image15.png))</span><span class="sxs-lookup"><span data-stu-id="169e5-219">**Figure 5**: Since the URL Authorization Rules Prohibit Anonymous Access, We are Redirected to the Login Page  ([Click to view full-size image](user-based-authorization-cs/_static/image15.png))</span></span>


<span data-ttu-id="169e5-220">Başarıyla oturum açtıktan sonra biz yönlendirilirsiniz `CreatingUserAccounts.aspx` sayfası.</span><span class="sxs-lookup"><span data-stu-id="169e5-220">Upon successfully logging in, we are redirected to the `CreatingUserAccounts.aspx` page.</span></span> <span data-ttu-id="169e5-221">Bu süre `UrlAuthorizationModule` biz artık anonim olmadığı için sayfa erişimi verir.</span><span class="sxs-lookup"><span data-stu-id="169e5-221">This time the `UrlAuthorizationModule` permits access to the page because we are no longer anonymous.</span></span>

### <a name="applying-url-authorization-rules-to-a-specific-location"></a><span data-ttu-id="169e5-222">URL yetkilendirme kuralları belirli bir konuma yeniden uygulama</span><span class="sxs-lookup"><span data-stu-id="169e5-222">Applying URL Authorization Rules to a Specific Location</span></span>

<span data-ttu-id="169e5-223">Tanımlanan yetkilendirme ayarları `<system.web>` bölümünü `Web.config` bu dizinde ve alt dizinlerinde ASP.NET kaynakların tümünü uygulamak (Aksi halde bir başkası tarafından geçersiz kılınmış kadar `Web.config` dosyası).</span><span class="sxs-lookup"><span data-stu-id="169e5-223">The authorization settings defined in the `<system.web>` section of `Web.config` apply to all of the ASP.NET resources in that directory and its subdirectories (until otherwise overridden by another `Web.config` file).</span></span> <span data-ttu-id="169e5-224">Bazı durumlarda, ancak biz tüm ASP.NET kaynakları belirli bir dizinde bir veya iki belirli sayfalara dışında belirli yetkilendirme yapılandırmasına sahip olmak isteyebilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="169e5-224">In some cases, though, we may want all ASP.NET resources in a given directory to have a particular authorization configuration except for one or two specific pages.</span></span> <span data-ttu-id="169e5-225">Bu ekleyerek sağlanabilir bir `<location>` öğesinde `Web.config`, yetkilendirme kuralları farklı dosyasına işaret eden ve benzersiz yetkilendirme kurallarını okuduğunuzu tanımlama.</span><span class="sxs-lookup"><span data-stu-id="169e5-225">This can be achieved by adding a `<location>` element in `Web.config`, pointing it to the file whose authorization rules differ, and defining its unique authorization rules therein.</span></span>

<span data-ttu-id="169e5-226">Kullanarak göstermeye `<location>` öğesinin belirli bir kaynak için yapılandırma ayarları geçersiz kılar, şimdi yalnızca Tito ziyaret edebilirsiniz yetkilendirme ayarlarını özelleştirmek için `CreatingUserAccounts.aspx`.</span><span class="sxs-lookup"><span data-stu-id="169e5-226">To illustrate using the `<location>` element to override the configuration settings for a specific resource, let's customize the authorization settings so that only Tito can visit `CreatingUserAccounts.aspx`.</span></span> <span data-ttu-id="169e5-227">Bunu başarmak için add bir `<location>` öğesine `Membership` klasörün `Web.config` dosya ve onun biçimlendirmesini şuna benzeyen şekilde güncelleştirin:</span><span class="sxs-lookup"><span data-stu-id="169e5-227">To accomplish this, add a `<location>` element to the `Membership` folder's `Web.config` file and update its markup so that it looks like the following:</span></span>

[!code-xml[Main](user-based-authorization-cs/samples/sample5.xml)]

<span data-ttu-id="169e5-228">`<authorization>` Öğesinde `<system.web>` varsayılan URL yetkilendirme kuralları için ASP.NET kaynaklarında tanımlar `Membership` klasörde ve alt klasörlerinde.</span><span class="sxs-lookup"><span data-stu-id="169e5-228">The `<authorization>` element in `<system.web>` defines the default URL authorization rules for ASP.NET resources in the `Membership` folder and its subfolders.</span></span> <span data-ttu-id="169e5-229">`<location>` Öğesi belirli bir kaynak için bu kurallarını geçersiz kılmasına izin verir.</span><span class="sxs-lookup"><span data-stu-id="169e5-229">The `<location>` element allows us to override these rules for a particular resource.</span></span> <span data-ttu-id="169e5-230">Yukarıdaki biçimlendirmede `<location>` öğesi başvuruları `CreatingUserAccounts.aspx` sayfasında ve kendi yetkilendirme kuralları Tito, izin gibi belirtir ancak Reddet diğerlerinin.</span><span class="sxs-lookup"><span data-stu-id="169e5-230">In the above markup the `<location>` element references the `CreatingUserAccounts.aspx` page and specifies its authorization rules such as to allow Tito, but deny everyone else.</span></span>

<span data-ttu-id="169e5-231">Bu yetkilendirme değişiklik sınamak için anonim kullanıcı olarak Web sitesini ziyaret ederek'ı başlatın.</span><span class="sxs-lookup"><span data-stu-id="169e5-231">To test out this authorization change, start by visiting the website as an anonymous user.</span></span> <span data-ttu-id="169e5-232">Herhangi bir sayfayı ziyaret edin çalışırsanız `Membership` klasörü gibi `UserBasedAuthorization.aspx`, `UrlAuthorizationModule` isteği reddeder ve oturum açma sayfasına yeniden yönlendirilir.</span><span class="sxs-lookup"><span data-stu-id="169e5-232">If you attempt to visit any page in the `Membership` folder, such as `UserBasedAuthorization.aspx`, the `UrlAuthorizationModule` will deny the request and you will be redirected to the login page.</span></span> <span data-ttu-id="169e5-233">Söyleyin, Scott olarak oturum açtıktan sonra herhangi bir sayfayı ziyaret edebilirsiniz `Membership` klasörü *dışında* için `CreatingUserAccounts.aspx`.</span><span class="sxs-lookup"><span data-stu-id="169e5-233">After logging in as, say, Scott, you can visit any page in the `Membership` folder *except* for `CreatingUserAccounts.aspx`.</span></span> <span data-ttu-id="169e5-234">Ziyaret çalışılıyor `CreatingUserAccounts.aspx` herkes oturum açmış ancak oturum açma sayfasına yönlendirerek Tito yetkisiz erişim girişimini sonuçlanır.</span><span class="sxs-lookup"><span data-stu-id="169e5-234">Attempting to visit `CreatingUserAccounts.aspx` logged on as anyone but Tito will result in an unauthorized access attempt, redirecting you back to the login page.</span></span>

> [!NOTE]
> <span data-ttu-id="169e5-235">`<location>` Öğesi yapılandırma dışında görünmelidir `<system.web>` öğesi.</span><span class="sxs-lookup"><span data-stu-id="169e5-235">The `<location>` element must appear outside of the configuration's `<system.web>` element.</span></span> <span data-ttu-id="169e5-236">Ayrı bir kullanmanıza gerek `<location>` yetkilendirme ayarlarını geçersiz kılmak istediğiniz her kaynak için öğesi.</span><span class="sxs-lookup"><span data-stu-id="169e5-236">You need to use a separate `<location>` element for each resource whose authorization settings you want to override.</span></span>


### <a name="a-look-at-how-theurlauthorizationmoduleuses-the-authorization-rules-to-grant-or-deny-access"></a><span data-ttu-id="169e5-237">Göz nasıl`UrlAuthorizationModule`erişim vermek veya reddetmek için yetkilendirme kuralları kullanır</span><span class="sxs-lookup"><span data-stu-id="169e5-237">A Look at How the`UrlAuthorizationModule`Uses the Authorization Rules to Grant or Deny Access</span></span>

<span data-ttu-id="169e5-238">`UrlAuthorizationModule` URL yetkilendirmesi çözümleyerek belirli bir URL için belirli bir kimliğe yetkilendirmek için birer birer ilk makineden başlatma ve aşağı kendi şekilde çalışan, kuralları olup olmadığını belirler.</span><span class="sxs-lookup"><span data-stu-id="169e5-238">The `UrlAuthorizationModule` determines whether to authorize a particular identity for a particular URL by analyzing the URL authorization rules one at a time, starting from the first one and working its way down.</span></span> <span data-ttu-id="169e5-239">Bir eşleşme olarak kullanıcı verilen veya erişimi reddedilen, açıksa bağlı olarak eşleşmenin bir `<allow>` veya `<deny>` öğesi.</span><span class="sxs-lookup"><span data-stu-id="169e5-239">As soon as a match is found, the user is granted or denied access, depending on if the match was found in an `<allow>` or `<deny>` element.</span></span> <span data-ttu-id="169e5-240"><strong>Eşleşme bulunamazsa, kullanıcıya erişim verilir.</strong></span><span class="sxs-lookup"><span data-stu-id="169e5-240"><strong>If no match is found, the user is granted access.</strong></span></span> <span data-ttu-id="169e5-241">Erişimi kısıtlamak istiyorsanız, bu nedenle, onu kullanmanız zorunludur bir `<deny>` öğesi URL yetkilendirme yapılandırma son öğesi olarak.</span><span class="sxs-lookup"><span data-stu-id="169e5-241">Consequently, if you want to restrict access, it is imperative that you use a `<deny>` element as the last element in the URL authorization configuration.</span></span> <span data-ttu-id="169e5-242"><strong>Atlarsanız bir</strong><strong>`<deny>`</strong><strong>öğesi, tüm kullanıcılara erişim verilecektir.</strong></span><span class="sxs-lookup"><span data-stu-id="169e5-242"><strong>If you omit a</strong><strong>`<deny>`</strong><strong>element, all users will be granted access.</strong></span></span>

<span data-ttu-id="169e5-243">Tarafından kullanılan işlem daha iyi anlamak için `UrlAuthorizationModule` yetkilisi belirlemek için şu arama sırasında bu adımda URL yetkilendirme kuralları örneği göz önünde bulundurun.</span><span class="sxs-lookup"><span data-stu-id="169e5-243">To better understand the process used by the `UrlAuthorizationModule` to determine authority, consider the example URL authorization rules we looked at earlier in this step.</span></span> <span data-ttu-id="169e5-244">İlk kural bir `<allow>` öğesi Tito ve Scott erişim sağlar.</span><span class="sxs-lookup"><span data-stu-id="169e5-244">The first rule is an `<allow>` element that allows access to Tito and Scott.</span></span> <span data-ttu-id="169e5-245">İkinci kuralları bir `<deny>` herkese erişimini engellediği öğesi.</span><span class="sxs-lookup"><span data-stu-id="169e5-245">The second rules is a `<deny>` element that denies access to everyone.</span></span> <span data-ttu-id="169e5-246">Anonim kullanıcı ziyaret, `UrlAuthorizationModule` isteyen tarafından başlatır anonim Scott veya Tito?</span><span class="sxs-lookup"><span data-stu-id="169e5-246">If an anonymous user visits, the `UrlAuthorizationModule` starts by asking, Is anonymous either Scott or Tito?</span></span> <span data-ttu-id="169e5-247">Belli ki, yanıt yok, olduğundan, ikinci kural devam eder.</span><span class="sxs-lookup"><span data-stu-id="169e5-247">The answer, obviously, is No, so it proceeds to the second rule.</span></span> <span data-ttu-id="169e5-248">Herkes kümesinde anonim mi?</span><span class="sxs-lookup"><span data-stu-id="169e5-248">Is anonymous in the set of everybody?</span></span> <span data-ttu-id="169e5-249">Bu yana yanıt Evet, işte `<deny>` kural yürürlükte koyun ve ziyaretçi oturum açma sayfasına yeniden yönlendirilir.</span><span class="sxs-lookup"><span data-stu-id="169e5-249">Since the answer here is Yes, the `<deny>` rule is put in effect and the visitor is redirected to the login page.</span></span> <span data-ttu-id="169e5-250">Benzer şekilde, Jisun ziyaret, `UrlAuthorizationModule` istemekle olan Jisun başlatır Scott veya Tito?</span><span class="sxs-lookup"><span data-stu-id="169e5-250">Similarly, if Jisun is visiting, the `UrlAuthorizationModule` starts by asking, Is Jisun either Scott or Tito?</span></span> <span data-ttu-id="169e5-251">Aynen, olmadığından `UrlAuthorizationModule` olan Jisun kümesi herkes, ikinci soruyu devam eder?</span><span class="sxs-lookup"><span data-stu-id="169e5-251">Since she is not, the `UrlAuthorizationModule` proceeds to the second question, Is Jisun in the set of everybody?</span></span> <span data-ttu-id="169e5-252">Aynen, çok, erişim reddedildi depoladığından, olduğundan.</span><span class="sxs-lookup"><span data-stu-id="169e5-252">She is, so she, too, is denied access.</span></span> <span data-ttu-id="169e5-253">Son olarak, Tito ziyaret eder, ilk sorusu sorulmuş `UrlAuthorizationModule` İleticiden olumlu bir yanıt olduğundan, Tito erişimi verilir.</span><span class="sxs-lookup"><span data-stu-id="169e5-253">Finally, if Tito visits, the first question posed by the `UrlAuthorizationModule` is an affirmative answer, so Tito is granted access.</span></span>

<span data-ttu-id="169e5-254">Bu yana `UrlAuthorizationModule` işlemleri yetkilendirme kuralları yukarıdan aşağıya doğru durdurma hiçbir eşleşme en az yayına önce gelen daha belirli kurallar sağlamak önemlidir.</span><span class="sxs-lookup"><span data-stu-id="169e5-254">Since the `UrlAuthorizationModule` processes the authorization rules from the top down, stopping at any match, it is important to have the more specific rules come before the less specific ones.</span></span> <span data-ttu-id="169e5-255">Diğer bir deyişle, Jisun ve anonim kullanıcılar yasaklamaz, ancak diğer tüm kimliği doğrulanmış kullanıcıların yetkilendirme kurallarını tanımlamak için en belirgin kuralla - etkileyen bir Jisun - Başlat ve daha az belirli kuralları - olanlar diğer tüm izin vererek devam Kimliği doğrulanmış kullanıcılar, ancak tüm anonim kullanıcılar engelleme.</span><span class="sxs-lookup"><span data-stu-id="169e5-255">That is, to define authorization rules that forbid Jisun and anonymous users, but allow all other authenticated users, you would start with the most specific rule - the one impacting Jisun - and then proceed to the less specific rules - those allowing all other authenticated users, but denying all anonymous users.</span></span> <span data-ttu-id="169e5-256">Aşağıdaki URL yetkilendirme kuralları ilk Jisun engelleme ve herhangi bir anonim kullanıcı engelleme bu ilkeyi uygular.</span><span class="sxs-lookup"><span data-stu-id="169e5-256">The following URL authorization rules implements this policy by first denying Jisun, and then denying any anonymous user.</span></span> <span data-ttu-id="169e5-257">Jisun dışındaki herhangi bir kimliği doğrulanmış kullanıcı erişimi olduğundan sağlanacak hiçbirini `<deny>` deyimleri eşleşir.</span><span class="sxs-lookup"><span data-stu-id="169e5-257">Any authenticated user other than Jisun will be granted access because neither of these `<deny>` statements will match.</span></span>

[!code-xml[Main](user-based-authorization-cs/samples/sample6.xml)]

## <a name="step-2-fixing-the-workflow-for-unauthorized-authenticated-users"></a><span data-ttu-id="169e5-258">2. adım: iş akışı yetkisiz, kimliği doğrulanmış kullanıcılar için düzeltme</span><span class="sxs-lookup"><span data-stu-id="169e5-258">Step 2: Fixing the Workflow for Unauthorized, Authenticated Users</span></span>

<span data-ttu-id="169e5-259">Biz A bakabilir URL yetkilendirme iş akışı bölümü, bu öğreticide daha önce açıklandığı gibi dilediğiniz zaman bir yetkisiz isteği transpires, `UrlAuthorizationModule` isteğini durdurur ve bir HTTP 401 yetkilendirilmedi durum döndürür.</span><span class="sxs-lookup"><span data-stu-id="169e5-259">As we discussed earlier in this tutorial in the A Look at the URL Authorization Workflow section, anytime an unauthorized request transpires, the `UrlAuthorizationModule` aborts the request and returns an HTTP 401 Unauthorized status.</span></span> <span data-ttu-id="169e5-260">Bu 401 durum değiştiren `FormsAuthenticationModule` kullanıcı oturum açma sayfasına yeniden gönderir durum 302 yeniden yönlendirme.</span><span class="sxs-lookup"><span data-stu-id="169e5-260">This 401 status is modified by the `FormsAuthenticationModule` into a 302 Redirect status that sends the user to the login page.</span></span> <span data-ttu-id="169e5-261">Kullanıcının kimliği doğrulanır olsa bile bu iş akışı yetkisiz herhangi bir istek üzerinde oluşur.</span><span class="sxs-lookup"><span data-stu-id="169e5-261">This workflow occurs on any unauthorized request, even if the user is authenticated.</span></span>

<span data-ttu-id="169e5-262">Kimliği doğrulanmış bir kullanıcı oturum açma sayfasına döndürme sisteme zaten oturum olduğundan bunları işlemlerini birbirine karıştırmaktadır olasılığı yüksektir.</span><span class="sxs-lookup"><span data-stu-id="169e5-262">Returning an authenticated user to the login page is likely to confuse them since they have already logged into the system.</span></span> <span data-ttu-id="169e5-263">Biraz iş ile Biz bu iş akışı, bunların sınırlı bir sayfaya erişmeye çalıştınız açıklayan bir sayfaya yetkisiz isteklerde kimliği doğrulanmış kullanıcıları yönlendirerek artırabilir.</span><span class="sxs-lookup"><span data-stu-id="169e5-263">With a little bit of work we can improve this workflow by redirecting authenticated users who make unauthorized requests to a page that explains that they have attempted to access a restricted page.</span></span>

<span data-ttu-id="169e5-264">Başlangıç adlı web uygulamasının kök klasöründe yeni bir ASP.NET sayfası oluşturarak `UnauthorizedAccess.aspx`; bu sayfayla ilişkilendirilecek unutmayın `Site.master` ana sayfa.</span><span class="sxs-lookup"><span data-stu-id="169e5-264">Start by creating a new ASP.NET page in the web application's root folder named `UnauthorizedAccess.aspx`; don't forget to associate this page with the `Site.master` master page.</span></span> <span data-ttu-id="169e5-265">Bu sayfayı oluşturduktan sonra başvuran içerik denetimi kaldırılmaya `LoginContent` ContentPlaceHolder ana sayfa varsayılan böylece içerik görüntülenir.</span><span class="sxs-lookup"><span data-stu-id="169e5-265">After creating this page, remove the Content control that references the `LoginContent` ContentPlaceHolder so that the master page's default content will be displayed.</span></span> <span data-ttu-id="169e5-266">Sonra durumu, yani açıklayan bir ileti ekleyin kullanıcı korunan bir kaynağa erişme girişiminde bulunuldu.</span><span class="sxs-lookup"><span data-stu-id="169e5-266">Next, add a message that explains the situation, namely that the user attempted to access a protected resource.</span></span> <span data-ttu-id="169e5-267">Bu tür bir ileti ekledikten sonra `UnauthorizedAccess.aspx` sayfanın bildirim temelli biçimlendirme aşağıdakine benzer görünmelidir:</span><span class="sxs-lookup"><span data-stu-id="169e5-267">After adding such a message, the `UnauthorizedAccess.aspx` page's declarative markup should look similar to the following:</span></span>

[!code-aspx[Main](user-based-authorization-cs/samples/sample7.aspx)]

<span data-ttu-id="169e5-268">Şimdi bir yetkisiz isteği kimliği doğrulanmış bir kullanıcı tarafından gerçekleştirilirse gönderilirler böylece iş akışını değiştirmek ihtiyacımız `UnauthorizedAccess.aspx` sayfası yerine oturum açma sayfası.</span><span class="sxs-lookup"><span data-stu-id="169e5-268">We now need to alter the workflow so that if an unauthorized request is performed by an authenticated user they are sent to the `UnauthorizedAccess.aspx` page instead of the login page.</span></span> <span data-ttu-id="169e5-269">Yetkisiz istekler oturum açma sayfasına yönlendirir mantığı içinde özel bir yöntem kaçınma `FormsAuthenticationModule` Biz bu davranış özelleştiremezsiniz şekilde sınıfı.</span><span class="sxs-lookup"><span data-stu-id="169e5-269">The logic that redirects unauthorized requests to the login page is buried within a private method of the `FormsAuthenticationModule` class, so we cannot customize this behavior.</span></span> <span data-ttu-id="169e5-270">Biz, ancak ne kendi mantığımızı kullanıcıya yönlendiren oturum açma sayfasına eklemektir `UnauthorizedAccess.aspx`gerekirse.</span><span class="sxs-lookup"><span data-stu-id="169e5-270">What we can do, however, is add our own logic to the login page that redirects the user to `UnauthorizedAccess.aspx`, if needed.</span></span>

<span data-ttu-id="169e5-271">Zaman `FormsAuthenticationModule` yetkisiz bir ziyaretçi yönlendiren isteğe bağlı olarak oturum açma sayfasına adıyla querystring istenen, yetkisiz URL'sine ekler `ReturnUrl`.</span><span class="sxs-lookup"><span data-stu-id="169e5-271">When the `FormsAuthenticationModule` redirects an unauthorized visitor to the login page it appends the requested, unauthorized URL to the querystring with the name `ReturnUrl`.</span></span> <span data-ttu-id="169e5-272">Örneğin, yetkisiz bir kullanıcının ziyaret çalışıldı `OnlyTito.aspx`, `FormsAuthenticationModule` bunları yeniden yönlendirme `Login.aspx?ReturnUrl=OnlyTito.aspx`.</span><span class="sxs-lookup"><span data-stu-id="169e5-272">For example, if an unauthorized user attempted to visit `OnlyTito.aspx`, the `FormsAuthenticationModule` would redirect them to `Login.aspx?ReturnUrl=OnlyTito.aspx`.</span></span> <span data-ttu-id="169e5-273">Bu nedenle, oturum açma sayfasını içeren bir sorgu dizesi sahip kimliği doğrulanmış bir kullanıcı tarafından ulaşıldığında `ReturnUrl` parametresi sonra biz biliyorsanız bu kimliği doğrulanmamış bir kullanıcı yalnızca aynen yetkilendirilmemiş görüntülemek için bir sayfasını ziyaret denediğini.</span><span class="sxs-lookup"><span data-stu-id="169e5-273">Therefore, if the login page is reached by an authenticated user with a querystring that includes the `ReturnUrl` parameter, then we know that this unauthenticated user just attempted to visit a page she is not authorized to view.</span></span> <span data-ttu-id="169e5-274">Böyle bir durumda, kendisi için yeniden yönlendirme istiyoruz `UnauthorizedAccess.aspx`.</span><span class="sxs-lookup"><span data-stu-id="169e5-274">In such a case, we want to redirect her to `UnauthorizedAccess.aspx`.</span></span>

<span data-ttu-id="169e5-275">Bunu başarmak için oturum açma sayfasına ait aşağıdaki kodu ekleyin `Page_Load` olay işleyicisi:</span><span class="sxs-lookup"><span data-stu-id="169e5-275">To accomplish this, add the following code to the login page's `Page_Load` event handler:</span></span>

[!code-csharp[Main](user-based-authorization-cs/samples/sample8.cs)]

<span data-ttu-id="169e5-276">Yukarıdaki kod kimliği doğrulanmış, yetkisiz kullanıcılara yönlendiren `UnauthorizedAccess.aspx` sayfası.</span><span class="sxs-lookup"><span data-stu-id="169e5-276">The above code redirects authenticated, unauthorized users to the `UnauthorizedAccess.aspx` page.</span></span> <span data-ttu-id="169e5-277">Bu eylem mantığında görmek için anonim bir ziyaretçi olarak sitesini ziyaret edin ve sol sütunda kullanıcı hesapları oluşturma bağlantıyı tıklatın.</span><span class="sxs-lookup"><span data-stu-id="169e5-277">To see this logic in action, visit the site as an anonymous visitor and click on the Creating User Accounts link in the left column.</span></span> <span data-ttu-id="169e5-278">Bu, olanak sürecek `~/Membership/CreatingUserAccounts.aspx` biz yapılandırılmış yalnızca 1. adımda erişimine izin vermek için Tito sayfasını.</span><span class="sxs-lookup"><span data-stu-id="169e5-278">This will take you to the `~/Membership/CreatingUserAccounts.aspx` page, which in Step 1 we configured to only permit access to Tito.</span></span> <span data-ttu-id="169e5-279">Anonim kullanıcılar yasaklanmış olduğundan, `FormsAuthenticationModule` bize oturum açma sayfasına yönlendirir.</span><span class="sxs-lookup"><span data-stu-id="169e5-279">Since anonymous users are prohibited, the `FormsAuthenticationModule` redirects us back to the login page.</span></span>

<span data-ttu-id="169e5-280">Bu noktada anonim gerçekleştiriyoruz, bu nedenle `Request.IsAuthenticated` döndürür `false` ve biz yönlendirilir değil `UnauthorizedAccess.aspx`.</span><span class="sxs-lookup"><span data-stu-id="169e5-280">At this point we are anonymous, so `Request.IsAuthenticated` returns `false` and we are not redirected to `UnauthorizedAccess.aspx`.</span></span> <span data-ttu-id="169e5-281">Bunun yerine, oturum açma sayfası görüntülenir.</span><span class="sxs-lookup"><span data-stu-id="169e5-281">Instead, the login page is displayed.</span></span> <span data-ttu-id="169e5-282">Tito Bruce'a gibi başka bir kullanıcı olarak oturum açın.</span><span class="sxs-lookup"><span data-stu-id="169e5-282">Log in as a user other than Tito, such as Bruce.</span></span> <span data-ttu-id="169e5-283">Uygun kimlik bilgilerini girdikten sonra oturum açma sayfasında üzerine bize yeniden yönlendirir `~/Membership/CreatingUserAccounts.aspx`.</span><span class="sxs-lookup"><span data-stu-id="169e5-283">After entering the appropriate credentials, the login page redirects us back to `~/Membership/CreatingUserAccounts.aspx`.</span></span> <span data-ttu-id="169e5-284">Ancak, bu sayfayı yalnızca Tito için erişilebilir olduğundan, biz görüntülemek için yetkisiz ve derhal oturum açma sayfasına dönersiniz.</span><span class="sxs-lookup"><span data-stu-id="169e5-284">However, since this page is only accessible to Tito, we are unauthorized to view it and are promptly returned to the login page.</span></span> <span data-ttu-id="169e5-285">Bu süre, ancak `Request.IsAuthenticated` döndürür `true` (ve `ReturnUrl` sorgu dizesi parametresi var.), böylece biz yönlendirilirsiniz `UnauthorizedAccess.aspx` sayfası.</span><span class="sxs-lookup"><span data-stu-id="169e5-285">This time, however, `Request.IsAuthenticated` returns `true` (and the `ReturnUrl` querystring parameter exists), so we are redirected to the `UnauthorizedAccess.aspx` page.</span></span>


<span data-ttu-id="169e5-286">[![Kimlik doğrulaması, yetkisiz kullanıcılar için UnauthorizedAccess.aspx yönlendirilir](user-based-authorization-cs/_static/image17.png)](user-based-authorization-cs/_static/image16.png)</span><span class="sxs-lookup"><span data-stu-id="169e5-286">[![Authenticated, Unauthorized Users are Redirected to UnauthorizedAccess.aspx](user-based-authorization-cs/_static/image17.png)](user-based-authorization-cs/_static/image16.png)</span></span>

<span data-ttu-id="169e5-287">**Şekil 6**: kimlik doğrulaması, yetkisiz kullanıcıların yönlendirilirsiniz `UnauthorizedAccess.aspx` ([tam boyutlu görüntüyü görüntülemek için tıklatın](user-based-authorization-cs/_static/image18.png))</span><span class="sxs-lookup"><span data-stu-id="169e5-287">**Figure 6**: Authenticated, Unauthorized Users are Redirected to `UnauthorizedAccess.aspx` ([Click to view full-size image](user-based-authorization-cs/_static/image18.png))</span></span>


<span data-ttu-id="169e5-288">Özelleştirilmiş bu iş akışı, Şekil 2'de gösterilen döngüsü kestirmeler tarafından daha duyarlı ve basit bir kullanıcı deneyimi sunar.</span><span class="sxs-lookup"><span data-stu-id="169e5-288">This customized workflow presents a more sensible and straightforward user experience by short circuiting the cycle depicted in Figure 2.</span></span>

## <a name="step-3-limiting-functionality-based-on-the-currently-logged-in-user"></a><span data-ttu-id="169e5-289">3. adım: üzerinde şu anda oturum açmış olan kullanıcının tabanlı işlevsellik sınırlama</span><span class="sxs-lookup"><span data-stu-id="169e5-289">Step 3: Limiting Functionality Based on the Currently Logged In User</span></span>

<span data-ttu-id="169e5-290">URL yetkilendirmesi, kaba yetkilendirme kurallarını belirtmek kolaylaştırır.</span><span class="sxs-lookup"><span data-stu-id="169e5-290">URL authorization makes it easy to specify coarse authorization rules.</span></span> <span data-ttu-id="169e5-291">Adım 1'de gördüğümüz gibi URL yetkilendirmesi ile biz temellerini hangi kimlikleri izin verilen ve hangilerinin belirli bir sayfa veya tüm sayfaların bir klasörde görüntüleme reddedilir durumu.</span><span class="sxs-lookup"><span data-stu-id="169e5-291">As we saw in Step 1, with URL authorization we can succinctly state what identities are permitted and which ones are denied from viewing a particular page or all pages in a folder.</span></span> <span data-ttu-id="169e5-292">Bazı senaryolarda, ancak biz tüm kullanıcıların bir sayfasını ziyaret edin, ancak bunu ziyaret kullanıcıyı temel alarak sayfanın işlevselliği sınırlamak için izin vermek isteyebilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="169e5-292">In certain scenarios, however, we may want to allow all users to visit a page, but limit the page's functionality based on the user visiting it.</span></span>

<span data-ttu-id="169e5-293">Ürünlerini gözden geçirmek kimliği doğrulanmış ziyaretçileri izin veren bir e-ticaret Web sitesi durumunu göz önünde bulundurun.</span><span class="sxs-lookup"><span data-stu-id="169e5-293">Consider the case of an eCommerce website that allows authenticated visitors to review their products.</span></span> <span data-ttu-id="169e5-294">Adsız bir kullanıcı bir ürün sayfasını ziyaret ettiğinde, yalnızca ürün bilgileri görür ve bir gözden geçirme bırakın fırsatı verilmedi.</span><span class="sxs-lookup"><span data-stu-id="169e5-294">When an anonymous user visits a product's page, they would see just the product information and would not be given the opportunity to leave a review.</span></span> <span data-ttu-id="169e5-295">Ancak, aynı sayfasını ziyaret kimliği doğrulanmış bir kullanıcı gözden geçirme arabirimi görür.</span><span class="sxs-lookup"><span data-stu-id="169e5-295">However, an authenticated user visiting the same page would see the reviewing interface.</span></span> <span data-ttu-id="169e5-296">Kimliği doğrulanmış kullanıcının henüz bu ürünün gözden değil, bunları bir gözden geçirme göndermek arabirimi sağlayacağı; Aksi takdirde, bunları önceden gönderilmiş gözden gösterir.</span><span class="sxs-lookup"><span data-stu-id="169e5-296">If the authenticated user had not yet reviewed this product, the interface would enable them to submit a review; otherwise it would show them their previously-submitted review.</span></span> <span data-ttu-id="169e5-297">Bu senaryo bir adım almak için daha fazla ürün sayfasını ek bilgileri göster ve e-ticaret şirket için çalışan kullanıcılar için genişletilmiş özellikler sunar.</span><span class="sxs-lookup"><span data-stu-id="169e5-297">To take this scenario a step further, the product page might show additional information and offer extended features for those users that work for the eCommerce company.</span></span> <span data-ttu-id="169e5-298">Örneğin, ürün sayfasını bir stok stoktaki listelemek ve ürünün fiyat ve bir çalışan tarafından ziyaret edildiğinde açıklama düzenlemek için seçenekleri içerir.</span><span class="sxs-lookup"><span data-stu-id="169e5-298">For example, the product page might list the inventory in stock and include options to edit the product's price and description when visited by an employee.</span></span>

<span data-ttu-id="169e5-299">Bu tür ince çizgisi yetkilendirme kuralları, bildirimli olarak veya program aracılığıyla (ya da iki şunların bir birleşimi yoluyla) uygulanabilir.</span><span class="sxs-lookup"><span data-stu-id="169e5-299">Such fine grain authorization rules can be implemented either declaratively or programmatically (or through some combination of the two).</span></span> <span data-ttu-id="169e5-300">Sonraki bölümde ince çizgisi yetkilendirme LoginView denetimi aracılığıyla uygulama göreceğiz.</span><span class="sxs-lookup"><span data-stu-id="169e5-300">In the next section we will see how to implement fine grain authorization via the LoginView control.</span></span> <span data-ttu-id="169e5-301">Programlı teknikleri inceleyeceksiniz.</span><span class="sxs-lookup"><span data-stu-id="169e5-301">Following that, we will explore programmatic techniques.</span></span> <span data-ttu-id="169e5-302">Biz ince çizgisi yetkilendirme kurallarını uygulayarak en bakabilirsiniz önce ancak biz öncelikle bir sayfa, ziyaret eden kullanıcının olan işlevsellik bağlıdır oluşturmanız gerekir.</span><span class="sxs-lookup"><span data-stu-id="169e5-302">Before we can look at applying fine grain authorization rules, however, we first need to create a page whose functionality depends on the user visiting it.</span></span>

<span data-ttu-id="169e5-303">GridView içinde belirli bir dizindeki dosyaları listeleyen bir sayfa oluşturalım.</span><span class="sxs-lookup"><span data-stu-id="169e5-303">Let's create a page that lists the files in a particular directory within a GridView.</span></span> <span data-ttu-id="169e5-304">Her dosyanın adı, boyutu ve diğer bilgileri listeleyen yanı sıra, GridView LinkButtons iki sütunları içerir: biri başlıklı görünümü ve bir başlıklı silme.</span><span class="sxs-lookup"><span data-stu-id="169e5-304">Along with listing each file's name, size, and other information, the GridView will include two columns of LinkButtons: one titled View and one titled Delete.</span></span> <span data-ttu-id="169e5-305">Görünüm LinkButton tıkladıysanız, seçilen dosya içeriğini görüntülenir; Dosya Sil LinkButton tıkladıysanız silinir.</span><span class="sxs-lookup"><span data-stu-id="169e5-305">If the View LinkButton is clicked, the contents of the selected file will be displayed; if the Delete LinkButton is clicked, the file will be deleted.</span></span> <span data-ttu-id="169e5-306">Görünüm ve delete işlevselliğini tüm kullanıcılar için kullanılabilir olacak şekilde, başlangıçta bu sayfayı oluşturalım.</span><span class="sxs-lookup"><span data-stu-id="169e5-306">Let's initially create this page such that its view and delete functionality is available to all users.</span></span> <span data-ttu-id="169e5-307">Kullanarak, biz nasıl etkinleştirileceği veya sayfasını ziyaret kullanıcıyı temel alarak bu özellikleri devre dışı bırakılacağı görürsünüz LoginView denetimi ve program aracılığıyla sınırlama işlevselliği bölümler.</span><span class="sxs-lookup"><span data-stu-id="169e5-307">In the Using the LoginView Control and Programmatically Limiting Functionality sections we will see how to enable or disable these features based on the user visiting the page.</span></span>

> [!NOTE]
> <span data-ttu-id="169e5-308">Yaklaşık yapı duyuyoruz ASP.NET sayfası GridView denetimi dosyaların bir listesini görüntülemek için kullanır.</span><span class="sxs-lookup"><span data-stu-id="169e5-308">The ASP.NET page we are about to build uses a GridView control to display a list of files.</span></span> <span data-ttu-id="169e5-309">Form kimlik doğrulaması, yetkilendirme, kullanıcı hesapları ve rolleri serisi odaklanan Bu öğretici itibaren çalışmalar GridView denetimini ele çok fazla süre beklemesini istemiyorum.</span><span class="sxs-lookup"><span data-stu-id="169e5-309">Since this tutorial series focuses on forms authentication, authorization, user accounts, and roles, I do not want to spend too much time discussing the inner workings of the GridView control.</span></span> <span data-ttu-id="169e5-310">Bu öğretici bu sayfası ayarlama belirli adım adım yönergeler sağlar, ancak bunu neden belirli seçimler yapılan veya ne işlenmiş çıktı etkisi belirli özelliklere sahip ayrıntılarını içine inceleyin değil.</span><span class="sxs-lookup"><span data-stu-id="169e5-310">While this tutorial provides specific step-by-step instructions for setting up this page, it does not delve into the details of why certain choices were made, or what effect particular properties have on the rendered output.</span></span> <span data-ttu-id="169e5-311">GridView denetiminin kapsamlı incelenmesi için başvurun my *[, ASP.NET 2.0 verilerle çalışma](../../data-access/index.md)* öğretici serisi.</span><span class="sxs-lookup"><span data-stu-id="169e5-311">For a thorough examination of the GridView control, consult my *[Working with Data in ASP.NET 2.0](../../data-access/index.md)* tutorial series.</span></span>


<span data-ttu-id="169e5-312">Başlangıç açarak `UserBasedAuthorization.aspx` dosyasını `Membership` klasörü ve GridView denetim adlı sayfası ekleme `FilesGrid`.</span><span class="sxs-lookup"><span data-stu-id="169e5-312">Start by opening the `UserBasedAuthorization.aspx` file in the `Membership` folder and adding a GridView control to the page named `FilesGrid`.</span></span> <span data-ttu-id="169e5-313">GridView kullanıcının akıllı etiketten alanları iletişim kutusunu başlatmak için sütunları Düzenle bağlantısına tıklayın.</span><span class="sxs-lookup"><span data-stu-id="169e5-313">From the GridView's Smart Tag, click the Edit Columns link to launch the Fields dialog box.</span></span> <span data-ttu-id="169e5-314">Buradan, sol alt köşedeki otomatik oluşturma alanları onay kutusunun işaretini kaldırın.</span><span class="sxs-lookup"><span data-stu-id="169e5-314">From here, uncheck the Auto-generate fields checkbox in the lower left corner.</span></span> <span data-ttu-id="169e5-315">Ardından, üst sol Köşeden (seçin ve Sil düğmeleri CommandField türü'nün altında bulunabilir) seçme düğmesi, bir Delete düğmesi ve iki BoundFields ekleyin.</span><span class="sxs-lookup"><span data-stu-id="169e5-315">Next, add a Select button, a Delete button, and two BoundFields from the upper left corner (the Select and Delete buttons can be found under the CommandField type).</span></span> <span data-ttu-id="169e5-316">Select düğmenin ayarlamak `SelectText` özelliğini görünümü ve ilk BoundField'ın `HeaderText` ve `DataField` özellikleri adı.</span><span class="sxs-lookup"><span data-stu-id="169e5-316">Set the Select button's `SelectText` property to View and the first BoundField's `HeaderText` and `DataField` properties to Name.</span></span> <span data-ttu-id="169e5-317">İkinci BoundField's ayarlamak `HeaderText` bayt cinsinden boyutu özelliğine kendi `DataField` uzunluğu özelliğine kendi `DataFormatString` {0: N0} özelliğine ve onun `HtmlEncode` özelliğini false olarak ayarlayın.</span><span class="sxs-lookup"><span data-stu-id="169e5-317">Set the second BoundField's `HeaderText` property to Size in Bytes, its `DataField` property to Length, its `DataFormatString` property to {0:N0} and its `HtmlEncode` property to False.</span></span>

<span data-ttu-id="169e5-318">GridView'ın sütunları yapılandırdıktan sonra alanları iletişim kutusunu kapatmak için Tamam'ı tıklatın.</span><span class="sxs-lookup"><span data-stu-id="169e5-318">After configuring the GridView's columns, click OK to close the Fields dialog box.</span></span> <span data-ttu-id="169e5-319">GridView ait Özellikler penceresinden ayarlamak `DataKeyNames` özelliğine `FullName`.</span><span class="sxs-lookup"><span data-stu-id="169e5-319">From the Properties window, set the GridView's `DataKeyNames` property to `FullName`.</span></span> <span data-ttu-id="169e5-320">Bu noktada GridView'ın bildirim temelli biçimlendirme, aşağıdaki gibi görünmelidir:</span><span class="sxs-lookup"><span data-stu-id="169e5-320">At this point the GridView's declarative markup should look like the following:</span></span>

[!code-aspx[Main](user-based-authorization-cs/samples/sample9.aspx)]

<span data-ttu-id="169e5-321">Oluşturulan GridView'ın biçimlendirme ile biz belirli bir dizindeki dosyaları almak ve bunları bağlamak için GridView kod yazmaya hazırsınız.</span><span class="sxs-lookup"><span data-stu-id="169e5-321">With the GridView's markup created, we're ready to write the code that will retrieve the files in a particular directory and bind them to the GridView.</span></span> <span data-ttu-id="169e5-322">Sayfanın aşağıdaki kodu ekleyin `Page_Load` olay işleyicisi:</span><span class="sxs-lookup"><span data-stu-id="169e5-322">Add the following code to the page's `Page_Load` event handler:</span></span>

[!code-csharp[Main](user-based-authorization-cs/samples/sample10.cs)]

<span data-ttu-id="169e5-323">Yukarıdaki kod kullanan [ `DirectoryInfo` sınıfı](https://msdn.microsoft.com/library/system.io.directoryinfo.aspx) uygulamanın kök klasördeki dosyaların listesini elde edilir.</span><span class="sxs-lookup"><span data-stu-id="169e5-323">The above code uses the [`DirectoryInfo` class](https://msdn.microsoft.com/library/system.io.directoryinfo.aspx) to obtain a list of the files in the application's root folder.</span></span> <span data-ttu-id="169e5-324">[ `GetFiles()` Yöntemi](https://msdn.microsoft.com/library/system.io.directoryinfo.getfiles.aspx) tüm dosyaları dizinde bir dizi döndürür [ `FileInfo` nesneleri](https://msdn.microsoft.com/library/system.io.fileinfo.aspx), ardından GridView bağlı.</span><span class="sxs-lookup"><span data-stu-id="169e5-324">The [`GetFiles()` method](https://msdn.microsoft.com/library/system.io.directoryinfo.getfiles.aspx) returns all of the files in the directory as an array of [`FileInfo` objects](https://msdn.microsoft.com/library/system.io.fileinfo.aspx), which is then bound to the GridView.</span></span> <span data-ttu-id="169e5-325">`FileInfo` Nesneye sahip bir sınıflama özelliklerinin gibi `Name`, `Length`, ve `IsReadOnly`, diğerlerinin yanı sıra.</span><span class="sxs-lookup"><span data-stu-id="169e5-325">The `FileInfo` object has an assortment of properties, such as `Name`, `Length`, and `IsReadOnly`, among others.</span></span> <span data-ttu-id="169e5-326">Bildirim temelli biçimlendirmeden gördüğünüz GridView yalnızca görüntüler `Name` ve `Length` özellikleri.</span><span class="sxs-lookup"><span data-stu-id="169e5-326">As you can see from its declarative markup, the GridView displays just the `Name` and `Length` properties.</span></span>

> [!NOTE]
> <span data-ttu-id="169e5-327">`DirectoryInfo` Ve `FileInfo` içinde bulunan sınıflar [ `System.IO` ad alanı](https://msdn.microsoft.com/library/system.io.aspx).</span><span class="sxs-lookup"><span data-stu-id="169e5-327">The `DirectoryInfo` and `FileInfo` classes are found in the [`System.IO` namespace](https://msdn.microsoft.com/library/system.io.aspx).</span></span> <span data-ttu-id="169e5-328">Bu nedenle, bu sınıf adları ad alanı adları ile yazdığınızdan veya sınıf dosyasına içeri aktarılan ad alanınız için her iki gereksinim olur (aracılığıyla `using System.IO`).</span><span class="sxs-lookup"><span data-stu-id="169e5-328">Therefore, you will either need to preface these class names with their namespace names or have the namespace imported into the class file (via `using System.IO`).</span></span>


<span data-ttu-id="169e5-329">Bu sayfa bir tarayıcı aracılığıyla ziyaret etmek için bir dakikanızı ayırın.</span><span class="sxs-lookup"><span data-stu-id="169e5-329">Take a moment to visit this page through a browser.</span></span> <span data-ttu-id="169e5-330">Bu uygulamanın kök dizininde bulunan dosyaların listesini görüntüler.</span><span class="sxs-lookup"><span data-stu-id="169e5-330">It will display the list of files residing in the application's root directory.</span></span> <span data-ttu-id="169e5-331">Herhangi bir görünüm veya silme LinkButtons tıklatarak geri gönderimin neden olur, ancak biz için henüz olduğunuz için hiçbir eylem meydana gelir gerekli olay işleyicileri oluşturma.</span><span class="sxs-lookup"><span data-stu-id="169e5-331">Clicking any of the View or Delete LinkButtons will cause a postback, but no action will occur because we've yet to create the necessary event handlers.</span></span>


<span data-ttu-id="169e5-332">[![GridView Web uygulamasının kök dizindeki dosyaların listeler](user-based-authorization-cs/_static/image20.png)](user-based-authorization-cs/_static/image19.png)</span><span class="sxs-lookup"><span data-stu-id="169e5-332">[![The GridView Lists the Files in the Web Application's Root Directory](user-based-authorization-cs/_static/image20.png)](user-based-authorization-cs/_static/image19.png)</span></span>

<span data-ttu-id="169e5-333">**Şekil 7**: GridView Web uygulamasının kök dizindeki dosyaların listeler ([tam boyutlu görüntüyü görüntülemek için tıklatın](user-based-authorization-cs/_static/image21.png))</span><span class="sxs-lookup"><span data-stu-id="169e5-333">**Figure 7**: The GridView Lists the Files in the Web Application's Root Directory  ([Click to view full-size image](user-based-authorization-cs/_static/image21.png))</span></span>


<span data-ttu-id="169e5-334">Seçilen dosya içeriğini görüntülemek için bir yol ihtiyacımız var.</span><span class="sxs-lookup"><span data-stu-id="169e5-334">We need a means to display the contents of the selected file.</span></span> <span data-ttu-id="169e5-335">Visual Studio'ya dönmek ve adlı bir metin kutusu ekleyin `FileContents` GridView üstünde.</span><span class="sxs-lookup"><span data-stu-id="169e5-335">Return to Visual Studio and add a TextBox named `FileContents` above the GridView.</span></span> <span data-ttu-id="169e5-336">Ayarlama, `TextMode` özelliğine `MultiLine` ve kendi `Columns` ve `Rows` özellikleri % 95 ve 10, sırasıyla.</span><span class="sxs-lookup"><span data-stu-id="169e5-336">Set its `TextMode` property to `MultiLine` and its `Columns` and `Rows` properties to 95% and 10, respectively.</span></span>

[!code-aspx[Main](user-based-authorization-cs/samples/sample11.aspx)]

<span data-ttu-id="169e5-337">Ardından, olay işleyicisi GridView için 's oluşturmak [ `SelectedIndexChanged` olay](https://msdn.microsoft.com/library/system.web.ui.webcontrols.gridview.selectedindexchanged.aspx) ve aşağıdaki kodu ekleyin:</span><span class="sxs-lookup"><span data-stu-id="169e5-337">Next, create an event handler for the GridView's [`SelectedIndexChanged` event](https://msdn.microsoft.com/library/system.web.ui.webcontrols.gridview.selectedindexchanged.aspx) and add the following code:</span></span>

[!code-csharp[Main](user-based-authorization-cs/samples/sample12.cs)]

<span data-ttu-id="169e5-338">Bu kodu GridView's kullanır `SelectedValue` seçilen dosyanın tam dosya adını belirlemek için özellik.</span><span class="sxs-lookup"><span data-stu-id="169e5-338">This code uses the GridView's `SelectedValue` property to determine the full file name of the selected file.</span></span> <span data-ttu-id="169e5-339">Dahili olarak, `DataKeys` koleksiyonu almak için başvurulmaktadır `SelectedValue`, GridView's ayarladığınız zorunludur `DataKeyNames` özelliği daha önce bu adımda anlatıldığı gibi adı.</span><span class="sxs-lookup"><span data-stu-id="169e5-339">Internally, the `DataKeys` collection is referenced in order to obtain the `SelectedValue`, so it is imperative that you set the GridView's `DataKeyNames` property to Name, as described earlier in this step.</span></span> <span data-ttu-id="169e5-340">[ `File` Sınıfı](https://msdn.microsoft.com/library/system.io.file.aspx) bir dizeye sonra atanan seçilen dosyanın içeriğini okumak için kullanılan `FileContents` TextBox'ın `Text` özelliği, dolayısıyla sayfada seçilen dosyanın içeriğini görüntüleme.</span><span class="sxs-lookup"><span data-stu-id="169e5-340">The [`File` class](https://msdn.microsoft.com/library/system.io.file.aspx) is used to read the selected file's contents into a string, which is then assigned to the `FileContents` TextBox's `Text` property, thereby displaying the contents of the selected file on the page.</span></span>


<span data-ttu-id="169e5-341">[![Seçili dosyanın içeriğini metin kutusunda görüntülenir](user-based-authorization-cs/_static/image23.png)](user-based-authorization-cs/_static/image22.png)</span><span class="sxs-lookup"><span data-stu-id="169e5-341">[![The Selected File's Contents are Displayed in the TextBox](user-based-authorization-cs/_static/image23.png)](user-based-authorization-cs/_static/image22.png)</span></span>

<span data-ttu-id="169e5-342">**Şekil 8**: seçilen dosyanın içeriğini metin kutusunda görüntülenir ([tam boyutlu görüntüyü görüntülemek için tıklatın](user-based-authorization-cs/_static/image24.png))</span><span class="sxs-lookup"><span data-stu-id="169e5-342">**Figure 8**: The Selected File's Contents are Displayed in the TextBox  ([Click to view full-size image](user-based-authorization-cs/_static/image24.png))</span></span>


> [!NOTE]
> <span data-ttu-id="169e5-343">HTML biçimlendirmesini içeren bir dosyanın içeriğini görüntüleyin ve görüntülemek veya dosya silme denemesi, alacak bir `HttpRequestValidationException` hata.</span><span class="sxs-lookup"><span data-stu-id="169e5-343">If you view the contents of a file that contains HTML markup, and then attempt to view or delete a file, you will receive an `HttpRequestValidationException` error.</span></span> <span data-ttu-id="169e5-344">Bu durum, web sunucusuna gönderilen geri göndermede TextBox'ın içeriği kaynaklanır.</span><span class="sxs-lookup"><span data-stu-id="169e5-344">This occurs because on postback the TextBox's contents are sent back to the web server.</span></span> <span data-ttu-id="169e5-345">Varsayılan olarak, ASP.NET başlatır bir `HttpRequestValidationException` HTML biçimlendirmesi gibi potansiyel olarak tehlikeli olabilecek geri gönderme içerik algılandığında hata.</span><span class="sxs-lookup"><span data-stu-id="169e5-345">By default, ASP.NET raises an `HttpRequestValidationException` error whenever potentially dangerous postback content, such as HTML markup, is detected.</span></span> <span data-ttu-id="169e5-346">Bu hata oluşmasını devre dışı bırakmak için sayfa için istek doğrulamayı ekleyerek devre dışı `ValidateRequest="false"` için `@Page` yönergesi.</span><span class="sxs-lookup"><span data-stu-id="169e5-346">To disable this error from occurring, turn off request validation for the page by adding `ValidateRequest="false"` to the `@Page` directive.</span></span> <span data-ttu-id="169e5-347">Hangi önlemleri iyi ne zaman almanız gereken olarak istek doğrulama yararları hakkında daha fazla bilgi için devre dışı bırakma okuma [istek doğrulama - komut dosyası saldırılarını önleme](https://asp.net/learn/whitepapers/request-validation/).</span><span class="sxs-lookup"><span data-stu-id="169e5-347">For more information on the benefits of request validation as well as what precautions you should take when disabling it, read [Request Validation - Preventing Script Attacks](https://asp.net/learn/whitepapers/request-validation/).</span></span>


<span data-ttu-id="169e5-348">Son olarak, aşağıdaki kod ile olay işleyicisi GridView için 's eklemek [ `RowDeleting` olay](https://msdn.microsoft.com/library/system.web.ui.webcontrols.gridview.rowdeleting.aspx):</span><span class="sxs-lookup"><span data-stu-id="169e5-348">Finally, add an event handler with the following code for the GridView's [`RowDeleting` event](https://msdn.microsoft.com/library/system.web.ui.webcontrols.gridview.rowdeleting.aspx):</span></span>

[!code-csharp[Main](user-based-authorization-cs/samples/sample13.cs)]

<span data-ttu-id="169e5-349">Kod silmek için dosyanın tam adını görüntüler `FileContents` TextBox *olmadan* gerçekten dosyası siliniyor.</span><span class="sxs-lookup"><span data-stu-id="169e5-349">The code simply displays the full name of the file to delete in the `FileContents` TextBox *without* actually deleting the file.</span></span>


<span data-ttu-id="169e5-350">[![Sil düğmesini tıklatarak gerçekte dosyayı silmez](user-based-authorization-cs/_static/image26.png)](user-based-authorization-cs/_static/image25.png)</span><span class="sxs-lookup"><span data-stu-id="169e5-350">[![Clicking the Delete Button Does Not Actually Delete the File](user-based-authorization-cs/_static/image26.png)](user-based-authorization-cs/_static/image25.png)</span></span>

<span data-ttu-id="169e5-351">**Şekil 9**: Dosya Sil düğmesine gerçekte silmez'yı tıklayarak ([tam boyutlu görüntüyü görüntülemek için tıklatın](user-based-authorization-cs/_static/image27.png))</span><span class="sxs-lookup"><span data-stu-id="169e5-351">**Figure 9**: Clicking the Delete Button Does Not Actually Delete the File  ([Click to view full-size image](user-based-authorization-cs/_static/image27.png))</span></span>


<span data-ttu-id="169e5-352">1. adımda biz URL yetkilendirme kuralları, anonim kullanıcılar sayfalarında görüntülemesini engellemek için yapılandırılmış `Membership` klasör.</span><span class="sxs-lookup"><span data-stu-id="169e5-352">In Step 1 we configured the URL authorization rules to prohibit anonymous users from viewing the pages in the `Membership` folder.</span></span> <span data-ttu-id="169e5-353">Daha iyi ince çizgisi kimlik doğrulaması göstermesi için şirketinizdeki ziyaret etmek anonim kullanıcıların `UserBasedAuthorization.aspx` sayfasında, ancak işlevselliği sınırlıdır.</span><span class="sxs-lookup"><span data-stu-id="169e5-353">In order to better exhibit fine grain authentication, let's allow anonymous users to visit the `UserBasedAuthorization.aspx` page, but with limited functionality.</span></span> <span data-ttu-id="169e5-354">Tüm kullanıcılar tarafından erişilebilmesi için bu sayfayı açmak için aşağıdakileri ekleyin `<location>` öğesine `Web.config` dosyasını `Membership` klasörü:</span><span class="sxs-lookup"><span data-stu-id="169e5-354">To open this page up to be accessed by all users, add the following `<location>` element to the `Web.config` file in the `Membership` folder:</span></span>

[!code-xml[Main](user-based-authorization-cs/samples/sample14.xml)]

<span data-ttu-id="169e5-355">Bunu ekledikten sonra `<location>` öğesi, site dışında açarak yeni URL yetkilendirme kuralları sınayın.</span><span class="sxs-lookup"><span data-stu-id="169e5-355">After adding this `<location>` element, test the new URL authorization rules by logging out of the site.</span></span> <span data-ttu-id="169e5-356">Anonim kullanıcı olarak, ziyaret izni verilmesi gerekip `UserBasedAuthorization.aspx` sayfası.</span><span class="sxs-lookup"><span data-stu-id="169e5-356">As an anonymous user you should be permitted to visit the `UserBasedAuthorization.aspx` page.</span></span>

<span data-ttu-id="169e5-357">Şu anda, herhangi bir doğrulanmış veya anonim kullanıcı ziyaret edebilirsiniz `UserBasedAuthorization.aspx` sayfasında ve görüntülemek veya dosyaları silin.</span><span class="sxs-lookup"><span data-stu-id="169e5-357">Currently, any authenticated or anonymous user can visit the `UserBasedAuthorization.aspx` page and view or delete files.</span></span> <span data-ttu-id="169e5-358">Böylece yalnızca kimliği doğrulanmış kullanıcılar bir dosyanın içeriğini görüntüleyebilir ve yalnızca Tito bir dosyayı silebilirsiniz olalım.</span><span class="sxs-lookup"><span data-stu-id="169e5-358">Let's make it so that only authenticated users can view contents of a file and only Tito can delete a file.</span></span> <span data-ttu-id="169e5-359">Bu tür ince çizgisi yetkilendirme kuralları, bildirimli olarak, program aracılığıyla veya her iki yöntemlerinin bir birleşimini aracılığıyla uygulanabilir.</span><span class="sxs-lookup"><span data-stu-id="169e5-359">Such fine grain authorization rules can be applied declaratively, programmatically, or through a combination of both methods.</span></span> <span data-ttu-id="169e5-360">Bir dosyanın içeriğini görüntüleyebilecek sınırlamak için bildirim temelli bir yaklaşım kullanalım; bir dosyayı silebilirsiniz sınırı programlı yaklaşım kullanacağız.</span><span class="sxs-lookup"><span data-stu-id="169e5-360">Let's use the declarative approach to limit who can view the contents of a file; we'll use the programmatic approach to limit who can delete a file.</span></span>

### <a name="using-the-loginview-control"></a><span data-ttu-id="169e5-361">LoginView denetimi kullanma</span><span class="sxs-lookup"><span data-stu-id="169e5-361">Using the LoginView Control</span></span>

<span data-ttu-id="169e5-362">Geçmiş eğitimlerine anlatıldığı gibi LoginView denetimi kimliği doğrulanmış ve anonim kullanıcılar için farklı arabirimlerini görüntülemek için yararlıdır ve anonim kullanıcılar için erişilebilir değil işlevselliği gizlemek için kolay bir yol sunar.</span><span class="sxs-lookup"><span data-stu-id="169e5-362">As we've seen in past tutorials, the LoginView control is useful for displaying different interfaces for authenticated and anonymous users, and offers an easy way to hide functionality that is not accessible to anonymous users.</span></span> <span data-ttu-id="169e5-363">Anonim kullanıcılar görüntüleyemez veya dosyaları silin olduğundan, yalnızca göstermek ihtiyacımız `FileContents` sayfa kimliği doğrulanmış bir kullanıcı tarafından ziyaret edildiğinde metin kutusu.</span><span class="sxs-lookup"><span data-stu-id="169e5-363">Since anonymous users cannot view or delete files, we only need to show the `FileContents` TextBox when the page is visited by an authenticated user.</span></span> <span data-ttu-id="169e5-364">Bunu başarmak için sayfaya LoginView denetim ekleme, adlandırın `LoginViewForFileContentsTextBox`ve taşıma `FileContents` TextBox'ın bildirim temelli biçimlendirme LoginView denetimin içine `LoggedInTemplate`.</span><span class="sxs-lookup"><span data-stu-id="169e5-364">To achieve this, add a LoginView control to the page, name it `LoginViewForFileContentsTextBox`, and move the `FileContents` TextBox's declarative markup into the LoginView control's `LoggedInTemplate`.</span></span>

[!code-aspx[Main](user-based-authorization-cs/samples/sample15.aspx)]

<span data-ttu-id="169e5-365">Web denetimleri (link)'ın şablonlarındaki artık arka plan kodu sınıfından doğrudan erişilebilir.</span><span class="sxs-lookup"><span data-stu-id="169e5-365">The Web controls in the LoginView's templates are no longer directly accessible from the code-behind class.</span></span> <span data-ttu-id="169e5-366">Örneğin, `FilesGrid` GridView'ın `SelectedIndexChanged` ve `RowDeleting` olay işleyicileri şu anda başvuru `FileContents` TextBox denetimi koduyla ister:</span><span class="sxs-lookup"><span data-stu-id="169e5-366">For example, the `FilesGrid` GridView's `SelectedIndexChanged` and `RowDeleting` event handlers currently reference the `FileContents` TextBox control with code like:</span></span>

[!code-csharp[Main](user-based-authorization-cs/samples/sample16.cs)]

<span data-ttu-id="169e5-367">Ancak, bu kod artık geçerli değil.</span><span class="sxs-lookup"><span data-stu-id="169e5-367">However, this code is no longer valid.</span></span> <span data-ttu-id="169e5-368">Taşıyarak `FileContents` metin kutusuna `LoggedInTemplate` TextBox doğrudan erişilemez.</span><span class="sxs-lookup"><span data-stu-id="169e5-368">By moving the `FileContents` TextBox into the `LoggedInTemplate` the TextBox cannot be directly accessed.</span></span> <span data-ttu-id="169e5-369">Bunun yerine, biz kullanmalısınız `FindControl("controlId")` programlı olarak denetimi başvurmak için yöntem.</span><span class="sxs-lookup"><span data-stu-id="169e5-369">Instead, we must use the `FindControl("controlId")` method to programmatically reference the control.</span></span> <span data-ttu-id="169e5-370">Güncelleştirme `FilesGrid` TextBox başvurmak için olay işleyicileri sözlüğüdür:</span><span class="sxs-lookup"><span data-stu-id="169e5-370">Update the `FilesGrid` event handlers to reference the TextBox like so:</span></span>

[!code-csharp[Main](user-based-authorization-cs/samples/sample17.cs)]

<span data-ttu-id="169e5-371">TextBox (link) için 's taşıdıktan `LoggedInTemplate` ve sayfanın kodunu kullanarak metin kutusuna referansı güncelleme `FindControl("controlId")` deseni, bir anonim kullanıcı olarak sayfasını ziyaret edin.</span><span class="sxs-lookup"><span data-stu-id="169e5-371">After moving the TextBox to the LoginView's `LoggedInTemplate` and updating the page's code to reference the TextBox using the `FindControl("controlId")` pattern, visit the page as an anonymous user.</span></span> <span data-ttu-id="169e5-372">Şekil 10 gösterildiği gibi `FileContents` TextBox görüntülenmez.</span><span class="sxs-lookup"><span data-stu-id="169e5-372">As Figure 10 shows, the `FileContents` TextBox is not displayed.</span></span> <span data-ttu-id="169e5-373">Ancak, görünümü LinkButton hala görüntülenir.</span><span class="sxs-lookup"><span data-stu-id="169e5-373">However, the View LinkButton is still displayed.</span></span>


<span data-ttu-id="169e5-374">[![LoginView denetimi yalnızca kimliği doğrulanmış kullanıcılar için FileContents TextBox işler](user-based-authorization-cs/_static/image29.png)](user-based-authorization-cs/_static/image28.png)</span><span class="sxs-lookup"><span data-stu-id="169e5-374">[![The LoginView Control Only Renders the FileContents TextBox for Authenticated Users](user-based-authorization-cs/_static/image29.png)](user-based-authorization-cs/_static/image28.png)</span></span>

<span data-ttu-id="169e5-375">**Şekil 10**: LoginView denetimi yalnızca işler `FileContents` TextBox kimliği doğrulanmış kullanıcılar için ([tam boyutlu görüntüyü görüntülemek için tıklatın](user-based-authorization-cs/_static/image30.png))</span><span class="sxs-lookup"><span data-stu-id="169e5-375">**Figure 10**: The LoginView Control Only Renders the `FileContents` TextBox for Authenticated Users  ([Click to view full-size image](user-based-authorization-cs/_static/image30.png))</span></span>


<span data-ttu-id="169e5-376">Anonim kullanıcılar için görünümü düğmesini gizlemek için bir GridView alan TemplateField'a dönüştürmek için yoludur.</span><span class="sxs-lookup"><span data-stu-id="169e5-376">One way to hide the View button for anonymous users is to convert the GridView field into a TemplateField.</span></span> <span data-ttu-id="169e5-377">Bu görünüm LinkButton için bildirim temelli biçimlendirme içeren bir şablon oluşturur.</span><span class="sxs-lookup"><span data-stu-id="169e5-377">This will generate a template that contains the declarative markup for the View LinkButton.</span></span> <span data-ttu-id="169e5-378">Ardından TemplateField LoginView denetimi ekleyebilir ve LinkButton (link)'ın içinde yerleştirin `LoggedInTemplate`, böylece anonim ziyaretçiler görünüm düğmesinden gizleme.</span><span class="sxs-lookup"><span data-stu-id="169e5-378">We can then add a LoginView control to the TemplateField and place the LinkButton within the LoginView's `LoggedInTemplate`, thereby hiding the View button from anonymous visitors.</span></span> <span data-ttu-id="169e5-379">Bunu gerçekleştirmek için alanları iletişim kutusunu başlatmak için GridView kullanıcının akıllı etiket sütunları düzenleme bağlantısını tıklayın.</span><span class="sxs-lookup"><span data-stu-id="169e5-379">To accomplish this, click on the Edit Columns link from the GridView's Smart Tag to launch the Fields dialog box.</span></span> <span data-ttu-id="169e5-380">Ardından, sol alt köşesinde listesinden Seç düğmesini seçin ve bu alan TemplateField bağlantısına dönüştürme'ye tıklayın.</span><span class="sxs-lookup"><span data-stu-id="169e5-380">Next, select the Select button from the list in the lower left corner and then click the Convert this field to a TemplateField link.</span></span> <span data-ttu-id="169e5-381">Bunun yapılması alanın bildirim temelli biçimlendirmeden değiştirir:</span><span class="sxs-lookup"><span data-stu-id="169e5-381">Doing so will modify the field's declarative markup from:</span></span>

[!code-aspx[Main](user-based-authorization-cs/samples/sample18.aspx)]

 <span data-ttu-id="169e5-382">Hedef:</span><span class="sxs-lookup"><span data-stu-id="169e5-382">To:</span></span> 

[!code-aspx[Main](user-based-authorization-cs/samples/sample19.aspx)]

<span data-ttu-id="169e5-383">Bu noktada, biz TemplateField bir LoginView ekleyebilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="169e5-383">At this point, we can add a LoginView to the TemplateField.</span></span> <span data-ttu-id="169e5-384">Aşağıdaki biçimlendirmede yalnızca kimliği doğrulanmış kullanıcılar için Görünüm LinkButton görüntüler.</span><span class="sxs-lookup"><span data-stu-id="169e5-384">The following markup displays the View LinkButton only for authenticated users.</span></span>

[!code-aspx[Main](user-based-authorization-cs/samples/sample20.aspx)]

<span data-ttu-id="169e5-385">Şekil 11 gösterildiği gibi sonuç görünümü LinkButtons sütun içinde gizli olsa bile oldukça görünüm olarak sütun hala görüntülendiğini değil.</span><span class="sxs-lookup"><span data-stu-id="169e5-385">As Figure 11 shows, the end result is not that pretty as the View column is still displayed even though the View LinkButtons within the column are hidden.</span></span> <span data-ttu-id="169e5-386">Biz ne tüm GridView Sütun (ve yalnızca LinkButton) gizlemek sonraki bölümde ele alacağız.</span><span class="sxs-lookup"><span data-stu-id="169e5-386">We will look at how to hide the entire GridView column (and not just the LinkButton) in the next section.</span></span>


<span data-ttu-id="169e5-387">[![LoginView denetimi görünüm LinkButtons anonim ziyaretçiler için gizler.](user-based-authorization-cs/_static/image32.png)](user-based-authorization-cs/_static/image31.png)</span><span class="sxs-lookup"><span data-stu-id="169e5-387">[![The LoginView Control Hides the View LinkButtons for Anonymous Visitors](user-based-authorization-cs/_static/image32.png)](user-based-authorization-cs/_static/image31.png)</span></span>

<span data-ttu-id="169e5-388">**Şekil 11**: LoginView denetimi görünüm LinkButtons anonim ziyaretçiler için gizler ([tam boyutlu görüntüyü görüntülemek için tıklatın](user-based-authorization-cs/_static/image33.png))</span><span class="sxs-lookup"><span data-stu-id="169e5-388">**Figure 11**: The LoginView Control Hides the View LinkButtons for Anonymous Visitors  ([Click to view full-size image](user-based-authorization-cs/_static/image33.png))</span></span>


### <a name="programmatically-limiting-functionality"></a><span data-ttu-id="169e5-389">Program aracılığıyla sınırlama işlevi</span><span class="sxs-lookup"><span data-stu-id="169e5-389">Programmatically Limiting Functionality</span></span>

<span data-ttu-id="169e5-390">Bazı durumlarda, bildirim temelli teknikleri bir sayfaya işlevselliği sınırlamak için yeterli değil.</span><span class="sxs-lookup"><span data-stu-id="169e5-390">In some circumstances, declarative techniques are insufficient for limiting functionality to a page.</span></span> <span data-ttu-id="169e5-391">Örneğin, belirli sayfa işlevselliği kullanılabilirliğini sayfasını ziyaret kullanıcı anonim veya kimliği doğrulanmış olup ötesinde ölçütleri bağımlı olabilir.</span><span class="sxs-lookup"><span data-stu-id="169e5-391">For example, the availability of certain page functionality may be dependent on criteria beyond whether the user visiting the page is anonymous or authenticated.</span></span> <span data-ttu-id="169e5-392">Böyle durumlarda, çeşitli kullanıcı arabirimi öğeleri görüntülenir veya programlama yollarla gizlenir.</span><span class="sxs-lookup"><span data-stu-id="169e5-392">In such cases, the various user interface elements can be displayed or hidden through programmatic means.</span></span>

<span data-ttu-id="169e5-393">Program aracılığıyla işlevselliği sınırlamak için iki görevleri gerçekleştirmek ihtiyacımız var:</span><span class="sxs-lookup"><span data-stu-id="169e5-393">In order to limit the functionality programmatically, we need to perform two tasks:</span></span>

1. <span data-ttu-id="169e5-394">Sayfasını ziyaret kullanıcı işlevselliği erişip erişemeyeceğini belirler ve</span><span class="sxs-lookup"><span data-stu-id="169e5-394">Determine whether the user visiting the page can access the functionality, and</span></span>
2. <span data-ttu-id="169e5-395">Program aracılığıyla kullanıcının söz konusu işlevine erişimi olup tabanlı kullanıcı arabirimi değiştirin.</span><span class="sxs-lookup"><span data-stu-id="169e5-395">Programmatically modify the user interface based on whether the user has access to the functionality in question.</span></span>

<span data-ttu-id="169e5-396">Bu iki görevler uygulama göstermek için şimdi yalnızca GridView dosyaları silmek Tito izin verir.</span><span class="sxs-lookup"><span data-stu-id="169e5-396">To demonstrate the application of these two tasks, let's only allow Tito to delete files from the GridView.</span></span> <span data-ttu-id="169e5-397">Bizim ilk, ardından sayfasını ziyaret Tito olup olmadığını belirlemek için bir görevdir.</span><span class="sxs-lookup"><span data-stu-id="169e5-397">Our first task, then, is to determine whether it is Tito visiting the page.</span></span> <span data-ttu-id="169e5-398">Belirlendikten sonra biz GridView'ın sütun Sil (göstermek veya gizlemek) gerekir.</span><span class="sxs-lookup"><span data-stu-id="169e5-398">Once that has been determined, we need to hide (or show) the GridView's Delete column.</span></span> <span data-ttu-id="169e5-399">GridView'ın sütunları üzerinden erişilebilir kendi `Columns` özellik; bir sütun ise yalnızca işlenen kendi `Visible` özelliği ayarlanmış `true` (varsayılan).</span><span class="sxs-lookup"><span data-stu-id="169e5-399">The GridView's columns are accessible through its `Columns` property; a column is only rendered if its `Visible` property is set to `true` (the default).</span></span>

<span data-ttu-id="169e5-400">Aşağıdaki kodu ekleyin `Page_Load` GridView veri bağlama önce olay işleyicisi:</span><span class="sxs-lookup"><span data-stu-id="169e5-400">Add the following code to the `Page_Load` event handler prior to binding the data to the GridView:</span></span>

[!code-csharp[Main](user-based-authorization-cs/samples/sample21.cs)]

<span data-ttu-id="169e5-401">Biz anlatıldığı gibi [ *form kimlik doğrulaması bir genel bakış* ](../introduction/an-overview-of-forms-authentication-cs.md) öğretici, `User.Identity.Name` kimliğin adını döndürür.</span><span class="sxs-lookup"><span data-stu-id="169e5-401">As we discussed in the [*An Overview of Forms Authentication*](../introduction/an-overview-of-forms-authentication-cs.md) tutorial, `User.Identity.Name` returns the identity's name.</span></span> <span data-ttu-id="169e5-402">Bu, oturum açma denetimi girilen kullanıcı adının karşılık gelir.</span><span class="sxs-lookup"><span data-stu-id="169e5-402">This corresponds to the username entered in the Login control.</span></span> <span data-ttu-id="169e5-403">Sayfanın, GridView'ın ikinci sütun ziyaret Tito olup olmadığını `Visible` özelliği ayarlanmış `true`; Aksi takdirde ayarlanır `false`.</span><span class="sxs-lookup"><span data-stu-id="169e5-403">If it is Tito visiting the page, the GridView's second column's `Visible` property is set to `true`; otherwise, it is set to `false`.</span></span> <span data-ttu-id="169e5-404">Net sonucudur birisi Tito dışındaki başka bir kimliği doğrulanmış kullanıcı veya anonim bir kullanıcı, sayfayı ziyaret ettiğinde Sütun Sil (bkz. Şekil 12); işlenmez Sütun Sil Tito sayfasını ziyaret ettiğinde, ancak varsa (bkz. Şekil 13).</span><span class="sxs-lookup"><span data-stu-id="169e5-404">The net result is that when someone other than Tito visits the page, either another authenticated user or an anonymous user, the Delete column is not rendered (see Figure 12); however, when Tito visits the page, the Delete column is present (see Figure 13).</span></span>


<span data-ttu-id="169e5-405">[![Değil çizilir zaman ziyaret tarafından birisi dışında Tito (örneğin, Bruce'a) Sil sütundur](user-based-authorization-cs/_static/image35.png)](user-based-authorization-cs/_static/image34.png)</span><span class="sxs-lookup"><span data-stu-id="169e5-405">[![The Delete Column is Not Rendered When Visited By Someone Other Than Tito (Such as Bruce)](user-based-authorization-cs/_static/image35.png)](user-based-authorization-cs/_static/image34.png)</span></span>

<span data-ttu-id="169e5-406">**Şekil 12**: Sil sütundur değil çizilir zaman ziyaret tarafından birisi dışında Tito (örneğin, Bruce'a) ([tam boyutlu görüntüyü görüntülemek için tıklatın](user-based-authorization-cs/_static/image36.png))</span><span class="sxs-lookup"><span data-stu-id="169e5-406">**Figure 12**: The Delete Column is Not Rendered When Visited By Someone Other Than Tito (Such as Bruce)  ([Click to view full-size image](user-based-authorization-cs/_static/image36.png))</span></span>


<span data-ttu-id="169e5-407">[![Sütun Sil Tito için işlenir](user-based-authorization-cs/_static/image38.png)](user-based-authorization-cs/_static/image37.png)</span><span class="sxs-lookup"><span data-stu-id="169e5-407">[![The Delete Column is Rendered for Tito](user-based-authorization-cs/_static/image38.png)](user-based-authorization-cs/_static/image37.png)</span></span>

<span data-ttu-id="169e5-408">**Şekil 13**: Column silmek için Tito çizilir ([tam boyutlu görüntüyü görüntülemek için tıklatın](user-based-authorization-cs/_static/image39.png))</span><span class="sxs-lookup"><span data-stu-id="169e5-408">**Figure 13**: The Delete Column is Rendered for Tito  ([Click to view full-size image](user-based-authorization-cs/_static/image39.png))</span></span>


## <a name="step-4-applying-authorization-rules-to-classes-and-methods"></a><span data-ttu-id="169e5-409">4. adım: Sınıflar ve yöntemler için yetkilendirme kuralları uygulama</span><span class="sxs-lookup"><span data-stu-id="169e5-409">Step 4: Applying Authorization Rules to Classes and Methods</span></span>

<span data-ttu-id="169e5-410">Adım 3'te anonim kullanıcılar bir dosyanın içeriğini görüntülemesine izin verilmeyen ve tüm kullanıcılar, ancak Tito dosyaları silme yasaktır.</span><span class="sxs-lookup"><span data-stu-id="169e5-410">In Step 3 we disallowed anonymous users from viewing a file's contents and prohibited all users but Tito from deleting files.</span></span> <span data-ttu-id="169e5-411">Bu, bildirim temelli ve programlama teknikleri aracılığıyla yetkisiz ziyaretçiler için ilişkili kullanıcı arabirimi öğelerini gizleme tarafından gerçekleştirilmiştir.</span><span class="sxs-lookup"><span data-stu-id="169e5-411">This was accomplished by hiding the associated user interface elements for unauthorized visitors through declarative and programmatic techniques.</span></span> <span data-ttu-id="169e5-412">Basit Bizim örneğimizde, kullanıcı arabirimi öğeleri doğru gizleme açık, ancak ne oluştu daha karmaşık siteleri olabilir; burada aynı işlevleri gerçekleştirmek için birçok farklı yolu?</span><span class="sxs-lookup"><span data-stu-id="169e5-412">For our simple example, properly hiding the user interface elements was straightforward, but what about more complex sites where there may be many different ways to perform the same functionality?</span></span> <span data-ttu-id="169e5-413">Tüm geçerli kullanıcı arabirimi öğeleri devre dışı bırakmak veya gizlemek unutursanız yetkisiz kullanıcılara bu işlevselliği sınırlama içinde ne olur?</span><span class="sxs-lookup"><span data-stu-id="169e5-413">In limiting that functionality to unauthorized users, what happens if we forget to hide or disable all of the applicable user interface elements?</span></span>

<span data-ttu-id="169e5-414">Bu sınıf veya yöntemin ile işaretleme işlevsellik belirli bir parçasını yetkisiz kullanıcılar tarafından erişilen emin olmak için kolay bir yoludur [ `PrincipalPermission` özniteliği](https://msdn.microsoft.com/library/system.security.permissions.principalpermissionattribute.aspx).</span><span class="sxs-lookup"><span data-stu-id="169e5-414">An easy way to ensure that a particular piece of functionality cannot be accessed by an unauthorized user is to decorate that class or method with the [`PrincipalPermission` attribute](https://msdn.microsoft.com/library/system.security.permissions.principalpermissionattribute.aspx).</span></span> <span data-ttu-id="169e5-415">.NET çalışma zamanı sınıf kullanır veya yöntemlerinden birini yürütür, geçerli güvenlik bağlamı sınıf kullanın veya yöntemi yürütme izni olduğundan emin olmak için denetler.</span><span class="sxs-lookup"><span data-stu-id="169e5-415">When the .NET runtime uses a class or executes one of its methods, it checks to ensure that the current security context has permission to use the class or execute the method.</span></span> <span data-ttu-id="169e5-416">`PrincipalPermission` Özniteliği üzerinden biz tanımlayabilirsiniz bu kurallar bir mekanizma sağlar.</span><span class="sxs-lookup"><span data-stu-id="169e5-416">The `PrincipalPermission` attribute provides a mechanism through which we can define these rules.</span></span>

<span data-ttu-id="169e5-417">Kullanarak gösterelim `PrincipalPermission` GridView'ın öznitelikte `SelectedIndexChanged` ve `RowDeleting` anonim kullanıcılar ve Tito, kullanıcılar tarafından yürütme sırasıyla engellemek için olay işleyicileri.</span><span class="sxs-lookup"><span data-stu-id="169e5-417">Let's demonstrate using the `PrincipalPermission` attribute on the GridView's `SelectedIndexChanged` and `RowDeleting` event handlers to prohibit execution by anonymous users and users other than Tito, respectively.</span></span> <span data-ttu-id="169e5-418">Yapmamız gereken tek şey her işlev tanımı üzerinde uygun özniteliği ekleyin:</span><span class="sxs-lookup"><span data-stu-id="169e5-418">All we need to do is add the appropriate attribute atop each function definition:</span></span>

[!code-csharp[Main](user-based-authorization-cs/samples/sample22.cs)]

<span data-ttu-id="169e5-419">Öznitelik için `SelectedIndexChanged` yalnızca kimliği doğrulanmış kullanıcılar olay işleyicisi belirtir, burada özniteliği olarak olay işleyicisi yürütebilir `RowDeleting` olay işleyicisi yürütme Tito için sınırlar.</span><span class="sxs-lookup"><span data-stu-id="169e5-419">The attribute for the `SelectedIndexChanged` event handler dictates that only authenticated users can execute the event handler, where as the attribute on the `RowDeleting` event handler limits the execution to Tito.</span></span>

<span data-ttu-id="169e5-420">Tito başka bir kullanıcı bu şekilde, yürütmeyi denediğinde, `RowDeleting` olay işleyicisi veya doğrulanmamış bir kullanıcı yürütme girişimlerini `SelectedIndexChanged` .NET çalışma zamanı olay işleyicisi yükseltmek bir `SecurityException`.</span><span class="sxs-lookup"><span data-stu-id="169e5-420">If, somehow, a user other than Tito attempts to execute the `RowDeleting` event handler or a non-authenticated user attempts to execute the `SelectedIndexChanged` event handler, the .NET runtime will raise a `SecurityException`.</span></span>


<span data-ttu-id="169e5-421">[![Güvenlik bağlamı yöntemi yürütmek için yetkili değil, bir SecurityException oluşturulur](user-based-authorization-cs/_static/image41.png)](user-based-authorization-cs/_static/image40.png)</span><span class="sxs-lookup"><span data-stu-id="169e5-421">[![If the Security Context is not Authorized to Execute the Method, a SecurityException is Thrown](user-based-authorization-cs/_static/image41.png)](user-based-authorization-cs/_static/image40.png)</span></span>

<span data-ttu-id="169e5-422">**Şekil 14**: güvenlik bağlamını yöntemi yürütmek için yetkili değil, bir `SecurityException` atılır ([tam boyutlu görüntüyü görüntülemek için tıklatın](user-based-authorization-cs/_static/image42.png))</span><span class="sxs-lookup"><span data-stu-id="169e5-422">**Figure 14**: If the Security Context is not Authorized to Execute the Method, a `SecurityException` is Thrown  ([Click to view full-size image](user-based-authorization-cs/_static/image42.png))</span></span>


> [!NOTE]
> <span data-ttu-id="169e5-423">Birden çok güvenlik kapsamları bir sınıf veya yöntemin erişmesine izin vermek için sınıf veya yöntemin ile işaretleme bir `PrincipalPermission` özniteliği için her güvenlik bağlamı.</span><span class="sxs-lookup"><span data-stu-id="169e5-423">To allow multiple security contexts to access a class or method, decorate the class or method with a `PrincipalPermission` attribute for each security context.</span></span> <span data-ttu-id="169e5-424">Diğer bir deyişle, Tito ve Bruce'a yürütmek izin vermek için `RowDeleting` olay işleyicisi ekleme *iki* `PrincipalPermission` öznitelikleri:</span><span class="sxs-lookup"><span data-stu-id="169e5-424">That is, to allow both Tito and Bruce to execute the `RowDeleting` event handler, add *two* `PrincipalPermission` attributes:</span></span>


[!code-csharp[Main](user-based-authorization-cs/samples/sample23.cs)]

<span data-ttu-id="169e5-425">Birçok uygulama, ASP.NET sayfaları ek olarak, iş mantığı ve verileri erişim katmanları gibi çeşitli katmanları içeren bir mimari de vardır.</span><span class="sxs-lookup"><span data-stu-id="169e5-425">In addition to ASP.NET pages, many applications also have an architecture that includes various layers, such as Business Logic and Data Access Layers.</span></span> <span data-ttu-id="169e5-426">Bu katmanlar genellikle sınıf kitaplıkları uygulanır ve sınıfları ve iş mantığı ve verileri ilgili işlevleri gerçekleştirmek için yöntemleri sunar.</span><span class="sxs-lookup"><span data-stu-id="169e5-426">These layers are typically implemented as Class Libraries and offer classes and methods for performing business logic- and data-related functionality.</span></span> <span data-ttu-id="169e5-427">`PrincipalPermission` Özniteliği bu katmanlara yetkilendirme kuralları uygulamak için yararlıdır.</span><span class="sxs-lookup"><span data-stu-id="169e5-427">The `PrincipalPermission` attribute is useful for applying authorization rules to these layers.</span></span>

<span data-ttu-id="169e5-428">Kullanma hakkında daha fazla bilgi için `PrincipalPermission` sınıflar ve yöntemler yetkilendirme kuralları tanımlamak, başvurmak için öznitelik [Scott Guthrie](https://weblogs.asp.net/scottgu/)'s blog girdisi [iş ve veri kullanan katmanlar içinyetkilendirmekurallarıekleme`PrincipalPermissionAttributes` ](https://weblogs.asp.net/scottgu/archive/2006/10/04/Tip_2F00_Trick_3A00_-Adding-Authorization-Rules-to-Business-and-Data-Layers-using-PrincipalPermissionAttributes.aspx).</span><span class="sxs-lookup"><span data-stu-id="169e5-428">For more information on using the `PrincipalPermission` attribute to define authorization rules on classes and methods, refer to [Scott Guthrie](https://weblogs.asp.net/scottgu/)'s blog entry [Adding Authorization Rules to Business and Data Layers Using `PrincipalPermissionAttributes`](https://weblogs.asp.net/scottgu/archive/2006/10/04/Tip_2F00_Trick_3A00_-Adding-Authorization-Rules-to-Business-and-Data-Layers-using-PrincipalPermissionAttributes.aspx).</span></span>

## <a name="summary"></a><span data-ttu-id="169e5-429">Özet</span><span class="sxs-lookup"><span data-stu-id="169e5-429">Summary</span></span>

<span data-ttu-id="169e5-430">Bu öğreticide kullanıcı tabanlı yetkilendirme kuralları uygulamak ne arama.</span><span class="sxs-lookup"><span data-stu-id="169e5-430">In this tutorial we looked at how to apply user-based authorization rules.</span></span> <span data-ttu-id="169e5-431">ASP göz ile başlatıldı. NET'in URL yetkilendirme çerçevesi.</span><span class="sxs-lookup"><span data-stu-id="169e5-431">We started with a look at ASP.NET's URL authorization framework.</span></span> <span data-ttu-id="169e5-432">Her isteğin, ASP.NET altyapısı üzerinde `UrlAuthorizationModule` kimliğini istenen kaynağa erişmek için yetkili olup olmadığını belirlemek için uygulamanın yapılandırma dosyasındaki tanımlanan URL yetkilendirme kurallarını denetler.</span><span class="sxs-lookup"><span data-stu-id="169e5-432">On each request, the ASP.NET engine's `UrlAuthorizationModule` inspects the URL authorization rules defined in the application's configuration to determine whether the identity is authorized to access the requested resource.</span></span> <span data-ttu-id="169e5-433">Kısacası, URL yetkilendirmesi, belirli bir dizindeki tüm sayfalar için veya belirli bir sayfa için yetkilendirme kuralları belirtmek kolaylaştırır.</span><span class="sxs-lookup"><span data-stu-id="169e5-433">In short, URL authorization makes it easy to specify authorization rules for a specific page or for all pages in a particular directory.</span></span>

<span data-ttu-id="169e5-434">URL yetkilendirme framework bir sayfa tarafından temelinde yetkilendirme kurallarını uygular.</span><span class="sxs-lookup"><span data-stu-id="169e5-434">The URL authorization framework applies authorization rules on a page-by-page basis.</span></span> <span data-ttu-id="169e5-435">URL yetkilendirmesi ile isteyen kimliğini belirli bir kaynağa erişim yetkisi.</span><span class="sxs-lookup"><span data-stu-id="169e5-435">With URL authorization, either the requesting identity is authorized to access a particular resource or not.</span></span> <span data-ttu-id="169e5-436">Birçok senaryo, ancak daha fazla ince çizgisi yetkilendirme kuralları için çağırın.</span><span class="sxs-lookup"><span data-stu-id="169e5-436">Many scenarios, however, call for more fine grain authorization rules.</span></span> <span data-ttu-id="169e5-437">Kimin bir sayfa erişim izni tanımlamanın yerine, biz herkes bir sayfa erişim sağlar, ancak farklı verileri gösterir veya sayfasını ziyaret kullanıcı bağlı olarak farklı işlevler sunar gerekebilir.</span><span class="sxs-lookup"><span data-stu-id="169e5-437">Rather than defining who is permitted to access a page, we may need to let everyone access a page, but to show different data or offer different functionality depending on the user visiting the page.</span></span> <span data-ttu-id="169e5-438">Sayfa düzeyinde yetkilendirme çoğunlukla, yetkisiz kullanıcıların yasaklanmış işlevselliği erişimini engellemek için belirli bir kullanıcı arabirimi öğelerini gizleme kapsar.</span><span class="sxs-lookup"><span data-stu-id="169e5-438">Page-level authorization usually involves hiding specific user interface elements in order to prevent unauthorized users from accessing prohibited functionality.</span></span> <span data-ttu-id="169e5-439">Ayrıca, sınıflar ve belirli kullanıcılar için yöntemlerini yürütülmesi için erişimi kısıtlamak için öznitelikleri kullanmak da mümkündür.</span><span class="sxs-lookup"><span data-stu-id="169e5-439">Additionally, it is possible to use attributes to restrict access to classes and execution of its methods for certain users.</span></span>

<span data-ttu-id="169e5-440">Mutluluk programlama!</span><span class="sxs-lookup"><span data-stu-id="169e5-440">Happy Programming!</span></span>

### <a name="further-reading"></a><span data-ttu-id="169e5-441">Daha Fazla Bilgi</span><span class="sxs-lookup"><span data-stu-id="169e5-441">Further Reading</span></span>

<span data-ttu-id="169e5-442">Bu öğreticide konular hakkında daha fazla bilgi için aşağıdaki kaynaklara bakın:</span><span class="sxs-lookup"><span data-stu-id="169e5-442">For more information on the topics discussed in this tutorial, refer to the following resources:</span></span>

- [<span data-ttu-id="169e5-443">İş ve veri katmanlarını kullanmak için yetkilendirme kuralları ekleme `PrincipalPermissionAttributes`</span><span class="sxs-lookup"><span data-stu-id="169e5-443">Adding Authorization Rules to Business and Data Layers Using `PrincipalPermissionAttributes`</span></span>](https://weblogs.asp.net/scottgu/archive/2006/10/04/Tip_2F00_Trick_3A00_-Adding-Authorization-Rules-to-Business-and-Data-Layers-using-PrincipalPermissionAttributes.aspx)
- [<span data-ttu-id="169e5-444">ASP.NET yetkilendirmesi</span><span class="sxs-lookup"><span data-stu-id="169e5-444">ASP.NET Authorization</span></span>](https://msdn.microsoft.com/library/wce3kxhd.aspx)
- [<span data-ttu-id="169e5-445">IIS6 ve IIS7 güvenlik arasındaki değişiklikleri</span><span class="sxs-lookup"><span data-stu-id="169e5-445">Changes Between IIS6 and IIS7 Security</span></span>](https://www.iis.net/articles/view.aspx/IIS7/Managing-IIS7/Configuring-Security/Changes-between-IIS6-and-IIS7-Security)
- [<span data-ttu-id="169e5-446">Belirli dosya ve alt dizinleri yapılandırma</span><span class="sxs-lookup"><span data-stu-id="169e5-446">Configuring Specific Files and Subdirectories</span></span>](https://msdn.microsoft.com/library/6hbkh9s7.aspx)
- [<span data-ttu-id="169e5-447">Kullanıcıyı temel alarak bir sınırlama veri değişikliği işlevi</span><span class="sxs-lookup"><span data-stu-id="169e5-447">Limiting Data Modification Functionality Based on the User</span></span>](../../data-access/editing-inserting-and-deleting-data/limiting-data-modification-functionality-based-on-the-user-cs.md)
- [<span data-ttu-id="169e5-448">LoginView denetimi QuickStarts</span><span class="sxs-lookup"><span data-stu-id="169e5-448">LoginView Control QuickStarts</span></span>](https://quickstarts.asp.net/QuickStartv20/aspnet/doc/ctrlref/login/loginview.aspx)
- [<span data-ttu-id="169e5-449">IIS7 URL yetkilendirmesi anlama</span><span class="sxs-lookup"><span data-stu-id="169e5-449">Understanding IIS7 URL Authorization</span></span>](https://www.iis.net/articles/view.aspx/IIS7/Managing-IIS7/Configuring-Security/URL-Authorization/Understanding-IIS7-URL-Authorization)
- [<span data-ttu-id="169e5-450">`UrlAuthorizationModule` Teknik belgeler</span><span class="sxs-lookup"><span data-stu-id="169e5-450">`UrlAuthorizationModule` Technical Documentation</span></span>](https://msdn.microsoft.com/library/system.web.security.urlauthorizationmodule.aspx)
- [<span data-ttu-id="169e5-451">ASP.NET 2.0 verilerle çalışma</span><span class="sxs-lookup"><span data-stu-id="169e5-451">Working with Data in ASP.NET 2.0</span></span>](../../data-access/index.md)

### <a name="about-the-author"></a><span data-ttu-id="169e5-452">Yazar hakkında</span><span class="sxs-lookup"><span data-stu-id="169e5-452">About the Author</span></span>

<span data-ttu-id="169e5-453">Scott Mitchell, birden çok ASP/ASP.NET books yazar ve 4GuysFromRolla.com, kurucusu 1998 itibaren Microsoft Web teknolojileri ile çalışmaktadır.</span><span class="sxs-lookup"><span data-stu-id="169e5-453">Scott Mitchell, author of multiple ASP/ASP.NET books and founder of 4GuysFromRolla.com, has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="169e5-454">Tan bağımsız Danışman, eğitmen ve yazıcı çalışır.</span><span class="sxs-lookup"><span data-stu-id="169e5-454">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="169e5-455">En son kendi defteri  *[kendi öğretmek kendiniz ASP.NET 2.0 24 saat içindeki](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco)*.</span><span class="sxs-lookup"><span data-stu-id="169e5-455">His latest book is *[Sams Teach Yourself ASP.NET 2.0 in 24 Hours](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco)*.</span></span> <span data-ttu-id="169e5-456">Tan adresindeki ulaşılabilir [ mitchell@4guysfromrolla.com ](mailto:mitchell@4guysfromrolla.com) veya kendi blog aracılığıyla [ http://ScottOnWriting.NET ](http://scottonwriting.net/).</span><span class="sxs-lookup"><span data-stu-id="169e5-456">Scott can be reached at [mitchell@4guysfromrolla.com](mailto:mitchell@4guysfromrolla.com) or via his blog at [http://ScottOnWriting.NET](http://scottonwriting.net/).</span></span>

### <a name="special-thanks-to"></a><span data-ttu-id="169e5-457">Özel teşekkürler</span><span class="sxs-lookup"><span data-stu-id="169e5-457">Special Thanks To</span></span>

<span data-ttu-id="169e5-458">Bu öğretici seri pek çok yararlı gözden geçirenler tarafından gözden geçirildi.</span><span class="sxs-lookup"><span data-stu-id="169e5-458">This tutorial series was reviewed by many helpful reviewers.</span></span> <span data-ttu-id="169e5-459">My yaklaşan MSDN makaleleri gözden geçirme ilginizi çekiyor mu?</span><span class="sxs-lookup"><span data-stu-id="169e5-459">Interested in reviewing my upcoming MSDN articles?</span></span> <span data-ttu-id="169e5-460">Öyleyse, bana bir satırında bırakma [ mitchell@4GuysFromRolla.com ](mailto:mitchell@4GuysFromRolla.com).</span><span class="sxs-lookup"><span data-stu-id="169e5-460">If so, drop me a line at [mitchell@4GuysFromRolla.com](mailto:mitchell@4GuysFromRolla.com).</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="169e5-461">[Önceki](validating-user-credentials-against-the-membership-user-store-cs.md)
> [sonraki](storing-additional-user-information-cs.md)</span><span class="sxs-lookup"><span data-stu-id="169e5-461">[Previous](validating-user-credentials-against-the-membership-user-store-cs.md)
[Next](storing-additional-user-information-cs.md)</span></span>
