---
uid: web-forms/overview/data-access/caching-data/caching-data-in-the-architecture-cs
title: "Mimarisinde (C#) verileri önbelleğe alma | Microsoft Docs"
author: rick-anderson
description: "Önceki öğreticide sunu katmanında önbelleğe alma uygulamak nasıl öğrendiniz. Bu öğreticide bizim katmanlı architectu yararlanmak nasıl öğrenin..."
ms.author: aspnetcontent
manager: wpickett
ms.date: 05/30/2007
ms.topic: article
ms.assetid: d29a7c41-0628-4a23-9dfc-bfea9c6c1054
ms.technology: dotnet-webforms
ms.prod: .net-framework
msc.legacyurl: /web-forms/overview/data-access/caching-data/caching-data-in-the-architecture-cs
msc.type: authoredcontent
ms.openlocfilehash: 60bdab9dc8317c7f8753891b461da18f02993812
ms.sourcegitcommit: 9a9483aceb34591c97451997036a9120c3fe2baf
ms.translationtype: MT
ms.contentlocale: tr-TR
ms.lasthandoff: 11/10/2017
---
<a name="caching-data-in-the-architecture-c"></a><span data-ttu-id="3a74c-104">Verileri önbelleğe alma mimarisinde (C#)</span><span class="sxs-lookup"><span data-stu-id="3a74c-104">Caching Data in the Architecture (C#)</span></span>
====================
<span data-ttu-id="3a74c-105">tarafından [Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="3a74c-105">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="3a74c-106">[Örnek uygulamayı indirin](http://download.microsoft.com/download/4/a/7/4a7a3b18-d80e-4014-8e53-a6a2427f0d93/ASPNET_Data_Tutorial_59_CS.exe) veya [PDF indirin](caching-data-in-the-architecture-cs/_static/datatutorial59cs1.pdf)</span><span class="sxs-lookup"><span data-stu-id="3a74c-106">[Download Sample App](http://download.microsoft.com/download/4/a/7/4a7a3b18-d80e-4014-8e53-a6a2427f0d93/ASPNET_Data_Tutorial_59_CS.exe) or [Download PDF](caching-data-in-the-architecture-cs/_static/datatutorial59cs1.pdf)</span></span>

> <span data-ttu-id="3a74c-107">Önceki öğreticide sunu katmanında önbelleğe alma uygulamak nasıl öğrendiniz.</span><span class="sxs-lookup"><span data-stu-id="3a74c-107">In the previous tutorial we learned how to apply caching at the Presentation Layer.</span></span> <span data-ttu-id="3a74c-108">Bu öğreticide iş mantığı katmanı önbellek verileri için katmanlı mimarimizin avantajlarından yararlanmak nasıl öğrenin.</span><span class="sxs-lookup"><span data-stu-id="3a74c-108">In this tutorial we learn how to take advantage of our layered architecture to cache data at the Business Logic Layer.</span></span> <span data-ttu-id="3a74c-109">Biz önbelleğe alma katman içerecek şekilde mimarisi genişleterek yapın.</span><span class="sxs-lookup"><span data-stu-id="3a74c-109">We do this by extending the architecture to include a Caching Layer.</span></span>


## <a name="introduction"></a><span data-ttu-id="3a74c-110">Giriş</span><span class="sxs-lookup"><span data-stu-id="3a74c-110">Introduction</span></span>

<span data-ttu-id="3a74c-111">Önceki öğreticide gördüğümüz gibi ObjectDataSource s verileri önbelleğe alma özelliklerini birkaç ayarı olarak kadar basittir.</span><span class="sxs-lookup"><span data-stu-id="3a74c-111">As we saw in the preceding tutorial, caching the ObjectDataSource s data is as simple as setting a couple of properties.</span></span> <span data-ttu-id="3a74c-112">Ne yazık ki, sıkı bir şekilde önbelleğe alma ilkelerini ASP.NET sayfasıyla couples sunu katmanında önbelleğe alma ObjectDataSource geçerlidir.</span><span class="sxs-lookup"><span data-stu-id="3a74c-112">Unfortunately, the ObjectDataSource applies caching at the Presentation Layer, which tightly couples the caching policies with the ASP.NET page.</span></span> <span data-ttu-id="3a74c-113">Katmanlı bir mimari oluşturmak için nedenlerden biri dolayısıyla kesilmesi böyle couplings izin vermektir.</span><span class="sxs-lookup"><span data-stu-id="3a74c-113">One of the reasons for creating a layered architecture is to allow such couplings to be broken.</span></span> <span data-ttu-id="3a74c-114">Veri erişim katmanı veri erişim ayrıntıları ayrıştırır sırada iş mantığı katmanı örneği için ASP.NET sayfaları iş mantığından ayrıştırır.</span><span class="sxs-lookup"><span data-stu-id="3a74c-114">The Business Logic Layer, for instance, decouples the business logic from the ASP.NET pages, while the Data Access Layer decouples the data access details.</span></span> <span data-ttu-id="3a74c-115">Sistem daha okunabilir, daha rahat ve değiştirmek için daha esnek kolaylaştırır bu iş mantığı ve verileri erişim ayrıntılarını kesilmesi parçası olarak, tercih edilen, çünkü.</span><span class="sxs-lookup"><span data-stu-id="3a74c-115">This decoupling of business logic and data access details is preferred, in part, because it makes the system more readable, more maintainable, and more flexible to change.</span></span> <span data-ttu-id="3a74c-116">Ayrıca etki alanı bilgi ve sunu katmanı içermiyor t üzerinde çalışan bir geliştirici kendi iş yapmak için veritabanı s ayrıntıları ile ilgili bilgi sahibi olmanız gereken işgücü bölümünün olanak sağlar.</span><span class="sxs-lookup"><span data-stu-id="3a74c-116">It also allows for domain knowledge and division of labor a developer working on the Presentation Layer doesn t need to be familiar with the database s details in order to do her job.</span></span> <span data-ttu-id="3a74c-117">Sunu katmanı önbelleğe alma ilkesinden kesilmesi benzer avantajları sunar.</span><span class="sxs-lookup"><span data-stu-id="3a74c-117">Decoupling the caching policy from the Presentation Layer offers similar benefits.</span></span>

<span data-ttu-id="3a74c-118">Bu öğreticide biz içerecek şekilde mimarimizin büyütmek bir *önbelleğe alma katman* (veya kısaca CL) önbelleğe alma ilkemizi kullanır.</span><span class="sxs-lookup"><span data-stu-id="3a74c-118">In this tutorial we will augment our architecture to include a *Caching Layer* (or CL for short) that employs our caching policy.</span></span> <span data-ttu-id="3a74c-119">Önbelleğe alma katman içerecek bir `ProductsCL` gibi yöntemleriyle ürün bilgilerine erişim sağlayan sınıf `GetProducts()`, `GetProductsByCategoryID(categoryID)`, vb., çağrıldığında, önbellekten veri almak için ilk deneme olur.</span><span class="sxs-lookup"><span data-stu-id="3a74c-119">The Caching Layer will include a `ProductsCL` class that provides access to product information with methods like `GetProducts()`, `GetProductsByCategoryID(categoryID)`, and so forth, that, when invoked, will first attempt to retrieve the data from the cache.</span></span> <span data-ttu-id="3a74c-120">Önbellek boşsa, bu yöntemleri uygun çağırma `ProductsBLL` veri DAL sırayla elde edebileceğiniz BLL yöntemi.</span><span class="sxs-lookup"><span data-stu-id="3a74c-120">If the cache is empty, these methods will invoke the appropriate `ProductsBLL` method in the BLL, which would in turn get the data from the DAL.</span></span> <span data-ttu-id="3a74c-121">`ProductsCL` Yöntemleri önbelleğe döndürmeden önce BLL alınan veri.</span><span class="sxs-lookup"><span data-stu-id="3a74c-121">The `ProductsCL` methods cache the data retrieved from the BLL before returning it.</span></span>

<span data-ttu-id="3a74c-122">Şekil 1'de görüldüğü gibi CL sunu ve iş mantığı katmanlar arasında yer alıyor.</span><span class="sxs-lookup"><span data-stu-id="3a74c-122">As Figure 1 shows, the CL resides between the Presentation and Business Logic Layers.</span></span>


![Önbelleğe alma katman (CL) Mız mimarisinde başka bir katmanıdır](caching-data-in-the-architecture-cs/_static/image1.png)

<span data-ttu-id="3a74c-124">**Şekil 1**: önbelleğe alma katman (CL) olan başka bir katmanında Mız mimarisi</span><span class="sxs-lookup"><span data-stu-id="3a74c-124">**Figure 1**: The Caching Layer (CL) is Another Layer in Our Architecture</span></span>


## <a name="step-1-creating-the-caching-layer-classes"></a><span data-ttu-id="3a74c-125">1. adım: önbelleğe alma katman sınıfları oluşturma</span><span class="sxs-lookup"><span data-stu-id="3a74c-125">Step 1: Creating the Caching Layer Classes</span></span>

<span data-ttu-id="3a74c-126">Bu öğreticide çok basit bir CL ile tek bir sınıf oluşturacağız `ProductsCL` yöntemleri sayıda sahip.</span><span class="sxs-lookup"><span data-stu-id="3a74c-126">In this tutorial we will create a very simple CL with a single class `ProductsCL` that has only a handful of methods.</span></span> <span data-ttu-id="3a74c-127">Tüm uygulama oluşturma gerektirecek için tam bir önbelleğe alma katmanı oluşturma `CategoriesCL`, `EmployeesCL`, ve `SuppliersCL` sınıfları ve BLL her veri erişimi veya değiştirilmesi yöntem için bu önbelleğe alma katman sınıflardaki bir yöntem sağlar.</span><span class="sxs-lookup"><span data-stu-id="3a74c-127">Building a complete Caching Layer for the entire application would require creating `CategoriesCL`, `EmployeesCL`, and `SuppliersCL` classes, and providing a method in these Caching Layer classes for each data access or modification method in the BLL.</span></span> <span data-ttu-id="3a74c-128">BLL ve DAL gibi önbelleğe alma katman ideal ayrı bir sınıf kitaplığı proje uygulanmalıdır; Ancak, biz onu bir sınıf olarak uygulayacak `App_Code` klasör.</span><span class="sxs-lookup"><span data-stu-id="3a74c-128">As with the BLL and DAL, the Caching Layer should ideally be implemented as a separate Class Library project; however, we will implement it as a class in the `App_Code` folder.</span></span>

<span data-ttu-id="3a74c-129">DAL ve BLL sınıflardan daha fazla düzgün bir şekilde ayrı CL sınıflarına olanak sağlayan s oluşturma yeni bir alt `App_Code` klasör.</span><span class="sxs-lookup"><span data-stu-id="3a74c-129">To more cleanly separate the CL classes from the DAL and BLL classes, let s create a new subfolder in the `App_Code` folder.</span></span> <span data-ttu-id="3a74c-130">Sağ `App_Code` Çözüm Gezgininde klasör yeni bir klasör seçin ve yeni bir klasör adı `CL`.</span><span class="sxs-lookup"><span data-stu-id="3a74c-130">Right-click on the `App_Code` folder in the Solution Explorer, choose New Folder, and name the new folder `CL`.</span></span> <span data-ttu-id="3a74c-131">Bu klasör oluşturduktan sonra adlı yeni bir sınıf ekleyin `ProductsCL.cs`.</span><span class="sxs-lookup"><span data-stu-id="3a74c-131">After creating this folder, add to it a new class named `ProductsCL.cs`.</span></span>


![CL adlı yeni bir klasör ve ProductsCL.cs adlı bir sınıf ekleyin](caching-data-in-the-architecture-cs/_static/image2.png)

<span data-ttu-id="3a74c-133">**Şekil 2**: adlı yeni bir klasör ekleyin `CL` ve adlı bir sınıf`ProductsCL.cs`</span><span class="sxs-lookup"><span data-stu-id="3a74c-133">**Figure 2**: Add a New Folder Named `CL` and a Class Named `ProductsCL.cs`</span></span>


<span data-ttu-id="3a74c-134">`ProductsCL` Sınıfı içinde karşılık gelen iş mantığı katmanı sınıfındaki bulunan veri erişimi ve değiştirme yöntemleri aynı kümesini içermelidir (`ProductsBLL`).</span><span class="sxs-lookup"><span data-stu-id="3a74c-134">The `ProductsCL` class should include the same set of data access and modification methods as found in its corresponding Business Logic Layer class (`ProductsBLL`).</span></span> <span data-ttu-id="3a74c-135">Bu yöntemlerin let s yalnızca derleme için desenleri bir fikir almak için birkaç burada kullanılan CL tarafından oluşturmak yerine.</span><span class="sxs-lookup"><span data-stu-id="3a74c-135">Rather than creating all of these methods, let s just build a couple here to get a feel for the patterns used by the CL.</span></span> <span data-ttu-id="3a74c-136">Özellikle, ekleyeceğiz `GetProducts()` ve `GetProductsByCategoryID(categoryID)` adım 3'te yöntemleri ve bir `UpdateProduct` adım 4'te aşırı yükleme.</span><span class="sxs-lookup"><span data-stu-id="3a74c-136">In particular, we'll add the `GetProducts()` and `GetProductsByCategoryID(categoryID)` methods in Step 3 and an `UpdateProduct` overload in Step 4.</span></span> <span data-ttu-id="3a74c-137">Kalan ekleyebilirsiniz `ProductsCL` yöntemleri ve `CategoriesCL`, `EmployeesCL`, ve `SuppliersCL` zamanınızda sınıfları.</span><span class="sxs-lookup"><span data-stu-id="3a74c-137">You can add the remaining `ProductsCL` methods and `CategoriesCL`, `EmployeesCL`, and `SuppliersCL` classes at your leisure.</span></span>

## <a name="step-2-reading-and-writing-to-the-data-cache"></a><span data-ttu-id="3a74c-138">2. adım: Okuma ve veri önbelleğine yazma</span><span class="sxs-lookup"><span data-stu-id="3a74c-138">Step 2: Reading and Writing to the Data Cache</span></span>

<span data-ttu-id="3a74c-139">Önceki öğreticide dahili olarak keşfedilen özellik önbelleğe alma ObjectDataSource ASP.NET veri önbelleği BLL alınan verileri depolamak için kullanır.</span><span class="sxs-lookup"><span data-stu-id="3a74c-139">The ObjectDataSource caching feature explored in the preceding tutorial internally uses the ASP.NET data cache to store the data retrieved from the BLL.</span></span> <span data-ttu-id="3a74c-140">Veri önbelleği de programlı olarak ASP.NET sayfaları arka plan kodu sınıflardan veya web uygulaması s mimarisinde sınıflardan erişilebilir.</span><span class="sxs-lookup"><span data-stu-id="3a74c-140">The data cache can also be accessed programmatically from ASP.NET pages code-behind classes or from the classes in the web application s architecture.</span></span> <span data-ttu-id="3a74c-141">Okumak ve veri önbelleği için ASP.NET sayfası s arka plandaki kod sınıfı yazmak için şu biçimi kullanın:</span><span class="sxs-lookup"><span data-stu-id="3a74c-141">To read and write to the data cache from an ASP.NET page s code-behind class, use the following pattern:</span></span>


[!code-csharp[Main](caching-data-in-the-architecture-cs/samples/sample1.cs)]

<span data-ttu-id="3a74c-142">[ `Cache` Sınıfı](https://msdn.microsoft.com/en-us/library/system.web.caching.cache.aspx) s [ `Insert` yöntemi](https://msdn.microsoft.com/en-us/library/system.web.caching.cache.insert.aspx) aşırı sayısı.</span><span class="sxs-lookup"><span data-stu-id="3a74c-142">The [`Cache` class](https://msdn.microsoft.com/en-us/library/system.web.caching.cache.aspx) s [`Insert` method](https://msdn.microsoft.com/en-us/library/system.web.caching.cache.insert.aspx) has a number of overloads.</span></span> <span data-ttu-id="3a74c-143">`Cache["key"] = value`ve `Cache.Insert(key, value)` eşanlamlıdır ve her ikisi de tanımlı bir süre sonu olmadan belirtilen anahtarı kullanarak önbelleğe bir öğe ekleyin.</span><span class="sxs-lookup"><span data-stu-id="3a74c-143">`Cache["key"] = value` and `Cache.Insert(key, value)` are synonymous and both add an item to the cache using the specified key without a defined expiry.</span></span> <span data-ttu-id="3a74c-144">Genellikle, bir öğe için önbellek, bir bağımlılık, zamana bağlı süre sonu veya her ikisini de olarak eklerken bir süre sonu belirtmek istiyoruz.</span><span class="sxs-lookup"><span data-stu-id="3a74c-144">Typically, we want to specify an expiry when adding an item to the cache, either as a dependency, a time-based expiry, or both.</span></span> <span data-ttu-id="3a74c-145">Diğer birini kullanın `Insert` s yöntemi aşırı bağımlılık veya zamana bağlı süre sonu bilgileri sağlayın.</span><span class="sxs-lookup"><span data-stu-id="3a74c-145">Use one of the other `Insert` method s overloads to provide dependency- or time-based expiry information.</span></span>

<span data-ttu-id="3a74c-146">Önbelleğe alma s yöntemleri istenen veri önbellekte ise ve bu durumda, ilk kontrol etmeniz katman buradan döndür.</span><span class="sxs-lookup"><span data-stu-id="3a74c-146">The Caching Layer s methods need to first check if the requested data is in the cache and, if so, return it from there.</span></span> <span data-ttu-id="3a74c-147">İstenen veri önbellekte değilse, uygun BLL yöntemin çağrılması gerekir.</span><span class="sxs-lookup"><span data-stu-id="3a74c-147">If the requested data is not in the cache, the appropriate BLL method needs to be invoked.</span></span> <span data-ttu-id="3a74c-148">Dönüş değerini önbelleğe ve döndürülen, aşağıdaki dizisi diyagramda gösterildiği gibi.</span><span class="sxs-lookup"><span data-stu-id="3a74c-148">Its return value should be cached and then returned, as the following sequence diagram illustrates.</span></span>


![Önbelleğe alma katman s yöntemleri, bu veri önbellekten döndürür, s kullanılabilir](caching-data-in-the-architecture-cs/_static/image3.png)

<span data-ttu-id="3a74c-150">**Şekil 3**: önbelleğe alma katman s yöntemleri, bu veri önbellekten döndürür, s kullanılabilir</span><span class="sxs-lookup"><span data-stu-id="3a74c-150">**Figure 3**: The Caching Layer s Methods Return Data from the Cache if it s Available</span></span>


<span data-ttu-id="3a74c-151">Şekil 3'te gösterilen dizisi şu biçimi kullanarak CL sınıflarda gerçekleştirilir:</span><span class="sxs-lookup"><span data-stu-id="3a74c-151">The sequence depicted in Figure 3 is accomplished in the CL classes using the following pattern:</span></span>


[!code-csharp[Main](caching-data-in-the-architecture-cs/samples/sample2.cs)]

<span data-ttu-id="3a74c-152">Burada, *türü* önbellekte saklanmasını veri türünde `Northwind.ProductsDataTable`, örneğin *anahtar* önbellek öğesinin benzersiz olarak tanıtan anahtarıdır.</span><span class="sxs-lookup"><span data-stu-id="3a74c-152">Here, *Type* is the type of data being stored in the cache `Northwind.ProductsDataTable`, for example while *key* is the key that uniquely identifies the cache item.</span></span> <span data-ttu-id="3a74c-153">Varsa belirtilen bir öğesiyle *anahtar* önbelleğinde sonra değil *örneği* olacaktır `null` ve verileri uygun BLL yönteminden alınır ve önbelleğe eklenir.</span><span class="sxs-lookup"><span data-stu-id="3a74c-153">If the item with the specified *key* is not in the cache, then *instance* will be `null` and the data will be retrieved from the appropriate BLL method and added to the cache.</span></span> <span data-ttu-id="3a74c-154">Zamana göre `return instance` ulaşıldığında *örneği* veri önbelleğinden ya da bir başvuru içeriyor veya BLL çekilen.</span><span class="sxs-lookup"><span data-stu-id="3a74c-154">By the time `return instance` is reached, *instance* contains a reference to the data, either from the cache or pulled from the BLL.</span></span>

<span data-ttu-id="3a74c-155">Yukarıdaki düzeni önbellekten verilere erişilirken kullandığınızdan emin olun.</span><span class="sxs-lookup"><span data-stu-id="3a74c-155">Be sure to use the above pattern when accessing data from the cache.</span></span> <span data-ttu-id="3a74c-156">İlk bakışta, eşdeğer görünüyor, aşağıdaki deseni bir yarış durumu tanıtan bir fark içerir.</span><span class="sxs-lookup"><span data-stu-id="3a74c-156">The following pattern, which, at first glance, looks equivalent, contains a subtle difference that introduces a race condition.</span></span> <span data-ttu-id="3a74c-157">Yarış durumları, çünkü bunlar kendilerini zaman zaman ortaya ve yeniden oluşturması zor olan hata ayıklama zordur.</span><span class="sxs-lookup"><span data-stu-id="3a74c-157">Race conditions are difficult to debug because they reveal themselves sporadically and are difficult to reproduce.</span></span>


[!code-csharp[Main](caching-data-in-the-architecture-cs/samples/sample3.cs)]

<span data-ttu-id="3a74c-158">Bu ikinci fark, hatalı kod parçacığında, yerine önbelleğe alınan öğe başvuru yerel bir değişkende depolama, veri önbelleği koşullu deyimde doğrudan erişilen *ve* içinde `return`.</span><span class="sxs-lookup"><span data-stu-id="3a74c-158">The difference in this second, incorrect code snippet is that rather than storing a reference to the cached item in a local variable, the data cache is accessed directly in the conditional statement *and* in the `return`.</span></span> <span data-ttu-id="3a74c-159">Bu kod ulaşıldığında, düşünün `Cache["key"]` olan olmayan`null`, ancak önce `return` deyimi ulaşıldığında, sistem çıkarır *anahtar* önbellekten.</span><span class="sxs-lookup"><span data-stu-id="3a74c-159">Imagine that when this code is reached, `Cache["key"]` is non-`null`, but before the `return` statement is reached, the system evicts *key* from the cache.</span></span> <span data-ttu-id="3a74c-160">Bu nadir durumda kodu döndürülecek bir `null` değer yerine beklenen türde bir nesne.</span><span class="sxs-lookup"><span data-stu-id="3a74c-160">In this rare case, the code will return a `null` value rather than an object of the expected type.</span></span>

> [!NOTE]
> <span data-ttu-id="3a74c-161">Veri önbelleği t basit okuma veya yazma işlemleri için iş parçacığı erişimini eşitlemek gerek güncelleştireceğinizi iş parçacığı açısından güvenli olduğundan.</span><span class="sxs-lookup"><span data-stu-id="3a74c-161">The data cache is thread-safe, so you don t need to synchronize thread access for simple reads or writes.</span></span> <span data-ttu-id="3a74c-162">Atomik olmasına gerek önbellekte verileri birden çok işlemleri ihtiyacınız varsa, ancak, siz kilit veya iş parçacığı güvenliği sağlamak için başka bir düzenek uygulamak için sorumlu olursunuz.</span><span class="sxs-lookup"><span data-stu-id="3a74c-162">However, if you need to perform multiple operations on data in the cache that need to be atomic, you are responsible for implementing a lock or some other mechanism to ensure thread safety.</span></span> <span data-ttu-id="3a74c-163">Bkz: [ASP.NET önbelleğe erişim eşitleme](http://www.ddj.com/184406369) daha fazla bilgi için.</span><span class="sxs-lookup"><span data-stu-id="3a74c-163">See [Synchronizing Access to the ASP.NET Cache](http://www.ddj.com/184406369) for more information.</span></span>


<span data-ttu-id="3a74c-164">Bir öğe programlı olarak kullanarak veri önbelleği çıkarılmasına [ `Remove` yöntemi](https://msdn.microsoft.com/en-us/library/system.web.caching.cache.remove.aspx) sözlüğüdür:</span><span class="sxs-lookup"><span data-stu-id="3a74c-164">An item can be programmatically evicted from the data cache using the [`Remove` method](https://msdn.microsoft.com/en-us/library/system.web.caching.cache.remove.aspx) like so:</span></span>


[!code-csharp[Main](caching-data-in-the-architecture-cs/samples/sample4.cs)]

## <a name="step-3-returning-product-information-from-theproductsclclass"></a><span data-ttu-id="3a74c-165">3. adım: Ürün bilgilerini döndürme`ProductsCL`sınıfı</span><span class="sxs-lookup"><span data-stu-id="3a74c-165">Step 3: Returning Product Information from the`ProductsCL`Class</span></span>

<span data-ttu-id="3a74c-166">Bu öğretici ürün bilgileri döndürmek için iki yöntem uygulamak s denetlemesine izin vermek için `ProductsCL` sınıfı: `GetProducts()` ve `GetProductsByCategoryID(categoryID)`.</span><span class="sxs-lookup"><span data-stu-id="3a74c-166">For this tutorial let s implement two methods for returning product information from the `ProductsCL` class: `GetProducts()` and `GetProductsByCategoryID(categoryID)`.</span></span> <span data-ttu-id="3a74c-167">İle gibi `ProductsBL` iş mantığı katmanı sınıfında `GetProducts()` CL yöntemi ürünlerin tamamı hakkında bilgi döndürür bir `Northwind.ProductsDataTable` nesnesi sırada `GetProductsByCategoryID(categoryID)` belirtilen bir kategorideki tüm ürünleri döndürür.</span><span class="sxs-lookup"><span data-stu-id="3a74c-167">Like with the `ProductsBL` class in the Business Logic Layer, the `GetProducts()` method in the CL returns information about all of the products as a `Northwind.ProductsDataTable` object, while `GetProductsByCategoryID(categoryID)` returns all of the products from a specified category.</span></span>

<span data-ttu-id="3a74c-168">Aşağıdaki kod yöntemleri bir kısmı gösterir `ProductsCL` sınıfı:</span><span class="sxs-lookup"><span data-stu-id="3a74c-168">The following code shows a portion of the methods in the `ProductsCL` class:</span></span>


[!code-vb[Main](caching-data-in-the-architecture-cs/samples/sample5.vb)]

<span data-ttu-id="3a74c-169">İlk olarak, Not `DataObject` ve `DataObjectMethodAttribute` sınıfı ve yöntemleri uygulanan öznitelikleri.</span><span class="sxs-lookup"><span data-stu-id="3a74c-169">First, note the `DataObject` and `DataObjectMethodAttribute` attributes applied to the class and methods.</span></span> <span data-ttu-id="3a74c-170">Bu öznitelikler ne sınıflar ve yöntemler Sihirbazı s adımlarda görünmelidir belirten ObjectDataSource s Sihirbazına bilgi sağlar.</span><span class="sxs-lookup"><span data-stu-id="3a74c-170">These attributes provide information to the ObjectDataSource s wizard, indicating what classes and methods should appear in the wizard s steps.</span></span> <span data-ttu-id="3a74c-171">Sunu katmanındaki bir ObjectDataSource gelen CL sınıflar ve yöntemler erişileceği olduğundan, bu öznitelikler tasarım zamanı deneyimini geliştirmek için eklendi.</span><span class="sxs-lookup"><span data-stu-id="3a74c-171">Since the CL classes and methods will be accessed from an ObjectDataSource in the Presentation Layer, I added these attributes to enhance the design-time experience.</span></span> <span data-ttu-id="3a74c-172">Geri başvurmak [bir iş mantığı katmanı oluşturma](../introduction/creating-a-business-logic-layer-cs.md) bu öznitelikler ve etkilerini daha kapsamlı bir açıklama için Öğreticisi.</span><span class="sxs-lookup"><span data-stu-id="3a74c-172">Refer back to the [Creating a Business Logic Layer](../introduction/creating-a-business-logic-layer-cs.md) tutorial for a more thorough description on these attributes and their effects.</span></span>

<span data-ttu-id="3a74c-173">İçinde `GetProducts()` ve `GetProductsByCategoryID(categoryID)` yöntemleri, döndürülen veriler `GetCacheItem(key)` yöntemi, yerel bir değişkene atanır.</span><span class="sxs-lookup"><span data-stu-id="3a74c-173">In the `GetProducts()` and `GetProductsByCategoryID(categoryID)` methods, the data returned from the `GetCacheItem(key)` method is assigned to a local variable.</span></span> <span data-ttu-id="3a74c-174">`GetCacheItem(key)` Size kısa süre içinde inceleyeceğiz, yöntem, belirtilen temel önbelleğinden belirli bir öğe döndürür *anahtar*.</span><span class="sxs-lookup"><span data-stu-id="3a74c-174">The `GetCacheItem(key)` method, which we'll examine shortly, returns a particular item from the cache based on the specified *key*.</span></span> <span data-ttu-id="3a74c-175">Böyle bir veri önbelleği'nde bulunursa, ilgili alınır `ProductsBLL` sınıf yöntemi ve önbellek kullanmaya eklenen `AddCacheItem(key, value)` yöntemi.</span><span class="sxs-lookup"><span data-stu-id="3a74c-175">If no such data is found in cache, it is retrieved from the corresponding `ProductsBLL` class method and then added to the cache using the `AddCacheItem(key, value)` method.</span></span>

<span data-ttu-id="3a74c-176">`GetCacheItem(key)` Ve `AddCacheItem(key, value)` arabirim yöntemleri veri önbelleği, okuma ve yazma değerler, sırasıyla.</span><span class="sxs-lookup"><span data-stu-id="3a74c-176">The `GetCacheItem(key)` and `AddCacheItem(key, value)` methods interface with the data cache, reading and writing values, respectively.</span></span> <span data-ttu-id="3a74c-177">`GetCacheItem(key)` Yöntem basittir iki.</span><span class="sxs-lookup"><span data-stu-id="3a74c-177">The `GetCacheItem(key)` method is the simpler of the two.</span></span> <span data-ttu-id="3a74c-178">Yalnızca geçirilen bileşenini kullanarak önbellek sınıfından değeri döndürür *anahtar*:</span><span class="sxs-lookup"><span data-stu-id="3a74c-178">It simply returns the value from the Cache class using the passed-in *key*:</span></span>


[!code-csharp[Main](caching-data-in-the-architecture-cs/samples/sample6.cs)]

<span data-ttu-id="3a74c-179">`GetCacheItem(key)`kullanmayan *anahtar* değer sağlanan gibi ancak bunun yerine çağrıları `GetCacheKey(key)` döndürür yöntemi *anahtar* $a ProductsCache - ile.</span><span class="sxs-lookup"><span data-stu-id="3a74c-179">`GetCacheItem(key)` does not use *key* value as supplied, but instead calls the `GetCacheKey(key)` method, which returns the *key* prepended with ProductsCache-.</span></span> <span data-ttu-id="3a74c-180">`MasterCacheKeyArray`, ProductsCache, dize tutan de kullanıldığında tarafından `AddCacheItem(key, value)` yöntemi, kısa bir süre içinde anlatıldığı gibi.</span><span class="sxs-lookup"><span data-stu-id="3a74c-180">The `MasterCacheKeyArray`, which holds the string ProductsCache, is also used by the `AddCacheItem(key, value)` method, as we'll see momentarily.</span></span>

<span data-ttu-id="3a74c-181">Bir ASP.NET sayfası s arka plandaki kod sınıfı kullanılarak veri önbelleği erişilebilir `Page` s sınıfı [ `Cache` özelliği](https://msdn.microsoft.com/en-us/library/system.web.ui.page.cache.aspx)ve benzer bir sözdizimi sağlar `Cache["key"] = value`, 2. adımda açıklandığı gibi.</span><span class="sxs-lookup"><span data-stu-id="3a74c-181">From an ASP.NET page s code-behind class, the data cache can be accessed using the `Page` class s [`Cache` property](https://msdn.microsoft.com/en-us/library/system.web.ui.page.cache.aspx), and allows for syntax like `Cache["key"] = value`, as discussed in Step 2.</span></span> <span data-ttu-id="3a74c-182">Öğesinden bir sınıf mimarisi içinde veri önbelleği ya da kullanılarak erişilebilir `HttpRuntime.Cache` veya `HttpContext.Current.Cache`.</span><span class="sxs-lookup"><span data-stu-id="3a74c-182">From a class within the architecture, the data cache can be accessed using either `HttpRuntime.Cache` or `HttpContext.Current.Cache`.</span></span> <span data-ttu-id="3a74c-183">[Peter Johnson](https://weblogs.asp.net/pjohnson/default.aspx)ın blog girdisi [HttpRuntime.Cache vs. HttpContext.Current.Cache](https://weblogs.asp.net/pjohnson/httpruntime-cache-vs-httpcontext-current-cache) kullanarak küçük bir performans avantajı Notlar `HttpRuntime` yerine `HttpContext.Current`; sonuç olarak, `ProductsCL` kullanan `HttpRuntime`.</span><span class="sxs-lookup"><span data-stu-id="3a74c-183">[Peter Johnson](https://weblogs.asp.net/pjohnson/default.aspx)'s blog entry [HttpRuntime.Cache vs. HttpContext.Current.Cache](https://weblogs.asp.net/pjohnson/httpruntime-cache-vs-httpcontext-current-cache) notes the slight performance advantage in using `HttpRuntime` instead of `HttpContext.Current`; consequently, `ProductsCL` uses `HttpRuntime`.</span></span>

> [!NOTE]
> <span data-ttu-id="3a74c-184">Sınıf Kitaplığı projelerinde kullanılarak Mimarinizi uygulanan sonra bir başvuru eklemeniz gerekir `System.Web` kullanmak için derleme [HttpRuntime](https://msdn.microsoft.com/en-us/library/system.web.httpruntime.aspx) ve [HttpContext](https://msdn.microsoft.com/en-us/library/system.web.httpcontext.aspx) sınıfları.</span><span class="sxs-lookup"><span data-stu-id="3a74c-184">If your architecture is implemented using Class Library projects then you will need to add a reference to the `System.Web` assembly in order to use the [HttpRuntime](https://msdn.microsoft.com/en-us/library/system.web.httpruntime.aspx) and [HttpContext](https://msdn.microsoft.com/en-us/library/system.web.httpcontext.aspx) classes.</span></span>


<span data-ttu-id="3a74c-185">Öğe önbellekte bulunmazsa `ProductsCL` s sınıfı yöntemleri BLL Veri Al ve önbelleği kullanmaya eklemek `AddCacheItem(key, value)` yöntemi.</span><span class="sxs-lookup"><span data-stu-id="3a74c-185">If the item is not found in the cache, the `ProductsCL` class s methods get the data from the BLL and add it to the cache using the `AddCacheItem(key, value)` method.</span></span> <span data-ttu-id="3a74c-186">Eklemek için *değeri* önbelleğe biz 60 saniye süre süre sonu kullanan aşağıdaki kodu kullanabilirsiniz:</span><span class="sxs-lookup"><span data-stu-id="3a74c-186">To add *value* to the cache we could use the following code, which uses a 60 second time expiry:</span></span>


[!code-csharp[Main](caching-data-in-the-architecture-cs/samples/sample7.cs)]

<span data-ttu-id="3a74c-187">`DateTime.Now.AddSeconds(CacheDuration)`zamana bağlı süre sonu 60 saniye gelecekteki while belirtir [ `System.Web.Caching.Cache.NoSlidingExpiration` ](https://msdn.microsoft.com/en-us/library/system.web.caching.cache.noslidingexpiration(vs.80).aspx) Kayan süre sonu olmadığını s gösterir.</span><span class="sxs-lookup"><span data-stu-id="3a74c-187">`DateTime.Now.AddSeconds(CacheDuration)` specifies the time-based expiry 60 seconds in the future while [`System.Web.Caching.Cache.NoSlidingExpiration`](https://msdn.microsoft.com/en-us/library/system.web.caching.cache.noslidingexpiration(vs.80).aspx) indicates that there s no sliding expiration.</span></span> <span data-ttu-id="3a74c-188">Bu `Insert` yöntemi aşırı yüklemesini hem bir mutlak parametrelerini giriş ve bitiş kayan, yalnızca iki birini sağlayabilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="3a74c-188">While this `Insert` method overload has input parameters for both an absolute and sliding expiry, you can only provide one of the two.</span></span> <span data-ttu-id="3a74c-189">Mutlak bir zaman ve bir zaman aralığı belirtmek çalışırsanız `Insert` yöntemi oluşturur bir `ArgumentException` özel durum.</span><span class="sxs-lookup"><span data-stu-id="3a74c-189">If you attempt to specify both an absolute time and a time span, the `Insert` method will throw an `ArgumentException` exception.</span></span>

> [!NOTE]
> <span data-ttu-id="3a74c-190">Bu uygulaması, `AddCacheItem(key, value)` yöntemi şu anda bazı eksik yok.</span><span class="sxs-lookup"><span data-stu-id="3a74c-190">This implementation of the `AddCacheItem(key, value)` method currently has some shortcomings.</span></span> <span data-ttu-id="3a74c-191">Biz adres ve adım 4'te bu sorunlarının üstesinden.</span><span class="sxs-lookup"><span data-stu-id="3a74c-191">We'll address and overcome these issues in Step 4.</span></span>


## <a name="step-4-invalidating-the-cache-when-the-data-is-modified-through-the-architecture"></a><span data-ttu-id="3a74c-192">4. adım: önbellek zaman verileri geçersiz kılmalarını değiştiren aracılığıyla mimarisidir</span><span class="sxs-lookup"><span data-stu-id="3a74c-192">Step 4: Invalidating the Cache When the Data is Modified Through the Architecture</span></span>

<span data-ttu-id="3a74c-193">Veri alma yöntemleri yanı sıra, önbelleğe alma katmanı ekleme, güncelleştirme ve verileri silme için aynı yöntemleri BLL olarak sağlaması gerekir.</span><span class="sxs-lookup"><span data-stu-id="3a74c-193">Along with data retrieval methods, the Caching Layer needs to provide the same methods as the BLL for inserting, updating, and deleting data.</span></span> <span data-ttu-id="3a74c-194">CL s veri değişikliği yöntemleri önbelleğe alınmış verileri değiştiremez, ancak yerine BLL s karşılık gelen veri değişikliği yöntemini çağırın ve önbelleği geçersiz kılar.</span><span class="sxs-lookup"><span data-stu-id="3a74c-194">The CL s data modification methods do not modify the cached data, but rather call the BLL s corresponding data modification method and then invalidate the cache.</span></span> <span data-ttu-id="3a74c-195">Önceki öğreticide gördüğümüz gibi ObjectDataSource önbelleğe alma özelliklerini etkinleştirildiğinde uygulayan aynı davranış budur ve kendi `Insert`, `Update`, veya `Delete` yöntemleri çağrılır.</span><span class="sxs-lookup"><span data-stu-id="3a74c-195">As we saw in the preceding tutorial, this is the same behavior that the ObjectDataSource applies when its caching features are enabled and its `Insert`, `Update`, or `Delete` methods are invoked.</span></span>

<span data-ttu-id="3a74c-196">Aşağıdaki `UpdateProduct` aşırı CL veri değişikliği yöntemleri uygulamak nasıl gösterilmektedir:</span><span class="sxs-lookup"><span data-stu-id="3a74c-196">The following `UpdateProduct` overload illustrates how to implement the data modification methods in the CL:</span></span>


[!code-csharp[Main](caching-data-in-the-architecture-cs/samples/sample8.cs)]

<span data-ttu-id="3a74c-197">Uygun veri değişikliği iş mantığı katmanı yöntemi çağrılır, ancak yanıt döndürmeden önce önbellek geçersiz kılmak ihtiyacımız.</span><span class="sxs-lookup"><span data-stu-id="3a74c-197">The appropriate data modification Business Logic Layer method is invoked, but before its response is returned we need to invalidate the cache.</span></span> <span data-ttu-id="3a74c-198">Ne yazık ki, önbellek geçersiz kılmalarını açık olduğundan değil `ProductsCL` s sınıfı `GetProducts()` ve `GetProductsByCategoryID(categoryID)` yöntemleri her öğe Ekle önbelleğe farklı anahtarlara ve `GetProductsByCategoryID(categoryID)` yöntemi her biri için farklı önbellek öğesi ekler benzersiz *adlı kullanıcı, Categoryıd'si*.</span><span class="sxs-lookup"><span data-stu-id="3a74c-198">Unfortunately, invalidating the cache is not straightforward because the `ProductsCL` class s `GetProducts()` and `GetProductsByCategoryID(categoryID)` methods each add items to the cache with different keys, and the `GetProductsByCategoryID(categoryID)` method adds a different cache item for each unique *categoryID*.</span></span>

<span data-ttu-id="3a74c-199">Önbellek geçersiz kılınması, kaldırmak ihtiyacımız *tüm* tarafından eklenmemiş olabilir öğelerin `ProductsCL` sınıfı.</span><span class="sxs-lookup"><span data-stu-id="3a74c-199">When invalidating the cache, we need to remove *all* of the items that may have been added by the `ProductsCL` class.</span></span> <span data-ttu-id="3a74c-200">Bu ilişkilendirerek gerçekleştirilebilir bir *önbelleğe bağımlılık* önbelleğe eklenen her öğeyle `AddCacheItem(key, value)` yöntemi.</span><span class="sxs-lookup"><span data-stu-id="3a74c-200">This can be accomplished by associating a *cache dependency* with the each item added to the cache in the `AddCacheItem(key, value)` method.</span></span> <span data-ttu-id="3a74c-201">Genel olarak, bir önbellek bağımlılığı önbelleği, dosya sistemi veya bir Microsoft SQL Server veritabanındaki verileri bir dosyaya başka bir öğe olabilir.</span><span class="sxs-lookup"><span data-stu-id="3a74c-201">In general, a cache dependency can be another item in the cache, a file on the file system, or data from a Microsoft SQL Server database.</span></span> <span data-ttu-id="3a74c-202">Olduğunda bağımlılık değiştirir veya önbellekten kaldırıldı, ilişkili olduğu önbellek öğeleri otomatik olarak önbellekten çıkarılmasına.</span><span class="sxs-lookup"><span data-stu-id="3a74c-202">When the dependency changes or is removed from the cache, the cache items it is associated with are automatically evicted from the cache.</span></span> <span data-ttu-id="3a74c-203">Bu öğretici için tüm öğeleri için önbellek bağımlılık aracılığıyla eklenen, hizmet önbelleğinde ek öğe oluşturma istiyoruz `ProductsCL` sınıfı.</span><span class="sxs-lookup"><span data-stu-id="3a74c-203">For this tutorial, we want to create an additional item in the cache that serves as a cache dependency for all items added through the `ProductsCL` class.</span></span> <span data-ttu-id="3a74c-204">Böylece, bu öğelerin tümünü önbellekten önbellek bağımlılığını kaldırarak kaldırılabilir.</span><span class="sxs-lookup"><span data-stu-id="3a74c-204">That way, all of these items can be removed from the cache by simply removing the cache dependency.</span></span>

<span data-ttu-id="3a74c-205">Let s güncelleştirme `AddCacheItem(key, value)` yöntemi bu yöntemle önbelleğe eklenen her öğe, böylelikle tek önbellek bağımlılığı ile ilişkili:</span><span class="sxs-lookup"><span data-stu-id="3a74c-205">Let s update the `AddCacheItem(key, value)` method so that each item added to the cache through this method is associated with a single cache dependency:</span></span>


[!code-csharp[Main](caching-data-in-the-architecture-cs/samples/sample9.cs)]

<span data-ttu-id="3a74c-206">`MasterCacheKeyArray`ProductsCache tek bir değer içeren bir dize dizisidir.</span><span class="sxs-lookup"><span data-stu-id="3a74c-206">`MasterCacheKeyArray` is a string array that holds a single value, ProductsCache.</span></span> <span data-ttu-id="3a74c-207">İlk olarak, bir önbellek öğesi önbelleğe eklenir ve geçerli tarih ve saat atandı.</span><span class="sxs-lookup"><span data-stu-id="3a74c-207">First, a cache item is added to the cache and assigned the current date and time.</span></span> <span data-ttu-id="3a74c-208">Önbellek öğesi zaten varsa, güncelleştirilir.</span><span class="sxs-lookup"><span data-stu-id="3a74c-208">If the cache item already exists, it is updated.</span></span> <span data-ttu-id="3a74c-209">Ardından, önbellek bağımlılığı oluşturulur.</span><span class="sxs-lookup"><span data-stu-id="3a74c-209">Next, a cache dependency is created.</span></span> <span data-ttu-id="3a74c-210">[ `CacheDependency` Sınıfı](https://msdn.microsoft.com/en-US/library/system.web.caching.cachedependency(VS.80).aspx) s kurucusunun aşırı sayısı, ancak burada kullanılan bir iki bekliyor `string` dizi girdi.</span><span class="sxs-lookup"><span data-stu-id="3a74c-210">The [`CacheDependency` class](https://msdn.microsoft.com/en-US/library/system.web.caching.cachedependency(VS.80).aspx) s constructor has a number of overloads, but the one being used in here expects two `string` array inputs.</span></span> <span data-ttu-id="3a74c-211">Birinci bağımlılıklar olarak kullanılacak dosya kümesini belirtir.</span><span class="sxs-lookup"><span data-stu-id="3a74c-211">The first one specifies the set of files to be used as dependencies.</span></span> <span data-ttu-id="3a74c-212">Biz güncelleştireceğinizi beri t değeri herhangi dosya tabanlı bağımlılıkları, kullanmak istediğiniz `null` ilk giriş parametresi için kullanılır.</span><span class="sxs-lookup"><span data-stu-id="3a74c-212">Since we don t want to use any file-based dependencies, a value of `null` is used for the first input parameter.</span></span> <span data-ttu-id="3a74c-213">İkinci giriş parametresi bağımlılıklar olarak kullanmak için önbellek anahtarlarını belirtir.</span><span class="sxs-lookup"><span data-stu-id="3a74c-213">The second input parameter specifies the set of cache keys to use as dependencies.</span></span> <span data-ttu-id="3a74c-214">Bizim tek bağımlılık burada belirttiğimiz `MasterCacheKeyArray`.</span><span class="sxs-lookup"><span data-stu-id="3a74c-214">Here we specify our single dependency, `MasterCacheKeyArray`.</span></span> <span data-ttu-id="3a74c-215">`CacheDependency` Daha sonra içine geçirilir `Insert` yöntemi.</span><span class="sxs-lookup"><span data-stu-id="3a74c-215">The `CacheDependency` is then passed into the `Insert` method.</span></span>

<span data-ttu-id="3a74c-216">Bu değişikliği ile `AddCacheItem(key, value)`, invaliding bağımlılığın kaldırılması olarak basit bir önbelleğidir.</span><span class="sxs-lookup"><span data-stu-id="3a74c-216">With this modification to `AddCacheItem(key, value)`, invaliding the cache is as simple as removing the dependency.</span></span>


[!code-csharp[Main](caching-data-in-the-architecture-cs/samples/sample10.cs)]

## <a name="step-5-calling-the-caching-layer-from-the-presentation-layer"></a><span data-ttu-id="3a74c-217">5. adım: önbelleğe alma katman sunu katmanı çağırma</span><span class="sxs-lookup"><span data-stu-id="3a74c-217">Step 5: Calling the Caching Layer from the Presentation Layer</span></span>

<span data-ttu-id="3a74c-218">Önbelleğe alma katman s sınıflar ve yöntemler çalışmaya teknikler kullanılarak verilerle Biz bu öğreticileri incelenmesi ve kullanılabilir.</span><span class="sxs-lookup"><span data-stu-id="3a74c-218">The Caching Layer s classes and methods can be used to work with data using the techniques we ve examined throughout these tutorials.</span></span> <span data-ttu-id="3a74c-219">Önbelleğe alınan verilerle çalışmak göstermek için yaptığınız değişiklikleri kaydetmek `ProductsCL` sınıfı ve ardından açın `FromTheArchitecture.aspx` sayfasındaki `Caching` klasörü ve GridView ekleyin.</span><span class="sxs-lookup"><span data-stu-id="3a74c-219">To illustrate working with cached data, save your changes to the `ProductsCL` class and then open the `FromTheArchitecture.aspx` page in the `Caching` folder and add a GridView.</span></span> <span data-ttu-id="3a74c-220">GridView s akıllı etiketten yeni ObjectDataSource oluşturun.</span><span class="sxs-lookup"><span data-stu-id="3a74c-220">From the GridView s smart tag, create a new ObjectDataSource.</span></span> <span data-ttu-id="3a74c-221">Sihirbaz s ilk adımda görmelisiniz `ProductsCL` sınıf açılır liste seçeneklerinden biri olarak.</span><span class="sxs-lookup"><span data-stu-id="3a74c-221">In the wizard s first step you should see the `ProductsCL` class as one of the options from the drop-down list.</span></span>


<span data-ttu-id="3a74c-222">[![ProductsCL sınıfı iş nesnesi aşağı açılan listesinde yer](caching-data-in-the-architecture-cs/_static/image5.png)](caching-data-in-the-architecture-cs/_static/image4.png)</span><span class="sxs-lookup"><span data-stu-id="3a74c-222">[![The ProductsCL Class is Included in the Business Object Drop-Down List](caching-data-in-the-architecture-cs/_static/image5.png)](caching-data-in-the-architecture-cs/_static/image4.png)</span></span>

<span data-ttu-id="3a74c-223">**Şekil 4**: `ProductsCL` sınıfı iş nesnesi aşağı açılan listesinde dahil ([tam boyutlu görüntüyü görüntülemek için tıklatın](caching-data-in-the-architecture-cs/_static/image6.png))</span><span class="sxs-lookup"><span data-stu-id="3a74c-223">**Figure 4**: The `ProductsCL` Class is Included in the Business Object Drop-Down List ([Click to view full-size image](caching-data-in-the-architecture-cs/_static/image6.png))</span></span>


<span data-ttu-id="3a74c-224">Seçtikten sonra `ProductsCL`, İleri'yi tıklatın.</span><span class="sxs-lookup"><span data-stu-id="3a74c-224">After selecting `ProductsCL`, click Next.</span></span> <span data-ttu-id="3a74c-225">SELECT sekmesi açılır listede iki öğe - sahip `GetProducts()` ve `GetProductsByCategoryID(categoryID)` ve güncelleştirme sekmesi yalnızca `UpdateProduct` aşırı yükleme.</span><span class="sxs-lookup"><span data-stu-id="3a74c-225">The drop-down list in the SELECT tab has two items - `GetProducts()` and `GetProductsByCategoryID(categoryID)` and the UPDATE tab has the sole `UpdateProduct` overload.</span></span> <span data-ttu-id="3a74c-226">Seçin `GetProducts()` yöntemi seçme sekmesinden ve `UpdateProducts` tıklatın ve güncelleştirme sekmesini yönteminden son.</span><span class="sxs-lookup"><span data-stu-id="3a74c-226">Choose the `GetProducts()` method from the SELECT tab and the `UpdateProducts` method from the UPDATE tab and click Finish.</span></span>


<span data-ttu-id="3a74c-227">[![S ProductsCL sınıfı yöntemleri aşağı açılan listeler içinde listelenir](caching-data-in-the-architecture-cs/_static/image8.png)](caching-data-in-the-architecture-cs/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="3a74c-227">[![The ProductsCL Class s Methods are Listed in the Drop-Down Lists](caching-data-in-the-architecture-cs/_static/image8.png)](caching-data-in-the-architecture-cs/_static/image7.png)</span></span>

<span data-ttu-id="3a74c-228">**Şekil 5**: `ProductsCL` s sınıfı yöntemleri, aşağı açılan listeler içinde listelenen ([tam boyutlu görüntüyü görüntülemek için tıklatın](caching-data-in-the-architecture-cs/_static/image9.png))</span><span class="sxs-lookup"><span data-stu-id="3a74c-228">**Figure 5**: The `ProductsCL` Class s Methods are Listed in the Drop-Down Lists ([Click to view full-size image](caching-data-in-the-architecture-cs/_static/image9.png))</span></span>


<span data-ttu-id="3a74c-229">Sihirbazı tamamladıktan sonra Visual Studio ObjectDataSource s ayarlayacaktır `OldValuesParameterFormatString` özelliğine `original_{0}` ve GridView uygun alanları ekleyin.</span><span class="sxs-lookup"><span data-stu-id="3a74c-229">After completing the wizard, Visual Studio will set the ObjectDataSource s `OldValuesParameterFormatString` property to `original_{0}` and add the appropriate fields to the GridView.</span></span> <span data-ttu-id="3a74c-230">Değişiklik `OldValuesParameterFormatString` varsayılan değerini geri özelliğine `{0}`ve disk belleği, sıralama ve düzenleme desteklemek için GridView yapılandırın.</span><span class="sxs-lookup"><span data-stu-id="3a74c-230">Change the `OldValuesParameterFormatString` property back to its default value, `{0}`, and configure the GridView to support paging, sorting, and editing.</span></span> <span data-ttu-id="3a74c-231">Bu yana `UploadProducts` CL tarafından kullanılan aşırı kabul yalnızca s düzenlenen ürün adı ve fiyat, böylece yalnızca bu alanlar düzenlenebilir GridView sınırlandırın.</span><span class="sxs-lookup"><span data-stu-id="3a74c-231">Since the `UploadProducts` overload used by the CL accepts only the edited product s name and price, limit the GridView so that only these fields are editable.</span></span>

<span data-ttu-id="3a74c-232">Önceki öğreticide için alanları içerecek şekilde GridView tanımladığımız `ProductName`, `CategoryName`, ve `UnitPrice` alanları.</span><span class="sxs-lookup"><span data-stu-id="3a74c-232">In the preceding tutorial we defined a GridView to include fields for the `ProductName`, `CategoryName`, and `UnitPrice` fields.</span></span> <span data-ttu-id="3a74c-233">Bu biçimlendirme ve yapı çoğaltmak çekinmeyin, GridView ve ObjectDataSource s bildirim temelli durumda biçimlendirme aşağıdakine benzer görünmelidir:</span><span class="sxs-lookup"><span data-stu-id="3a74c-233">Feel free to replicate this formatting and structure, in which case your GridView and ObjectDataSource s declarative markup should look similar to the following:</span></span>


[!code-aspx[Main](caching-data-in-the-architecture-cs/samples/sample11.aspx)]

<span data-ttu-id="3a74c-234">Bu noktada önbelleğe alma katmanı kullanan bir sayfa vardır.</span><span class="sxs-lookup"><span data-stu-id="3a74c-234">At this point we have a page that uses the Caching Layer.</span></span> <span data-ttu-id="3a74c-235">Eylem önbelleğinde görmek için kümesinde kesme noktaları `ProductsCL` s sınıfı `GetProducts()` ve `UpdateProduct` yöntemleri.</span><span class="sxs-lookup"><span data-stu-id="3a74c-235">To see the cache in action, set breakpoints in the `ProductsCL` class s `GetProducts()` and `UpdateProduct` methods.</span></span> <span data-ttu-id="3a74c-236">Sıralama ve verileri görmek için disk belleği önbellekten çekilen, tarayıcı ve kod aracılığıyla adım sayfasını ziyaret edin.</span><span class="sxs-lookup"><span data-stu-id="3a74c-236">Visit the page in a browser and step through the code when sorting and paging in order to see the data pulled from the cache.</span></span> <span data-ttu-id="3a74c-237">Bir kaydı güncelleştirmeye sonra Not önbellekte geçersiz kılınan ve sonuç olarak, verileri GridView DataSet'e olduğunda, BLL alınır.</span><span class="sxs-lookup"><span data-stu-id="3a74c-237">Then update a record and note that the cache is invalidated and, consequently, it is retrieved from the BLL when the data is rebound to the GridView.</span></span>

> [!NOTE]
> <span data-ttu-id="3a74c-238">Bu makalede eşlik indirme sağlanan önbelleğe alma katmanı tam değil.</span><span class="sxs-lookup"><span data-stu-id="3a74c-238">The Caching Layer provided in the download accompanying this article is not complete.</span></span> <span data-ttu-id="3a74c-239">Yalnızca bir sınıf içerir `ProductsCL`, hangi yalnızca Spor yöntemleri sayıda.</span><span class="sxs-lookup"><span data-stu-id="3a74c-239">It contains only one class, `ProductsCL`, which only sports a handful of methods.</span></span> <span data-ttu-id="3a74c-240">Ayrıca, yalnızca bir ASP.NET sayfası CL kullanır (`~/Caching/FromTheArchitecture.aspx`) diğerlerini hala BLL doğrudan başvurun.</span><span class="sxs-lookup"><span data-stu-id="3a74c-240">Moreover, only a single ASP.NET page uses the CL (`~/Caching/FromTheArchitecture.aspx`) all others still reference the BLL directly.</span></span> <span data-ttu-id="3a74c-241">Uygulamanızda bir CL kullanmayı planlıyorsanız, bu sınıfları ve sunu katmanı tarafından kullanılmakta BLL yöntemleri yöntemlerini ele ve sunu katmanı gelen tüm çağrıları CL s sınıfları, gerektirecek CL tamamlamalıdır.</span><span class="sxs-lookup"><span data-stu-id="3a74c-241">If you plan on using a CL in your application, all calls from the Presentation Layer should go to the CL, which would require that the CL s classes and methods covered those classes and methods in the BLL currently used by the Presentation Layer.</span></span>


## <a name="summary"></a><span data-ttu-id="3a74c-242">Özet</span><span class="sxs-lookup"><span data-stu-id="3a74c-242">Summary</span></span>

<span data-ttu-id="3a74c-243">Önbelleğe alma ASP.NET 2.0 s SqlDataSource sunu katmanı ve ObjectDataSource denetimleri uygulanabilir olsa da, ideal olarak sorumlulukları önbelleğe alma mimarisi ayrı bir katmana temsilci.</span><span class="sxs-lookup"><span data-stu-id="3a74c-243">While caching can be applied at the Presentation Layer with ASP.NET 2.0 s SqlDataSource and ObjectDataSource controls, ideally caching responsibilities would be delegated to a separate layer in the architecture.</span></span> <span data-ttu-id="3a74c-244">Bu öğreticide bir önbelleğe alma sunu katmanı ve iş mantığı katmanı arasında duran katman oluşturduk.</span><span class="sxs-lookup"><span data-stu-id="3a74c-244">In this tutorial we created a Caching Layer that resides between the Presentation Layer and the Business Logic Layer.</span></span> <span data-ttu-id="3a74c-245">Önbelleğe alma katman sınıfları ve BLL var ve sunu katmanı adlı yöntemleri aynı kümesi sağlaması gerekir.</span><span class="sxs-lookup"><span data-stu-id="3a74c-245">The Caching Layer needs to provide the same set of classes and methods that exist in the BLL and are called from the Presentation Layer.</span></span>

<span data-ttu-id="3a74c-246">Biz keşfedilen bu ve önceki öğreticileri önbelleğe alma katman örnekleri sergilenen *reaktif yükleme*.</span><span class="sxs-lookup"><span data-stu-id="3a74c-246">The Caching Layer examples we explored in this and the preceding tutorials exhibited *reactive loading*.</span></span> <span data-ttu-id="3a74c-247">Geriye dönük yükleme ile veriler yalnızca veriler için bir istek yapıldığında ve bu verileri önbellekten eksik önbelleğine yüklenir.</span><span class="sxs-lookup"><span data-stu-id="3a74c-247">With reactive loading, the data is loaded into the cache only when a request for the data is made and that data is missing from the cache.</span></span> <span data-ttu-id="3a74c-248">Verileri de olabilir *önceden yüklenen* önbelleğine bir teknik, yükler verileri önbelleğe gerçekten gerekli önce.</span><span class="sxs-lookup"><span data-stu-id="3a74c-248">Data can also be *proactively loaded* into the cache, a technique that loads the data into the cache before it is actually needed.</span></span> <span data-ttu-id="3a74c-249">Sonraki öğreticide bir örnek uygulama başlangıcında önbelleğine statik değerlerini depolamak nasıl ele zaman öngörülü yüklenirken göreceğiz.</span><span class="sxs-lookup"><span data-stu-id="3a74c-249">In the next tutorial we'll see an example of proactive loading when we look at how to store static values into the cache at application startup.</span></span>

<span data-ttu-id="3a74c-250">Mutluluk programlama!</span><span class="sxs-lookup"><span data-stu-id="3a74c-250">Happy Programming!</span></span>

## <a name="about-the-author"></a><span data-ttu-id="3a74c-251">Yazar hakkında</span><span class="sxs-lookup"><span data-stu-id="3a74c-251">About the Author</span></span>

<span data-ttu-id="3a74c-252">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), yazar ve yedi ASP/ASP.NET books kurucusu, [4GuysFromRolla.com](http://www.4guysfromrolla.com), Microsoft Web teknolojileri ile bu yana 1998 çalışma.</span><span class="sxs-lookup"><span data-stu-id="3a74c-252">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), author of seven ASP/ASP.NET books and founder of [4GuysFromRolla.com](http://www.4guysfromrolla.com), has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="3a74c-253">Tan bağımsız Danışman, eğitmen ve yazıcı çalışır.</span><span class="sxs-lookup"><span data-stu-id="3a74c-253">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="3a74c-254">En son kendi defteri [ *kendi öğretmek kendiniz ASP.NET 2.0 24 saat içindeki*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span><span class="sxs-lookup"><span data-stu-id="3a74c-254">His latest book is [*Sams Teach Yourself ASP.NET 2.0 in 24 Hours*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span></span> <span data-ttu-id="3a74c-255">Kendisi üzerinde erişilebilir [ mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com) veya kendi blog hangi adresinde bulunabilir [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span><span class="sxs-lookup"><span data-stu-id="3a74c-255">He can be reached at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com) or via his blog, which can be found at [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span></span>

## <a name="special-thanks-to"></a><span data-ttu-id="3a74c-256">Özel teşekkürler</span><span class="sxs-lookup"><span data-stu-id="3a74c-256">Special Thanks To</span></span>

<span data-ttu-id="3a74c-257">Bu öğretici seri pek çok yararlı gözden geçirenler tarafından gözden geçirildi.</span><span class="sxs-lookup"><span data-stu-id="3a74c-257">This tutorial series was reviewed by many helpful reviewers.</span></span> <span data-ttu-id="3a74c-258">Bu öğretici için sağlama İnceleme Teresa Murph oluştu.</span><span class="sxs-lookup"><span data-stu-id="3a74c-258">Lead reviewer for this tutorial was Teresa Murph.</span></span> <span data-ttu-id="3a74c-259">My yaklaşan MSDN makaleleri gözden geçirme ilginizi çekiyor mu?</span><span class="sxs-lookup"><span data-stu-id="3a74c-259">Interested in reviewing my upcoming MSDN articles?</span></span> <span data-ttu-id="3a74c-260">Öyleyse, bana bir satırında bırakma [ mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="3a74c-260">If so, drop me a line at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span>

>[!div class="step-by-step"]
<span data-ttu-id="3a74c-261">[Önceki](caching-data-with-the-objectdatasource-cs.md)
[sonraki](caching-data-at-application-startup-cs.md)</span><span class="sxs-lookup"><span data-stu-id="3a74c-261">[Previous](caching-data-with-the-objectdatasource-cs.md)
[Next](caching-data-at-application-startup-cs.md)</span></span>
