---
title: ASP.NET Core Azure anahtar kasası yapılandırma sağlayıcısı
author: guardrex
description: Çalışma zamanında yüklenen ad-değer çiftleri kullanarak bir uygulamayı yapılandırmak için Azure anahtar kasası yapılandırma Sağlayıcısı'nı kullanmayı öğrenin.
manager: wpickett
ms.author: riande
ms.date: 08/09/2017
ms.prod: asp.net-core
ms.topic: article
uid: security/key-vault-configuration
ms.openlocfilehash: 78a00e04e260863af17d7888ca6bf77d3f915ce1
ms.sourcegitcommit: 5130b3034165f5cf49d829fe7475a84aa33d2693
ms.translationtype: MT
ms.contentlocale: tr-TR
ms.lasthandoff: 05/03/2018
---
# <a name="azure-key-vault-configuration-provider-in-aspnet-core"></a><span data-ttu-id="ea46e-103">ASP.NET Core Azure anahtar kasası yapılandırma sağlayıcısı</span><span class="sxs-lookup"><span data-stu-id="ea46e-103">Azure Key Vault configuration provider in ASP.NET Core</span></span>

<span data-ttu-id="ea46e-104">Tarafından [Luke Latham](https://github.com/guardrex) ve [Barış Stanton-Nurse](https://github.com/anurse)</span><span class="sxs-lookup"><span data-stu-id="ea46e-104">By [Luke Latham](https://github.com/guardrex) and [Andrew Stanton-Nurse](https://github.com/anurse)</span></span>

# <a name="aspnet-core-2xtabaspnetcore2x"></a>[<span data-ttu-id="ea46e-105">ASP.NET Core 2.x</span><span class="sxs-lookup"><span data-stu-id="ea46e-105">ASP.NET Core 2.x</span></span>](#tab/aspnetcore2x)

<span data-ttu-id="ea46e-106">Görüntülemek veya karşıdan 2.x için örnek kod:</span><span class="sxs-lookup"><span data-stu-id="ea46e-106">View or download sample code for 2.x:</span></span>

* <span data-ttu-id="ea46e-107">[Temel örnek](https://github.com/aspnet/Docs/tree/master/aspnetcore/security/key-vault-configuration/samples/basic-sample/2.x) ([nasıl indirileceğini](xref:tutorials/index#how-to-download-a-sample))-gizli değerleri uygulamaya okur.</span><span class="sxs-lookup"><span data-stu-id="ea46e-107">[Basic sample](https://github.com/aspnet/Docs/tree/master/aspnetcore/security/key-vault-configuration/samples/basic-sample/2.x) ([how to download](xref:tutorials/index#how-to-download-a-sample)) - Reads secret values into an app.</span></span>
* <span data-ttu-id="ea46e-108">[Anahtar adı öneki örnek](https://github.com/aspnet/Docs/tree/master/aspnetcore/security/key-vault-configuration/samples/key-name-prefix-sample/2.x) ([nasıl indirileceğini](xref:tutorials/index#how-to-download-a-sample)) - gizli değerleri her uygulama sürümü için farklı bir kümesini yüklemek izin veren bir uygulamanın sürümünü temsil eden bir anahtar adı ön ekini kullanarak gizli değerleri okur.</span><span class="sxs-lookup"><span data-stu-id="ea46e-108">[Key name prefix sample](https://github.com/aspnet/Docs/tree/master/aspnetcore/security/key-vault-configuration/samples/key-name-prefix-sample/2.x) ([how to download](xref:tutorials/index#how-to-download-a-sample)) - Reads secret values using a key name prefix that represents the version of an app, which allows you to load a different set of secret values for each app version.</span></span>

# <a name="aspnet-core-1xtabaspnetcore1x"></a>[<span data-ttu-id="ea46e-109">ASP.NET Core 1.x</span><span class="sxs-lookup"><span data-stu-id="ea46e-109">ASP.NET Core 1.x</span></span>](#tab/aspnetcore1x)

<span data-ttu-id="ea46e-110">Görüntülemek veya karşıdan 1.x için örnek kod:</span><span class="sxs-lookup"><span data-stu-id="ea46e-110">View or download sample code for 1.x:</span></span>

* <span data-ttu-id="ea46e-111">[Temel örnek](https://github.com/aspnet/Docs/tree/master/aspnetcore/security/key-vault-configuration/samples/basic-sample/1.x) ([nasıl indirileceğini](xref:tutorials/index#how-to-download-a-sample))-gizli değerleri uygulamaya okur.</span><span class="sxs-lookup"><span data-stu-id="ea46e-111">[Basic sample](https://github.com/aspnet/Docs/tree/master/aspnetcore/security/key-vault-configuration/samples/basic-sample/1.x) ([how to download](xref:tutorials/index#how-to-download-a-sample)) - Reads secret values into an app.</span></span>
* <span data-ttu-id="ea46e-112">[Anahtar adı öneki örnek](https://github.com/aspnet/Docs/tree/master/aspnetcore/security/key-vault-configuration/samples/key-name-prefix-sample/1.x) ([nasıl indirileceğini](xref:tutorials/index#how-to-download-a-sample)) - gizli değerleri her uygulama sürümü için farklı bir kümesini yüklemek izin veren bir uygulamanın sürümünü temsil eden bir anahtar adı ön ekini kullanarak gizli değerleri okur.</span><span class="sxs-lookup"><span data-stu-id="ea46e-112">[Key name prefix sample](https://github.com/aspnet/Docs/tree/master/aspnetcore/security/key-vault-configuration/samples/key-name-prefix-sample/1.x) ([how to download](xref:tutorials/index#how-to-download-a-sample)) - Reads secret values using a key name prefix that represents the version of an app, which allows you to load a different set of secret values for each app version.</span></span> 

---

<span data-ttu-id="ea46e-113">Bu belge nasıl kullanılacağını açıklamaktadır [Microsoft Azure anahtar kasası](https://azure.microsoft.com/services/key-vault/) Azure anahtar kasası gizli uygulama yapılandırma değerlerini yüklemek için yapılandırma sağlayıcısı.</span><span class="sxs-lookup"><span data-stu-id="ea46e-113">This document explains how to use the [Microsoft Azure Key Vault](https://azure.microsoft.com/services/key-vault/) configuration provider to load application configuration values from Azure Key Vault secrets.</span></span> <span data-ttu-id="ea46e-114">Azure anahtar kasası, şifreleme anahtarları ve gizli anahtarları uygulamalar ve hizmetler tarafından kullanılan korumaya yardımcı olan bir bulut tabanlı bir hizmettir.</span><span class="sxs-lookup"><span data-stu-id="ea46e-114">Azure Key Vault is a cloud-based service that helps you safeguard cryptographic keys and secrets used by apps and services.</span></span> <span data-ttu-id="ea46e-115">Önemli yapılandırma verilerine erişimi denetleme yaygın senaryolar içerir ve FIPS 140-2 gereksinimini toplantı Düzey 2 donanım güvenlik modülleri (HSM's) yapılandırma verileri depolarken doğrulanabilir.</span><span class="sxs-lookup"><span data-stu-id="ea46e-115">Common scenarios include controlling access to sensitive configuration data and meeting the requirement for FIPS 140-2 Level 2 validated Hardware Security Modules (HSM's) when storing configuration data.</span></span> <span data-ttu-id="ea46e-116">Bu özellik, daha yüksek veya ASP.NET Core 1.1 hedefleyen uygulamalar için kullanılabilir.</span><span class="sxs-lookup"><span data-stu-id="ea46e-116">This feature is available for applications that target ASP.NET Core 1.1 or higher.</span></span>

## <a name="package"></a><span data-ttu-id="ea46e-117">Paket</span><span class="sxs-lookup"><span data-stu-id="ea46e-117">Package</span></span>
<span data-ttu-id="ea46e-118">Sağlayıcı kullanmak için bir başvuru ekleyin [Microsoft.Extensions.Configuration.AzureKeyVault](https://www.nuget.org/packages/Microsoft.Extensions.Configuration.AzureKeyVault/) paket.</span><span class="sxs-lookup"><span data-stu-id="ea46e-118">To use the provider, add a reference to the [Microsoft.Extensions.Configuration.AzureKeyVault](https://www.nuget.org/packages/Microsoft.Extensions.Configuration.AzureKeyVault/) package.</span></span>

## <a name="application-configuration"></a><span data-ttu-id="ea46e-119">Uygulama yapılandırması</span><span class="sxs-lookup"><span data-stu-id="ea46e-119">Application configuration</span></span>
<span data-ttu-id="ea46e-120">Sağlayıcı ile keşfedebilirsiniz [örnek uygulamaları](https://github.com/aspnet/Docs/tree/master/aspnetcore/security/key-vault-configuration/samples).</span><span class="sxs-lookup"><span data-stu-id="ea46e-120">You can explore the provider with the [sample apps](https://github.com/aspnet/Docs/tree/master/aspnetcore/security/key-vault-configuration/samples).</span></span> <span data-ttu-id="ea46e-121">Bir anahtar kasası oluşturmak ve kasasına gizli anahtarları oluşturmak sonra örnek uygulamaları güvenli bir şekilde gizli değerlerini yapılandırmalarına yüklemek ve Web sayfalarındaki görüntüleme.</span><span class="sxs-lookup"><span data-stu-id="ea46e-121">Once you establish a key vault and create secrets in the vault, the sample apps securely load the secret values into their configurations and display them in webpages.</span></span>

<span data-ttu-id="ea46e-122">Sağlayıcı eklenen `ConfigurationBuilder` ile `AddAzureKeyVault` uzantısı.</span><span class="sxs-lookup"><span data-stu-id="ea46e-122">The provider is added to the `ConfigurationBuilder` with the `AddAzureKeyVault` extension.</span></span> <span data-ttu-id="ea46e-123">Örnek uygulamaları uzantısı gelen yüklenen üç yapılandırma değerlerini kullanır. *appsettings.json* dosya.</span><span class="sxs-lookup"><span data-stu-id="ea46e-123">In the sample apps, the extension uses three configuration values loaded from the *appsettings.json* file.</span></span>

| <span data-ttu-id="ea46e-124">Uygulama ayarı</span><span class="sxs-lookup"><span data-stu-id="ea46e-124">App Setting</span></span>    | <span data-ttu-id="ea46e-125">Açıklama</span><span class="sxs-lookup"><span data-stu-id="ea46e-125">Description</span></span>                    | <span data-ttu-id="ea46e-126">Örnek</span><span class="sxs-lookup"><span data-stu-id="ea46e-126">Example</span></span>                                      |
| -------------- | ------------------------------ | -------------------------------------------- |
| `Vault`        | <span data-ttu-id="ea46e-127">Azure anahtar kasası adı</span><span class="sxs-lookup"><span data-stu-id="ea46e-127">Azure Key Vault name</span></span>           | <span data-ttu-id="ea46e-128">contosovault</span><span class="sxs-lookup"><span data-stu-id="ea46e-128">contosovault</span></span>                                 |
| `ClientId`     | <span data-ttu-id="ea46e-129">Azure Active Directory Uygulama Kimliği</span><span class="sxs-lookup"><span data-stu-id="ea46e-129">Azure Active Directory App Id</span></span>  | <span data-ttu-id="ea46e-130">627e911e-43cc-61d4-992e-12db9c81b413</span><span class="sxs-lookup"><span data-stu-id="ea46e-130">627e911e-43cc-61d4-992e-12db9c81b413</span></span>         |
| `ClientSecret` | <span data-ttu-id="ea46e-131">Azure Active Directory Uygulama anahtarı</span><span class="sxs-lookup"><span data-stu-id="ea46e-131">Azure Active Directory App Key</span></span> | <span data-ttu-id="ea46e-132">g58K3dtg59o1Pa + e59v2Tx829w6VxTB2yv9sv/101di =</span><span class="sxs-lookup"><span data-stu-id="ea46e-132">g58K3dtg59o1Pa+e59v2Tx829w6VxTB2yv9sv/101di=</span></span> |

[!code-csharp[Program](key-vault-configuration/samples/basic-sample/2.x/Program.cs?name=snippet1&highlight=2,7-10)]

## <a name="creating-key-vault-secrets-and-loading-configuration-values-basic-sample"></a><span data-ttu-id="ea46e-133">Anahtar kasasına gizli anahtarları oluşturma ve yapılandırma değerlerini (basic örnek) yükleme</span><span class="sxs-lookup"><span data-stu-id="ea46e-133">Creating key vault secrets and loading configuration values (basic-sample)</span></span>
1. <span data-ttu-id="ea46e-134">Bir anahtar kasası oluşturun ve yer alan yönergeleri izleyerek uygulama için Azure Active Directory'yi (Azure AD) ayarlama ayarlayın [Azure anahtar kasası ile çalışmaya başlama](https://azure.microsoft.com/documentation/articles/key-vault-get-started/).</span><span class="sxs-lookup"><span data-stu-id="ea46e-134">Create a key vault and set up Azure Active Directory (Azure AD) for the application following the guidance in [Get started with Azure Key Vault](https://azure.microsoft.com/documentation/articles/key-vault-get-started/).</span></span>
   * <span data-ttu-id="ea46e-135">Gizli anahtar kasası kullanmaya eklemek [AzureRM anahtar kasası PowerShell Modülü](/powershell/module/azurerm.keyvault) kullanılabilir [PowerShell Galerisi](https://www.powershellgallery.com/packages/AzureRM.KeyVault), [Azure anahtar kasası REST API](/rest/api/keyvault/), veya [Azure Portal](https://portal.azure.com/).</span><span class="sxs-lookup"><span data-stu-id="ea46e-135">Add secrets to the key vault using the [AzureRM Key Vault PowerShell Module](/powershell/module/azurerm.keyvault) available from the [PowerShell Gallery](https://www.powershellgallery.com/packages/AzureRM.KeyVault), the [Azure Key Vault REST API](/rest/api/keyvault/), or the [Azure Portal](https://portal.azure.com/).</span></span> <span data-ttu-id="ea46e-136">Gizli ya da oluşturulan *el ile* veya *sertifika* gizli.</span><span class="sxs-lookup"><span data-stu-id="ea46e-136">Secrets are created as either *Manual* or *Certificate* secrets.</span></span> <span data-ttu-id="ea46e-137">*Sertifika* gizli uygulamalar ve hizmetler tarafından kullanılması için sertifikalar ancak yapılandırma sağlayıcısı tarafından desteklenmiyor.</span><span class="sxs-lookup"><span data-stu-id="ea46e-137">*Certificate* secrets are certificates for use by apps and services but are not supported by the configuration provider.</span></span> <span data-ttu-id="ea46e-138">Kullanmanız gereken *el ile* yapılandırma sağlayıcısı ile kullanmak için ad-değer çifti parolaları oluşturmak için seçeneği.</span><span class="sxs-lookup"><span data-stu-id="ea46e-138">You should use the *Manual* option to create name-value pair secrets for use with the configuration provider.</span></span>
     * <span data-ttu-id="ea46e-139">Basit gizli ad-değer çiftleri olarak oluşturulur.</span><span class="sxs-lookup"><span data-stu-id="ea46e-139">Simple secrets are created as name-value pairs.</span></span> <span data-ttu-id="ea46e-140">Azure anahtar kasası gizli adların, alfasayısal karakterler ve tire sınırlıdır.</span><span class="sxs-lookup"><span data-stu-id="ea46e-140">Azure Key Vault secret names are limited to alphanumeric characters and dashes.</span></span>
     * <span data-ttu-id="ea46e-141">Hiyerarşik değerleri (yapılandırma bölümlerinin) kullanmak `--` (iki kısa çizgi) örnek ayırıcı olarak.</span><span class="sxs-lookup"><span data-stu-id="ea46e-141">Hierarchical values (configuration sections) use `--` (two dashes) as a separator in the sample.</span></span> <span data-ttu-id="ea46e-142">Normalde bir alt anahtarda bölümünden sınırlandırmak için kullanılan iki nokta üst üste, [ASP.NET Core yapılandırma](xref:fundamentals/configuration/index), gizli adlarında izin verilmez.</span><span class="sxs-lookup"><span data-stu-id="ea46e-142">Colons, which are normally used to delimit a section from a subkey in [ASP.NET Core configuration](xref:fundamentals/configuration/index), aren't allowed in secret names.</span></span> <span data-ttu-id="ea46e-143">Bu nedenle, iki kısa çizgi kullanılan ve gizli anahtarları uygulamanın yapılandırma yüklendiğinde bir iki nokta üst üste takas.</span><span class="sxs-lookup"><span data-stu-id="ea46e-143">Therefore, two dashes are used and swapped for a colon when the secrets are loaded into the app's configuration.</span></span>
     * <span data-ttu-id="ea46e-144">İki oluşturmak *el ile* aşağıdaki ad-değer çiftleri ile gizli.</span><span class="sxs-lookup"><span data-stu-id="ea46e-144">Create two *Manual* secrets with the following name-value pairs.</span></span> <span data-ttu-id="ea46e-145">İlk gizli bir basit bir ad ve değer olmadığından ve ikinci gizli bir bölüm ve alt gizli adında gizli bir değer oluşturur:</span><span class="sxs-lookup"><span data-stu-id="ea46e-145">The first secret is a simple name and value, and the second secret creates a secret value with a section and subkey in the secret name:</span></span>
       * <span data-ttu-id="ea46e-146">`SecretName`: `secret_value_1`</span><span class="sxs-lookup"><span data-stu-id="ea46e-146">`SecretName`: `secret_value_1`</span></span>
       * <span data-ttu-id="ea46e-147">`Section--SecretName`: `secret_value_2`</span><span class="sxs-lookup"><span data-stu-id="ea46e-147">`Section--SecretName`: `secret_value_2`</span></span>
   * <span data-ttu-id="ea46e-148">Örnek uygulamayı Azure Active Directory ile kaydedin.</span><span class="sxs-lookup"><span data-stu-id="ea46e-148">Register the sample app with Azure Active Directory.</span></span>
   * <span data-ttu-id="ea46e-149">Anahtar kasası erişmek için uygulamasını yetkilendirin.</span><span class="sxs-lookup"><span data-stu-id="ea46e-149">Authorize the app to access the key vault.</span></span> <span data-ttu-id="ea46e-150">Kullandığınızda `Set-AzureRmKeyVaultAccessPolicy` anahtar kasası erişmek için uygulamasını yetkilendirmek için PowerShell cmdlet sağlamak `List` ve `Get` gizli ile erişimi `-PermissionsToSecrets list,get`.</span><span class="sxs-lookup"><span data-stu-id="ea46e-150">When you use the `Set-AzureRmKeyVaultAccessPolicy` PowerShell cmdlet to authorize the app to access the key vault, provide `List` and `Get` access to secrets with `-PermissionsToSecrets list,get`.</span></span>

2. <span data-ttu-id="ea46e-151">Uygulamanın güncelleştirme *appsettings.json* değerlerini dosyasıyla `Vault`, `ClientId`, ve `ClientSecret`.</span><span class="sxs-lookup"><span data-stu-id="ea46e-151">Update the app's *appsettings.json* file with the values of `Vault`, `ClientId`, and `ClientSecret`.</span></span>
3. <span data-ttu-id="ea46e-152">Kendi yapılandırma değerlerini alır örnek uygulamayı çalıştırma `IConfigurationRoot` gizli adıyla aynı ada sahip.</span><span class="sxs-lookup"><span data-stu-id="ea46e-152">Run the sample app, which obtains its configuration values from `IConfigurationRoot` with the same name as the secret name.</span></span>
   * <span data-ttu-id="ea46e-153">Hiyerarşik olmayan değerleri: değeri `SecretName` ile elde `config["SecretName"]`.</span><span class="sxs-lookup"><span data-stu-id="ea46e-153">Non-hierarchical values: The value for `SecretName` is obtained with `config["SecretName"]`.</span></span>
   * <span data-ttu-id="ea46e-154">Hiyerarşik değerleri (bölümler): kullanım `:` (iki nokta üst üste) gösterimi veya `GetSection` genişletme yöntemi.</span><span class="sxs-lookup"><span data-stu-id="ea46e-154">Hierarchical values (sections): Use `:` (colon) notation or the `GetSection` extension method.</span></span> <span data-ttu-id="ea46e-155">Yapılandırma değeri elde etmek için Bu yaklaşımlardan birini kullanın:</span><span class="sxs-lookup"><span data-stu-id="ea46e-155">Use either of these approaches to obtain the configuration value:</span></span>
     * `config["Section:SecretName"]`
     * `config.GetSection("Section")["SecretName"]`

<span data-ttu-id="ea46e-156">Uygulamayı çalıştırdığınızda, bir Web sayfası yüklenen gizli değerleri gösterir:</span><span class="sxs-lookup"><span data-stu-id="ea46e-156">When you run the app, a webpage shows the loaded secret values:</span></span>

![Azure anahtar kasası yapılandırma sağlayıcısı aracılığıyla yüklenen gizli değerleri gösteren bir tarayıcı penceresi](key-vault-configuration/_static/sample1.png)

## <a name="creating-prefixed-key-vault-secrets-and-loading-configuration-values-key-name-prefix-sample"></a><span data-ttu-id="ea46e-158">Önekli anahtar kasasına gizli anahtarları oluşturma ve yapılandırma değerlerini (anahtar-adı-önek-sample) yükleme</span><span class="sxs-lookup"><span data-stu-id="ea46e-158">Creating prefixed key vault secrets and loading configuration values (key-name-prefix-sample)</span></span>
<span data-ttu-id="ea46e-159">`AddAzureKeyVault` Ayrıca uygulaması kabul eden bir aşırı sağlar `IKeyVaultSecretManager`, nasıl anahtar kasasına gizli anahtarları denetlemenize olanak sağlayan yapılandırma anahtarlara dönüştürülür.</span><span class="sxs-lookup"><span data-stu-id="ea46e-159">`AddAzureKeyVault` also provides an overload that accepts an implementation of `IKeyVaultSecretManager`, which allows you to control how key vault secrets are converted into configuration keys.</span></span> <span data-ttu-id="ea46e-160">Örneğin, uygulama başlatma sırasında sağladığınız bir önek değere göre gizli değerlerini yüklemek için arabirimi uygulayabilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="ea46e-160">For example, you can implement the interface to load secret values based on a prefix value you provide at app startup.</span></span> <span data-ttu-id="ea46e-161">Bu, örneğin, uygulama sürümüne gizli yüklemek için sağlar.</span><span class="sxs-lookup"><span data-stu-id="ea46e-161">This allows you, for example, to load secrets based on the version of the app.</span></span>

> [!WARNING]
> <span data-ttu-id="ea46e-162">Önekleri anahtar kasası parolaları parolaları birden fazla uygulama için aynı anahtar kasasını yerleştirmek için veya çevre gizli yerleştirmek üzere kullanma (örneğin, *geliştirme* karşı *üretim* gizli) aynı içine Kasa.</span><span class="sxs-lookup"><span data-stu-id="ea46e-162">Don't use prefixes on key vault secrets to place secrets for multiple apps into the same key vault or to place environmental secrets (for example, *development* versus *production* secrets) into the same vault.</span></span> <span data-ttu-id="ea46e-163">Farklı uygulamalar ve geliştirme/üretim ortamlarında ayrı anahtar kasalarını uygulama ortamları için yüksek düzeyde güvenlik yalıtmak için kullanmanızı öneririz.</span><span class="sxs-lookup"><span data-stu-id="ea46e-163">We recommend that different apps and development/production environments use separate key vaults to isolate app environments for the highest level of security.</span></span>

<span data-ttu-id="ea46e-164">İkinci örnek uygulaması kullanarak, bir gizli anahtar kasası için oluşturduğunuz `5000-AppSecret` (anahtar kasası gizli adlarında nokta izin verilmiyor) temsil eden 5.0.0.0 sürümü, uygulamanız için bir uygulama gizli anahtarı.</span><span class="sxs-lookup"><span data-stu-id="ea46e-164">Using the second sample app, you create a secret in the key vault for `5000-AppSecret` (periods aren't allowed in key vault secret names) representing an app secret for version 5.0.0.0 of your app.</span></span> <span data-ttu-id="ea46e-165">Başka bir sürümü için 5.1.0.0, için gizli anahtar oluşturma `5100-AppSecret`.</span><span class="sxs-lookup"><span data-stu-id="ea46e-165">For another version, 5.1.0.0, you create a secret for `5100-AppSecret`.</span></span> <span data-ttu-id="ea46e-166">Her uygulamanın sürüm yapılandırmasıyla gizli değerini yükler `AppSecret`, çıkarma sürümü gizli yüklerken.</span><span class="sxs-lookup"><span data-stu-id="ea46e-166">Each app version loads its own secret value into its configuration as `AppSecret`, stripping off the version as it loads the secret.</span></span> <span data-ttu-id="ea46e-167">Örnek 's uygulama aşağıda gösterilmiştir:</span><span class="sxs-lookup"><span data-stu-id="ea46e-167">The sample's implementation is shown below:</span></span>

[!code-csharp[Configuration builder](key-vault-configuration/samples/key-name-prefix-sample/2.x/Program.cs?name=snippet1&highlight=12)]

[!code-csharp[PrefixKeyVaultSecretManager](key-vault-configuration/samples/key-name-prefix-sample/2.x/Startup.cs?name=snippet1)]

<span data-ttu-id="ea46e-168">`Load` Yöntemi sürüm önekine sahip olanları bulmak için kasa gizli tekrarlanan bir sağlayıcı algoritması tarafından çağrılır.</span><span class="sxs-lookup"><span data-stu-id="ea46e-168">The `Load` method is called by a provider algorithm that iterates through the vault secrets to find the ones that have the version prefix.</span></span> <span data-ttu-id="ea46e-169">Ne zaman bir sürüm önek bulundu ile `Load`, algoritma `GetKey` gizli yapılandırma adı döndürülecek yöntemi.</span><span class="sxs-lookup"><span data-stu-id="ea46e-169">When a version prefix is found with `Load`, the algorithm uses the `GetKey` method to return the configuration name of the secret name.</span></span> <span data-ttu-id="ea46e-170">Parolanın ad sürüm önekten kapalı kaldırır ve yüklenmesi için gizli anahtar adı kalan ad-değer çiftleri uygulamanın yapılandırma döndürür.</span><span class="sxs-lookup"><span data-stu-id="ea46e-170">It strips off the version prefix from the secret's name and returns the rest of the secret name for loading into the app's configuration name-value pairs.</span></span>

<span data-ttu-id="ea46e-171">Ne zaman bu yaklaşımı uygulayın:</span><span class="sxs-lookup"><span data-stu-id="ea46e-171">When you implement this approach:</span></span>

1. <span data-ttu-id="ea46e-172">Anahtar kasasına gizli anahtarları yüklenir.</span><span class="sxs-lookup"><span data-stu-id="ea46e-172">The key vault secrets are loaded.</span></span>
2. <span data-ttu-id="ea46e-173">Dize gizliliğini `5000-AppSecret` eşleştirilir.</span><span class="sxs-lookup"><span data-stu-id="ea46e-173">The string secret for `5000-AppSecret` is matched.</span></span>
3. <span data-ttu-id="ea46e-174">Sürüm `5000` (tireyle), bırakarak anahtar adı dışına yapılandırıldıktan `AppSecret` gizli değerle uygulamanın yapılandırma yüklenemedi.</span><span class="sxs-lookup"><span data-stu-id="ea46e-174">The version, `5000` (with the dash), is stripped off of the key name leaving `AppSecret` to load with the secret value into the app's configuration.</span></span>

> [!NOTE]
> <span data-ttu-id="ea46e-175">Ayrıca kendi sağlayabilirsiniz `KeyVaultClient` uygulamasına `AddAzureKeyVault`.</span><span class="sxs-lookup"><span data-stu-id="ea46e-175">You can also provide your own `KeyVaultClient` implementation to `AddAzureKeyVault`.</span></span> <span data-ttu-id="ea46e-176">Özel bir istemci sağladığını istemci yapılandırma sağlayıcısı ve uygulamanızdaki diğer bölümleri arasında tek bir örneğini paylaşmanıza olanak tanır.</span><span class="sxs-lookup"><span data-stu-id="ea46e-176">Supplying a custom client allows you to share a single instance of the client between the configuration provider and other parts of your app.</span></span>

1. <span data-ttu-id="ea46e-177">Bir anahtar kasası oluşturun ve yer alan yönergeleri izleyerek uygulama için Azure Active Directory'yi (Azure AD) ayarlama ayarlayın [Azure anahtar kasası ile çalışmaya başlama](https://azure.microsoft.com/documentation/articles/key-vault-get-started/).</span><span class="sxs-lookup"><span data-stu-id="ea46e-177">Create a key vault and set up Azure Active Directory (Azure AD) for the application following the guidance in [Get started with Azure Key Vault](https://azure.microsoft.com/documentation/articles/key-vault-get-started/).</span></span>
   * <span data-ttu-id="ea46e-178">Gizli anahtar kasası kullanmaya eklemek [AzureRM anahtar kasası PowerShell Modülü](/powershell/module/azurerm.keyvault) kullanılabilir [PowerShell Galerisi](https://www.powershellgallery.com/packages/AzureRM.KeyVault), [Azure anahtar kasası REST API](/rest/api/keyvault/), veya [Azure Portal](https://portal.azure.com/).</span><span class="sxs-lookup"><span data-stu-id="ea46e-178">Add secrets to the key vault using the [AzureRM Key Vault PowerShell Module](/powershell/module/azurerm.keyvault) available from the [PowerShell Gallery](https://www.powershellgallery.com/packages/AzureRM.KeyVault), the [Azure Key Vault REST API](/rest/api/keyvault/), or the [Azure Portal](https://portal.azure.com/).</span></span> <span data-ttu-id="ea46e-179">Gizli ya da oluşturulan *el ile* veya *sertifika* gizli.</span><span class="sxs-lookup"><span data-stu-id="ea46e-179">Secrets are created as either *Manual* or *Certificate* secrets.</span></span> <span data-ttu-id="ea46e-180">*Sertifika* gizli uygulamalar ve hizmetler tarafından kullanılması için sertifikalar ancak yapılandırma sağlayıcısı tarafından desteklenmiyor.</span><span class="sxs-lookup"><span data-stu-id="ea46e-180">*Certificate* secrets are certificates for use by apps and services but are not supported by the configuration provider.</span></span> <span data-ttu-id="ea46e-181">Kullanmanız gereken *el ile* yapılandırma sağlayıcısı ile kullanmak için ad-değer çifti parolaları oluşturmak için seçeneği.</span><span class="sxs-lookup"><span data-stu-id="ea46e-181">You should use the *Manual* option to create name-value pair secrets for use with the configuration provider.</span></span>
     * <span data-ttu-id="ea46e-182">Hiyerarşik değerleri (yapılandırma bölümlerinin) kullanmak `--` (iki kısa çizgi) ayırıcı olarak.</span><span class="sxs-lookup"><span data-stu-id="ea46e-182">Hierarchical values (configuration sections) use `--` (two dashes) as a separator.</span></span>
     * <span data-ttu-id="ea46e-183">İki oluşturmak *el ile* parolaları aşağıdaki ad-değer çiftleri ile:</span><span class="sxs-lookup"><span data-stu-id="ea46e-183">Create two *Manual* secrets with the following name-value pairs:</span></span>
       * <span data-ttu-id="ea46e-184">`5000-AppSecret`: `5.0.0.0_secret_value`</span><span class="sxs-lookup"><span data-stu-id="ea46e-184">`5000-AppSecret`: `5.0.0.0_secret_value`</span></span>
       * <span data-ttu-id="ea46e-185">`5100-AppSecret`: `5.1.0.0_secret_value`</span><span class="sxs-lookup"><span data-stu-id="ea46e-185">`5100-AppSecret`: `5.1.0.0_secret_value`</span></span>
   * <span data-ttu-id="ea46e-186">Örnek uygulamayı Azure Active Directory ile kaydedin.</span><span class="sxs-lookup"><span data-stu-id="ea46e-186">Register the sample app with Azure Active Directory.</span></span>
   * <span data-ttu-id="ea46e-187">Anahtar kasası erişmek için uygulamasını yetkilendirin.</span><span class="sxs-lookup"><span data-stu-id="ea46e-187">Authorize the app to access the key vault.</span></span> <span data-ttu-id="ea46e-188">Kullandığınızda `Set-AzureRmKeyVaultAccessPolicy` anahtar kasası erişmek için uygulamasını yetkilendirmek için PowerShell cmdlet sağlamak `List` ve `Get` gizli ile erişimi `-PermissionsToSecrets list,get`.</span><span class="sxs-lookup"><span data-stu-id="ea46e-188">When you use the `Set-AzureRmKeyVaultAccessPolicy` PowerShell cmdlet to authorize the app to access the key vault, provide `List` and `Get` access to secrets with `-PermissionsToSecrets list,get`.</span></span>

2. <span data-ttu-id="ea46e-189">Uygulamanın güncelleştirme *appsettings.json* değerlerini dosyasıyla `Vault`, `ClientId`, ve `ClientSecret`.</span><span class="sxs-lookup"><span data-stu-id="ea46e-189">Update the app's *appsettings.json* file with the values of `Vault`, `ClientId`, and `ClientSecret`.</span></span>
3. <span data-ttu-id="ea46e-190">Kendi yapılandırma değerlerini alır örnek uygulamayı çalıştırma `IConfigurationRoot` ile aynı adı taşıyan önekli gizli.</span><span class="sxs-lookup"><span data-stu-id="ea46e-190">Run the sample app, which obtains its configuration values from `IConfigurationRoot` with the same name as the prefixed secret name.</span></span> <span data-ttu-id="ea46e-191">Bu örnekte, için sağlanan uygulamanın sürüm önektir `PrefixKeyVaultSecretManager` Azure anahtar kasası yapılandırma sağlayıcısı eklediğiniz zaman.</span><span class="sxs-lookup"><span data-stu-id="ea46e-191">In this sample, the prefix is the app's version, which you provided to the `PrefixKeyVaultSecretManager` when you added the Azure Key Vault configuration provider.</span></span> <span data-ttu-id="ea46e-192">Değeri `AppSecret` ile elde `config["AppSecret"]`.</span><span class="sxs-lookup"><span data-stu-id="ea46e-192">The value for `AppSecret` is obtained with `config["AppSecret"]`.</span></span> <span data-ttu-id="ea46e-193">Uygulama tarafından oluşturulan Web sayfası yüklenen değer gösterir:</span><span class="sxs-lookup"><span data-stu-id="ea46e-193">The webpage generated by the app shows the loaded value:</span></span>

   ![Uygulamanın sürüm 5.0.0.0 olduğunda Azure anahtar kasası yapılandırma sağlayıcısı aracılığıyla yüklenen gizli bir değer gösteren bir tarayıcı penceresi](key-vault-configuration/_static/sample2-1.png)

4. <span data-ttu-id="ea46e-195">Proje dosyasından uygulama derlemede sürümünü değiştirmek `5.0.0.0` için `5.1.0.0` ve uygulamayı yeniden çalıştırın.</span><span class="sxs-lookup"><span data-stu-id="ea46e-195">Change the version of the app assembly in the project file from `5.0.0.0` to `5.1.0.0` and run the app again.</span></span> <span data-ttu-id="ea46e-196">Bu süre, döndürülen gizli değerdir `5.1.0.0_secret_value`.</span><span class="sxs-lookup"><span data-stu-id="ea46e-196">This time, the secret value returned is `5.1.0.0_secret_value`.</span></span> <span data-ttu-id="ea46e-197">Uygulama tarafından oluşturulan Web sayfası yüklenen değer gösterir:</span><span class="sxs-lookup"><span data-stu-id="ea46e-197">The webpage generated by the app shows the loaded value:</span></span>

   ![Uygulamanın sürüm 5.1.0.0 olduğunda Azure anahtar kasası yapılandırma sağlayıcısı aracılığıyla yüklenen gizli bir değer gösteren bir tarayıcı penceresi](key-vault-configuration/_static/sample2-2.png)

## <a name="controlling-access-to-the-clientsecret"></a><span data-ttu-id="ea46e-199">ClientSecret erişimi denetleme</span><span class="sxs-lookup"><span data-stu-id="ea46e-199">Controlling access to the ClientSecret</span></span>
<span data-ttu-id="ea46e-200">Kullanım [gizli Yöneticisi aracını](xref:security/app-secrets) korumak için `ClientSecret` proje kaynak ağacı dışında.</span><span class="sxs-lookup"><span data-stu-id="ea46e-200">Use the [Secret Manager tool](xref:security/app-secrets) to maintain the `ClientSecret` outside of your project source tree.</span></span> <span data-ttu-id="ea46e-201">Uygulama parolaları belirli bir proje ile ilişkilendirmek ve birden çok projeler arasında paylaşmak gizli Manager'la.</span><span class="sxs-lookup"><span data-stu-id="ea46e-201">With Secret Manager, you associate app secrets with a specific project and share them across multiple projects.</span></span>

<span data-ttu-id="ea46e-202">Sertifikaları destekleyen bir ortamda bir .NET Framework uygulama geliştirirken, Azure anahtar Kasası'na bir X.509 sertifikası ile doğrulanabilir.</span><span class="sxs-lookup"><span data-stu-id="ea46e-202">When developing a .NET Framework app in an environment that supports certificates, you can authenticate to Azure Key Vault with an X.509 certificate.</span></span> <span data-ttu-id="ea46e-203">X.509 sertifikasının özel anahtarı işletim sistemi tarafından yönetilir.</span><span class="sxs-lookup"><span data-stu-id="ea46e-203">The X.509 certificate's private key is managed by the OS.</span></span> <span data-ttu-id="ea46e-204">Daha fazla bilgi için bkz: [istemci parolası yerine bir sertifika ile kimlik doğrulama](https://docs.microsoft.com/azure/key-vault/key-vault-use-from-web-application#authenticate-with-a-certificate-instead-of-a-client-secret).</span><span class="sxs-lookup"><span data-stu-id="ea46e-204">For more information, see [Authenticate with a Certificate instead of a Client Secret](https://docs.microsoft.com/azure/key-vault/key-vault-use-from-web-application#authenticate-with-a-certificate-instead-of-a-client-secret).</span></span> <span data-ttu-id="ea46e-205">Kullanım `AddAzureKeyVault` kabul aşırı bir `X509Certificate2`.</span><span class="sxs-lookup"><span data-stu-id="ea46e-205">Use the `AddAzureKeyVault` overload that accepts an `X509Certificate2`.</span></span>

```csharp
var store = new X509Store(StoreLocation.CurrentUser);
store.Open(OpenFlags.ReadOnly);
var cert = store.Certificates.Find(X509FindType.FindByThumbprint, config["CertificateThumbprint"], false);

builder.AddAzureKeyVault(
    config["Vault"],
    config["ClientId"],
    cert.OfType<X509Certificate2>().Single(),
    new EnvironmentSecretManager(env.ApplicationName));
store.Close();

Configuration = builder.Build();
```

## <a name="reloading-secrets"></a><span data-ttu-id="ea46e-206">Parolaları yeniden yükleniyor</span><span class="sxs-lookup"><span data-stu-id="ea46e-206">Reloading secrets</span></span>
<span data-ttu-id="ea46e-207">Parolaları önbelleğe kadar `IConfigurationRoot.Reload()` olarak adlandırılır.</span><span class="sxs-lookup"><span data-stu-id="ea46e-207">Secrets are cached until `IConfigurationRoot.Reload()` is called.</span></span> <span data-ttu-id="ea46e-208">Süresi doldu, devre dışı bırakıldı ve güncelleştirilmiş gizli anahtar kasasında değil kadar uygulama tarafından dikkate `Reload` yürütülür.</span><span class="sxs-lookup"><span data-stu-id="ea46e-208">Expired, disabled, and updated secrets in the key vault are not respected by the application until `Reload` is executed.</span></span>

```csharp
Configuration.Reload();
```

## <a name="disabled-and-expired-secrets"></a><span data-ttu-id="ea46e-209">Devre dışı bırakılmış ve süresi dolan gizli</span><span class="sxs-lookup"><span data-stu-id="ea46e-209">Disabled and expired secrets</span></span>
<span data-ttu-id="ea46e-210">Devre dışı bırakılmış ve süresi dolan gizli throw bir `KeyVaultClientException`.</span><span class="sxs-lookup"><span data-stu-id="ea46e-210">Disabled and expired secrets throw a `KeyVaultClientException`.</span></span> <span data-ttu-id="ea46e-211">Uygulamanızı atma gelen önlemek için uygulamanızı değiştirmek veya devre dışı bırakılmış/süresi dolmuş gizli güncelleştirin.</span><span class="sxs-lookup"><span data-stu-id="ea46e-211">To prevent your app from throwing, replace your app or update the disabled/expired secret.</span></span>

## <a name="troubleshooting"></a><span data-ttu-id="ea46e-212">Sorun giderme</span><span class="sxs-lookup"><span data-stu-id="ea46e-212">Troubleshooting</span></span>
<span data-ttu-id="ea46e-213">Yapılandırma Sağlayıcısı'nı kullanarak yüklemek uygulama başarısız olduğunda bir hata iletisi yazılır [ASP.NET oturum altyapı](xref:fundamentals/logging/index).</span><span class="sxs-lookup"><span data-stu-id="ea46e-213">When the application fails to load configuration using the provider, an error message is written to the [ASP.NET Logging infrastructure](xref:fundamentals/logging/index).</span></span> <span data-ttu-id="ea46e-214">Aşağıdaki koşullar yapılandırma yüklenmesini engeller:</span><span class="sxs-lookup"><span data-stu-id="ea46e-214">The following conditions will prevent configuration from loading:</span></span>
* <span data-ttu-id="ea46e-215">Uygulama Azure Active Directory'de doğru yapılandırılmamış.</span><span class="sxs-lookup"><span data-stu-id="ea46e-215">The app isn't configured correctly in Azure Active Directory.</span></span>
* <span data-ttu-id="ea46e-216">Anahtar kasası Azure anahtar kasası yok.</span><span class="sxs-lookup"><span data-stu-id="ea46e-216">The key vault doesn't exist in Azure Key Vault.</span></span>
* <span data-ttu-id="ea46e-217">Uygulama anahtar kasası erişmek için yetkili değil.</span><span class="sxs-lookup"><span data-stu-id="ea46e-217">The app isn't authorized to access the key vault.</span></span>
* <span data-ttu-id="ea46e-218">Erişim İlkesi içermeyen `Get` ve `List` izinleri.</span><span class="sxs-lookup"><span data-stu-id="ea46e-218">The access policy doesn't include `Get` and `List` permissions.</span></span>
* <span data-ttu-id="ea46e-219">Anahtar kasasına yapılandırma verileri (ad-değer çifti) yanlış, eksik, devre dışı ya da süresi dolmuş olarak adlandırılır.</span><span class="sxs-lookup"><span data-stu-id="ea46e-219">In the key vault, the configuration data (name-value pair) is incorrectly named, missing, disabled, or expired.</span></span>
* <span data-ttu-id="ea46e-220">Uygulama yanlış anahtar kasasının adına sahip (`Vault`), Azure AD uygulama kimliği (`ClientId`), ya da Azure AD anahtarı (`ClientSecret`).</span><span class="sxs-lookup"><span data-stu-id="ea46e-220">The app has the wrong key vault name (`Vault`), Azure AD App Id (`ClientId`), or Azure AD Key (`ClientSecret`).</span></span>
* <span data-ttu-id="ea46e-221">Azure AD anahtarı (`ClientSecret`) süresi doldu.</span><span class="sxs-lookup"><span data-stu-id="ea46e-221">The Azure AD Key (`ClientSecret`) is expired.</span></span>
* <span data-ttu-id="ea46e-222">Yapılandırma anahtarı (ad) uygulama yüklemeye çalıştığınız değer için geçersiz.</span><span class="sxs-lookup"><span data-stu-id="ea46e-222">The configuration key (name) is incorrect in the app for the value you're trying to load.</span></span>

## <a name="additional-resources"></a><span data-ttu-id="ea46e-223">Ek kaynaklar</span><span class="sxs-lookup"><span data-stu-id="ea46e-223">Additional resources</span></span>
* [<span data-ttu-id="ea46e-224">Yapılandırma</span><span class="sxs-lookup"><span data-stu-id="ea46e-224">Configuration</span></span>](xref:fundamentals/configuration/index)
* [<span data-ttu-id="ea46e-225">Microsoft Azure: Anahtar kasası</span><span class="sxs-lookup"><span data-stu-id="ea46e-225">Microsoft Azure: Key Vault</span></span>](https://azure.microsoft.com/services/key-vault/)
* [<span data-ttu-id="ea46e-226">Microsoft Azure: Anahtar kasası belgeleri</span><span class="sxs-lookup"><span data-stu-id="ea46e-226">Microsoft Azure: Key Vault Documentation</span></span>](https://docs.microsoft.com/azure/key-vault/)
* [<span data-ttu-id="ea46e-227">Azure anahtar kasası için nasıl oluşturma ve aktarma HSM korumalı anahtarları</span><span class="sxs-lookup"><span data-stu-id="ea46e-227">How to generate and transfer HSM-protected keys for Azure Key Vault</span></span>](https://docs.microsoft.com/azure/key-vault/key-vault-hsm-protected-keys)
* [<span data-ttu-id="ea46e-228">KeyVaultClient sınıfı</span><span class="sxs-lookup"><span data-stu-id="ea46e-228">KeyVaultClient Class</span></span>](/dotnet/api/microsoft.azure.keyvault.keyvaultclient)
